# Makefile for world and support programs for Amiga
#
# Compiled with Manx 3.4a
#
# The program has been tested and compiles and runs properly on the
# following systems:
# 
# 1)  VAX/VMS Digital CC compiler. No particular tricks are needed.
# 2)  IBM PC-AT Xenix 1.00. It eems to be necessary to use the large
#     memory model, although I'm not sure why since it runs on the
#     same machine under DOS in the small model.
# 3)  IBM PC under Microsoft C version 4.00. It works in the default
#     small memory model if you compile with the -Os switch. Note
#     that on this setup you MUST link the main program World with
#     binmode.obj, provided by Microsoft, for it to work right.
#     Vtxtcn and vcnvrt must NOT be lined with binmode.obj.
#     This compiler generates a few harmless warning messages.
#     You may need to use EXEMOD to increase the stack size.
# 4)  VAX/4.3bsd Unix. No particular tricks needed.
#
# NOTE: Edit helper.c to adjust the pathname for q1text.dat for
# your particular system.
#

WHEADERS = arrays.h variab.h
WOBJS = demons.o helper.o motion.o parser.o verbs1.o verbs2.o world.o wbstuff.o
CSRC = demons.c helper.c motion.c parser.c verbs1.c verbs2.c world.c wbstuff.c
LNFLAGS = -o world -lm -lc
CFLAGS = +fi -DAMIGA
DEST = dh0:rec/world


all:	world


$(WOBJS): $(WHEADERS) convert


vtext.dat:
	join vtext.dat.aa vtext.dat.ab vtext.dat.ac AS vtext.dat 


convert:	vcnvrt vtxtcn vtext.dat
	@echo "creating data files..."
	vtxtcn
	vcnvrt
	@type nil: TO convert
# the 'type nil: to convert' stuff is a kludge.  Manx 'touch' won't create a
# file if it doesn't exist.

vtxtcn:	vtxtcn.o
	ln vtxtcn.o -lc

vcnvrt: vcnvrt.o
	ln vcnvrt.o -lc

zoo:  readme world world.info q1text.dat q1text.dat.info readme.info
	-delete world.zoo
	zoo a world world world.info q1text.dat README q1text.dat.info readme.info

zoosrc: readme $(CSRC) $(WHEADERS) vtext.dat.aa vtext.dat.ab vtext.dat.ac\
        vocab.dat vtxtcn.c vcnvrt.c 
	-delete worldsrc.zoo
	zoo a worldsrc $(CSRC) $(WHEADERS) vtext.dat.aa vtext.dat.ab vtext.dat.ac\
	     data.dat vocab.dat vtxtcn.c vcnvrt.c makefile.old makefile readme

clean:
	delete #?.o

install: 	world q1text.dat
	copy world $(DEST)
	copy q1text.dat $(DEST)
    copy world.info $(DEST)
	copy q1text.dat.info $(DEST)


world:	$(WOBJS) convert
	ln $(WOBJS) $(LNFLAGS) 
