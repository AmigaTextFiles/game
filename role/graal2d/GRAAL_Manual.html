<!-- Published by Quadralay WebWorks HTML Lite 1.5.1 -->
<html>
<head>
<title></title>
</head>

<body>
<a name="998828">
<h1>1	 Contents	</h1>
</a>
<a href="graal22.htm#998828">
<H2> 1	Contents	 </H2>
</a>
<a href="graal22.htm#999001">
<H2> 2	Introduction	 </H2>
</a>
<dl>
<a href="graal22.htm#999007">
<dt><dd> 2.1	Copyright Information	 
</a>
<a href="graal22.htm#999013">
<dt><dd> 2.2	Credits	 
</a>
<a href="graal22.htm#999016">
<dt><dd> 2.3	About the Manual	 
</a>
<a href="graal22.htm#999029">
<dt><dd> 2.4	Release Info	 
</a>
<a href="graal22.htm#999060">
<dt><dd> 2.5	Typographical Conventions	 
</a>
</dl>
<a href="graal22.htm#999066">
<H2> 3	(Finally:) The REAL Introduction	 </H2>
</a>
<dl>
<a href="graal22.htm#999070">
<dt><dd> 3.1	So, What Is GRAAL?	 
</a>
<a href="graal22.htm#999078">
<dt><dd> 3.2	Other Tools of the Trade	 
</a>
<a href="graal22.htm#999083">
<dt><dd> 3.3	The Things That Make a GRAAL	 
</a>
<a href="graal22.htm#999086">
<dt><dd> 3.4	GRAAL Script Files	 
</a>
<a href="graal22.htm#999144">
<dt><dd> 3.5	The main Script	 
</a>
<a href="graal22.htm#999155">
<dt><dd> 3.6	The Room Scripts	 
</a>
<a href="graal22.htm#1005618">
<dt><dd> 3.7	The Section Scripts	 
</a>
<a href="graal22.htm#999171">
<dt><dd> 3.8	The Scene Scripts	 
</a>
<a href="graal22.htm#999175">
<dt><dd> 3.9	The Pattern Scripts	 
</a>
<a href="graal22.htm#999177">
<dt><dd> 3.10	Running an Adventure	 
</a>
<a href="graal22.htm#999190">
<dt><dd> 3.11	Loading, Saving and Quitting	 
</a>
</dl>
<a href="graal22.htm#999197">
<H2> 4	Starting on an Adventure	 </H2>
</a>
<dl>
<a href="graal22.htm#999206">
<dt><dd> 4.1	Starting on the main script	 
</a>
<a href="graal22.htm#999234">
<dt><dd> 4.2	The Hero - What a Character!	 
</a>
<a href="graal22.htm#999253">
<dt><dd> 4.3	Basics about Images and Bobs	 
</a>
<a href="graal22.htm#999274">
<dt><dd> 4.4	The Images in the main script	 
</a>
</dl>
<a href="graal22.htm#999339">
<H2> 5	 "A Room! A Room! A Kingdom for a Room!"	 </H2>
</a>
<a href="graal22.htm#999379">
<H2> 6	The Object Matter	 </H2>
</a>
<a href="graal22.htm#999444">
<H2> 7	Section Objects and Images	 </H2>
</a>
<a href="graal22.htm#999450">
<H2> 8	Camera! Action! Lights!	 </H2>
</a>
<dl>
<a href="graal22.htm#999453">
<dt><dd> 8.1	ACTION: statements	 
</a>
</dl>
<a href="graal22.htm#999497">
<H2> 9	Using Exits	 </H2>
</a>
<a href="graal22.htm#999512">
<H2> 10	The DACT: Statements	 </H2>
</a>
<a href="graal22.htm#1003112">
<H2> 11	Flags and String Variables	 </H2>
</a>
<dl>
<a href="graal22.htm#1003123">
<dt><dd> 11.1	Flags	 
</a>
<a href="graal22.htm#1003133">
<dt><dd> 11.2	String Variables	 
</a>
</dl>
<a href="graal22.htm#1005112">
<H2> 12	Displaying text	 </H2>
</a>
<dl>
<a href="graal22.htm#1005121">
<dt><dd> 12.1	Text styles	 
</a>
<a href="graal22.htm#1005123">
<dt><dd> 12.2	Variables and Other Special Strings	 
</a>
<a href="graal22.htm#1005125">
<dt><dd> 12.3	Audio Information	 
</a>
</dl>
<a href="graal22.htm#999516">
<H2> 13	Having a Chat	 </H2>
</a>
<a href="graal22.htm#999600">
<H2> 14	Multiple Characters and Inventories	 </H2>
</a>
<dl>
<a href="graal22.htm#999606">
<dt><dd> 14.1	Multiple Character Graphics	 
</a>
<a href="graal22.htm#999620">
<dt><dd> 14.2	Character Objects	 
</a>
<a href="graal22.htm#999652">
<dt><dd> 14.3	Switching Characters	 
</a>
<a href="graal22.htm#999660">
<dt><dd> 14.4	Inventory Switching and Inventory Objects	 
</a>
<a href="graal22.htm#999677">
<dt><dd> 14.5	Identifying Characters and/or Inventories	 
</a>
<a href="graal22.htm#999679">
<dt><dd> 14.6	Characters Following Characters Around...	 
</a>
<a href="graal22.htm#999696">
<dt><dd> 14.7	Helpful Conditions	 
</a>
<a href="graal22.htm#999702">
<dt><dd> 14.8	Things to Consider	 
</a>
<a href="graal22.htm#999704">
<dt><dd> 14.9	Space-saving Tip	 
</a>
</dl>
<a href="graal22.htm#999708">
<H2> 15	Character and Graphics Design	 </H2>
</a>
<dl>
<a href="graal22.htm#999711">
<dt><dd> 15.1	Size	 
</a>
<a href="graal22.htm#999714">
<dt><dd> 15.2	Colour	 
</a>
<a href="graal22.htm#999720">
<dt><dd> 15.3	Pointer Shapes and Colours	 
</a>
<a href="graal22.htm#999733">
<dt><dd> 15.4	Designing Animations	 
</a>
<a href="graal22.htm#999746">
<dt><dd> 15.5	Complex animation patterns	 
</a>
<a href="graal22.htm#999765">
<dt><dd> 15.6	A Note about Flipped Images	 
</a>
<a href="graal22.htm#999770">
<dt><dd> 15.7	All About 3D and Hotspots	 
</a>
<a href="graal22.htm#1001234">
<dt><dd> 15.8	Scaling the Characters	 
</a>
</dl>
<a href="graal22.htm#999781">
<H2> 16	Cutscenes	 </H2>
</a>
<dl>
<a href="graal22.htm#999793">
<dt><dd> 16.1	Hop, Skip and Jump	 
</a>
<a href="graal22.htm#999797">
<dt><dd> 16.2	No Breaks!	 
</a>
<a href="graal22.htm#999799">
<dt><dd> 16.3	Nesting	 
</a>
</dl>
<a href="graal22.htm#999812">
<H2> 17	Timer Events	 </H2>
</a>
<a href="graal22.htm#1001794">
<H2> 18	Special Techniques or "How The Heck Did He Do That?"	 </H2>
</a>
<dl>
<a href="graal22.htm#999814">
<dt><dd> 18.1	The Load / Save Room.	 
</a>
<a href="graal22.htm#1002568">
<dt><dd> 18.2	Going into the Alley	 
</a>
<a href="graal22.htm#1003010">
<dt><dd> 18.3	Speaking In a Foreign Tongue	 
</a>
<a href="graal22.htm#999822">
<dt><dd> 18.4	An Automated Room	 
</a>
<a href="graal22.htm#999825">
<dt><dd> 18.5	The Art of Avoiding a Seagull	 
</a>
<a href="graal22.htm#999832">
<dt><dd> 18.6	A Spitting Image	 
</a>
<a href="graal22.htm#999835">
<dt><dd> 18.7	A Map Room without the Command Area	 
</a>
</dl>
<a href="graal22.htm#999855">
<H2> 19	The On-line Monitor	 </H2>
</a>
<a href="graal22.htm#999909">
<H2> 20	Macros	 </H2>
</a>
<dl>
<a href="graal22.htm#999913">
<dt><dd> 20.1	Starting a Macro Recording	 
</a>
<a href="graal22.htm#999917">
<dt><dd> 20.2	Saving a Macro	 
</a>
<a href="graal22.htm#999921">
<dt><dd> 20.3	Playing a Macro	 
</a>
<a href="graal22.htm#999928">
<dt><dd> 20.4	Restrictions to Macro Playback	 
</a>
</dl>
<a href="graal22.htm#999931">
<H2> 21	"Productifying" Your Adventures	 </H2>
</a>
<dl>
<a href="graal22.htm#999932">
<dt><dd> 21.1	The Basics	 
</a>
<a href="graal22.htm#999941">
<dt><dd> 21.2	The diskinfo.graal File	 
</a>
<a href="graal22.htm#999964">
<dt><dd> 21.3	GREP	 
</a>
<a href="graal22.htm#999971">
<dt><dd> 21.4	GPRO	 
</a>
<a href="graal22.htm#1000011">
<dt><dd> 21.5	GDC	 
</a>
</dl>
<a href="graal22.htm#1000040">
<H2> 22	The Editor	 </H2>
</a>
<dl>
<a href="graal22.htm#1000041">
<dt><dd> 22.1	Introduction	 
</a>
<a href="graal22.htm#1000051">
<dt><dd> 22.2	System Requirements	 
</a>
<a href="graal22.htm#1000057">
<dt><dd> 22.3	Known Bugs &amp; Irritating Facts	 
</a>
<a href="graal22.htm#1000066">
<dt><dd> 22.4	Creating a New Script	 
</a>
<a href="graal22.htm#1000073">
<dt><dd> 22.5	Working with the Editor	 
</a>
<a href="graal22.htm#1000125">
<dt><dd> 22.6	Creating a Report	 
</a>
<a href="graal22.htm#1000128">
<dt><dd> 22.7	The Parameter Editor	 
</a>
<a href="graal22.htm#1000207">
<dt><dd> 22.8	Icon Tooltypes	 
</a>
<a href="graal22.htm#1000219">
<dt><dd> 22.9	Editor Keyboard Shortcuts	 
</a>
</dl>
<a href="graal22.htm#1000227">
<H2> 23	Hints and Tips	 </H2>
</a>
<dl>
<a href="graal22.htm#1000230">
<dt><dd> 23.1	Flags	 
</a>
<a href="graal22.htm#1002529">
<dt><dd> 23.2	Diverse	 
</a>
</dl>
<a href="graal22.htm#1000236">
<H2> 24	Questions and Answers	 </H2>
</a>
<a href="graal22.htm#1000274">
<H2> 25	Index	 </H2>
</a>

<H2> </H2>

<a name="999001">
<h1>2	 Introduction</h1>
</a>
<a name="999005">
<p><img src="g-norm.gif"><p>
<p>
</a>
<dl>
<dl>
<dl>
<dl>
<dl>
<dl>
<a name="999006">
<dt> You too can make a game like this! (Screen shots for this manual<br>are from various GRAAL releases, and the appearance of some screens<br>may have changed slightly in the latest release.)
</a>
</dl>
</dl>
</dl>
</dl>
</dl>
</dl>
<a name="999007">
<h2>2.1	 Copyright Information</h2>
</a>
<a name="999008">
GRAAL 2 is Shareware. If you like it and use it, register and make me happy!<p>
</a>
<a name="999009">
All rights to the GRAAL system remains with Performance Software and is copyright (C) 1997/1998 Per Thulin.<p>
</a>
<a name="999010">
Users of GRAAL may use the system freely to distribute their own graphic adventures, but are completely forbidden to use any of the supplied example material - puzzles, characters, animations, or scenes - in their own work. Quite simply, all material used in your own GRAAL adventures must be your own!<p>
</a>
<a name="999011">
The shareware version of GRAAL is not crippled in any way, but it is not quite adapted for "professional" use, which is explained later in this manual.<p>
</a>
<a name="999012">
See the file Registration.form for details on how to register.<p>
</a>
<a name="999013">
<h2>2.2	 Credits</h2>
</a>
<a name="999014">
GRAAL is coded in Amos Professional. You know it makes sense... :) Also, let's not forget that Black Legend Craft 1 and AMCAF extensions. They made things that much better!<p>
</a>
<a name="999015">
The GRAAL Editor is coded in Blitz 2 Basic. You know it makes even more sense... ;)<p>
</a>
<a name="999016">
<h2>2.3	 About the Manual</h2>
</a>
<a name="999017">
This manual contains an awful lot of text. Don't be discouraged - that is simply because each little GRAAL statement carries an awful lot of power (and because I'm such a blabbermouth), and some sophisticated initial definitions automate most of the gameplay! Before you get totally discouraged, print out the following files from the example disk(s):<p>
</a>
<a name="999018">
graal.main <br>1.section <br>1.room<p>
</a>
<a name="999019">
If you look at these files, and disregard the abundance of comment lines starting with /*, you will quickly realise how precious little GRAAL code is actually needed for the basics of an adventure. Also, remember that there is an editor included making your GRAAL-coding life a lot easier - you don't have to enter that many tricky parts manually, because the editor can help you.<p>
</a>
<a name="999020">
The GRAAL documentation is divided into three main parts:<p>
</a>
<ul>
<a name="999021">
<li>The latest .readme file - essential to all who wants to read about the news in the latest version of the system.
</a>
<a name="999022">
<li>This manual.
</a>
<a name="999023">
<li>An AmigaGuide on-line reference (graal.guide), the definitive authority on all GRAAL statements and commands. While this manual discusses various topics in general and on a broad scale, all the nit-picking details on statement and command syntax are found here.
</a>
</ul>
<a name="999028">
If you want to play the provided "Olaf" demo AND build your own Graphic Adventure, I strongly suggest you play the game first!  Because "Olaf" is used as an example throughout the tutorial, some of the secrets of the demo is given away here. This is also a good way of deciding whether this kind of stuff is what you want to spend the rest of your life doing :-)<p>
</a>
<a name="999029">
<h2>2.4	 Release Info</h2>
</a>
<a name="999030">
GRAAL 2.3 brings you the following features:<p>
</a>
<ul>
<a name="999031">
<li>A graphic adventure point'n'click interface along the lines of, among others, the Indy games and Monkey Island (Trademarks of LucasArts Ltd.).
</a>
<a name="999032">
<li>Automation of most of the controllable characters' walking, talking, and general fiddling around.
</a>
<a name="999033">
<li>32- or 64-colour (EHB) lowres, automatically scrolling background screens, 320 to 640 pixels wide.
</a>
<a name="1001482">
<li>16-colour, hires, fully configurable command area, 640 pixels wide.
</a>
<a name="999034">
<li>Any number of player commands.
</a>
<a name="1001485">
<li>Features to handle USE, GIVE TO and GO TO commands.
</a>
<a name="999036">
<li>Room and section data swapped in and out of memory at runtime to minimise the growth of permanent in-memory data as the adventure grows. This gives you a virtually unlimited number of locations (rooms), objects, images, dialogues, etc.
</a>
<a name="999037">
<li>Also automatically detects extra memory and uses this as cache memory to avoid unnecessary disk access.
</a>
<a name="1001480">
<li>Animated objects and characters.
</a>
<a name="1001481">
<li>Pixel-perfect detection of objects.
</a>
<a name="999038">
<li>Side-view "simulated 3D" scenes with foreground, "middle", and background objects.
</a>
<a name="1001474">
<li>Dynamic depth-scaling of characters.
</a>
<a name="999041">
<li>A rather intelligent and easy-to-use dialogue system for those totally silly discussions with sidekick characters we all have come love so much.
</a>
<a name="999042">
<li>An equally intelligent but perhaps a little more difficult-to-grasp floor and path definition system - for defining legal movement paths and automatic negotiation of obstacles.
</a>
<a name="999043">
<li>Cut-scenes with or without indicators. Nested cut-scenes are possible.
</a>
<a name="1001498">
<li>Timer events.
</a>
<a name="1001499">
<li>Functions for in-game clocks and dates.
</a>
<a name="1001500">
<li>Built-in requesters for save/load and quit functions - or disable them and design your own save/load and quit screens.
</a>
<a name="999044">
<li>Multiple character control.
</a>
<a name="999045">
<li>Multiple inventories.
</a>
<a name="999046">
<li>Soundtracker style music modules for background music.
</a>
<a name="999047">
<li>IFF and raw samples for sound effects.
</a>
<a name="1005235">
<li>The possibility to create "talkies", that is, adventures with spoken dialogue.
</a>
<a name="999048">
<li>Run-time error checking (to a degree).
</a>
<a name="999049">
<li>GRAAL automatically detects if a GRAAL adventure is run from diskette, CD-ROM, or hard disk, and adjusts disk swapping and save/load routines accordingly.
</a>
<a name="999050">
<li>All tools included except an art/animation package and (optional) sound sampler equipment.
</a>
<a name="999051">
<li>Diskette layout system for automatic copying and labelling of distribution master diskettes.
</a>
<a name="999052">
<li>Dynamic on-line monitor and debugger for script testing, on-the- fly temporary corrections, and examination of the game status.
</a>
<a name="999053">
<li>Single-step trace mode for debugging.
</a>
</ul>
<a name="999054">
The developer's registered version also gives you:<p>
</a>
<ul>
<a name="999055">
<li>Optimization and encryption of distribution files. The process also locks all development functions (the on-line monitor, break keys, etc.) so that they cannot be used by the player.
</a>
</ul>
<a name="999057">
It does NOT give you:<p>
</a>
<ul>
<a name="999059">
<li>AGA (but on the other hand, a much broader customer base for your games. Let's be kind to those ECS and emulator users out there! :)
</a>
</ul>
<a name="999060">
<h2>2.5	 Typographical Conventions</h2>
</a>
<a name="999061">
In this text, &lt; &gt; denotes button gadgets and [ ] keyboard keys.<p>
</a>
<a name="999062">
Furthermore, I have tried to print names of files and sections of scripts in a special font:<p>
</a>
<a name="999063">
file.name<p>
</a>
<a name="999064">
Of course, those of you who only have the ascii manual will not benefit from this. Register and order the manual! :)<p>
</a>
<a name="999065">
<p>
</a>
<a name="999066">
<h1>3	 (Finally:) The REAL Introduction</h1>
</a>
<a name="999067">
Welcome to GRAAL. Maybe thy quest is over!<p>
</a>
<a name="999068">
...or maybe it has just begun. Because, although GRAAL is a powerful tool, designing a graphic adventure still needs an awful lot of hard work from your side - all GRAAL does is take most of the actual coding work out of the job and lets you get on with designing the story, logic, backgrounds, objects, animated characters and dialogue. Which, in itself, should keep you busy for quite a while.<p>
</a>
<a name="999069">
GRAAL was mainly invented along with the 7-room demo of the first ever GRAAL adventure "Olaf Longhair, Part I", delaying the release of both, but ensuring that GRAAL really works on a full-scale and rather advanced graphic adventure. Although maybe not quite up to LucasArts standards, it proves that GRAAL can make at least a budget-level game any day! And since this manual was written parallel to the code that went into "Olaf" and GRAAL itself, you should find everything of importance right here.<p>
</a>
<a name="999070">
<h2>3.1	 So, What Is GRAAL?</h2>
</a>
<a name="999071">
All GRAAL adventures consist of:<p>
</a>
<ul>
<a name="999073">
<li>The GRAAL driver program, which is the "adventure engine". It is named GRAAL_2 in the development package. When you use it to run a specific game, it is usually renamed to whatever that adventure is called.
</a>
<a name="999074">
<li>GRAAL script files, containing the statements that make up the adventure. There are different kinds of script files: One main script, room scripts, section scripts, scene scripts, and animation pattern scripts.
</a>
<a name="999075">
<li>IFF image files, depicting background scenes and object and character "clip-art".
</a>
<a name="999076">
<li>A file called diskinfo.graal. This file contains, among other things, the names of all the other files used in your adventure. This file is used by GRAAL to locate files and handle disk swapping in an intelligent way if your game gets so big it does not fit onto one disk.
</a>
<a name="999077">
<li>Optionally, soundtracker music modules and sound sample files.
</a>
</ul>
<a name="999078">
<h2>3.2	 Other Tools of the Trade</h2>
</a>
<a name="999079">
If you don't have AmigaGuide (or Multiview - WB 3 and above), get hold of it NOW. You'll need it to use the editor, and read the on-line command reference.<p>
</a>
<a name="999080">
You will not go far without a good paint program like Deluxe Paint, Brilliance or Personal Paint to create all backgrounds, objects and animations. An image processing program like Photopaint, Image FX or ADPro is a good complement.<p>
</a>
<a name="999081">
To take some of the work out of the backdrop scene creation, why not use a <p>
</a>
<a name="1001226">
modelling and rendering package? (Believe it or not, there are some good ones that are freeware, even - POV-ray, for instance.)<p>
</a>
<a name="999082">
A sound sampler and software could also come in handy, as could a scanner or digitizer. But hey, it's up to you. Or rather, your wallet.<p>
</a>
<a name="999083">
<h2>3.3	 The Things That Make a GRAAL</h2>
</a>
<a name="999084">
Because there are a lot of things in the GRAAL system to keep track of, and you need almost all of it to make the adventure work, the manual will try to explain most of the stuff in the tutorial form, followed by in-depth discussions on a number of the trickier subjects and concepts. <p>
</a>
<a name="1005244">
Apart from the essential graal.guide reference file, the "Olaf "demo provided with the package provides you with well commented script files of all types, and a couple of GRAAL-driven "disk-mag demos" are available on aminet showing off techniques not used in "Olaf". (game/role/GraalHerald1.lha and game/role/GraalHerald2.lha).<p>
</a>
<a name="1005249">
Together, these information sources demonstrate most major GRAAL techniques. (Beware: READ THE COPYRIGHT NOTICE!)<p>
</a>
<a name="999086">
<h2>3.4	 GRAAL Script Files</h2>
</a>
<a name="1005253">
Now, let's have a quick general look at the general structure of a GRAAL game.<p>
</a>
<a name="999088">
The GRAAL code needed to make an adventure tick is contained in a number of script files. It is a compact language; if it wasn't for the heavy commenting, they would not take up too much space at all.<p>
</a>
<a name="999089">
There are different types of script files, each controlling a different portion of the game. Their relationships form a tree-shaped structure, like this:<p>
</a>
<a name="999119">
The numbers are only examples. There may be any number of section scripts beneath the main script, and any number of room scripts under each section script.<p>
</a>
<a name="999120">
Although placed in the middle of the structure, the importance of section scripts vary greatly depending on the design of your adventure. In some cases, you may want to have only one section file, containing nothing at all! More about this further on.<p>
</a>
<a name="999122">
In all the script files there are three basic kinds of lines:<p>
</a>
<a name="999124">
<h3> Comment lines</h3>
</a>
<a name="1005258">
All comment lines must begin with the characters<p>
</a>
<a name="999125">
<pre>/*
</pre>
</a>
<a name="999126">
which can be followed by any text, like in<p>
</a>
<a name="999127">
<pre>/* This is a comment if ever I saw one!
</pre>
</a>
<a name="999128">
Use comments a lot, because the GRAAL syntax is not particularly reader-friendly, and what was clear in your mind when you typed it in may seem like pointless rubbish a couple of weeks later - if you don't have the comments there to remind you. First and foremost, ALWAYS document what your variables (called room and object flags - more about them later) contain and how they are supposed to be used!<p>
</a>
<a name="999129">
Hint: The GRAAL_Editor uses the first line of each script file to explain its contents in file requesters, making it easier to find the file you want. Therefore, always make the first line of each script a comment, like this:<p>
</a>
<a name="999130">
/* Short description of script contents<p>
</a>
<a name="999131">
<h3> Empty lines</h3>
</a>
<a name="1005259">
Empty lines may be used as separators for improved readability.<p>
</a>
<a name="999133">
<h3> Statement lines</h3>
</a>
<a name="1005264">
Each statement line contains a statement (or keyword, if you will), followed by a colon, and one or more parameters separated by semicolons. Like this:<p>
</a>
<a name="999134">
<pre>statement: parameter1;parameter2;...;parameterN
</pre>
</a>
<a name="999136">
In many cases, the parameters contained in a statement line are conditions or commands, containing their own parameters. Example:<p>
</a>
<a name="999138">
<pre>ACTION: 4;IFRF 2=0;SAY I Can't do that;EXIT
</pre>
</a>
<a name="1001781">
In this example, ACTION: is a statement that comes into play when GRAAL is checking a command input by the player. More precisely, the ACTION: statement in this example will be used if a sentence using verb 4 (parameter 1) has been entered by the player. GRAAL will then execute the commands SAY and EXIT, but only if the condition IFRF 2=0 has been fulfilled first.<p>
</a>
<a name="999140">
Note: There must be a space between the ":" and the parameters, but there must be no spaces around the semicolons separating the parameters! Also, there is no semi-colon after the last parameter in a line.<p>
</a>
<a name="999141">
Each statement in a script file may be up to 255 characters long. The script files are case sensitive, so make sure all statement and command names are written in upper case.<p>
</a>
<a name="999142">
Any line in the three types of script files mentioned above that does not conform to the rules will be spotted by GRAAL at run-time, normally causing the execution of the adventure to halt with an error message. Double-check everything, and use the GRAAL editor for help with the parameter syntax and syntax checking!<p>
</a>
<a name="999144">
<h2>3.5	 The main Script</h2>
</a>
<a name="999145">
"All right, but what do these different script files actually do?" I hear you scream.<p>
</a>
<a name="999146">
Good questions! The first, and in many ways the most important, is the main script. It is always called graal.main because that is what it must be called - if GRAAL doesn't find a graal.main script in the current directory, it will say so and terminate.<p>
</a>
<a name="999147">
The main script sets up everything that is common to the entire adventure, such as:<p>
</a>
<ul>
<a name="999148">
<li>All basic aspects of the main character's behaviour - he's certainly going to be around in the entire adventure!
</a>
<a name="999149">
<li>Where the adventure starts.
</a>
<a name="999150">
<li>The fonts to be used for the user interface.
</a>
<a name="1004648">
<li>The appearance of the command area.
</a>
<a name="1004649">
<li>The commands (verbs) that are available to the player.
</a>
<a name="999152">
<li>All the characters involved in dialogues.
</a>
<a name="1006495">
<li>All the objects that can be carried anywhere in the game.
</a>
<a name="999153">
<li>All the actions that can be performed by the player in all, or at least in most, locations.
</a>
</ul>
<a name="999155">
<h2>3.6	 The Room Scripts</h2>
</a>
<a name="999156">
Once GRAAL has interpreted the main script, it knows which room script to look for first. All room scripts have the suffix .room preceded by the room number, so the first room script used in the adventure is very often called 1.room . (If you decide on a better starting point for the adventure later on, you may of course tell GRAAL to start in, for example, room 45 instead.)<p>
</a>
<a name="999157">
Since GRAAL reserves memory for each possible room number from 1 and up to the highest room number used, it is a waste to have "gaps" in the room sequence. If you have deleted some rooms in the middle of the sequence, use the vacant numbers when you add new rooms, thus minimising the gaps in the numbering sequence.<p>
</a>
<a name="999158">
The room scripts do much the same for each adventure location or "room" as the main script does for the adventure as a whole.<p>
</a>
<a name="999159">
They contain, among other things, the following:<p>
</a>
<ul>
<a name="999160">
<li>The name of the IFF file to be used as the background in the Scene Area.
</a>
<a name="999161">
<li>Information about "clip-art" to be loaded in and used as graphic elements and objects for this particular room.
</a>
<a name="999162">
<li>The dialogues that take place in this room.
</a>
<a name="999163">
<li>The objects that can only exist within this room.
</a>
<a name="1005616">
<li>All actions that are specific to this room.
</a>
</ul>
<a name="1005618">
<h2>3.7	 The Section Scripts</h2>
</a>
<a name="1005619">
Section scripts are very similar to room scripts. Their main purpose in life is to make GRAAL more memory efficient. The basic idea is that many graphic adventures are divided into logical sections, a section being a number of connected rooms where the same objects can be handled and a number of puzzles need to be solved before you can move on to the next section. However, once you are through with a section, there are a number of objects and images you will never use again, and therefore they can be deleted from memory the freed space can be used for the objects of the new section. Or, perhaps the rooms of the section share a lot of graphics - like a labyrinth in a system of caves probably would.<p>
</a>
<a name="999168">
How you define sections is up to you, and you do not need to use the concept at all if it is irrelevant. (In that case, just use section 1 for all the rooms, and place no commands in the 1.section script - just a few comment lines describing what the blazes you are up to, with a couple of totally blank lines in between.)<p>
</a>
<a name="999171">
<h2>3.8	 The Scene Scripts</h2>
</a>
<a name="999172">
Scene scripts are known as cut-scene scripts, containing non- interactive parts of the adventure (playing much like cartoon movies). They can also be used as subroutines, saving you the work of re-coding the same set of commands in a lot of places.<p>
</a>
<a name="999173">
The cut-scene scripts are a little special (but simpler) than the previous script files, and will be discussed later on.<p>
</a>
<a name="999175">
<h2>3.9	 The Pattern Scripts</h2>
</a>
<a name="999176">
Pattern scripts are not scripts as such - they contain definitions of animation patterns that would be too long to enter into the other script files directly, or you wish to re-use in a number of different places in your scripts - or all of the above. (For those of you familiar with Amos Pro, the contents of the pattern scripts follow the animation and movement parts of the AMAL syntax. The way to express image numbers to be used is slighlty different, though.)<p>
</a>
<a name="999177">
<h2>3.10	 Running an Adventure</h2>
</a>
<a name="999179">
At some point or other, you feel that the script files are good enough to be tested. This is simply a matter of trying to start the adventure by running the driver program GRAAL_2, which must be placed in the same directory as all the script and graphics files you refer to in the game.<p>
</a>
<a name="999180">
(You should, of course, run the syntax checker in the GRAAL_Editor on all scripts first to get rid of all typing errors and other such mistakes. This takes far less time than re-running GRAAL_2!)<p>
</a>
<a name="999181">
First, the GRAAL_2 program loads. Then, the GRAAL title screen is shown. The progress indicator (the horizontal bar) indicates that the contents of the main script are being loaded and processed. When the title screen disappears and the screen goes blank for a moment, the system is working on the first room and section scripts.<p>
</a>
<a name="999183">
Most likely, you will get some error messages before everything starts running smoothly. A GRAAL "run-time error" message will appear in yellow text surrounded by a red border on screen, stating the type of error, which room was currently loaded, and which file was last accessed. <p>
</a>
<a name="999184">
Note: The file referenced in the error message is not always the actual culprit! For example, if GRAAL has loaded a small cutscene script, executed it and run into a problem in the calling script later on, it is still the name of the completely innocent cutscene file that is shown. Take this information for what it is.<p>
</a>
<a name="999185">
Some problems may be of a less severe nature. In those cases, GRAAL sometimes lets you decide whether to continue playing, or exit the program (in which case it tries to clean up the memory just as if you give the "Q"uit command when playing the game the normal way).<p>
</a>
<a name="999186">
However, continuing after such a warning is seldom safe: The error almost certainly affects some aspect of the game. While things like flag value errors may often be corrected using the on-line monitor (see the appendices), other problems propagate and make GRAAL keel over shortly after the first, ignored error message.<p>
</a>
<a name="999187">
Also note that in the error messages, the offensive statements and commands are sometimes printed in a slightly different way from how they appear in the script: This is because all RIMGn, SIMGn, ROBJn and SOBJn references, which are relative numbers, are translated directly upon loading to become absolute numbers. So if your N_xxxxIMGS: statement in the main script decide that room images start at image number 51, an erroneous statement containing RIMG4 would actually show the number as "54" in the error message. (Sorry 'bout that. Read on, and you will probably understand what the heck I am talking about later.)<p>
</a>
<a name="999188">
There will most likely always be some errors that are not trapped properly, and the system may just "die on you". In those cases, try to determine how far the loading process has actually gone, and check the structure of YOUR scripts carefully against the Olaf demo and the order in which things appear there! Also, resetting your Amiga before trying again often helps. As always, there is a certain amount of memory thrashing going on if you make a lot of consecutive test runs.<p>
</a>
<a name="999189">
For an overview of the basic features of the GRAAL_2 player interface, read the "Olaf.guide" that contains instructions for the demo adventure.<p>
</a>
<a name="999190">
<h2>3.11	 Loading, Saving and Quitting</h2>
</a>
<a name="999191">
GRAAL has its own, built-in requesters and short-cut keys for the standard tasks of loading, saving, and quitting a game. However, you can easily disable those short-cut keys (with some statements in the main script) and design your own routines. Olaf Longhair uses a special room where you can have a look at the score, save and load games, and optionally quit the program. In the demo, I have not disabled the short-cut keys, so you can choose which way to quit, save and load - the quick one or the impressive one!<p>
</a>
<a name="999193">
On the subject of loading saved games, note that saved game files can only be used with the same GRAAL driver and adventure version with which they were saved - each time you add or delete objects, rooms and other stuff in the adventure, the saved game file format changes, and renders old saved game files unusable. To make the task of testing a little easier, have a look at the macro feature (<a href="graal22.htm#999909">``Macros'' on page 70</a>).<p>
</a>
<a name="999197">
<h1>4	 Starting on an Adventure</h1>
</a>
<a name="999198">
I won't bother you with a lot of talk about how you must plan the contents of your adventure, have a good storyline, so on and so forth. If you don't that's not my fault, is it? I simply assume you HAVE a story to tell, and that you are well aware of how graphic adventures of this kind works - if you don't, you'd better play some first. I will then show how you can do it all using GRAAL.<p>
</a>
<a name="999199">
I won't even go into the basic idea behind my example adventure "Olaf Longhair", because surely you have played the demo by now!<p>
</a>
<a name="999200">
This tutorial concentrates on everything that makes the first four rooms in Olaf Longhair tick - because once we have that much going, almost everything follows along the same lines (or will be pointed out separately).<p>
</a>
<a name="999201">
The four rooms, in order of appearance, are:<p>
</a>
<ul>
<a name="999202">
<li>The bar, where Olaf wakes up the morning after the night before, and has an informative chat with the bartender.
</a>
<a name="999203">
<li>The street outside the bar, where he bumps into a strange- looking guy with an even stranger-looking animal.
</a>
<a name="999204">
<li>The harbour, where he meets a foreign captain and deals with a rather irritating seagull.
</a>
<a name="999205">
<li>The shopping emporium of one Ali Harrod, Esq.
</a>
</ul>
<a name="999206">
<h2>4.1	 Starting on the main script</h2>
</a>
<a name="999207">
Look at the graal.main script now. To do it "the GRAAL way", <p>
</a>
<ul>
<a name="999208">
<li>Start the GRAAL Editor, which should be in the same directory as the example files.
</a>
<a name="999209">
<li>Press right Amiga + "4" to automatically open a new window in the editor and load the graal.main script there.<p><img src="ge-main.gif"><p>

</a>
<dl>
<dl>
<dl>
<dl>
<dl>
<a name="999213">
<dt> The GRAAL Editor with graal.main loaded into window no.2
</a>
</dl>
</dl>
</dl>
</dl>
</dl>
</ul>
<a name="999214">
The best way to start creating a new adventure is to take a main script that works, and alter it to suit your own needs. Using the GRAAL editor, you can also choose to create a main script template, with comments and statements showing what is mandatory and what is not. (This method can also be used for the other script types.)<p>
</a>
<a name="999215">
Here are some examples of statements that can be set almost immediately. Other ones will be dealt with once we start designing rooms, objects and characters for the adventure.<p>
</a>
<a name="999216">
If you use the GRAAL Editor, you can read more about each statement if you place the cursor in the statement name somewhere and then press the [Help] key or click the &lt;?&gt; button.<p>
</a>
<a name="999217">
<pre>NAME: "Olaf Longhair Goes East"
</pre>
</a>
<a name="999218">
The name of my adventure is "Olaf Longhair Goes East". (The quotes are not there because they enclose a string or anything - I actually want them displayed on screen when the name of the adventure is called up by pressing the [V] key during a game!)<p>
</a>
<a name="999219">
<pre>VERSION: version
</pre>
</a>
<a name="1005721">
The adventure version number. This is especially useful to guarantee that you don't try to load old saved game files when testing a newer version of the adventure.<p>
</a>
<a name="1003665">
Then follows a lot of statements dealing with the player interface layout, and numbers setting limits for how many images, objects, and other things GRAAL can handle in your adventure. Basically, the size of the comand area, the number of available commands, their positions and appearance, the layout of inventory lists, and dialogue alternative displays can all be adjusted to suit your needs. Read the comments in the graal.main script, that's the best way to learn about them. Many of these statements require graphic images to be specified and positioned - more about graphics follows below.<p>
</a>
<a name="999223">
<h3> Fonts</h3>
</a>
<a name="999225">
Among the statements in graal.main, one thing worth a special mention is the way GRAAL uses fonts.<p>
</a>
<a name="999226">
The statements<p>
</a>
<a name="999227">
<pre>MSGFONT: xen;8<br>
COMFONT: garnet;9<br>
TITLEFONT1: olaf;27<br>
TITLEFONT2: times;14
</pre>
</a>
<a name="999228">
each loads a font with a certain size and stores it in memory for later use in the game. (For more information on what font is used where, go to the on-line reference.) <p>
</a>
<a name="999229">
To keep things easy to handle on the player side, we do NOT install these fonts in the normal Workbench FONTS: drawer, but keep them in a special FONTS drawer inside the drawer where all the other game files reside. <p>
</a>
<a name="999230">
This means all fonts you wish to use in the game must be copied to this special "game fonts" drawer in your development directory. The only trouble is that GRAAL needs to have its fonts drawer "prepared" with the standard Amiga FIXFONTS command in order to be able to load the fonts.<p>
</a>
<a name="999231">
What this means is that whenever you change the fonts in the drawer, you should run the standard Workbench "fixfonts" program, with the logical assign FONTS: pointing to the game fonts drawer. You do this in a CLI shell, and the commands used should look something like this ("DH1:" below is a hard disk drive, and "MYADVENTURE" is the path to your development drawer on that disk):<p>
</a>
<a name="999232">
<pre>&gt; assign FONTS: to DH1:MYADVENTURE/FONTS<br>
&gt; fixfonts<br>
&gt; assign FONTS: to SYS:FONTS
</pre>
</a>
<a name="999233">
The last command re-assigns FONTS: to the Workbench FONTS drawer.<p>
</a>
<a name="999234">
<h2>4.2	 The Hero - What a Character!</h2>
</a>
<a name="999235">
At this point, we will not get much further without bringing the big star, our main character, the man, Olaf Longhair himself, into play!<p>
</a>
<a name="999237">
One of the things GRAAL makes so easy to manage is the point and click control of the main character - in this case, Olaf. GRAAL controls what animation sequence is the correct one to use in all standard situations, in which direction Olaf is heading, where in a room he can actually place his feet, and so on.<p>
</a>
<a name="999238">
Wonderful as all this may be, it doesn't relieve you of the responsibility for the character design - in other words, before GRAAL can do all this wonderful stuff, you must design the main character and the animations used for his basic movements.<p>
</a>
<a name="999239">
Basically, what we need now are some still images and animation cels showing Olaf in various standardised poses. For "Olaf", all these are placed in the IFF picture file Olaf_Original.iff, which you should take a look at now.<p>
</a>
<a name="999243">
<p><img src="ge-area.gif"><p>
<p>
</a>
<dl>
<dl>
<dl>
<dl>
<dl>
<dl>
<a name="999244">
<dt> The "Olaf_Original.iff" file, here loaded into the area editor<br>(more about that in the chapter about the GRAAL Editor later on).
</a>
</dl>
</dl>
</dl>
</dl>
</dl>
</dl>
<a name="999245">
What the images portray are:<p>
</a>
<ul>
<a name="999246">
<li>Olaf walking towards, away, and sideways
</a>
<a name="999247">
<li>Olaf's front, back, and profile when standing still
</a>
<a name="999248">
<li>Olaf talking - the front, back, and profile views.
</a>
<a name="999249">
<li>Olaf manipulating things - also front, back and sideways views, but for each view also in three "height" versions - for objects high up, far down, or "in mid-air".
</a>
</ul>
<a name="999250">
As you notice, the images of Olaf in the file are neatly and evenly spaced. This makes it easier for GRAAL to "cut out" these images and store them in its image bank later.<p>
</a>
<a name="999251">
Also note that there are no separate images for the right and left profiles - to make life a little easier, and less memory consuming, the profile images will simply be flipped by GRAAL when a reversed view is required.<p>
</a>
<a name="999252">
We will need more images of Olaf during the course of the game, but since they will only be used for special occasions, they are loaded into memory only when they are needed and erased afterwards. So Olaf_Original.iff contains all the "global" images of our main character and favourite hero.<p>
</a>
<a name="999253">
<h2>4.3	 Basics about Images and Bobs</h2>
</a>
<a name="999254">
We are going to talk a lot about stills, cels, animations and BOBs in this tutorial, all concepts dealing with how an image is used.<p>
</a>
<a name="999256">
A still is any image that is static.<p>
</a>
<a name="999258">
An animation is any image that moves, and it does so by using a number of slightly different stills replacing each other, sometimes referred to as animation cels.<p>
</a>
<a name="1006526">
In GRAAL, all images used in the game - stills as well as animation cels - are stored in an image bank.<p>
</a>
<a name="999262">
BOB is short for Blitter OBject. BOBs are well-known to Amos programmers. They are, basically, the way GRAAL manages the display of all graphic items on screen that aren't just backdrops: Objects, animated characters, texts, and so on. BOBs can be put into the display and deleted again without harming the backdrop picture. To achieve this, the system must keep track of all these graphic items by assigning each one used at any time with a BOB number. <p>
</a>
<a name="999264">
Any BOB may use any image (or vice versa, depending on how you look at the world). For example, BOB number 44 may be used to display a flower, held in image bank position 56, in one scene. In another room or scene, the same BOB number 44 may be used to display a knife, which is image 78 in the bank. Confusing? <p>
</a>
<a name="1006531">
You usually specify BOB numbers in the statements that define image-related things, like OBJECT:, ANIM: and STATIC: stetement. There are also commands to handle BOBs that are not connected to any specific item: BOBON and BOBOFF.<p>
</a>
<a name="999265">
Since re-cycling is the word of the day, there is no difference in the image types used for different purposes - all are stored in the image bank, and you may use the same image as an animation cel in one situation and as a still image in another.<p>
</a>
<a name="999268">
The image bank, where we store all images, must be logically divided into three sections:<p>
</a>
<ul>
<a name="999270">
<li>Global images are those that are kept in memory at all times, for example all Olaf's basic movements, icons for global objects, and command area graphics. The number of slots used for these are defined with the N_GLOBALIMGS: statement. Make an educated guess how many of these you'll need. "Olaf" uses about 90.
</a>
<a name="999271">
<li>Room images are images that are only needed in a specific room - as soon as the game switched to a new room, all these images are erased from memory and replaced by the graphics for the new room. The number of these is defined by the N_ROOMIMGS: statement. When referred to in the scripts, their numbers are always prefixed with RIMG: RIMG5 means room image 5.
</a>
<a name="999272">
<li>Section images work the same way as room images, but for a section (collection of connected rooms) rather than a single room. Their number is defined by the N_SECTIONIMGS: statement. When referred to in the scripts, their numbers are always prefixed with SIMG: SIMG10 means section image 10.
</a>
</ul>
<a name="999273">
If you make a mistake when estimating the number of each image category here, it is not the end of the world. These numbers can be altered at any time later on.<p>
</a>
<a name="999274">
<h2>4.4	 The Images in the main script</h2>
</a>
<a name="999275">
Back to the main script now, to practice what was just preached:<p>
</a>
<a name="999276">
<pre>N_GLOBALIMGS: 90 <br>
N_SECTIONIMGS: 30 <br>
N_ROOMIMGS: 70
</pre>
</a>
<a name="999277">
This means that right now, we believe we need 50 global images, 30 for use in sections, and 70 for use in rooms. If we change our minds later on, we can always change the numbers then.<p>
</a>
<a name="999279">
Let's define the main character's images. The statement<p>
</a>
<a name="999280">
CLPART: Olaf_Original.iff<p>
</a>
<a name="999281">
tells GRAAL that following statements will grab images from the picture file Olaf_Original.iff<p>
</a>
<a name="999282">
<pre>IMGS: 10;11;1;1;31;47;32;0
</pre>
</a>
<a name="999283">
tells GRAAL to grab 10 images and store them in image slot 11 and upwards.<p>
</a>
<a name="999284">
In the GRAAL editor, try this:<p>
</a>
<ul>
<a name="999285">
<li>Put the cursor on the statement name IMGS: .
</a>
<a name="999286">
<li>Click &lt;Edit parameters&gt;.
</a>
<a name="999287">
<li>Click &lt;Area&gt;.
</a>
<a name="999288">
<li>The Olaf_Original.iff file appears with ten frames showing which pieces of graphics will be cut out. The frames can be moved, resized, and re-spaced. If you were to change the new position with the Enter key (but don't do it now!), the parameters of the statement reflects the changes you made. See <a href="graal22.htm#1000040">``The Editor'' on page 79</a> for a complete description of the editor.
</a>
</ul>
<a name="999292">
More CLPART: and IMGS: statements follow upon this first one, until all basic images we need have been loaded into the image bank.<p>
</a>
<a name="1003609">
If you want to use multiple controllable characters, automatic character scaling, or make the single controlled character "clickable", you have to define a CHAR: statement for it.<p>
</a>
<a name="1003610">
In my demo adventure, I do use character scaling, so let's define Olaf with a CHAR: statement:<p>
</a>
<a name="1003611">
<pre>CHAR: 1;18;11;40;1;1;37;0;22;1.2;47;31
</pre>
</a>
<a name="1003612">
<pre>1;
</pre>
</a>
<a name="1003613">
means Olaf is character number one. There must ALWAYS be a character number one if CHAR: statements are used at all!<p>
</a>
<a name="1003614">
<pre>18;
</pre>
</a>
<a name="1003615">
means that Olaf is object 18. We'll come back to defining objects later - in this case, the object definition holds some important information about Olaf, like which animation channel he will be using.<p>
</a>
<a name="1003630">
We will not go into details about the other parameters here - read all about it in the on-line reference.<p>
</a>
<a name="1003787">
(In older versions of GRAAL, there was no CHAR: statement, or indeed a character object - instead, you had separate CHARACTER_WIDTH:, CHARACTER_HEIGHT: and similar statements to set the properties now dealt with in the CHAR: statement.)<p>
</a>
<a name="1003786">
Anyway, on with it. We need to define some graphics concering some standard movements and still images for our hero:<p>
</a>
<a name="999302">
<pre>STILL_RIGHT: 14<br>
STILL_LEFT: //14 <br>
STILL_BACK: 12 <br>
STILL_FRONT: 11
</pre>
</a>
<a name="999304">
These statements tell which still images are to be shown when Olaf is facing in the respective direction, doing nothing.<p>
</a>
<a name="999306">
Wait a minute, what's that strange "//14" thing? Well, it's a convenient way of re-using graphics. Any image number prefixed with "//" will display the image flipped left/right, so you don't have to create graphics for both views. Neat, eh?<p>
</a>
<a name="999307">
Anyway, on with it.<p>
</a>
<a name="999308">
<pre>PAUSE_RIGHT: 13 <br>
PAUSE_LEFT: //13 <br>
PAUSE_BACK: 12 <br>
PAUSE_FRONT: 11
</pre>
</a>
<a name="999309">
These images are used when Olaf pauses after having gone in a certain direction. If you wish, they may be set to exactly the same values as the STILL_... images. However, as you see, Olaf uses image 13, a slightly more relaxed, forward-facing and "ready-for-input" pose, for the right and left poses in these statements than in the STILL_... statements. <p>
</a>
<a name="999310">
You don't HAVE to make the left pose the flipped-over version of the right pose - if you want to draw different images for each direction, go right ahead. Also, if there is any risk of both views of the same image being shown on screen at the same time, they should be separate images! For more info, see <a href="graal22.htm#999708">``Character and Graphics Design'' on page 53</a>.<p>
</a>
<a name="999315">
So far, all we have done is specify still images. Now we enter into the gruesome, yet strangely attractive world of animation:<p>
</a>
<a name="999316">
<pre>WALK_RIGHT: A 0,(16,6)(15,6)(14,6)(17,6) ... <br>
WALK_LEFT: A 0,(//16,6)(//15,6)(//14,6)(//17,6) ... <br>
WALK_AWAY: A 0,(29,8)(30,8)(31,8)(30,8) <br>
WALK_TOWARD: A 0,(26,8)(27,8)(28,8)(27,8)
</pre>
</a>
<a name="999318">
And yes, AMOS Pro users will immediately give a cry of joy: It's AMAL!<p>
</a>
<a name="999319">
AMAL is AMOS Pro's animation language, and GRAAL uses the same syntax for animations. So let's see what we have here:<p>
</a>
<a name="999320">
"A 0," simply tells GRAAL to repeat the following animation sequence indefinitely. (Stay calm - GRAAL will handle all starting and stopping of standard character animations automatically.)<p>
</a>
<a name="999321">
"(16,6)(15,6)(14,6)" and so on are the images and display lengths of each animation cel. For WALK_RIGHT:, first image 16 is displayed for 6 frames (=screen updates), then image 15 is displayed for 6 frames, and so on. When the end of the list is reached, the animation loops and starts over with image 16 again. As you see in the WALK_LEFT: statements, flipped images are used in animations also - no problems. For more about animations, see <a href="graal22.htm#999733">``Designing Animations'' on page 54</a>.<p>
</a>
<a name="999326">
It's quite wise to use 6 frames as the smallest time space for any image during background scrolling - 3 is possible and may work well if you have a limited number of BOBs in each scene in your adventure. However, if you paint on a large canvas so to speak, the system will have problems fitting all graphic updates into a 3 frame space and so the animation may become jerky. (6 isn't safe in all situations, but it usually works and is a good compromise.)<p>
</a>
<a name="999329">
<pre>TALK_MAP: 11;A 0,(20,18)(11,12)(20,12)(11,6)(19,12)
</pre>
</a>
<a name="999330">
Not only walking is animated and automated in GRAAL - talking is as well.<p>
</a>
<a name="999331">
The animation to be used for speech in each situation is not connected to a certain direction, but rather to what image is displayed on screen at the time the character starts talking - The above statement tells us to use this animation if the character is facing forwards (image 11) when the speech starts.<p>
</a>
<a name="999332">
As you see in graal.main, there are six TALK_MAP:s specified - all STILL_ and PAUSE_ images are accounted for, which indeed they must be for GRAAL automation of the speech to work in all standard situations. And you can test for flipped images, too: TALK_MAP: //14; ..., for instance, checks if the image displayed is the flipped version of image 14.<p>
</a>
<a name="999333">
<pre>HANDLE_MAP: 11;A 1,(11,12)(36,1);A 1,(11,12)(34,1);A 1,(11,12)...
</pre>
</a>
<a name="999334">
Standard "manipulation" or handling of objects are specified in a similar manner - the animation to be used when a certain object is handled depends on a) the previous character image on screen and b) whether the object in question is placed high up, low down or in mid-air - an animation sequence for each possible position is supplied in the same statement, separated by semicolons.<p>
</a>
<a name="999335">
Note that the last image in each sequence should be specified as shown for only ONE frame - this is because a) the character will stay in that position during the handling of the object anyway, and b) we may wish to immediately do some other graphic tricks after the HANDLE command has been given, such as placing an object in the character's out-stretched hand. Specifying too long a pause in these animation sequences would produce an unwanted pause in the flow of the script.<p>
</a>
<a name="999336">
To summarise, if the character is facing forward using image 11, and suddenly is commanded to handle an object placed in mid-air, (the cup in the "Constantinoplian" bar is a concrete example), the middle animation sequence in the above statement, which is A 1,(11,12)(34,1), would be executed.<p>
</a>
<a name="999337">
OK. That was a lot of hard work and tricky definitions to sink one's teeth into, but guess what? We're done! We have actually completed a large percentage of the animations needed for our hero, and can get on with designing the adventure itself!<p>
</a>
<a name="999338">
The statements we have defined above will be used and executed time and time again throughout the adventure, and in a fully automated fashion, too. But you control-freaks should not worry too much: GRAAL contains enough script commands to enable you to break away from the standard poses and animations in any given special situation - if you are willing to take on the extra work and extra coding in the scripts that is required.<p>
</a>
<a name="999339">
<h1>5	  "A Room! A Room! A Kingdom for a Room!"</h1>
</a>
<a name="999340">
As you may gather from the heading of this chapter, we now quite badly need a room or other location to move about in - having our hero confined to a lot of abstract image and animation statements in the main script will not make anyone happy.<p>
</a>
<a name="1005662">
Let's start with room number one. The demo adventure first goes through a couple of other rooms, but these only make up the introductory animation and this is where the real action starts. <p>
</a>
<a name="1005663">
Similar to how the main properties of the adventure is defined in graal.main, the properties of room 1 is defined in the script 1.room. Have a look.<p>
</a>
<a name="999344">
The first statement we come across here is<p>
</a>
<a name="999345">
<pre>UPDATE: 3;1
</pre>
</a>
<a name="999346">
which sets the updating speed of the scene area. The higher the numbers, the slower the screen updating, and the more graphics GRAAL is capable to shift between updates. To keep animations etc. from becoming jerky, the numbers must be set high enough to cope with all graphics.<p>
</a>
<a name="999347">
Actually, this only becomes a real problem when the background is scrolling, so there are two numbers. The first is only used during such scrolls. At all other times, the update rate is determined by the second number. And in this room, the first number is completely irrelevant, because the scene fits into the display without scrolling - it is exactly 320 pixels wide. For other rooms, like the harbour, UPDATE: is set to 6. (I have designed all of Olaf's animations to work with the update range set in multiples of 2 or 3.)<p>
</a>
<a name="999348">
Next, there comes a<p>
</a>
<a name="999349">
<pre>SECTION: 1
</pre>
</a>
<a name="999350">
statement, indicating that this room is part of section 1, as are all the rooms making up Constantinople in this game.<p>
</a>
<a name="999352">
Next, we need a background picture for the scene area. I prepared the interior of this rather primitive bar in the file 1BG.IFF using the 3D modelling and rendering freeware program POV-RAY. The gorgeous 24-bit image that was the result was then reduced to 16 colours, creating an image that is crude but suitably "cartoon-like" for the purpose.<p>
</a>
<a name="999353">
The background's 16 colour registers were then moved around and combined with 16 standard colours used for Olaf and any other common BOBs and images, whereupon I remapped the colours of the 16-colour original in DPAINT. Now, all that remains is to tell GRAAL to use this picture as the backdrop. <p>
</a>
<a name="999354">
<pre>BACKDROP: 1BG.IFF
</pre>
</a>
<a name="999355">
takes care of that.<p>
</a>
<a name="999356">
The width of the backdrops may be from 320 up to 640, making for excellent scrolling background scenarios (as shown in the Constantinople main street and the Baghdad panorama, for instance). The height is variable, but must be the same for all rooms, and is set with the AREA_SIZES: statement in graal.main<p>
</a>
<a name="1003592">
Each time we enter a new room, Olaf must have a starting position and pose. This is defined by the<p>
</a>
<a name="1003593">
<pre>START_POS: 1;13;20;115;L;1
</pre>
</a>
<a name="1003594">
statement. This not only indicates where Olaf starts, but whether the background screen starts scrolled to the far left, far right or the middle. (In this case, it's all the same, since the scene fits within the screen width.)<p>
</a>
<a name="999360">
Any number of starting positions may be defined for the same room - great for those really awkward labyrinths!<p>
</a>
<a name="999362">
GRAAL is not truly 3D - nothing shown on a computer screen ever is - but uses a simulated 3D perspective. The bar in 1BG.IFF has a floor, extending from the very bottom of the scene area and a few lines up in the picture - if Olaf moves higher up in the picture, he is also going further back in the room. The effect is demonstrated more fully by the alley in the street outside the bar, which Olaf can actually "walk into". To enhance the effect, GRAAL can also scale the character or characters under your control automatically, so the further up they go, the smaller they become. (However, this is only done for rooms where it is needed, and only if you specifically ask for it.)<p>
</a>
<a name="999364">
Now, in order for Olaf to stay on the floor and not start climbing the walls of the bar, we need some way of restricting his movement. We do that using statements like<p>
</a>
<a name="999365">
<pre>FLOOR: 1;16;114;304;119;1-1/2-2/3-3/4-4
</pre>
</a>
<a name="999366">
Each such statement defines a rectangular part of the picture where Olaf may place his feet. If there is more than one such rectangle, each is defined by a separate floor statement, and all floors must overlap with at least one other floor to enable Olaf to find his way from one floor to another. The last parameter, "1-1/2-2/3-3/4-4", describe how Olaf navigates between the four floors in this room. See the FLOOR: statement in the on-line reference for more information about this.<p>
</a>
<a name="999368">
It wouldn't be much fun to have an adventure take place in only one room (although such a thing IS possible - how about a "closed room murder mystery"?). So the next statement, <p>
</a>
<a name="999369">
<pre>EXIT: 1;7;66;12;112;10;113;Exit to\street
</pre>
</a>
<a name="999370">
defines an exit from the bar. This creates a "clickable" rectangle on the screen with some additional parameters describing the properties of the exit. We will come back to the subject of switching rooms further on.<p>
</a>
<a name="999371">
So, now we have a background, an exit, and area to move about on, and much more. Time to add some special graphics to the room to spice things up a little.<p>
</a>
<a name="999372">
<pre>CLPART: 1FG.IFF
</pre>
</a>
<a name="999373">
is a statement telling GRAAL that we wish to grab some clipart from the 1FG.IFF file to use as images in this room. <p>
</a>
<a name="999374">
<pre>ROOMIMGS: ...
</pre>
</a>
<a name="1004663">
statements follow the syntax of the IMGS: statement we used in the main script. Every image grabbed with this statement should later be referred to by a "room image number", which is a number preceeded by RIMG. For example, RIMG3 means room image 3.<p>
</a>
<a name="1004664">
The images we grab as room images are all used for objects and graphics that are unique to this room, and are not much use outside it (although you CAN grab clipart from the same 1FG.IFF file anywhere you like in the game, of course).<p>
</a>
<a name="999377">
Perhaps some of the clipart we just loaded is supposed to be pasted into the scene without doing anything except being pretty. The statements STATIC: and ANIM: are used for this purpose - which one depends on whether the image should be static or animated. We have two such static objects in the bar. One is the barrel behind which Olaf appears. It has no other function except hiding Olaf at the start of the game and being a general foreground object which adds a bit of depth to the scene. The other is the wooden pillar, also placed in the foreground.<p>
</a>
<a name="999378">
That is the graphics department of room 1 over and done with.<p>
</a>
<a name="999379">
<h1>6	 The Object Matter</h1>
</a>
<a name="999381">
You could, theoretically, spring Olaf loose in the bar now, but there would be absolutely nothing to do - just an exit pointing to an undefined room, floors to move about on - and a barrel to hide behind! So far, there is not a single object to interact with!<p>
</a>
<a name="999383">
The OBJECT: statement lets you define things that can be manipulated in various ways. Every piece of your scene that you need to hide, show, interact with, or move around, should be defined as an object. For less "intelligent" graphics, you may wish to use ANIM: or STATIC: statements, or BOBON / PIMG commands.<p>
</a>
<a name="999384">
Just as with images, objects are defined in various places depending on where in the adventure they may appear - just in one room, in a section, or in the entire adventure. Sticking with the 1.room script for the moment, you see some<p>
</a>
<a name="999385">
ROOMOBJ: ...<p>
</a>
<a name="999386">
statements here. They define objects which are never removed from the bar, and never changed in any way: One of the barrels, the plate of spam that Olaf refuses to touch, and so on. Room objects are a great way of adding atmosphere, detail, and red herrings to a game without wasting computer memory - from the players' point of view, there is no way of telling whether an object is a room, section, or global object. Only you know!<p>
</a>
<a name="999387">
The policy in the tutorial is to leave details to the on-line reference in graal.guide, but understanding the properties of an object is rather vital, so let's examine one of the global objects closely.<p>
</a>
<a name="999388">
In the graal.main script, locate the line<p>
</a>
<a name="999389">
<pre>OBJECT: 16;piece of\paper;8;VIS;56;RIMG6;66;119;14;0;<br>
	//14;with;PICK;0;8;47;LOW;WD;an;this;it
</pre>
</a>
<a name="999390">
In the GRAAL Editor, you get a better view of the parameters if you place the cursor on the word OBJECT: and then click &lt;Edit Parameters&gt; to load the object into the Edit Parameters window:<p><img src="ge-param.gif"><p>
<p>
</a>
<dl>
<dl>
<dl>
<dl>
<dl>
<dl>
<a name="999394">
<dt> An object loaded into the parameter editor <br>(more about that in the chapter about the GRAAL Editor).
</a>
</dl>
</dl>
</dl>
</dl>
</dl>
</dl>
<a name="999395">
This statement describes a piece of paper not actually used in the demo portion of the adventure, but it serves to display the properties of a typical object:<p>
</a>
<a name="999396">
<pre>16; 
</pre>
</a>
<a name="999397">
means this is global object number 16.<p>
</a>
<a name="999398">
piece of\paper; <p>
</a>
<a name="999399">
is the name of the object. The backslash is replaced by a line break when the name is shown in the scene area.<p>
</a>
<a name="999400">
<pre>8; 
</pre>
</a>
<a name="999401">
is the room where the object first appears.<p>
</a>
<a name="999402">
<pre>VIS; 
</pre>
</a>
<a name="999403">
means the object can be seen and handled. (NVIS means "invisible".)<p>
</a>
<a name="999404">
<pre>56; 
</pre>
</a>
<a name="999405">
is the BOB number that will be used when displaying the object.<p>
</a>
<a name="999406">
<pre>RIMG6; 
</pre>
</a>
<a name="999407">
is the image number which is used to display the object by default. This could also be an animation sequence using the same animation syntax as the TALK_MAP: etc. statements explained previously.<p>
</a>
<a name="999408">
But wait a minute! We use an room image, obviously grabbed in the 8.room script, to display a global object, which is obviously not tied to that one room? Isn't this strange? <p>
</a>
<a name="999409">
No, it actually makes sense. Room 8 is the only place where the piece of paper will actually be SHOWN in that shape - when it is used further on in the game, it will only be displayed using its inventory icon. So this is a safe use of room images!<p>
</a>
<a name="999410">
<pre>66;119; 
</pre>
</a>
<a name="999411">
is the x and y position where the image will be displayed (i relation to the room image's hotspot).<p>
</a>
<a name="999412">
<pre>14;0; 
</pre>
</a>
<a name="999413">
is the "character offset". When Olaf wants to handle the piece of paper, he will walk to a position 14 pixels to the right and 0 pixels above the object's hotspot.<p>
</a>
<a name="999414">
Normally, we talk about the relative positions of the character's and object's hotspots here. (See <a href="graal22.htm#999770">``All About 3D and Hotspots'' on page 57</a>.) However, if you prefix the x value with a "W", for example W8;0; the x position refers to the edge of the character that is closest to the object instead. That technique allows for multiple characters of different widths more easily. However, if you only have one character, or all characters look more or less the same, don't bother.<p>
</a>
<a name="999421">
<pre>//14; 
</pre>
</a>
<a name="999422">
is the still image used to display Olaf once he has walked up to the object. Since the object is to the left of him, he will face it using image //14. And specifying the correct still image for each object is vital: Should Olaf begin to handle the object after walking up to it, the HANDLE_MAP: sequence linked to image //14 will be used. Should he start to talk, the TALK_MAP: sequence linked to the image will be used. This is all done automatically, as long as you specify the HANDLE_MAP:s, TALK_MAP:s and still images used for object handling correctly!<p>
</a>
<a name="999423">
<pre>with; 
</pre>
</a>
<a name="999424">
is a preposition. If a preposition exists, it is assumed that this object can not be used on its own with the USE verb - it must be combined with something else, and so the sentence line will read USE PIECE OF PAPER WITH, and the system will wait for a second object to be clicked. If this parameter is left blank, the object will be used on its own.<p>
</a>
<a name="999425">
<pre>PICK; 
</pre>
</a>
<a name="999426">
indicates that the object can be picked up (the condition IFPICK returns TRUE). NPICK is used for the opposite.<p>
</a>
<a name="999427">
Actually, you can easily override this parameter using script commands - picking up objects marked NPICK, and making the character refuse to pick up objects marked PICK. This setting only ensures objects which rely on the global ACTION: statements dealing with picking up and dropping will be handled in the correct way.<p>
</a>
<a name="999428">
Also, there is no risk in making an object pickable even if it is initially invisible (NVIS). If it cannot be seen, it cannot be accessed by the player, and thus, the PICK status becomes insignificant...<p>
</a>
<a name="999429">
(ALWAYS use NPICK for room objects, unless you make sure you make the character drop the object again before he leaves the room!)<p>
</a>
<a name="999430">
<pre>0; 
</pre>
</a>
<a name="999431">
If the object is animated using an animation command (instead of the single RIMG17 for this example), the animation channel must be specified here. The range of possible values is 2-16, and as with BOB numbers, the same number may not be used for two things simultaneously. The piece of paper is not animated, and therefore this parameter is 0.<p>
</a>
<a name="999432">
<pre>8; 
</pre>
</a>
<a name="999433">
This is the object's "quick command", that is, the command issued when the player points to the object and clicks the right mouse button. Verb 8 is LOOK AT.<p>
</a>
<a name="999434">
<pre>47; 
</pre>
</a>
<a name="999435">
This is the object icon used to show the object in the inventory: Global image 47.<p>
</a>
<a name="999436">
<pre>LOW; 
</pre>
</a>
<a name="999437">
This is an important one for all objects which can be picked or handled! It determines which of the "handle animations" Olaf will use. Since the piece of paper is on the floor, the LOW animation will be used. (Always place objects, or Olaf, using the character offset co-ordinates so that one of the three positions can be used in a natural way!)<p>
</a>
<a name="999438">
<pre>DW; 
</pre>
</a>
<a name="999439">
This is an "attribute string" which can be used to determine some general properties for the object. "D" stands for dead object, and "W" for "wood". (A rather pointless attribute in this case. Basically, it only tells us that it is softer than stone or steel!)<p>
</a>
<a name="999440">
Attributes are used to make basic responses to some actions seem more natural - you don't have to define separate replies to all objects, but can specify a general response for all cases of Olaf trying to use the small knife on objects made of wood, for instance. You may also find an "abstract" class very useful - when Olaf attempts to pick up the horizon, it enables you to respond with some really insulting remarks! (Look in the main script for ACTION: statements containing IFTYPE tests to see how this can be used.)<p>
</a>
<a name="1004608">
<pre>a;this;it
</pre>
</a>
<a name="1004609">
Often, you refer to an object in sentences and messages. For example, if someone looks at an apple, just may wish the message "Just an apple" to appear.<p>
</a>
<a name="1004614">
This is where you can define up to three "special words" that can be used to properly describe the object. By using special variables in the messages to refer to these words and the object name, you only need to specify one message to say things as different as, for example, "Just an apple", "Just a hotel", "Just two monkeys"<p>
</a>
<a name="999441">
GRAAL is quite flexible in many ways, and there are a number of GRAAL commands to alter many of the object's properties, such as the name, visibility, location and so forth during the course of the game. See the on-line reference for a complete list of commands. Generally speaking, the statements in the script files set things up - it is the commands contained in DACT:, LACT: and ACTION: statements executed during gameplay that brings the whole thing to life.<p>
</a>
<a name="999442">
While we are at it, let us examine another, but more human, global object: The bearded man / bartender.<p>
</a>
<a name="999443">
So, what is the difference between a bearded man and a piece of paper? Well, the bartender is animated using a default animation sequence, as you see. This sequence also uses room images, since the bartender never leaves room 1. Furthermore, the bartender can not be picked up (there's a relief!) and uses animation channel number 8 for the animation. His special attributes are "MV" - meaning he's a male character and alive.<p>
</a>
<a name="999444">
<h1>7	 Section Objects and Images</h1>
</a>
<a name="999446">
There is a third class of objects involved in the bar scene: Those defined in the section script 1.section with the SECTIONOBJ: statements. These are objects that only exist the very first time a new section of the game is visited, and disappear again during the visit to the section. It is not a completely necessary feature, but in the demo some of the objects in Constantinople are of this kind - the magic flute, for example, which disappears into the pawn shop before you can leave town.<p>
</a>
<a name="999447">
You will probably find section images (SIMGs) more useful than section objects. These are grabbed in the section script the same way room images are grabbed in the room scripts, but with the SECTIONIMGS: statement. Needless to say, they remain in memory during the visit to the section, but disappear and are replaced by other graphics the moment you walk into another game section.<p>
</a>
<a name="999448">
You are not obliged to use the section concept at all, especially if your adventure is quite small. However, at least one section script must exist, even if it just contains a comment saying "Not Used". Then specify all your rooms as belonging to this "empty" section.<p>
</a>
<a name="999449">
Okay, we have everything in place, except one VERY important thing - the instructions telling Olaf to deal with the commands you give him!<p>
</a>
<a name="999450">
<h1>8	 Camera! Action! Lights!</h1>
</a>
<a name="999453">
<h2>8.1	 ACTION: statements</h2>
</a>
<a name="1002803">
All conditions and commands executed in response to the player's actions are placed in ACTION: statements (except for the ones executed during dialogues, but we'll leave them out of the discussion for the moment).<p>
</a>
<a name="999454">
ACTION: statements may appear in all three major types of script file: room, section and main.<p>
</a>
<a name="999455">
The idea is that the ACTION: statements taking care of a certain action is placed closest to the place where the action takes place. If an action can only take place in one specific room, the ACTION: statements for it are placed in that room script. If the action is only valid in a certain section, they are placed in the section script. If it is something that needs to be taken care of regardless of where it appears, the main script is the place.<p>
</a>
<a name="999456">
In fact, almost every action should have some "safety net" in the main script - if no specific action is taken in the ACTION: statements of the room and section scripts, the main script ACTION: statements should at least make it look like Olaf understood what you were trying to do! There is nothing more unrewarding than clicking away at lots of things and have absolutely nothing happen.<p>
</a>
<a name="999457">
Okay. So we write a lot of action statements containing commands that make Olaf walk, talk, and jump! But how does GRAAL know when to use what actions?<p>
</a>
<a name="999458">
Well, suppose we want to pick up the cup on the barrel in the bar. Let's look at how that is performed in GRAAL, keeping in mind that GRAAL always checks the room script first, then the section script, and finally, if nothing else helps, the main script. Each script is checked from the top down to the bottom, which is very important to remember in order to get the sequence of tests and commands right.<p>
</a>
<a name="999459">
When the player has clicked PICK UP and the CUP, GRAAL starts looking for appropriate ACTION: statements, knowing the number of the verb (PICK UP = 2) and the object (the CUP is section object 3, referred to as SOBJ3).<p>
</a>
<a name="999460">
The first parameter in each ACTION: statement is always the verb number, and in 1.room, the first ACTION: 2;... statement that we come across is<p>
</a>
<a name="1003634">
<pre>ACTION: 2;IFOBJ SOBJ3;ADDRF 0,20,1
</pre>
</a>
<a name="1003639">
IFOBJ SOBJ3 tells us to perform the rest of the actions if we pointed to room object SOBJ3, and we did. What happens next? Well, 1 is added to the value of room flag 20 for room 0. More about flags later - suffice to say they are like variables in ordinary programming languages, and this particular flag is used to hold the player score in "Olaf". So you get one point for picking up the cup...<p>
</a>
<a name="1003640">
When we are done with the first ACTION: 2;... line, the next one reads<p>
</a>
<a name="999461">
<pre>ACTION: 2;IFOBJ ROBJ6;....
</pre>
</a>
<a name="999466">
This is not a match, because the line is only relevant if we're trying to pick up ROBJ6. Going through the rest of the ACTION: 2;... lines in 1.room, we quickly discover that there are no more lines concering the mug there.<p>
</a>
<a name="1003645">
Switching to the 1.section script, let's see if we are more lucky. No, not a single PICK UP command, actually. This is not so surprising, since almost all objects start out in a certain room.<p>
</a>
<a name="999467">
Well, why then wasn't there a command to really pick up the cup in the 1.room script? Because, with the power of GRAAL, almost all PICK UPs of any "pickable" object can be handled using a few single ACTION: statements in the main script - only objects handled in special ways in room 1 need to have their actions in the 1.room script. Going on to the main script, we find the following:<p>
</a>
<a name="999468">
<pre>ACTION: 2;IFCARR;SAY I Already have it!;EXIT
</pre>
</a>
<a name="999469">
IFCARR says that if the object we refer to is already in the inventory, then let Olaf say "I already have it!". EXIT means no more tests on ACTION: statements will be done for our current input: The sentence line will be cleared and Olaf is ready to try something else.<p>
</a>
<a name="999471">
However, SOBJ1 is NOT in our inventory yet, so we go on:<p>
</a>
<a name="999472">
<pre>ACTION: 2;IFPICK;MOBJ;HANDLE;W 12;PICK;HANDLE -1;EXIT
</pre>
</a>
<a name="999473">
Now behold the true power of the GRAAL. This is the stuff we have been tormenting ourselves for all along the tutorial up to this point!<p>
</a>
<a name="999474">
<pre>IFPICK; 
</pre>
</a>
<a name="999475">
If the object is "pickable"...<p>
</a>
<a name="999476">
<pre>MOBJ; 
</pre>
</a>
<a name="999477">
Olaf walks to the default offset position next to the object (as specified in the OBJECT: statement for the cup)...<p>
</a>
<a name="999478">
<pre>HANDLE; 
</pre>
</a>
<a name="999479">
Olaf stretches out a hand according to the HANDLE_MAP: animation...<p>
</a>
<a name="999480">
<pre>W 12; 
</pre>
</a>
<a name="999481">
and waits for about 1/4 of a second...<p>
</a>
<a name="999482">
<pre>PICK; 
</pre>
</a>
<a name="999483">
grabs the object (it disappears from the screen and enters the inventory list)...<p>
</a>
<a name="999484">
<pre>HANDLE -1; 
</pre>
</a>
<a name="999485">
lowers the hand again to the position it had before the HANDLE command...<p>
</a>
<a name="999486">
<pre>EXIT; 
</pre>
</a>
<a name="999487">
...and then we are done!<p>
</a>
<a name="999488">
Now, if our object hadn't been "pickable", the ACTION: used by us above are followed by a couple of "safety nets". (Remember, we never get to these lines if the object has indeed been picked up - the EXIT command sees to that.) One example of such a safety net is:<p>
</a>
<a name="999489">
<pre>ACTION: 2;IFTYPE -;SAY That was rather far-fetched, wasn't it?;EXIT
</pre>
</a>
<a name="999490">
<pre>IFTYPE -; 
</pre>
</a>
<a name="999491">
This checks if the referred object was an abstract object, like the horizon in the Constantinople harbour. Since abstract objects can't very well be picked up under any circumstances, <p>
</a>
<a name="999492">
<pre>SAY That was rather far-fetched, wasn't it?;EXIT
</pre>
</a>
<a name="999493">
makes Olaf "speak" this sentence using the talk-map corresponding to his current position on the screen.<p>
</a>
<a name="999494">
And finally, if the object happens to be un-pickable, but of another type, <p>
</a>
<a name="999495">
<pre>ACTION: 2;SAY I can't pick that up.;EXIT
</pre>
</a>
<a name="999496">
gives a rather dull but to-the-point message to the player. Don't go erasing ACTION: statements in the supplied example main script altogether the first thing you do - a lot of these "safety net" actions should be in almost any game, although you should of course alter the wording and detailed behaviour to suit your own needs!<p>
</a>
<a name="1002802">
<h3> Special ACTION: Statements</h3>
</a>
<a name="1002806">
The verb numbers corresponding to normal player input goes from 1 and upwards. Instead of an ordinary verb number, the following can appear as the first parameter of an ACTION: statement:<p>
</a>
<a name="1002809">
<pre>0 
</pre>
</a>
<a name="1002834">
(zero) - the verb number used for "go to" (that is, clicking an exit. See <a href="graal22.htm#999497">``Using Exits'' on page 36</a>).<p>
</a>
<a name="1002810">
<pre>-1
</pre>
</a>
<a name="1002835">
Timer events. See <a href="graal22.htm#999812">``Timer Events'' on page 62</a>.<p>
</a>
<a name="1002821">
<pre>-2
</pre>
</a>
<a name="1002836">
Things to do after a LOAD or RESUME command. See <a href="graal22.htm#999814">``The Load / Save Room.'' on page 63</a>.<p>
</a>
<a name="1002826">
<pre>?
</pre>
</a>
<a name="1002837">
means any normal verb number from 1 and upwards will match this statement. For example, you may have a room where no ordinary actions should be possible. All player input (except exit movements) could then be trapped in the room script with a single<p>
</a>
<a name="1002831">
<pre>ACTION: ?;EXIT
</pre>
</a>
<a name="1002832">
statement.<p>
</a>
<a name="1002863">
<h3> Repeating Verbs and Conditions</h3>
</a>
<a name="1002838">
If the first parameter in an ACTION: statement reads<p>
</a>
<a name="1002868">
<pre>=
</pre>
</a>
<a name="1002839">
the verb number and initial conditions from the action statement immediately above, saving you some typing if several statements begin in the same way. <p>
</a>
<a name="1003947">
Example:<p>
</a>
<a name="1002840">
<pre>ACTION: 1;IFOBJ 2;IFOBJ2 21;MOBJ 21;SAY Here you go!;...<br>
ACTION: =;RESP R,4,Thank you very much!;EXIT
</pre>
</a>
<a name="1002833">
The second line will actually be interpreted as<p>
</a>
<a name="1002844">
<pre>ACTION: 1;IFOBJ2;IFOBJ2 21;RESP R,4,Thank you very much!;EXIT
</pre>
</a>
<a name="1002845">
If only some of the initial conditions should be repeated, but a blank space in between conditions. Here's the example once more, this time repeating only the first condition:<p>
</a>
<a name="1002848">
<pre>ACTION: 1;IFOBJ 2; ;IFOBJ2 21;MOBJ 21;SAY Here you go!;...<br>
ACTION: =;RESP R,4,Thank you very much!;EXIT
</pre>
</a>
<a name="1002846">
Now the second line will actually read<p>
</a>
<a name="1002860">
<pre>ACTION: 1;IFOBJ2;RESP R,4,Thank you very much!;EXIT
</pre>
</a>
<a name="1002858">
The method can also be used to repeat the initial part of DACT: and LACT: statements.<p>
</a>
<a name="1005724">
Note: If you change the order of your ACTION: statements, check any "=" constructions VERY carefully so that the "=" still repeats the correct conditions!<p>
</a>
<a name="999497">
<h1>9	 Using Exits</h1>
</a>
<a name="999499">
Now that we are familiar with the general behaviour of ACTION: statements, it is time to explain how exits work.<p>
</a>
<a name="999500">
As you may or may not remember, the EXIT: statement in the 1.room script defined a "clickable" rectangle on screen. However, we never explained what happens when the player clicks the exit.<p>
</a>
<a name="999501">
This is what happens: GRAAL interprets this as a very special input sentence, with the VERB set to 0 and OBJ1 set to the number of the exit. It then checks the ACTION: statements just as if the player had input a normal command. This is a typical ACTION: statement to take care of an exit click:<p>
</a>
<a name="999502">
<pre>ACTION: 0;IFOBJ 1;MEXIT;CIMG 12;GOTO 2,1
</pre>
</a>
<a name="999503">
<pre>0; 
</pre>
</a>
<a name="999504">
was the verb number indicating an "exit click".<p>
</a>
<a name="999505">
<pre>IFOBJ 1; 
</pre>
</a>
<a name="999506">
tests if it was exit number 1 that was clicked.<p>
</a>
<a name="999507">
<pre>MEXIT; 
</pre>
</a>
<a name="999508">
is a special command that can only be used in ACTION: 0;... statements. It makes the main character move to the exit point specified in the EXIT: statement (not to be confused with the EXIT *command*, which is something completely different).<p>
</a>
<a name="1002874">
<pre>CIMG 12
</pre>
</a>
<a name="1002875">
Perhaps we wish the character to face the door before exiting.<p>
</a>
<a name="999509">
<pre>GOTO 2,1
</pre>
</a>
<a name="999510">
is a command specifying which room and entrance to go to. Voil&agrave;!<p>
</a>
<a name="999511">
Of course, you are free to do whatever you like in these statements, just like in any other ACTION: statement. You may manipulate the way exits are interpreted to your heart's content!<p>
</a>
<a name="999512">
<h1>10	 The DACT: Statements</h1>
</a>
<a name="999514">
In each room script, there must be at least one DACT: statement. The DACT: statements contain conditions and commands that are run through each time the room is entered. The flow of control is the same as for ACTION: statements: If a condition is not met, the rest of that DACT: statement is disregarded, and if an EXIT command is encountered, no more DACT: lines will be checked this time around.<p>
</a>
<a name="999515">
When GRAAL starts to run through the DACT: statements, all graphics and objects are already loaded into their proper places. However, the screen is still black - the light switch has not been pushed yet, so to speak. This means you can do tests and move things around using commands in the DACT: statements before you let the player see the scene, which is very, very useful. Once you are done preparing the scene, simply use a LIGHTS ON command in a DACT: statement. When an EXIT command is encountered, control is handed over to the player.<p>
</a>
<a name="1003112">
<h1>11	 Flags and String Variables</h1>
</a>
<a name="1003118">
In order to keep track of what is going on in your adventure, you need a way to store information about the player's actions. In GRAAL, there are two forms of variables that can be used to stora information: Flags and string variables.<p>
</a>
<a name="1003123">
<h2>11.1	 Flags</h2>
</a>
<a name="1003124">
Flags can hold integer numbers. There are 20 flags for each room and 6 for each object. In reality, you can use any flag for any purpose you like, but naturally it is most logical to keep information regarding a certain room in that room's room flags, information about an object in its own object flags, and so on. Also, this is often most convenient - if you refer to the current room's or object's flags, you don't have to specify the room or object number in most flag-handling conditions and commands.<p>
</a>
<a name="1003125">
Since room 0 is never used as a location in the game, but it exists as a "flag space", you can use room 0 flags to hold information that pertains to the whole game.<p>
</a>
<a name="1003127">
There are commands to set, add, and subtract from flag values, and conditions to test the contents in many different ways. Flags can also be set to store in-game dates and times.<p>
</a>
<a name="1003135">
The flag values can also be printed in sentences by all text-displaying commands - see next chapter.<p>
</a>
<a name="1003133">
<h2>11.2	 String Variables</h2>
</a>
<a name="1003134">
In addition to the flags, there are 12 "global" string variables that can hold text strings like the player name, or just snippets of text you have to repeat in several text-displaying commands. There are commands to set and test string variable contents, and there is also a PROMPT command that asks the player for input. The PROMPT command uses the dialogue area to display a prompt on the first line and a text cursor on the second line. The player then enters the text of his choice, and ends the input by pressing the Enter key. Simple as that.<p>
</a>
<a name="1005112">
<h1>12	 Displaying text</h1>
</a>
<a name="1005117">
There are a number of commands that share the same routines when displaying text messages on the screen: SAY, THINK, RESP, TEXT, and the dialogue lines in the LINE: statements (see next chapter). Here's what you can do to spice up the messages to your player:<p>
</a>
<a name="1005121">
<h2>12.1	 Text styles</h2>
</a>
<a name="1005122">
SAY, THINK, RESP, and LINE: all take care of displaying the sentences "spoken" by the characters in the game. You can set the general properties for how this text should look with the SPEECH_LAYOUT: statement in graal.main. You can choose between transparent, semi-transparent or solid background, square, rounded or cartoon-style speech bubbles, and so on.<p>
</a>
<a name="1005126">
Because TEXT is sometimes used in special circumstances as a resplacement to SAY or RESP, it's essential that TEXT messages can be displayed in the same style as the other commands. This is done with the SETTEXT command, which affects all subsequent TEXT command. The changes apply until the next SETTEXT command. A SETTEXT with no parameters reverts to the default text style (text with transparent background and outlined in black, no border).<p>
</a>
<a name="1005123">
<h2>12.2	 Variables and Other Special Strings</h2>
</a>
<a name="1005124">
The value of any room flag, object flag or string variable can be shown in sentences. <p>
</a>
<a name="1005733">
Example: The text #O#1#1# is replaced by the current value of object flag 1 for room 1, so the command<p>
</a>
<a name="1005734">
<pre>SAY I have #O#1#1# gold coins
</pre>
</a>
<a name="1005735">
may come out as "I have 23 gold coins".<p>
</a>
<a name="1005143">
Date and time values can be shown in a similar way. See graal.guide for details of the available options.<p>
</a>
<a name="1005144">
Also, this is where the three special words for each object come in handy. If word 3 for object 1 is "it", the text:<p>
</a>
<a name="1005153">
<pre>I can't see #W13#.
</pre>
</a>
<a name="1005154">
will display as "I can't see it".<p>
</a>
<a name="1005125">
<h2>12.3	 Audio Information</h2>
</a>
<a name="1005156">
Starting with GRAAL 2.3, you have the option of making a GRAAL "talkie", that is, have spoken dialogue instead of just plain old text displays. The SPEECHMODE command decides whether GRAAL should use text, audio or both. (Switching this via a command means you can code set-up screens where the players can chosse which type of output they want.)<p>
</a>
<a name="1005168">
Audio information consists of the name of the sound sample file, the sound channels to use, and a few other parameters. It is put just before the corresponding text strings within angle brackets. See graal.guide for details of the format and parameters. <p>
</a>
<a name="1005215">
This is an example of audio information that relates the audio file "sample.snd" with the text "This is the text to be spoken" in a SAY command:<p>
</a>
<a name="1005169">
<pre>SAY &lt;sample/D/D/D&gt;This is the text to be spoken.
</pre>
</a>
<a name="1005218">
For random alternatives, an audio info string must be related to each alternative for a complete sound track:<p>
</a>
<a name="1005223">
<pre>SAY &lt;cantdothat/D/D/D&gt;I can't do that.|&lt;impossible/D/D/D&gt;That is 
impossible!
</pre>
</a>
<a name="1005196">
If no audio information is available for a string, the text is always displayed in the normal way regardless of audio setting.<p>
</a>
<a name="1005189">
is audio information is present and audio is ON and text is OFF, only the sound sample is played.<p>
</a>
<a name="1005199">
In order not to clutter up the GRAAL directory with tonnes of audio files for speech, these are put in a special subdirectory named /graalaudio. Note that this only concerns the files specified in audio information strings: Ordinary sound samples and tracker modules are placed in the main directory exactly like they've always been.<p>
</a>
<a name="1005226">
For reasons beyond my control ,it seems like the IFF sound samples used must be less than 65536 bytes long. Oh well, for a complete "talkie", you really want to limit the size of the samples anyway. For a typical-sized room with a dialogue, even sound samples at 8363 Hz can take up about 2 megs - and that's for one room!<p>
</a>
<a name="999516">
<h1>13	 Having a Chat</h1>
</a>
<a name="999520">
<p><img src="g-dlg.gif"><p>
<p>
</a>
<dl>
<dl>
<dl>
<dl>
<dl>
<dl>
<a name="999521">
<dt> GRAAL in the dialogue mode
</a>
</dl>
</dl>
</dl>
</dl>
</dl>
</dl>
<a name="999523">
There are few things that breathe life into a graphic adventure the way good dialogues do. Of course, in order to have a dialogue, you need to have at least two people communicating. In this case, this means our hero and another character in the game.<p>
</a>
<a name="999524">
In the bar where the game starts, there is a bearded bartender who is very likely to become the first person Olaf speaks to. Let's look at how this is done.<p>
</a>
<a name="1006569">
Note: The examples in this chapter is for a "Text only" adventure, whereas the current Olaf demo also has some audio information appended to each sentence that the characters speak in room 1. See <a href="graal22.htm#1005125">``Audio Information'' on page 40</a>.<p>
</a>
<a name="999526">
First of all, any character involved in conversations must be defined as an object using an OBJECT: statement - it can be a global, section or room object. There is nothing special with the definition: Just make sure the object is visible and placed in the room where the dialogue takes place. Also, assign an animation channel to it.<p>
</a>
<a name="999527">
We need a way to make each "speaking partner" talk to the player-controlled character, which is done by defining DLG: statements in the main script (below the OBJECT statements). Each DLG: statement defines a set of rules for where and how the speech is displayed, and an animation sequence for the speaking partner talking.<p>
</a>
<a name="999528">
<pre>DLG: 1;5;11;-20;A 0,(RIMG4,12)(RIMG6,24)...
</pre>
</a>
<a name="999529">
<pre>1; 
</pre>
</a>
<a name="999530">
means this is dialogue speech definition number one. <p>
</a>
<a name="999531">
<pre>5; 
</pre>
</a>
<a name="999532">
means that the appearance of the speaking partner is defined by global object 5 (the bartender).<p>
</a>
<a name="999533">
<pre>11; 
</pre>
</a>
<a name="999534">
is the colour used for the text displayed when the bartender speaks.<p>
</a>
<a name="999535">
<pre>20; 
</pre>
</a>
<a name="999536">
determines how far above the bartender's head the text is displayed.<p>
</a>
<a name="999537">
<pre>A 0,(RIMG4,12)(RIMG6,24)....
</pre>
</a>
<a name="999538">
is the animation used when the bartender talks.<p>
</a>
<a name="999539">
Some speaking partners are probably fairly static, and then you do not need more than one animation for the speech. However, nothing prevents you from defining more than one DLG: statement for the same speaking partner.<p>
</a>
<a name="999540">
Now that we have two statements in the main script, we move on to the 1.room script, where the actual dialogue contents are defined.<p>
</a>
<a name="999541">
A dialogue always starts when GRAAL encounters a DSET command in an ACTION: or DACT: statement. It then shifts into another mode, where the player's input is no longer a normal command sentence, but only the number of a dialogue alternative. GRAAL responds to the chosen alternative by going through LACT: statements that correspond to the selected alternative, and does not consider the ordinary ACTION: statements. Sooner or later, GRAAL encounters an EDLG command in one of the LACT: statements, which terminates the dialogue and switches the game back to the normal input mode.<p>
</a>
<a name="999542">
Let's begin from the beginning. When the player commands TALK TO  BEARDED MAN, the following ACTION: statement is performed:<p>
</a>
<a name="999543">
<pre>ACTION: 5;IFOBJ 5;IFOF 1=0;MOBJ;SAY Hello;RESP R,1,Hello,yourself;<br>
DSET 1,+3,+7,+9,+11,+12;EXIT
</pre>
</a>
<a name="999544">
<pre>5; 
</pre>
</a>
<a name="999545">
the verb is TALK TO - we have a match<p>
</a>
<a name="999546">
<pre>IFOBJ 5; 
</pre>
</a>
<a name="999547">
the object is the BEARDED MAN/BARTENDER - we still have a match<p>
</a>
<a name="999548">
<pre>IFOF 1=0; 
</pre>
</a>
<a name="999550">
Hello, what's this? It's a test of an object flag, as mentioned in <a href="graal22.htm#1003112">``Flags and String Variables'' on page 38</a>. By assigning values to flags and testing them, you can keep track of everything that has happened to an object - it's up to you to decide what to use the flags for. In this case, I have decided to use flag 1 for the bartender to see if this is the first time ever we talk to him. All flags are initially 0, so this test - IFOF 1=0 - is true in our case. Before the dialogue is ended, the flag values will be set to 1 to indicate that next time around, we should resume the conversation in a slightly different manner.<p>
</a>
<a name="999551">
OK, on with it:<p>
</a>
<a name="999552">
<pre>MOBJ; 
</pre>
</a>
<a name="999553">
We move up to the bartender just like we move up to any object before manipulating it.<p>
</a>
<a name="999554">
<pre>SAY Hello; 
</pre>
</a>
<a name="1006568">
Say "Hello".<p>
</a>
<a name="999555">
<pre>RESP R,1,Hello, yourself.; 
</pre>
</a>
<a name="999556">
This is the bartender's response. "1" means GRAAL will look up the statement <p>
</a>
<a name="999557">
DLG: 1;... <p>
</a>
<a name="999558">
in the main script to find out how the bartender should behave when talking. "R" means the default bartender animation will resume as soon as the talking is over.<p>
</a>
<a name="999559">
So far, all statements have been performed with the game still in the "normal" mode. Now comes the command which switches to dialogue mode:<p>
</a>
<a name="999560">
<pre>DSET 1,+3,+7,+9,+11,+12 
</pre>
</a>
<a name="999561">
This command engages us in dialogue number one and tells GRAAL to add the four dialogue alternatives 3, 7, 9, 11 and 12 to the list of possible lines for Olaf to speak. Since this is the first DSET command ever to be performed for dialogue one, they will be the ONLY four alternatives.<p>
</a>
<a name="999562">
<pre>EXIT
</pre>
</a>
<a name="999563">
exits the parsing of the TALK TO command, and leaves us to get on with the dialogue - the player now has to select a dialogue line from the dialogue area which has replaced the normal control area.<p>
</a>
<a name="999564">
What are dialogue lines 3,7,9, 11 and 12? All the lines are defined by LINE: statements in the 1.room script. Let us take line 3 as an example:<p>
</a>
<a name="999565">
<pre>LINE: 1;3;What is this place?;Where did you say I was?; 
</pre>
</a>
<a name="999566">
<pre>1;3; 
</pre>
</a>
<a name="999567">
means this is line 3 of dialogue 1<p>
</a>
<a name="999568">
<pre>What is this place?; 
</pre>
</a>
<a name="999569">
This is the line appearing in the dialogue command area (where the player can choose a line to say) when the alternative is previously unused.<p>
</a>
<a name="999570">
<pre>Where did you say I was?; 
</pre>
</a>
<a name="999571">
is the version that will appear if the alternative is "re-used". If this second version is specified as a blank space only, the first version of the sentence will always be used.<p>
</a>
<a name="999572">
"one blank space"<p>
</a>
<a name="999573">
The last semi-colon is followed by one, very important blank space, which tells GRAAL there are no conditions attached to this dialogue line.<p>
</a>
<a name="999574">
To explain the concept of dialogue conditions, let's look at another of the initially added lines, line 7. The definition of that LINE: goes:<p>
</a>
<a name="999575">
<pre>LINE: 1;7;Do you know anything about the ship in the harbour?; ;IFOF 2=1
</pre>
</a>
<a name="999576">
First of all, notice there is no second version of this line. The question will always look the same, regardless of how many times Olaf puts it to the poor bartender.<p>
</a>
<a name="999577">
Here, there is an additional condition that determines whether this dialogue alternative is available to Olaf or not. Object flag 2 for the bartender must be set to 1, otherwise the line will not appear in the dialogue command area, no matter how many DSET 1,+7 commands are issued. However, once a DSET 1,+7 command has been given, line 7 becomes a possible line: GRAAL will check object flag 2 for the bartender each time the dialogue is re-engaged or refreshed, and as soon as flag 2 becomes 1, the line will appear and become available for Olaf to speak.<p>
</a>
<a name="999578">
If you look through the lines, you will notice that only lines 3, 11 and 12 are unconditional. This means that if the first thing Olaf does is engage in conversation with the bartender, only those two alternatives will be visible. So what the player now sees in the command area is:<p>
</a>
<a name="999579">
<pre>What is this place? <br>
My head hurts.<br>
Could you help me, please...
</pre>
</a>
<a name="999580">
However, if he trundles off to the harbour to look at the ship, and only then returns to talk to the bartender, line 7<p>
</a>
<a name="999581">
<pre>Do you know anything about the ship in the harbour?
</pre>
</a>
<a name="999582">
is also available.<p>
</a>
<a name="999583">
OK, back to our poor player, currently facing the task of choosing a sentence to speak.<p>
</a>
<a name="999584">
When the player clicks one of the alternatives, the corresponding line number is sent back to GRAAL. Let's assume the player clicks on<p>
</a>
<a name="999585">
<pre>My head hurts.
</pre>
</a>
<a name="999586">
This means the number "11" is returned. GRAAL now starts to search for LACT: statements starting with 1;11; - there had better be one, or nothing will happen! Fortunately, there is:<p>
</a>
<a name="999587">
<pre>LACT: 1;11;RESP R,1,That's probably because...;DSET 1,N11
</pre>
</a>
<a name="999588">
This is a typical example of a simple response to a dialogue line. The bartender speaks, and then another DSET command is given. Because we already are in dialogue mode, this command only "refreshes" the dialogue - that is, makes alterations to the current set of valid alternatives. In this case, the adjustment is to take away line 11 and tell GRAAL that it should never been shown again. That's what N11 means.<p>
</a>
<a name="999589">
The alternative "Could you help me, please..." yields a similarly unusable response, so assuming Olaf hasn't been out exploring the town yet, he is now left with only one alternative - the line<p>
</a>
<a name="999590">
<pre>What is this place?
</pre>
</a>
<a name="999591">
The response to this one is a bit more substantial. The bartender makes a long response - so long, in fact, that is does not fit into one LACT: statement with ease. Instead, there are two statements, performed in sequence. When using this technique, remember NOT to put an EXIT or DSET command at the end of the first statement, because that would interrupt the process and prohibit the second statement from being executed!<p>
</a>
<a name="999592">
In the process, the bartender - if he is still named "bearded man" - reveals his identity. Therefore, there is a<p>
</a>
<a name="999593">
<pre>NAME bartender; 
</pre>
</a>
<a name="999594">
command, renaming object 5 "bartender" if it has not been done already.<p>
</a>
<a name="999595">
The response ends with DSET 1,+1,+2,+5. This means that three more possible alternatives will be added to the set of lines available to Olaf, all of which are unconditional. The current alternative - line 3 - also remains, but now appears in its alternative form "Where did you say I was?". This makes the conversation a bit more believable, since you usually rephrase your questions when you feel you need to repeat them.<p>
</a>
<a name="999596">
One of the added alternatives, line 1, is an "end-of-conversation" alternative. When Olaf says "Thank you very much", the bartender answers "Don't mention it.". Then, <p>
</a>
<a name="999597">
<pre>EDLG;EXIT
</pre>
</a>
<a name="999598">
is performed, which switches the game back to normal input mode. As you se in the LACT statement, object flag 1 for the bartender is set to 1 with a SETOF (set object flag) command to indicate that if we TALK TO the bartender again, it is a resumed conversation - the initial "hellos" will be expressed a bit differently.<p>
</a>
<a name="999599">
 This concludes the basic tour of the features available in GRAAL, but stay tuned: Below are a lot of hints and tips about how to use the power and special techniques of GRAAL to their full potential.<p>
</a>
<a name="999600">
<h1>14	 Multiple Characters and Inventories</h1>
</a>
<a name="999601">
In the dialogues described in the previous chapter, the "speaking partners" were little more than ordinary objects, animated to make them look and act like human beings (or wizards, hobbits, monsters... take your pick). <p>
</a>
<a name="999602">
You can also offer the player true control over more than one character. GRAAL keeps track of each character's location. There are also multiple inventories, so that each character may have its own inventory. <p>
</a>
<a name="999604">
Up to four alternate characters and four inventories can be used.<p>
</a>
<a name="999605">
(The Olaf Longhair adventure demo does not use multiple characters. Get hold of "The GRAAL Herald, Issue 2" - GraalHerald2.lha - which contains a mini-demo showing off these and other 2.1+ features.)<p>
</a>
<a name="999606">
<h2>14.1	 Multiple Character Graphics</h2>
</a>
<a name="999607">
To make the multiple character feature feasible, each character uses the same animation patterns, sequences and default still images as the main (default) character. The only thing that differs between the characters are the image numbers being used.<p>
</a>
<a name="999608">
This means that we still only need one set of "default graphics" statements in graal.main. In other words, the<p>
</a>
<a name="999609">
<pre>STILL_...<br>
PAUSE_...<br>
WALK_...<br>
HANDLE_MAP: ...<br>
TALK_MAP: ...
</pre>
</a>
<a name="999610">
statements are defined only for the main character, exactly the same way as in single-character games. Also, the CIMG command expects you to specify an image number for the main character, and then automatically uses the corresponding image for the currently controlled character instead, and the same goes for the IFCIMG condition.<p>
</a>
<a name="999611">
All images used in these statements should have numbers close together so as to form a "block" of graphics in the image bank, describing all default poses of the main character. This block should be placed as low as possible in the image number series. For example, the main character graphics may consist of 30 images, which we need to store in image numbers 11 to 40. Something like <p>
</a>
<a name="999612">
<pre>/* Clipart file containing all graphics for the main character<br>
CLPART: main_character.iff<br>
/* The IMGS: statements below grab 3*10=30 images<br>
IMGS: 10;11;...<br>
IMGS: 10;21;...<br>
IMGS: 10;31;...
</pre>
</a>
<a name="999613">
in graal.main should take care of that.<p>
</a>
<a name="999614">
Now, for each extra controllable character, an identical "graphics block" must be loaded in a similar way. Ideally, these blocks are placed directly above the main characters graphics, like this:<p>
</a>
<a name="999615">
<pre>CLPART: second_character.iff<br>
IMGS: 10;41;...<br>
IMGS: 10;51;...<br>
IMGS: 10;61;...
</pre>
</a>
<a name="999616">
would place the graphics for the second character in slots 41 to 70.<p>
</a>
<a name="999617">
Note: The image numbers used for alternate characters MUST be higher than those for the main character graphics!<p>
</a>
<a name="999618">
Now, as you have already guessed, the images contained in the two blocks must match each other: If image 11 shows the main character facing forward, image 41 MUST show the second character facing forward, and so on.<p>
</a>
<a name="999620">
<h2>14.2	 Character Objects</h2>
</a>
<a name="999621">
Each controllable character must be a global object, although they may not be treated as such on screen - you can choose if the name should appear when you move the mouse pointer over the character in the scene area or not.<p>
</a>
<a name="999622">
First, define a global object for each character. It's nice if the main character is object number 1, and the second character object 2 and so on, but this is not at all necessary as we shall see later on.<p>
</a>
<a name="999623">
You MUST abide by the following rules for the character objects:<p>
</a>
<ul>
<a name="999624">
<li>Each one must have a unique BOB number not used for anything else in the parts of the game where the character can appear.
</a>
<a name="999625">
<li>Each one must have a unique animation channel, not used for anything else in the parts of the game where the character can appear.
</a>
<a name="999626">
<li>They should all be VISible.
</a>
<a name="999627">
<li>They should all be NPICK (not "pickable").
</a>
</ul>
<a name="999628">
Apart from this, they are defined pretty much like any other type of object.<p>
</a>
<a name="999629">
Now, we need to tell GRAAL that there are multiple controllable characters in the game, and define some more properties for them that cannot be deduced from their respective OBJECT: definitions. This is done with CHAR: statements:<p>
</a>
<a name="999630">
<pre>CHAR: no;object;stimg;eimg;floor;colour;height;text_offset;width;speed;<br>
im_height;im_width
</pre>
</a>
<a name="999631">
<pre>no
</pre>
</a>
<a name="999632">
is the character number. The main (default) character is always number 1, and if CHAR: statements are used at all, there MUST be one for character number 1!<p>
</a>
<a name="999633">
<pre>object
</pre>
</a>
<a name="999634">
This is the object number of the object defining the character, as discussed earlier.<p>
</a>
<a name="999635">
<pre>startimage;endimage
</pre>
</a>
<a name="999636">
These parameters define the first and last image number of the "image block" containing all default character graphics. <p>
</a>
<a name="999637">
<pre>startfloor
</pre>
</a>
<a name="999638">
This one may seem a little odd. Each character's starting position in the game is defined by the room and x/y parameters of the OBJECT: statement, but we also need to know what floor in the room contains that point, which is a piece of information not available in the OBJECT: statement.<p>
</a>
<a name="999639">
<pre>colour;height;text_offset;width;speed  
</pre>
</a>
<a name="999641">
When using a only one controllable character, all these things are set in separate statements.<p>
</a>
<a name="1005205">
<pre>im_height;im_width
</pre>
</a>
<a name="1005206">
This is the height and width of the graphic images that make up the display of your character - refer to its IMGS: paremeters to get the values. (The height and width specified before is the approximate character height and width, but the character seldom takes upp all the space within the cut-out images!)<p>
</a>
<a name="999642">
Examples:<p>
</a>
<a name="999643">
<pre>CHAR: 1;1;11;40;2;11;40;10;20;1.2;47;31
</pre>
</a>
<a name="999644">
Character 1 is global object 1, occupies image slots 11-40, and starts out on floor 2 - the room and exact position are specified in the object definition.<p>
</a>
<a name="999645">
Furthermore, it uses text colour 11, is about 40 pixels high, has an extra 10 pixels above its head to the place where related text is displayed, is 20 pixels wide, and walks at a speed of 1.2. (This is one of the very few floating point numbers used in GRAAL!) The images are 47 pixels high and 31 pixels wide<p>
</a>
<a name="999646">
<pre>CHAR: 2;20;41;70;1;4;0;40;18;1.5;35;20
</pre>
</a>
<a name="999647">
Character 2 is global object 20, occupies image slots 41-70, and starts out on floor 1 - once again, the room and exact position are specified in the object definition.<p>
</a>
<a name="999648">
It uses colour 4, its height is set to 0 which makes the mouse pointer point to its feet, the text is displayed 40 pixels higher up than that, it is 18 pixels wide and uses a walking speed of 1.5. The images are 35 pixels high and 20 wide.<p>
</a>
<a name="999649">
Note that if your various controllable characters are of different heights, it is probably a very wise thing to set the height to 0 as in this example, otherwise offsets from objects and the mouse cursor will look very strange indeed.<p>
</a>
<a name="999650">
<h3> Using a Character Object with a Single Character</h3>
</a>
<a name="999651">
Perhaps you want to manipulate your character using commands that requires it to be clickable in the scene area. Even if you only have one character in your game, you can still specify an object for it and connect it with a CHAR: 1;... statement. The mouse pointer will then recognise the character and display its name in the scene area (although that effect can be disabled making games with CHAR: statements behave just like those without.). A CHAR: 1,... statement is also required if you wish to use GRAAL's automatic 3D scaling feature.<p>
</a>
<a name="999652">
<h2>14.3	 Switching Characters</h2>
</a>
<a name="999654">
Proper IMGS:, OBJECT:, and CHAR: statements - that is all that is needed in your main script to make your game multi-character. However, we still need a way of switching between the various characters.<p>
</a>
<a name="999655">
Well, here it is. Switching between characters is r-e-a-l-l-y easy - in fact, I can't think of a single way to make it any easier. The command to use is simply<p>
</a>
<a name="999656">
<pre>SWITCH character
</pre>
</a>
<ul>
<a name="999657">
<li>If the characters are visible in the current screen, you won't see the change, apart from the fact that the next time you click in the scene area, the new character moves instead of the old one. 
</a>
<a name="999658">
<li>If the characters are in different rooms, GRAAL will simply jump to the room where the new character is currently located - the first time you switch to a character, this is of course the room and position specified in that character's OBJECT: statement.
</a>
<a name="999659">
<li>If the characters are in the same room, but the one you switch to is "off camera", the scene area will scroll the character into view.
</a>
</ul>
<a name="1004000">
The SWITCH command must always come last in a command sequence, followed by an EXIT command. <p>
</a>
<a name="999660">
<h2>14.4	 Inventory Switching and Inventory Objects</h2>
</a>
<a name="999662">
Now, you probably want each character to have its own inventory. Normally, this means the SWITCH command should be preceded by an inventory command:<p>
</a>
<a name="999663">
<pre>INVENTORY 2,U;SWITCH 2
</pre>
</a>
<a name="999664">
would switch to inventory 2 (and update the command area to show the change), and then also immediately switch to character 2. <p>
</a>
<a name="999665">
Note: The inventory switching is handled completely separately from the character switching, and there is no law that says character 1 must use inventory 1 and so forth. This is because you may want to switch inventory lists for other purposes than switching characters!<p>
</a>
<a name="999666">
Another note: The default inventory is inventory 1. (There's a big shock for you... :)<p>
</a>
<a name="999667">
To make an object start out in an inventory rather than in a room, you use a special form of room number in the OBJECT: statement room parameter. Simply type an "I" followed by the inventory number:<p>
</a>
<a name="999668">
<pre>I2
</pre>
</a>
<a name="999669">
will place the object in inventory 2.<p>
</a>
<a name="999670">
PICK, GET, and PUT commands always work with the currently selected inventory. To place things in another inventory than the currently selected, you must use the PUT command specifying the inventory in a similar way to the OBJECT: statement room number:<p>
</a>
<a name="999671">
<pre>PUT 4,U,I2
</pre>
</a>
<a name="999672">
would move object 4 to inventory 2. The parameter "U" indicates that the move is made from the current inventory, since U means we wish to update the inventory display to show the change.<p>
</a>
<a name="999673">
Technically, each inventory is a room number, calculated by <p>
</a>
<a name="999674">
1000 - inventory number = inventory room<p>
</a>
<a name="999675">
which means inventory 1 is actually room 999. This concept works as long as you don't have more than 995 rooms in your game, and I really don't think you do...<p>
</a>
<a name="999676">
<p>
</a>
<a name="999677">
<h2>14.5	 Identifying Characters and/or Inventories</h2>
</a>
<a name="999678">
You may well wish to have some way of knowing which character is currently selected. There is a COMGR command that can paste an image anywhere in the command area (although you should take care not overlay the inventory list or any other areas used by the system, of course). Simply create a global image containing the name, symbol or portrait for each of the possible characters / inventories, then COMGR the proper one onto the command area when switching.<p>
</a>
<a name="999679">
<h2>14.6	 Characters Following Characters Around...</h2>
</a>
<a name="999681">
If you have a game with two controllable characters it is very likely that, from time to time, you will want one of them to follow the other one around. As long as all movements by the currently controlled character is generated either by the player clicking in the scene area, or by the CMOVE command, this is quite simple to achieve. The command<p>
</a>
<a name="999682">
FOLLOW character,startx,starty,followx,followy<p>
</a>
<a name="999683">
will cause the specified character to follow the one under player control around.<p>
</a>
<a name="999684">
This continues until a SWITCH command switches the control to another character, or you give a FOLLOW OFF command.<p>
</a>
<a name="999687">
The parameters following the character specification deals with where the following character will position itself in relation to the current character.<p>
</a>
<a name="999688">
Generally speaking, it will strive to always stop "behind" the controlled character.<p>
</a>
<a name="999689">
<pre>startx,starty
</pre>
</a>
<a name="999690">
After a FOLLOW command has been given, any GOTO command moving the controlled character to a new room will cause the following character to go there, too. startx specifies the number of pixels between the characters. It is the Left/Right/Middle parameter of the START_POS: statement that determines whether the following character will be to the left or the right of the controlled one. Thus, it should always be a positive number; GRAAL determines the actual sign. starty should normally be a small, negative number.<p>
</a>
<a name="999691">
<pre>followx, followy
</pre>
</a>
<a name="999692">
These number work about the same way as startx and starty, except they determine the offset between the characters after having walked around in a room. Both numbers should always be positive: GRAAL "knows" where to place the following character in most cases.<p>
</a>
<a name="999693">
Note that when the controlled character goes next to a floor boundary, the following character probably ends up a few pixels off that floor, depending on your offset settings. There are two things to remember about this:<p>
</a>
<ul>
<a name="999694">
<li>You may want to adjust the floor sizes in some rooms to prevent the following character from "climbing the walls".
</a>
<a name="999695">
<li>Normally, if control is switched to the following character, it will be treated as if it had been placed on the same spot as the previously controlled character. Normally, having a character move from a spot outside the floor system results in very odd movement paths, but in this special case, the slight misplacement of the character will be taken care of automatically. However, if a SHOW or OMOVE command has been issued for the character's object between the last "follow" and the switching of control to it, GRAAL expects you to correctly specify the controlled character's current floor using SETFLOOR instead (once control has been switched to it).
</a>
</ul>
<a name="999696">
<h2>14.7	 Helpful Conditions</h2>
</a>
<a name="999697">
To help to determine what the scene looks like, a couple of conditions have been added primarily for multiple character games:<p>
</a>
<a name="999698">
<pre>IFCHAR character
</pre>
</a>
<a name="999699">
is TRUE if the current character under player control is the specified character.<p>
</a>
<a name="999700">
<pre>IFHERE object
</pre>
</a>
<a name="999701">
is TRUE if the specified object is in the room. Note that the parameter is the object number and not the character number - because this may also come in handy for other objects apart from characters.<p>
</a>
<a name="999702">
<h2>14.8	 Things to Consider</h2>
</a>
<a name="999703">
Unfortunately, there is no collision detection between characters. From time to time, they will seem to "walk through" each other on screen. The only thing you can do about it is try to minimize the problem by carefully thinking about character placements and floor layouts.<p>
</a>
<a name="999704">
<h2>14.9	 Space-saving Tip</h2>
</a>
<a name="999705">
If you have a need for different controllable characters in different sections of the game, you can save a lot of chip memory by letting them share the same space in the image bank. Just put CLPART and IMGS commands in the appropriate section scripts (and also in ACTION: -2 statements to make sure the correct set is loaded after loading a saved game).<p>
</a>
<a name="999706">
<p>
</a>
<a name="999708">
<h1>15	 Character and Graphics Design </h1>
</a>
<a name="999709">
Well, fellow adventurer, by now you are a proficient GRAAL user. I hope. Anyway, welcome to the first master class, where we will look at some of the central GRAAL concepts a bit more closely.<p>
</a>
<a name="999710">
This chapter deals with designing your main character and planning your graphics, something that must be done with some thought and consideration - although small adjustments are easy to make at any stage during the game development, things like the character size influence every other piece of graphics you create, so beware!<p>
</a>
<a name="999711">
<h2>15.1	 Size</h2>
</a>
<a name="999712">
Get a suitable character size, keeping the backgrounds in mind - they are in lowres, so you must use lowres when designing too - otherwise your hero will look rather fat on the screen! I should think a character between 40 and 60 pixels high would be about right for most cases. Below 40 and there is not much room for detail at all, more than 60 and the scenes may start to feel cramped because the character takes up too much space. Also, bigger graphics takes more processing power. 	 In addition, the more pixels you have to animate, the more chances you have of making a bad job of it! Really, I am not kidding. Small can be beautiful sometimes.<p>
</a>
<a name="999713">
Naturally, how you want the backdrops to relate to the main character is also a factor - is he a small guy in a big, cruel world, or an ace detective always moving around in cramped Victorian tunnels and Baker Street studies?<p>
</a>
<a name="999714">
<h2>15.2	 Colour</h2>
</a>
<a name="999715">
Use only some of the available colours for your character, and make it a good spread of useful colours, because these colours will have to be the same in all scenes! (See also <a href="graal22.htm#999720">``Pointer Shapes and Colours'' on page 54</a> for more about fixed colours.)<p>
</a>
<a name="999716">
Colours not used for portrayal of the main character, or frequently occurring objects, can change according to the current scene - the more colours you have left to play with, the more variation you can bring to the backdrops.<p>
</a>
<a name="999717">
Note: The first three colours more or less have to be as follows: Colour 0 should always be used ONLY for transparent areas in images. Colour 1 SHOULD be a rather bright white, colour 2 MUST be black!!<p>
</a>
<a name="999718">
Here's a tip: When working with a background or clip-art picture in a paint program, set colour 0 to something strange to distinguish it from "usable" colours, but always set it back to black before saving, or the borders around the adventure scenes when running the adventure may become coloured in ways that we don't want! If you don't follow this advice, you surely will make the mistake of using colour 0 as the black colour in spots of the graphics, whereas it will be transparent when used in the game - and vice versa!<p>
</a>
<a name="999719">
Note: Despite the fact that you should only use some colours for the character, always create the graphics with a palette using the same number of colours as your backdrop pictures (32 or 64 in extra-halfbrite, that is).<p>
</a>
<a name="999720">
<h2>15.3	 Pointer Shapes and Colours</h2>
</a>
<a name="999721">
The shape of the two mouse pointers used in GRAAL can be changed in graal.main by using the ARROW_CURSOR: and CROSSHAIR_CURSOR: statements.<p>
</a>
<a name="999722">
The new pointer shapes are simply images stored in the image bank like any other, but they have some special properties:<p>
</a>
<ul>
<a name="999723">
<li>They must be four colours only, and colour 0 is transparent.
</a>
<a name="999724">
<li>Colours 1, 2, and 3 of the pointer shape will be mapped to colours 17, 18, and 19 of the backdrop palette. If you want the pointer to always have the same colours in the scene area, these colours must be the same for all backdrop pictures. 
</a>
</ul>
<a name="999725">
If there was a way to alter these palette numbers I would, but there isn't, so I can't. So there. This means that you may want to plan ahead and decide the following colours for all scene are graphics, once and for all:<p>
</a>
<a name="999726">
0	Black (transparent. Do NOT use this for the black parts of the backdrop itself!)<p>
</a>
<a name="999727">
1	White<p>
</a>
<a name="999728">
2	Black (Use THIS for the black parts of the backdrop picture!)<p>
</a>
<a name="999729">
17	Pointer colour 1<p>
</a>
<a name="999730">
18	Pointer colour 2<p>
</a>
<a name="999731">
19	Pointer colour 3<p>
</a>
<a name="999733">
<h2>15.4	 Designing Animations</h2>
</a>
<a name="999735">
The following poses must be designed for the main character:<p>
</a>
<ul>
<a name="999736">
<li>The stills to use for front, back and "sideways facing left" still poses.
</a>
<a name="999737">
<li>The animations for walking towards, away, and sideways right to left.
</a>
<a name="999738">
<li>The animations for talking corresponding to the front, back and side stills. (Open and close the mouth in different ways, move the head slightly, etc.)
</a>
<a name="999739">
<li>The animations or stills used for handling objects (picking up, handing over, etc.), also corresponding to the three "main stills" previously mentioned, but in three different heights for each still - High, Middle and Low, depending on whether the object is located on the floor, high up or on a table or something else in "mid air".
</a>
</ul>
<a name="999740">
The reason you don't have to make separate animations and images for right and left is that you can mirror one image to point in the other direction using a simple trick described further on. This saves memory as well as time spent in paint programs!<p>
</a>
<a name="999742">
To get the animation smooth, it should be designed to work with frame updating taking place every 6th vertical blank. This may sound like nonsense to you, but what it means is that you can switch the animation cel every six 50ths of a second, which equals six frames displayed on a PAL TV system (or 60ths of a second on an NTSC system).<p>
</a>
<a name="999743">
Actually, too many animation cels for a certain movement may not necessarily add that much to the game anyway. Olaf uses only 5 cels for a basic walking movement, each cel being shown for 6 50ths of a second.<p>
</a>
<a name="999744">
So, now you should have you basic animations designed. Good. First, test them against some different backdrops that you think will be representative for the game in your excellent paint program.<p>
</a>
<a name="999745">
Then, satisfied that your character basically looks OK, you should now design a "dummy room" in GRAAL, place some "dummy objects" in that room that will force your character to use all his newly learned physical skills. Then, give him a good work-out.<p>
</a>
<a name="999746">
<h2>15.5	 Complex animation patterns</h2>
</a>
<a name="999749">
Some times, we may need more complex animations for an object or character. For example, the captain in room 3 of the Olaf demo walks back and forth aboard his ship, bends down to fix things, and occasionally, also loses his hat! The AMAL animation language used by GRAAL allows us to achieve this, but the code needed is longer than will comfortably fit into a statement line in GRAAL. Therefore, ANIM: and OBJECT: statements as well as OMOVE:and SHOW: commands all accept animation pattern specifications that look like this:<p>
</a>
<a name="999750">
PTRN n<p>
</a>
<a name="999751">
which tells GRAAL to go look for the animation code in a script called n.ptrn. Here is part of the pattern script for the captain's movements as described above:<p>
</a>
<a name="999752">
<pre>/* The captain's standard movements for room 3<br>
/*<br>
S:<br>
A 15,(RIMG6,6)(RIMG5,6)(RIMG4,6)(RIMG7,6)(RIMG8,6)(RIMG7,6)...<br>
M 20,0,70 M 20,10,150 M 98,-6,200<br>
A 1,(RIMG4,100)<br>
M 0,0,100<br>
A 3,(RIMG9,72)(RIMG10,128)<br>
M 6,0,1<br>
M 0,0,499<br>
A 1,(RIMG4,50)<br>
M -6,0,1<br>
M 0,0,49<br>
A 15,(//RIMG6,6)(//RIMG5,6)(//RIMG4,6)(//RIMG7,6)(//RIMG8,6)...<br>
...<br>
A 1,(//RIMG4,500)<br>
M 6,0,1<br>
M 0,0,499<br>
J S
</pre>
</a>
<a name="999753">
The pattern contains three things:<p>
</a>
<ul>
<a name="999754">
<li>Labels and jumps to labels
</a>
<a name="999755">
<li>Animation commands (A...)
</a>
<a name="999756">
<li>Movement commands (M...)
</a>
</ul>
<a name="999757">
S: is simply a label allowing us to repeat the entire sequence of commands indefinitely by jumping back to the S: label from the very end of the commands sequence with the J(ump to) S command.<p>
</a>
<a name="999758">
The rest of the script is made up of "blocks" where we first specify an animation sequence, and how many times it should be repeated, and then one or more movement commands that decide how the object is to be moved during that animation.  <p>
</a>
<a name="999759">
In the M(ove) commands, the first number is the number of pixels to move left or right (negative numbers = left), the second is the number of pixels to move up or down (negative numbers = up), and the third is the number of frames the movement should take. Note that only the M(ove) commands control the timing of the program. If one or move M(ove) commands before the A(nimation) command has run out of frames to display, the program still moves on to the next A(nimation) command. This means that in most cases, the total number of frames that the A(nimation) command takes should match the number of frames the corresponding M(ove) command(s) will take. <p>
</a>
<a name="999761">
This way, the entire animation will keep in sync.<p>
</a>
<a name="999762">
To specify a "still image" in the middle of the pattern, do like this:<p>
</a>
<a name="999763">
<pre>A 1,(RIMG4,100)<br>
M 0,0,100
</pre>
</a>
<a name="999764">
Here, RIMG4 is shown for a hundred frames, and during that time, the M 0,0,100 command keeps it still, because it is told to move nowhere (0,0).<p>
</a>
<a name="999765">
<h2>15.6	 A Note about Flipped Images</h2>
</a>
<a name="999767">
As discussed in the section on image definitions in the main script, you can easily "flip" an image left/right by prefixing the number with two slashes ( // ). However, there is a catch: You cannot safely use both the normal and the flipped image on screen at the same time - unpredictable results will occur if you do so!<p>
</a>
<a name="999768">
The rule is, if you run the risk of having the same image in both the original and the flipped version on screen at the same time, you have to make the flipped version into a proper image in the image bank, with its own image number.<p>
</a>
<a name="999770">
<h2>15.7	 All About 3D and Hotspots</h2>
</a>
<a name="999772">
GRAAL rooms are usually displayed in a "simulated 3D" perspective (although top-down views can be achieved). This basically means that the things slightly higher up the picture seem "further away" than the things towards the lower end of the picture. Take the harbour in "Olaf" as an example: When Olaf walks towards the water and the edge of the quay, he's actually only moving a number of pixels up the screen - there is no such thing as "away", because the screen can never really be anything but 2D.<p>
</a>
<a name="999773">
This simple fact allows us to play with foreground and background objects. Anything placed towards the bottom of the screen will, generally speaking, be "in front". I'm talking about objects as well as STATIC: and ANIM: images now, mind you - everything drawn directly onto the background picture will naturally always be part of the background!<p>
</a>
<a name="999774">
So, as a rule anything lower down goes "in front" of anything further up, but that's not necessarily the way we want people to perceive things - take the mug on top of the barrel in the bar in room 1, for instance. Looking only at the placement of the images of the mug and the barrel, the mug should logically be partly hidden by the barrel, because it is further up the picture. It's not. Instead, it looks like it is placed ON the barrel, which is what we want. Also, when Olaf walks behind the barrel, he must also walk behind the mug - if the mug is on the barrel but Olaf seems to be walking in front of the mug but behind the barrel, everything becomes hideously unrealistic.<p>
</a>
<a name="999775">
The answer to this problem? It's simply a matter of setting each image's hotspot correctly. The hotspot is the point of each image that will actually be placed at the x and y coordinate specified when displaying the image.<p>
</a>
<a name="999777">
Each image has its own hotspot, and it is normally set when the image is loaded with an ...IMGS: statement (the last parameter - look it up in the reference). The GRAAL default is to place the hotspot at the middle of the bottom edge of the image - you might say at the "foot" of the image. This is normally very appropriate, especially so for people and living objects. But you can place the hotspot anywhere you like - if you specify a value other than the default, the hotspot will be offset in the y direction that number of pixels from the top edge of the image. Both negative and positive values are allowed, and hotspots can be placed outside the actual width and height of the image.<p>
</a>
<a name="999778">
Study the ROOMIMGS: statement for the mug image in room one, compare that to the mug's x and y position in the OBJECT: statement in graal.main, and you will see that the hotspot is placed well below the actual image, making it the "frontmost" object in the bar.<p>
</a>
<a name="999780">
The hotspot of an image can also be altered using the HOTSP command - this is used in some cutscenes dealing with the ship in the harbour, to switch the depth-placing of the sail. This is because the captain first walks behind the sail, but when summoned ashore, he suddenly has to go in front of it! The solution? Just alter the sail's hotspot and re-display the image using new coordinates!<p>
</a>
<a name="1001234">
<h2>15.8	 Scaling the Characters</h2>
</a>
<a name="1001235">
The characters under player control can be automatically scaled to match the simulated 3D perspective in your backdrop. (You should only use this in rooms where you really need it, because the scaled images never look as good as the original-sized ones.) It is demonstrated in room 2 of the demo adventure, where Olaf gets a lot smaller when walking into the alley.<p>
</a>
<a name="1001768">
To begin with, the 3D scaling process relies on the information about graphics stored in the CHAR: statements in graal.main. So even if you only have one controllable character, you have to create a global object and a CHAR: statement for it, as discussed in <a href="graal22.htm#999600">``Multiple Characters and Inventories'' on page 46</a>.<p>
</a>
<a name="1001422">
After that, the process is a simple one: At the very start of a room script, put a<p>
</a>
<a name="1001423">
<pre>3D: 
</pre>
</a>
<a name="1001424">
statement. (See the on-line reference for details).<p>
</a>
<a name="1001426">
Each parameter in the 3D: statement defines a vertical line on screen, and above each line, the character will be a little smaller than below it. If the character is below the first line, it will retain its original size as drawn by you. If the character is above the last line, it is at its minimum size (25%, that is, half the height an half the width).<p>
</a>
<a name="1001462">
The 3D scaling works with the SAY, MOBJ, HANDLE, CMOVE, CIMG and CPOS commands, and the IFCIMG condition. This means you shouldn't use OMOVE or SHOW to move or animate controllable characters, unless you know exactly where in the room the images following those commands will be displayed and can make them according to that size. <p>
</a>
<a name="1006635">
If you handle more than one controllable character in the same room, you probably need to use the SWITCH command a lot so you can animate each character with the above commands rather than relying on OMOVE and SHOW.<p>
</a>
<a name="1001425">
By setting some of the "scaling lines" outside the scene area, you can force GRAAL to only use one or two of the scaled sizes. I have used this in 7.room, where Olaf is only shown in the minimum size, because all the scaling lines are put below the displayed scene area.<p>
</a>
<a name="1001432">
Note 1: If you use the IMGS command to load a new set of global images that make up the graphics for one of your characters, you will have to issue the MAKE3D command afterwards to recreate the new scaled versions of the images as well. You probably also need to use flag values to keep track of which image set is currently loaded, and whether or not you need to re-load and re-generate 3D images after loading a saved game position, for example.<p>
</a>
<a name="1001463">
Note 2: If you use the FOLLOW command (see <a href="graal22.htm#999679">``Characters Following Characters Around...'' on page 50</a>), take care to lay out floors and paths so that the following character always ends up the same size as the controlled character. Otherwise, it usually looks plain ugly.<p>
</a>
<a name="1001438">
<p>
</a>
<a name="999781">
<h1>16	 Cutscenes</h1>
</a>
<a name="999785">
<p><img src="g-cutsc.gif"><p>
<p>
</a>
<dl>
<dl>
<dl>
<dl>
<dl>
<dl>
<a name="999786">
<dt> GRAAL in cutscene mode with hidden command area.
</a>
</dl>
</dl>
</dl>
</dl>
</dl>
</dl>
<a name="999788">
CUTSCENES are simply script files (suffixed with .scene) that contain nothing but commands. That's right - no conditions, and no statements! This means lines should NOT start with ACTION: or anything like that - just fire away with the command name in column one of each line. You can include several commands on the same line just like in ACTION: statements as long as you separate them with semi-colons.<p>
</a>
<a name="999790">
Depending on the command used to start the cutscene, the command area either disappears completely, has a special "cut-scene icon" overlaying part of it, or remains totally unaffected (although still unusable until the cutscene has ended). You may use this to alter the degree of "movie-feel" the cutscene invokes. Cutscenes that are so short that the player hardly notices anything special happening control-wise should NOT mess with the display of the command area.<p>
</a>
<a name="999791">
The immense usefulness of cutscenes may not be apparent at first, but you will soon find out that you use quite a lot of them - because in addition to being used for "movie scenes", they are also very handy whenever you have a sequence of GRAAL commands that you need to use in a lot of different places. In these cases, cutscenes can act the way procedures or subroutines do in ordinary programming languages. In those cases, you must make sure the entire cutscene is executed, and you probably don't want to show the cutscene indicator to the player. It's easy enough - just read on!<p>
</a>
<a name="999792">
The logic of cutscenes ought to be a fairly simple subject, since there are no conditions allowed in them. In practice, two things require you to think very carefully about designing your cutscenes: The "skip" function (pressing the [Esc] key to jump past a cutscene) and nested cutscenes.<p>
</a>
<a name="999793">
<h2>16.1	 Hop, Skip and Jump</h2>
</a>
<a name="999795">
Normally, a cutscene consists of two parts: The main part at the top, always containing ALL the actions in the scene, and the FINAL section at the end.<p>
</a>
<a name="999796">
The FINAL section is ONLY used if the [Esc] key was pressed during execution of the main part. It must duplicate all statements necessary to set the scene exactly the same way it would have been set if the main part had been run through completely. Remember, you never know exactly where in the flow of the main part the player decides to press [Esc] to break out of the action!<p>
</a>
<a name="999797">
<h2>16.2	 No Breaks!</h2>
</a>
<a name="999798">
In some circumstances, for example when you use cutscenes as "subroutines" as discussed above, you may not want the skip option to be in effect. In this case, start the entire cutscene with the cutscene command NOBREAK, which disables the [Esc] key for the duration of the cutscene. If a cutscene starts with NOBREAK, you don't need a FINAL section in it.<p>
</a>
<a name="999799">
<h2>16.3	 Nesting</h2>
</a>
<a name="999801">
Now, to complicate things even further, cutscenes may be nested in up to three levels - that is, you can execute a cutscene within a cutscene from within a cutscene!<p>
</a>
<a name="999802">
"Why on earth would I want to do that?" you ask. Well, a good example is the harbour scene in room 3 of "Olaf". There are a number of occasions when Olaf needs to interact with the captain, calling him ashore time and time again. The captain's going ashore and aboard can not be handled as simple PTRN sequences, because he, the ship itself, and the sail need to be rearranged in various ways to make the captain go behind the sail, in front of the sail but behind the gangplank, etc.<p>
</a>
<a name="999803">
Therefore, the captain going ashore is played using one cutscene, the going aboard in another (well, actually two, depending on whether his hat is secured with the rubber band or not). These cutscenes are then used from within, or in conjunction with, a number of others specifying what is going on when the captain comes ashore to talk to Olaf.<p>
</a>
<a name="999804">
Let us call the first cutscene the "master scene" and those called from within that "sub-scenes". Now, what we have to watch out for is this:<p>
</a>
<a name="999805">
If we press [Esc] at the very beginning of the master scene, or indeed anywhere before the last sub-scene, this means some of the sub-scenes will not come into play at all. However, the contents in each sub-scene may affect how the game should be set up at the end of the master scene.<p>
</a>
<a name="999806">
To conclusion is that the FINAL section of the master scene also must include all statements that are present in the FINAL sections of the relevant sub-scenes. Let's look at Olaf and the captain again, when Olaf tries to use the dictionary on the captain and gets it all wrong. This is depicted in CUTSCENE 13 structured like this:<p>
</a>
<ul>
<a name="999807">
<li>First, CUTSCENE 2 is called as a sub-scene to make the captain come ashore.<br>Note: Sub-scenes should always be called with parameter ,F or ,NF to stop the cutscene indicator symbol flickering on the screen. The master scene should be called with parameter ,S or N because when it's finished, the whole scene is finished.
</a>
<a name="999808">
<li>Then, Olaf tries to speak hindi or something like that, fails miserably, and is knocked down.
</a>
<a name="999809">
<li>While Olaf is still on the ground recovering, CUTSCENE 3 is invoked to put the captain back aboard the ship.
</a>
<a name="999810">
<li>Once the captain is back aboard, Olaf gets up and notes that the whole endeavour wasn't particularly successful.
</a>
<a name="999811">
<li>The FINAL section of the master scene CUTSCENE 13 then needs to contain the following: The commands from the FINAL section of CUTSCENE 3, because those make sure the captain is back in place aboard the ship, and some commands to put Olaf back on his feet in the right position. We do NOT have to bother about anything in CUTSCENE 2, because the captain's coming ashore does not have anything to do with how things look after the master scene is finished.
</a>
</ul>
<a name="999812">
<h1>17	 Timer Events</h1>
</a>
<a name="1001799">
GRAAL contains a number of functions that can make things happen at regular or irregular intervals more or less independent of the movements of your controlled character.<p>
</a>
<a name="1001800">
First, you use a DOAFTER command to set one of three "timer devices" to go off after a certain period of time (and this can also be a random amount).<p>
</a>
<a name="1001803">
Next, you specify a number of ACTION: -1;... statements, because each time a timer reaches zero, it goes through the list of ACTION: -1;... statements to see if it should do anything. (Each timer - there can be up to three running at the same time - uses its own "fake object number", so you can use IFOBJ conditions to see what statements belong to which timer if you have several running simultaneously.)<p>
</a>
<a name="1001806">
The timer will go on repeating itself, until you issue a CANCEL command for it. If you want the time between the timer events to change continuously, you should end each ACTION: -1,... command sequence with another DOAFTER for the same timer, specifying another random interval.<p>
</a>
<a name="1001811">
The timer device called "0" is a little special. It doesn't check the time elapsed since the DOAFTER command, but rather how long the player has been inactive. You can use this to trigger "stall anims" (like the one in "Simon the Sorcerer", where Simon puts on his headphones when nothing happens).<p>
</a>
<a name="1001812">
Normally, the cursor will flicker during execution of the ACTION: -1;... statements, because as always the player can't do anything while a command sequence is being executed. However, if the timer events are performed very quickly, you can use a TCURS ON command to stop the cursor from disappearing.<p>
</a>
<a name="1001823">
One of the uses for a timer is the concept of in-game date and time. GRAAL contains a number of commands and layout statements to set, advance, check, and automatically display the date and time, even on an analogue clock face with hands for the hours and minutes. (These things are displayed in special, reserved sections of the command area.)<p>
</a>
<a name="1001822">
There is more on each of these subjects in the command descriptions in the on-line reference.<p>
</a>
<a name="1001813">
<p>
</a>
<a name="1001794">
<h1>18	 Special Techniques or "How The Heck Did He Do That?" </h1>
</a>
<a name="999813">
This is a walk-through of some of the particularly clever stuff in the Olaf script files. <p>
</a>
<a name="999814">
<h2>18.1	 The Load / Save Room.</h2>
</a>
<a name="1002569">
GRAAL has some dull, built-in requesters for saving, loading and quitting games, but the demo adventure shows how you can customize these features using a special room.<p>
</a>
<a name="1002576">
The room is called by clicking verb 10, which is represented on screen by a diskette icon. Because the load/save room should be available everywhere, the code for jumping to it is in an<p>
</a>
<a name="1003045">
<pre>ACTION: 10;...
</pre>
</a>
<a name="1003046">
statement in graal.main, containing the following:<p>
</a>
<ul>
<a name="1003047">
<li>We set a flag to remind ourselves about the in the very near future missing command area - see COMAREA OFF below.
</a>
<a name="1002583">
<li>Next, we need to issue a MARK command - this is absolutely essential. Not only do we need it to get back to the same place when backing out from the load/save room, but we actually use the MARKed data when saving the game. We can't just SAVE directly in the load/save room, because then we would save - the load/save room position!
</a>
<a name="1003674">
<li>The next one may seem a little odd: We issue an EDLG command. This is because you can call load/save routines from within a dialogue, and if we were in dialogue mode, we need to get out of it in order to access the buttons and stuff in the load/save room. (When you load a saved game, the correct mode is automatically switched on again.) 
</a>
<a name="1003069">
<li>Because we will not need the command area in the load/save room, we hide it with a COMAREA OFF command. 
</a>
<a name="1002584">
<li>After all of this, we jump to room 40, which is the load/save room. Study the code to see how IFNOTSAVEDISK is used to ensure we have a place to save the game, and how IFEXISTS is used to check for existing, saved games and to alter the appearance of the save/load buttons and game slots according to what's available at the moment.
</a>
</ul>
<a name="1002588">
Now, if we back out from the load/save room, we'd like the command area back in place, thank you very much. Well, the "backing out" is handled by either a LOAD or a RESUME command, and both makes GRAAL look through the ACTION: -2... statements. So, all we have to do is have such a statement checking the flag we set earlier, and issue a COMAREA ON command to put the command area back where it belongs. (In the "Olaf" demo, some rooms don't use the COMAREA at all, so an extra variable is used to keep track of whether we are about to restore a game position with or without the comarea - see the comments to ACTION: 10;... and ACTION: -2;... in graal.main.)<p>
</a>
<a name="1007070">
Note 1: This means we now have ACTION: -2;... statements in graal.main that should always be executed after loading a game. So ACTION: -2;... statements in room and section scripts must never contain EXIT or GOTO commands, because this would prevent the statements in the main script from being executed!<p>
</a>
<a name="1002793">
Note 2: If you have designed your own save/load/quit functions, you could disable the ordinary short-cut keys for the standard requesters in the finished version of the game. You do this by putting a couple of DISABLE_... statements in the main script. Or, you could define your own save/load commands, pointing to your newly designed room, and map the standard short-cut keys (S/L/Q) to these commands. You do not necessarily have to put the "clickable areas" for these commands inside the command area visible to the player - if you put the areas off the screen with some coordinates like 500;500;501;501, you force the player to use the short-cut keys to access those commands.<p>
</a>
<a name="1003075">
Finally, remember that it is up to you to keep track of whether the command area is displayed or not every inch along the way - saving a game whilst the command area is not shown requires mechanisms to check out how it should be after each and every loading of a new game position.<p>
</a>
<a name="1002568">
<h2>18.2	 Going into the Alley</h2>
</a>
<a name="1003011">
In room 2, there is an example of how an un-named exit can be used to cover an area and make special things happen when the player tries to direct his character to go there. In this case, the back of the alley is covered with an un-named exit. When the player clicks the alley for the first time, Olaf moves there and makes a comment about how very uninteresting it is. Then, a room flag is set, and the exit is hidden. From there on, the alley is just an ordinary part of the scene, and Olaf may walk in and out of the alley any number of times without anything special happening. <p>
</a>
<a name="1003981">
The alley also demonstrates a typical use of the 3D scaling function - the way the 3D: statement is set up in 2.room, GRAAL uses 3 different image sizes to display Olaf, depending on how far into the alley he has gone.<p>
</a>
<a name="1003010">
<h2>18.3	 Speaking In a Foreign Tongue</h2>
</a>
<a name="999815">
The conversation with Rajah Singh on the quay is rather special - you are forgiven for thinking a special font is being used to display the foreign language spoken by Rajah. However, this is not the case. Instead, I have combined a "blank" RESP command with BOBON and BOBOFF commands. Have a look in the 3.room script:<p>
</a>
<a name="999816">
First, the "foreign language" was "typed" in an ordinary picture (3FG.IFF) using DPAINT.<p>
</a>
<a name="999817">
Then, the "words" were grabbed as room images using ROOMIMGS: statements.<p>
</a>
<a name="999818">
Rajah's responses to Olaf dialogue lines are as follows:<p>
</a>
<ul>
<a name="999819">
<li>First, a BOBON command is used to display the room image with the "foreign language".
</a>
<a name="999820">
<li>Immediately upon that, a RESP command displaying nothing but blank spaces is used to make Rajah Singh "speak". The number of blank spaces determines the time it takes to execute the RESP command.
</a>
<a name="999821">
<li>After that, a BOBOFF takes away the strange text again. Simple, eh? No need to construct an entire font (and no need for another GRAAL command to handle that font!).
</a>
</ul>
<a name="999822">
<h2>18.4	 An Automated Room</h2>
</a>
<a name="999823">
As you may have noticed, you can never get into normal game mode in Ali Harrod's shop - As soon as you walk in, you end up in dialogue mode, and when you end the dialogue, you are immediately transported out of the boutique. This is thanks to the DACT: statements, where the programmer can grab control and keep it for as long as he likes! Have a look in 4.room - there is not a single run-through of DACT: statements not ending with a DSET... EXIT combination, forcing the player into dialogue mode. Likewise, there are no LACT: statements that don't end with either a new DSET...EXIT combo, or EDLG...GOTO, which leaves the room. Therefore, there are no ACTION: statements either.<p>
</a>
<a name="999824">
This technique is useful in a lot of circumstances - many times, it relieves you of having to think up a lot of elaborate ideas for a room where you really don't want the player prowling around.<p>
</a>
<a name="999825">
<h2>18.5	 The Art of Avoiding a Seagull</h2>
</a>
<a name="999826">
As long as the seagull in the harbour is sitting on the pollard, Olaf steers well clear of it when walking about. He simply walks where the room script FLOOR: statements say he can move!<p>
</a>
<a name="999827">
However, as soon as the seagull is scared off, Olaf is free to approach the pollard and pick up the feather. This is made possible by two FLOOR and one NFLOOR commands executed in the cutscene where the seagull takes off (4.scene).<p>
</a>
<a name="999828">
Having chased the seagull away, one problem remains: The next time we re-enter the room, we want things to be the way they are now, and not according to how they are set up in the room script statements.<p>
</a>
<a name="999829">
A room flag comes to the rescue here - it allows us to "remember" the seagull status between visits to the room.<p>
</a>
<a name="999830">
Room flag 1 for the room (room 3) is used - as long as it is zero (the initial state), the seagull is on the pollard. As soon as the bird is scared off, we set the flag to 1 with a SETRF 1=1 command in the cutscene. This room flag is tested in a DACT: statement - if it is set to 1, the bird is moved to the roof of the shed, and the default floor definitions are changed exactly the same way as in cutscene 4.<p>
</a>
<a name="999831">
Remember, as long as the LIGHTS ON command has not been used, the scene remains black and we can move anything we want around without the player being aware of what is done!<p>
</a>
<a name="999832">
<h2>18.6	 A Spitting Image</h2>
</a>
<a name="999833">
The spitting llama on offer by Ali Harrod is composed of two animations, because I decided a single one would be too large. Instead, the llama itself is one animation, and the "spit" is another, very small one, animated by an AMAL "Move" command.<p>
</a>
<a name="999834">
The movement of the llama and spit animations are synchronised - the llama being displayed on top of the spit. (Well, almost synchronised. If you leave the llama sequence on and walk away for a quarter of an hour, you will notice that things have become a little strange when you return. But who could keep away from the game that long, anyway? And if you don't like it, you can always make one big animation of the whole thing!)<p>
</a>
<a name="999835">
<h2>18.7	 A Map Room without the Command Area</h2>
</a>
<a name="999836">
I had planned on only delivering the first four rooms with GRAAL, but ended up giving you seven. The reason is some quite interesting techniques were used in room 5, which may come in handy.<p>
</a>
<a name="999837">
Room 5 is an outline map of the East, showing the towns of Constantinople, Gurgan and Baghdad. The thing is, there is no Olaf, and nothing to do except watch a short cutscene and, when revisiting, point to one of the three towns. Also, this room does not use the command area at all - instead, the scene area itself takes up more space, and the command area is hidden.<p>
</a>
<a name="999838">
Olaf was done away with by a simple CHAR OFF command in a DACT: statement - nothing strange about that (once you read the on-line reference). Remember that the main character will always be made visible when entering a new room, unless you put it away with CHAR OFF.<p>
</a>
<a name="999839">
Because we don't need the command area for this room, each GOTO command leading into this room from other rooms is preceeded with a COMAREA OFF command. (See the load/save room above for more about hiding the command area.) In the room itself, a room flag for room 40 (the save/load room) is set to indicate the status of the command area (shown or hidden) - this flag is used in the save/load procedures, as described in <a href="graal22.htm#999814">``The Load / Save Room.'' on page 63</a>.<p>
</a>
<a name="1003693">
We need to make sure the command area is replaced when entering a new room. The only rooms Olaf can go to from room 5 is room 6 and room 7, so in each of these, a COMAREA ON command in the DACT: statements prior to LIGHTS ON restores the command area. (Keep the COMAREA ON commands close to LIGHTS ON to make sure the command area disappears/re-appears in sync with the scene area.)<p>
</a>
<a name="1002891">
By now, we have ensured the map, and ONLY the map, is shown on screen. The only thing the player can do in room 5 is to point to one of the three exits placed just over the towns on the map.<p>
</a>
<a name="999840">
I have chosen to display the exit names for the towns in the normal fashion when the mouse cursor moves over them, although I might just as well have put a blank space instead of names in the EXIT statements. The names of the towns are written on the map itself, and it shouldn't have taken the player too long to figure out where to click, anyway.<p>
</a>
<a name="999855">
<h1>19	 The On-line Monitor</h1>
</a>
<a name="999856">
GRAAL's on-line monitor is a great help when things go wrong in your scripts. It allows you to examine flags and other information "on the fly", and also make temporary corrections. This helps to lower the number of times you have to restart GRAAL during the tests. (Naturally, the monitor cannot be called up from an encrypted game unless there is a DEBUG: statement in graal.main.)<p>
</a>
<a name="999857">
To invoke the monitor, simply press the [G] key. The monitor window pops up, covering the lower part of the screen. <p><img src="g-moni.gif"><p>
<p>
</a>
<dl>
<dl>
<dl>
<dl>
<dl>
<dl>
<a name="999861">
<dt> GRAAL in monitor mode. The actual look of the buttons depends on<br>the requester graphics resource file loaded with the RESOURCE:<br>statement in graal.main.
</a>
</dl>
</dl>
</dl>
</dl>
</dl>
</dl>
<a name="999862">
Here's a description of what it contains:<p>
</a>
<a name="999863">
<h3> Information lines</h3>
</a>
<a name="999864">
At the very top are two lines of general information showing<p>
</a>
<ul>
<a name="999865">
<li>The current room.
</a>
<a name="999866">
<li>The last starting position used.
</a>
<a name="999867">
<li>The current floor.
</a>
<a name="999868">
<li>Whether the character is (should be) visible or not.
</a>
</ul>
<a name="999869">
The information in line two is mainly of interest in multiple-character games:<p>
</a>
<ul>
<a name="999870">
<li>The number of the character currently under player control.
</a>
<a name="999871">
<li>The number of the inventory currently used.
</a>
<a name="999872">
<li>The number of the character following the controlled character (if any).
</a>
</ul>
<a name="999874">
<h3> Command field and &lt; &lt;- Execute &gt; button, message field</h3>
</a>
<a name="999875">
In this text field, you can type any valid GRAAL command, and then make GRAAL execute it with the &lt; &lt;- Execute &gt; button next to the field. <p>
</a>
<a name="999876">
These are the commands your are likely to use most:<p>
</a>
<ul>
<a name="999877">
<li>GOTO to jump to another room (or reload the current one). This command also automatically closes the monitor and thus replaces the old (2.0) monitor's &lt; &lt;- GOTO &gt; button.
</a>
<a name="999878">
<li>SETOF and SETRF to set flags.
</a>
</ul>
<a name="999879">
While GRAAL takes care of your request, the text * executing * will be shown in the message field at the very bottom of the window. If it goes OK, the text <br>* OK * is shown. If GRAAL couldn't make sense of what you typed, the text <br>* error * is shown instead. Make sure you get the syntax correct - often, any mistakes will make the dreaded GRAAL run-time error screen appear.<p>
</a>
<a name="999880">
Some rules:<p>
</a>
<ul>
<a name="999881">
<li>You can only enter one command at a time.
</a>
<a name="999882">
<li>You cannot enter conditions.
</a>
<a name="999883">
<li>All input is automatically converted to upper case.
</a>
<a name="999884">
<li>You can use ROBJ, SOBJ, RIMG and SIMG references.
</a>
<a name="999885">
<li>While anything is possible, not everything is smart or even relevant at all times. Commands you probably don't want to execute from the monitor include SAVE, LOAD, MARK, RESUME and others that re-arrange a lot of stuff in GRAAL.
</a>
</ul>
<a name="999886">
<h3> &lt; Back to GRAAL &gt; button</h3>
</a>
<a name="999887">
This button quits the monitor. Remember that some changes you attempt in the monitor may require re-loading the current room to take effect, in which case you should end the monitor session by executing a GOTO command instead.<p>
</a>
<a name="999888">
<h3> List buttons</h3>
</a>
<a name="999889">
There are three buttons to list important information:<p>
</a>
<ul>
<a name="999891">
<li>&lt; Object List &gt; shows a list of all objects - numbers, locations and flag contents.
</a>
<a name="999893">
<li>&lt; Room List &gt; shows the contents of all room flags for all rooms.
</a>
<a name="999895">
<li>&lt; Inventories &gt; shows a list of the contents of each inventory.
</a>
</ul>
<a name="999896">
<h3> &lt; Trace &gt; button</h3>
</a>
<a name="999897">
This is a toggle button, deciding whether the single-trace debug mode is active or not.<p>
</a>
<a name="999899">
Click once to activate. The trace console will open at the top of the scene area. Then click &lt; Back to GRAAL&gt; and provide GRAAL with some input.<p>
</a>
<a name="999900">
As soon as GRAAL starts working on an input sentence, all conditions and commands about to be executed are shown in green in the trace console. For each command, you have to press a keyboard key to continue through the script. The full stop key is a good choice, because it also allows you to skip the pauses caused by commands like SAY and W(ait). <p>
</a>
<a name="1002799">
The text colour in the trace window changes from green to red while the command is being executed. An empty trace window means GRAAL is waiting for more player input.<p><img src="g-trace.gif"><p>
<p>
</a>
<dl>
<dl>
<dl>
<dl>
<dl>
<dl>
<a name="999904">
<dt> GRAAL with the trace console active. Here it waits for us to acknowledge the next action - loading a sound sample for the bell.
</a>
</dl>
</dl>
</dl>
</dl>
</dl>
</dl>
<a name="999905">
Note: In the trace console, object and image references are NOT converted back to ROBJ, RIMG, etc. references. For example, SIMG1 will show up as number 61 or something like that.<p>
</a>
<a name="999906">
To deactivate the trace mode, call up the monitor again and click &lt; Trace &gt; once more.<p>
</a>
<a name="999907">
The trace mode can also be activated and deactivated from within scripts with the TRACE ON and TRACE OFF commands.<p>
</a>
<a name="999909">
<h1>20	 Macros</h1>
</a>
<a name="999910">
Macros allow you to record a sequence of player input selections, store them in a file, and play them back later.<p>
</a>
<a name="999911">
The primary use is for testing - being able to play the same sequence of events back over and over again, and having it done automatically, makes testing a whole lot easier. They are especially useful for running through parts of the game which are really "finished", but still need to be tested from time to time to check that no alterations you have made to other parts of the game affects them, or when changes to scripts means you cannot use old saved game files to put you in the desired part of the game.<p>
</a>
<a name="999912">
The macro functions only work in development mode. In encrypted games, they are not available unless there is a DEBUG: statement in graal.main.<p>
</a>
<a name="999913">
<h2>20.1	 Starting a Macro Recording</h2>
</a>
<ul>
<a name="999914">
<li>Start the game. Load a saved game, or go to the position from which you want to start the macro recording by playing the game in the normal way.
</a>
<a name="999915">
<li>Press the [R] key. A message telling you that macro recording is activated is shown very briefly in the scene area.
</a>
<a name="999916">
<li>From now on, every command you execute, and every exit or dialogue line you choose, will be recorded to memory.
</a>
</ul>
<a name="999917">
<h2>20.2	 Saving a Macro</h2>
</a>
<ul>
<a name="999918">
<li>When you have reached the point where you want the macro to stop, press the [R] key again.
</a>
<a name="999919">
<li>A dialogue box pops up, asking for a macro file name. The name you type will be suffixed with the text ".macro"
</a>
<a name="999920">
<li>Click the "Save" button. The macro file is now stored in the development directory.
</a>
</ul>
<a name="999921">
<h2>20.3	 Playing a Macro</h2>
</a>
<ul>
<a name="999922">
<li>Put the game is in EXACTLY THE SAME POSITION as when you started the macro recording. 
</a>
<a name="999923">
<li>Press the [P] key. A dialogue box appears, asking for the macro file name. Type the name - you do not have to enter the ".macro" part.
</a>
<a name="999924">
<li>Click the "Load" button.
</a>
<a name="999925">
<li>The contents of the macro are now re-played before your very eyes. Sit back, watch, and enjoy!
</a>
<a name="999926">
<li>You may abort the playing of the macro at any time by pressing the [Esc] key between commands.
</a>
</ul>
<a name="1006671">
There is also a PLAYMACRO command making it possible to trigger the playing of a macro from within a script - This makes it possible to create self-running demos. <p>
</a>
<a name="1006655">
Tip: Before playing a macro, you may want to put the text display at maximum speed by pressing the [ I ] key a number of times first.<p>
</a>
<a name="999928">
<h2>20.4	 Restrictions to Macro Playback</h2>
</a>
<a name="999929">
The original timing of the player input is not preserved in the macros. When a macro is played back, execution of the next command starts as soon as the previous one is finished. This means macros are not suited for recording parts where the timing of player input is critical. In other words, if you are using the GRAAL timer functions, stop to think before you record macros.<p>
</a>
<a name="1003991">
Changing the N_GLOBALIMGS:, N_SECTIONIMGS:, GLOBALOBJS: or SECTIONOBJS: statements offsets the image and object numbers, and previously recorded macros will stop working. That's a very good reason to set them reasonably high right from the beginning.<p>
</a>
<a name="1006658">
<p>
</a>
<a name="999931">
<h1>21	 "Productifying" Your Adventures</h1>
</a>
<a name="999932">
<h2>21.1	 The Basics</h2>
</a>
<a name="999933">
While developing your adventure, you have all the required files in one, big, happy development directory. When you need to distribute your finished work (or test versions) to other people, problems arise: <p>
</a>
<ul>
<a name="999934">
<li>You only want to distribute the files needed for the adventure - not the GRAAL docs, utility programs and temporary work files which you probably also have in the development directory.
</a>
<a name="999935">
<li>If the game should be playable from diskettes, you need a way to tell GRAAL which files are on which diskette, and you probably want to duplicate some frequently used files onto all the game diskettes.
</a>
<a name="999936">
<li>Perhaps you want to encrypt and compress the files, saving disk space and making it very much harder for players to find the solution by cheating.
</a>
</ul>
<a name="999937">
This is how to go about it:<p>
</a>
<ul>
<a name="999938">
<li>You put the information about which files belong to the finished game, and which diskette(s) they should be placed on, in the diskinfo.graal file. Use the GREP program (described below) to help you out.
</a>
<a name="999939">
<li>This step is optional and can only be done by registered users: You run the GPRO program, which uses the diskinfo.graal file to copy all the required files from the development directory to a test directory (which must also be on hard disk). This makes it possible to test if all required files really were specified correctly in the diskinfo.graal file before making diskettes. It is during this step that GPRO also offers an option to encrypt and compress selected files.
</a>
<a name="999940">
<li>You run the GDC program - either from the development or the test directory depending on whether you did step 2 above - which uses the diskinfo.graal file to copy the game files to diskettes. It also formats and labels each diskette so that GRAAL knows what diskette names to look for when disk swapping during play becomes necessary.
</a>
</ul>
<a name="999941">
<h2>21.2	 The diskinfo.graal File</h2>
</a>
<a name="999942">
GPRO and GDC rely on a "diskinfo" file to tell them which files should be copied, and which diskette each file is meant to end up on. A diskinfo file must contain the following:<p>
</a>
<a name="999943">
On line 2 (and nowhere else): The common part of the delivery diskette volume name, for example<p>
</a>
<a name="999944">
MYADVENTURE_DISK<p>
</a>
<a name="999945">
When GDC does its stuff later, the diskettes will be labelled<p>
</a>
<a name="999946">
<pre>MYADVENTURE_DISK A   MYADVENTURE_DISK B
</pre>
</a>
<a name="999947">
and so on.<p>
</a>
<a name="999948">
Below line 3: The names of all the files, grouped according to delivery diskette. Each file name is on its own line, preceded by the diskette suffix and a space. For example:<p>
</a>
<a name="999949">
<pre>A 1.room
</pre>
</a>
<a name="999950">
means the script file 1.room is delivered on MYADVENTURE_DISK A.<p>
</a>
<a name="999951">
Remember: The files should be grouped according to volume, and the groups should be sorted alphabetically, starting with everything on diskette A.<p>
</a>
<a name="999952">
You may have as many comment lines and empty lines in between the file entries as you like.<p>
</a>
<a name="999953">
The following stuff should ALWAYS be on diskette A:<p>
</a>
<a name="999954">
1)  GRAAL_2 *<p>
</a>
<a name="999955">
The main program. It does not have to be called GRAAL_2 - rename it to anything you want your adventure called.<p>
</a>
<a name="999956">
2)  FONTS *<p>
</a>
<a name="999957">
A special entry which copies the entire fonts: drawer in your development directory.<p>
</a>
<a name="999958">
3)  graal.main<p>
</a>
<a name="999959">
The graal.main script file<p>
</a>
<a name="999960">
4)  diskinfo.graal *<p>
</a>
<a name="999961">
5)  The picture files for the command and dialogue areas (if you don't specify DEFAULT, in which case the graphics included in the GRAAL_2 program itself are used).<p>
</a>
<a name="999962">
6)  The resource file for requesters (suffix .rsb). If you use the DEFAULT, no entry is needed - it's already in the GRAAL_2 program itself.<p>
</a>
<a name="999963">
The asterisk (*) after some of the file names tells GPRO not to compress and encrypt these files (see below). Apart from the files above, always mark all user documentation and icon (.info) files with asterisks in the same manner!!<p>
</a>
<a name="999964">
<h2>21.3	 GREP</h2>
</a>
<a name="999965">
Once your adventure becomes reasonably big, you may find it a bit difficult to keep track of all the files you use. <p>
</a>
<a name="999966">
The GREP program starts by inspecting the main script, and from there it goes on to find all references to all files used by your adventure.(This, of course, requires that a proper START_ROOM: statement exists in graal.main, otherwise it will not find all the information.)<p>
</a>
<a name="999967">
GREP creates a report over what files are used where, and also gives you helpful suggestions regarding the contents of your diskinfo.graal file and some of the statement settings in graal.main. This information is saved in a file called graal.report.<p>
</a>
<a name="999968">
You can start GREP in two ways:<p>
</a>
<ul>
<a name="999969">
<li>From the shell: Switch to the development drawer, type "run GREP".
</a>
<a name="999970">
<li>From the Editor: Select the "Create Report" option in the GRAAL menu. The resulting file will automatically be loaded into a new window in the Editor.
</a>
</ul>
<a name="999971">
<h2>21.4	 GPRO</h2>
</a>
<a name="999972">
The GPRO program is used to copy the files that make up your adventure (the ones that should go on the delivery diskette) from the development directory (which can be a right old mess) to a test directory, containing only what is needed to run the adventure.<p>
</a>
<a name="999973">
You should test the adventure thoroughly in the test directory, making sure everything is included, before making the delivery diskettes. (GDC is automatically copied from development to this test directory by gpro, because you need it there to make the diskettes.)<p>
</a>
<a name="999974">
This program is only available to registered users (in other words, it needs the personal keyfile to work). Unregistered users are confined to copying the game files directly onto the delivery diskettes from the development directory using GDC, and then testing the diskettes.<p>
</a>
<a name="999975">
<h3> Starting GPRO</h3>
</a>
<a name="999976">
GPRO runs from CLI only. Open a shell, and switch to your development directory. Then type RUN GPRO. (Don't forget the "RUN" bit, or GPRO may lock up during the copying process!)<p>
</a>
<a name="1001839">
GPRO now checks if there is a valid graal.key file in the directory. If not, it will say so, urge you to register GRAAL, and terminate.<p>
</a>
<a name="999977">
The user interface is as follows:<p>
</a>
<a name="1001834">
<p><img src="g-gpro.gif"><p>
<p>
</a>
<a name="999980">
<h3> Encrypt:</h3>
</a>
<a name="999981">
&lt; &gt; Yes: Compress and encrypt files not marked by an asterisk in the         diskinfo.graal file. See "Compressing and encrypting" below.<p>
</a>
<a name="999982">
&lt; &gt; No: Do a normal file copy.<p>
</a>
<a name="999983">
<h3> Simulation: &lt; &gt;</h3>
</a>
<a name="999984">
Click this if you just want to test the contents of the diskinfo file. The Copy function will just "go through the motions", showing what would happen if you had been copying for real.<p>
</a>
<a name="999985">
<h3> Diskinfo:</h3>
</a>
<a name="999986">
You can choose the name of the diskinfo file to use here. You can, for example, have one diskinfo file for demo versions and one for "live" versions in your development directory. (I use this facility to produce a GRAAL delivery from the "Olaf" development directory, which normally produces only the "Olaf" game itself.)<p>
</a>
<a name="999987">
Note that the selected file is renamed diskinfo.graal (the default name) in the destination directory, and therefore, diskinfo.graal is the name that should ALWAYS be used when referring to the diskinfo file IN the diskinfo file!<p>
</a>
<a name="999988">
<h3> Destination:</h3>
</a>
<a name="999989">
The name of a hard disk directory, which, by the way, must exist already.<p>
</a>
<a name="999990">
GPRO saves the names of the last diskinfo file and destination directory in a file, and so remembers the settings until the next time it is used.<p>
</a>
<a name="999991">
<h3> Status bar</h3>
</a>
<a name="999992">
A green stripe shows how far the copying has progressed.<p>
</a>
<a name="999993">
<h3> Message field</h3>
</a>
<a name="999994">
A text shows what is currently going on during the copy operation.<p>
</a>
<a name="999995">
<h3> Copy and Exit buttons</h3>
</a>
<a name="999996">
Really... you'll just have to find out for yourself!<p>
</a>
<a name="999997">
<h3> Compressing and encrypting</h3>
</a>
<a name="999998">
Almost all files can be compressed and encrypted during the copying process. There are two benefits to this: You save disk space, and both graphics and text files are rendered unreadable to your users except through the GRAAL_2 program.<p>
</a>
<a name="999999">
The following files/diskinfo entries should NEVER be compressed during copying:<p>
</a>
<a name="1000000">
GRAAL_2 icon files documentation files graal.key diskinfo.graal<p>
</a>
<a name="1000001">
To make sure a file is never encrypted, just put a space and an asterisk after the file name in the diskinfo.graal file, for example:<p>
</a>
<a name="1000002">
A Disk.info * <br>A GRAAL_2 * <br>A GRAAL_2.info *<p>
</a>
<a name="1000003">
Of course, you may want to compress GRAAL_2 to save disk space, but do so before the final copying process, and use a utility that creates a self-decompressing executable file (like PowerPacker or CrunchMania).<p>
</a>
<a name="1000004">
Note that encrypted games DO NOT require the keyfile to run, and the key file must never be distributed with your finished games. It's your private property!<p>
</a>
<a name="1000005">
The compression routine puts the emphasis on speed rather than efficiency. On average, 30%-40% less space is used by a compressed adventure.<p>
</a>
<a name="1000006">
The percentage gained varies greatly with the structure and complexity of the files. Some examples:<p>
</a>
<a name="1000007">
120K tracker module			gained 42% <br>24K complex bg picture			gained 20% <br>12K simple clipart picture			gained 54% <br>24K script file			gained 50% <br>48K IFF sample w. "silent" parts			gained 38%<p>
</a>
<a name="1000008">
GRAAL games with compressed files require up to 200K or so extra RAM space to do their job. Running a reasonably large adventure thus takes a little more than 1,5MB...<p>
</a>
<a name="1000009">
On fast machines, I perceive a performance increase running compressed games, but perhaps that's only my imagination... It's not unreasonable, though, that the reduced disk access more than makes up for the unpacking time.<p>
</a>
<a name="1000010">
On slow machines, the unpacking time becomes more noticeable, and running a GRAAL game on an unexpanded 68000 machine with no memory cacheing can be a nuisance. To help out a little, consider NOT compressing and encrypting long sound samples, and perhaps you could leave the tracker modules alone, too. Because the tracker modules are probably the biggest files you have, this will also save some working space (perhaps a 100K or so).<p>
</a>
<a name="1000011">
<h2>21.5	 GDC</h2>
</a>
<a name="1000012">
GDC is the program that copies the game files to the final delivery diskettes. You MUST use this program to prepare the diskettes.<p>
</a>
<a name="1000013">
However, GDC is not intended for making copies of the game. Just use GDC to make the "master diskettes", and then use some proper diskette copying software for the copies.<p>
</a>
<a name="1000015">
If you have run GPRO, the GDC program was copied to the test directory automatically, and you should run it from there.<p>
</a>
<a name="1000016">
If you don't have access to GPRO, you run GDC directly from the development directory.<p>
</a>
<a name="1000017">
GDC runs from CLI only. Open a shell, and switch to the appropriate directory. Then type RUN GDC. (Don't forget the "RUN" bit, or GDC may lock up during the copying process!)<p>
</a>
<a name="1000021">
<p><img src="gdc.gif"><p>
<p>
</a>
<a name="1000022">
<h3> Format radio buttons</h3>
</a>
<a name="1000023">
To prepare the diskettes, and label them properly, GDC first formats each diskette. This can be done quickly, if the diskette has been preformatted, or in the normal fashion, in which case the previous formatting status of the disk is not important.<p>
</a>
<a name="1000024">
<h3> Check Sizes button</h3>
</a>
<a name="1000025">
This is normally done automatically when you start GDC.<p>
</a>
<a name="1000026">
The "gauges" or "meters" labelled A, B, and so on, are updated to show how much space is used on each disk. If you have specified too much for a certain volume in the diskinfo file, the top of that meter turns red to show that you must edit the diskinfo file and re-distribute the files to make it all fit. (We're talking standard DD diskettes here, of course.)<p>
</a>
<a name="1000027">
If you have left GDC running while editing the file, you could use the button to re-calculate the space requirements. On the other hand, it might be a good idea to exit the program, make sure you update the right file in the right place, and only then re-run GDC...<p>
</a>
<a name="1000028">
<h3> Status bar</h3>
</a>
<a name="1000029">
When you press &lt;Copy&gt;, each diskette meter in turn is gradually emptied, and this line starts growing instead to show how far the copy operation has progressed.<p>
</a>
<a name="1000030">
<h3> Message field</h3>
</a>
<a name="1000031">
If anything goes wrong, this is where you will get told.<p>
</a>
<a name="1000032">
<h3> Copy and Exit buttons</h3>
</a>
<a name="1000033">
Once more, pretty obvious...<p>
</a>
<a name="1000034">
<p>
</a>
<a name="1000035">
You don't need more than 18 diskettes, do you? Please! Tell me you don't!<p>
</a>
<a name="1000036">
<p>
</a>
<a name="1000037">
NICE TIP: It's good practice to keep the diskinfo.graal file updated during development. Start GDC now and then to see if the distribution of files seem about right with respect to the space requirements... Also, use GREP to check that the diskinfo.graal information is correct.<p>
</a>
<a name="1000038">
<p>
</a>
<a name="1000040">
<h1>22	 The Editor</h1>
</a>
<a name="1000041">
<h2>22.1	 Introduction</h2>
</a>
<a name="1000042">
This is a neat little (well, growing bigger all the time, actually) editor, making life in the GRAAL script-writing lane much easier than it otherwise would be.<p>
</a>
<a name="1000043">
At first, you may find the concept behind it all slightly confusing. While other "user-friendly" games development systems opt for point-and-click control of everything, storing the results away in cryptic databases, GRAAL is basically made up of ASCII scripts that can be created using any text editor. While this means more typing and requires a deeper understanding of what's going on, it also has some definite advantages. It means greater flexibility in your creations, a better overview, and a total freedom when it comes to documenting the scripts via comment lines. And the GRAAL editor steps in to bring you the best of the "point'n'click world", too. It makes the typing of the scripts a lot easier, and you will not want to be without it.<p>
</a>
<a name="1000044">
In short, the editor spares you from annoying things such as trying to remember what script does what, what the parameters of that "OBJECT:" statement mean, and what the coordinates of your last 6 FLOOR: and PATH: definitions actually looks like on screen. The end result is the same as you would get with any other editor, though - ASCII script files with lists of GRAAL statements and commands.<p>
</a>
<a name="1000045">
In addition, the GRAAL editor has the following advantages:<p>
</a>
<ul>
<a name="1000046">
<li>It handles multiple scripts in multiple windows simultaneously, with   easy switching, copying and pasting between them.
</a>
<a name="1000047">
<li>It is connected to the on-line reference, giving help on statements and commands.
</a>
<a name="1000048">
<li>It keeps track of used and unused room, section, scene, and ptrn   numbers.
</a>
<a name="1000049">
<li>Although many features are GRAAL-related, it is perfectly possible to use this editor to edit any kind of ASCII text file. You will probably find   it a good alternative. Enjoy!
</a>
</ul>
<a name="1000050">
The editor handles scripts up to 5000 lines long. (If you have GRAAL scripts that long, you are probably in need of professional help :-)<p>
</a>
<a name="1000051">
<h2>22.2	 System Requirements</h2>
</a>
<a name="1000052">
This editor needs Workbench 2.0 or better to work.<p>
</a>
<a name="1000053">
amigaguide.library v. 34 or later must be in your LIBS: drawer. (This can be found for free on Aminet.)<p>
</a>
<a name="1000054">
On AGA machines, the editor screen "clones" your Workbench setting by default. If you have a hi-res Workbench, it uses a hi-res screen; with a Productivity Workbench, it opens in Productivity mode... you get the picture. Just make sure that your Workbench is at least 640 pixels wide, and everything should operate smoothly. (The screen mode can be customised using the tooltypes in the GRAAL Editor icon - see the end of this chapter.)<p>
</a>
<a name="1000055">
On non-AGA machines, a normal hi-res, non-interlaced screen is always used.<p>
</a>
<a name="1000056">
Also note that the editor must be placed in your game development library on your hard disk for all file fetching routines to operate without problems. The GRAAL.guide file should also be placed in the same directory.<p>
</a>
<a name="1000057">
<h2>22.3	 Known Bugs &amp; Irritating Facts</h2>
</a>
<ul>
<a name="1000059">
<li>A block marked for editing and contained in a single screen line is   sometimes not properly highlighted on screen. However, the copy/cut/delete functions still work.
</a>
<a name="1000060">
<li>Adding lines to the end of the script in Overstrike Mode doesn't work   properly.
</a>
</ul>
<a name="1003762">
If you use a 68030 or better processor, you may have to turn CPU caches off before using the Editor. Otherwise, graphics in the graphical editing functions may not display properly and make you unnecessarily confused. The way to switch off caches is to open a CLI shell, and type<p>
</a>
<a name="1007093">
<pre>CPU NOCACHE NOBURST
</pre>
</a>
<a name="1000064">
<p><img src="ge-main.gif"><p>
<p>
</a>
<dl>
<dl>
<dl>
<dl>
<dl>
<dl>
<a name="1000065">
<dt> The GRAAL Editor's main screen with one editing window visible.
</a>
</dl>
</dl>
</dl>
</dl>
</dl>
</dl>
<a name="1000066">
<h2>22.4	 Creating a New Script</h2>
</a>
<a name="1000067">
Since the editor expects to be placed in your GRAAL development directory, it checks for a graal.main script in the current directory at start-up - without such a script, you don't really have much of a development environment!<p>
</a>
<a name="1000068">
If there is no main script, the editor asks if one should be created. If you answer "yes", a template for such a script will be created in the editing window (which makes up the main part of the editor display).<p>
</a>
<a name="1000069">
You can also use the "New" option in the "Project" menu to create a new script. The "New" option has six suboptions. The first one, "empty", just opens a new, empty editing window on top of the first one. The editor handles up to ten script windows simultaneously, and you can switch between them quite easily with the "Select Window" option in the "Edit" menu (or [Amiga&gt;+[W&gt;).<p>
</a>
<a name="1000070">
The suboption "graal.main" creates a main script template, as discussed above.<p>
</a>
<a name="1000071">
The last four suboptions, ".room", ".section", ".scene", and ".ptrn" creates a template for the specified script type. Before the template is shown, a requester pops up showing a recommended script number - this number is the first number not already occupied by any of the existing scripts. You can change it if you wish, but remember that it's a waste of space leaving unnecessary gaps in the number sequences.<p>
</a>
<a name="1000072">
The requester also has a gadget for a short script description - you should enter a meaningful description of the room, cutscene or whatever here. This comment is placed in the first (comment) line of the script, and you will see why it's so useful is a very short while... in the next section, as it were!<p>
</a>
<a name="1000073">
<h2>22.5	 Working with the Editor</h2>
</a>
<a name="1000074">
<h3> Loading Existing Scripts</h3>
</a>
<a name="1000075">
Just like the "New" option, the "Load" option, also in the "Project" menu, has the same selection of suboptions as the "New" option. (The only difference is that "empty" is called "general" here.)<p>
</a>
<a name="1000076">
"Load general" brings up an ordinary file requester.<p>
</a>
<a name="1000077">
"Load graal.main file" loads the graal.main straight away - not much use asking for its name, because it's always the same.<p>
</a>
<a name="1000078">
"Load .room file" and so on brings up a list requester showing the numbers and descriptions (see above) of all existing scripts of the desired type, neatly sorted in ascending order.<p>
</a>
<a name="1000079">
Most of the time, you probably want to open a script in a new window, which is why you should use the "Load Another" option instead. It looks exactly like the "Load" options, but in this case, the suboptions have keyboard short-cuts ([amiga&gt;+[3-8&gt;). Learn to use them, as this is the quickest way to open scripts.<p>
</a>
<a name="1000080">
Note: scene scripts with a space in the name will not be properly treated by the loader. Simply put, do not use spaces in script names.<p>
</a>
<a name="1000081">
<h3> The Templates and the Syntax Checker</h3>
</a>
<a name="1000082">
Some statements in the templates have suggested parameters already filled in but in most cases, there is no point in giving a suggestion because the correct parameters are very much up to yourself. You can see this quite easily:<p>
</a>
<ul>
<a name="1000083">
<li>Create a new room script, making the editor give you a room script template.
</a>
<a name="1000084">
<li>Now press the button marked "Syntax". This will make the editor check the script in the current window for syntax errors, and it will not be very long before it comes upon a statement with no parameter filled in. It then displays an error message telling you about the problem, and it also marks the statement where the error occurs.
</a>
</ul>
<a name="1000085">
The syntax checker is a great help, but it does not find every possible error. This is what it does:<p>
</a>
<ul>
<a name="1000086">
<li>It checks the names of all statements.
</a>
<a name="1000087">
<li>It checks that all mandatory statements are in place. However, note that   some statements may depend on others to work, and this is not checked by this function. Be particularly careful with graphics, and make sure the correct CLPART: statement is in effect in every situation requiring   CLPART pictures!
</a>
<a name="1000088">
<li>It checks the number of parameters for all statements (except for   statements with a variable number of parameters).
</a>
<a name="1000089">
<li>For all parameters that may consist of conditions, commands, or both, it checks the name of each condition and command.
</a>
</ul>
<a name="1000090">
If any error is found, the offending statement / command is highlighted, and the nature of the error is shown in a requester as described above.<p>
</a>
<a name="1003811">
All this should make development a little less frustrating. However, GRAAL itself checks a lot of other stuff too, and will still throw runtime errors at you from time to time. Further improvements will probably appear over time.<p>
</a>
<a name="1000091">
Note: The syntax checker uses the script name suffix to determine what statements and commands are allowed - so it can only be used in scripts following the GRAAL naming conventions. And it does NOT work with pattern scripts.<p>
</a>
<a name="1000093">
<h3> Amigaguide Help</h3>
</a>
<a name="1000094">
If you place the cursor on a statement or command word and press the HELP key, the amigaguide reference file graal.guide is opened with the relevant topic displayed. (The small &lt;?&gt; button does the same thing.)<p>
</a>
<a name="1000095">
Note that just like the syntax checker, the help function uses the script name suffix to determine what statements and commands are allowed - so it can only be used in scripts following the GRAAL naming conventions.<p>
</a>
<a name="1000096">
<h3> Normal Editing Functions</h3>
</a>
<a name="1000097">
I will not bother you too much about the functions that you are likely to encounter in any text editor. You should find the find &amp; replace options, and the other options of the "Edit" menu, quite adequate for the job at hand.<p>
</a>
<a name="1000098">
Just a few words about useful keyboard keys:<p>
</a>
<a name="1000099">
[shift]+[down arrow]<br>[shift]+[up arrow]		These keys scrolls the script one page at a <br>		time.<p>
</a>
<a name="1000100">
[shift]+[right arrow] 		Moves the cursor past the last character of <br>		the line.<p>
</a>
<a name="1000101">
[shift]+[left arrow] 		Moves the cursor to the beginning of the line.<p>
</a>
<a name="1000102">
[control]+[right arrow] 		Moves to the next semi-colon of the line; that <br>		is, to the next GRAAL statement parameter.<p>
</a>
<a name="1000103">
[Esc]		Closes the current window.<p>
</a>
<a name="1000104">
[enter]		Exits a string gadget (for example, in the <br>		Find window), or carries out a function (for <br>		example, "Find" in the find window, once the <br>		cursor is not in a string gadget any more).<p>
</a>
<a name="1000105">
Other available short-cut keys are all listed in the menus.<p>
</a>
<a name="1000106">
<h3> Marking Text Using the Mouse </h3>
</a>
<a name="1000107">
Apart from marking text blocks with [amiga&gt;+[1&gt; and [amiga&gt;+[2&gt;, you can use the mouse:<p>
</a>
<ul>
<a name="1000108">
<li>Click the first character of the block.
</a>
<a name="1000109">
<li>Hold down a [shift&gt; key and click the character immediately to the right of the last character of the block. (Clicking the first character of a line will mark the entire previous line.)
</a>
</ul>
<a name="1000110">
<h3> The Status Bar</h3>
</a>
<a name="1000111">
Some useful bits of information are shown in the "status bar" immediately above the editing windows:<p>
</a>
<ul>
<a name="1000112">
<li>Cursor row (r) and column (c) position.
</a>
<a name="1000113">
<li>Insert (I) or overstrike (O) write mode.
</a>
<a name="1000114">
<li>Number of changes made since the last save. Note that some "big" operations, like inserting a block of text, only count as one change each!
</a>
<a name="1000115">
<li>Time. The clock is only updated when you do something in the editor, like moving the cursor.
</a>
</ul>
<a name="1000116">
<h3> &lt;RUN&gt; button</h3>
</a>
<a name="1000117">
The &lt;RUN&gt; button (which has a small GRAAL symbol on it) tries to start the GRAAL driver as a separate process. By default, it assumes the name of the GRAAL driver program is GRAAL_2. This can be changed using tooltypes in the GRAAL Editor icon. (See the end of this chapter.)<p>
</a>
<a name="1000118">
<h3> "Quick LOCATE" Buttons</h3>
</a>
<a name="1000119">
To help you quickly locate those parts of a script file which are most often edited, four buttons have been provided. For example, clicking &lt;ACTION:&gt; takes you to the first occurrence of "ACTION:" in the script.<p>
</a>
<a name="1000120">
<h3> Switching between Windows</h3>
</a>
<a name="1000121">
When writing GRAAL scripts, you very often need to make changes to two or more script files almost simultaneously. Fortunately, the GRAAL editor really excels at this.<p>
</a>
<a name="1000122">
Use [amiga]+[w] to open a window containing a list of all currently open editing windows and their contents. In addition, all windows where unsaved changes exist are marked with an asterisk ( * ) before the window number.<p>
</a>
<a name="1000123">
Click on any name in the list, and that window will become active and placed on top of the other windows. You can also use the cursor keys and select a window with the [enter&gt; key. In fact, the GRAAL text editing functions have been designed to make as little use of the mouse as possible - the keyboard is much faster once you get accustomed to using all short-cut keys.<p>
</a>
<a name="1000124">
If you need to view more than one script at the same time, just resize the editing windows and place them next to each other - nothing could be simpler. (Though I must confess I don't use this much myself - window switching is so much easier!)<p>
</a>
<a name="1000125">
<h2>22.6	 Creating a Report</h2>
</a>
<a name="1000126">
The "Create Report" option in the GRAAL menu starts the GREP program, provided it is in the development drawer. When the program has finished, the resulting report (always called graal.report) is loaded into a new window in the Editor for viewing (and possibly some cutting and pasting as well).<p>
</a>
<a name="1000127">
The GREP program is described elsewhere in this manual.<p>
</a>
<a name="1000128">
<h2>22.7	 The Parameter Editor</h2>
</a>
<a name="1000129">
Instead of typing the parameters of all statements and commands, separating them with ";" or "," characters, you can edit the parameters in a window, with each parameter neatly contained in its own string gadget.<p>
</a>
<a name="1000130">
This is how to do it:<p>
</a>
<ul>
<a name="1000131">
<li>Place the cursor on a statement or command - the actual NAME, mind you, not on one of the parameters.
</a>
<a name="1000132">
<li>Press [right Amiga] + [E] or click the &lt;Edit Parameters&gt; button.
</a>
<a name="1000133">
<li>A window opens, with all parameters neatly laid out in string gadgets. The number of string gadgets available equals the number of parameters. Repetitive parameters (surrounded by brackets {} in the syntax description) only get one string gadget. You could type the parameters there, but it's often easier to do these in the normal editor "typewriter" mode.
</a>
</ul>
<a name="1000134">
The lead text for each gadget is taken from the syntax help - if it's longer than 15 characters, the leftmost characters will not be visible, which may look a little funny at times. Oh well...<p><img src="ge-param.gif"><p>
<p>
</a>
<dl>
<dl>
<dl>
<dl>
<dl>
<dl>
<a name="1000138">
<dt> The Parameter Editor window - this one with an OBJECT: statement loaded.
</a>
</dl>
</dl>
</dl>
</dl>
</dl>
</dl>
<a name="1000139">
<h3> Keyboard Short-cuts</h3>
</a>
<a name="1000140">
There are a number of short-cut keys to help you reach the different parts and functions of the window. They can only be used when the cursor is not in an input string gadget. That means after you have entered text into a gadget, press [Enter] to exit the gadget to make the short-cut keys available. Specifically:<p>
</a>
<ul>
<a name="1000141">
<li>When you press the [Tab] key, the next string gadget (following the last   activated one) will be activated.
</a>
<a name="1000142">
<li>When you press the [Enter] key whilst not in an active gadget, or click &lt;OK&gt;, any changes you have made will be inserted into the script file.
</a>
<a name="1000143">
<li>When you press the [Esc] key or click &lt;Cancel&gt;, the changes you've started to make will be forgotten, and the window is closed without any alterations to the script.
</a>
<a name="1000144">
<li>When you press [Help] or click &lt;?&gt;, the amigaguide help for the current statement or command is shown. When you've done reading up on the subject, press [Esc] to return to the parameter window.
</a>
<a name="1000145">
<li>The graphical editing functions have keyboard short-cuts [F1] to [F7], as listed further on.
</a>
</ul>
<a name="1000146">
<h3> Optional Parameters</h3>
</a>
<a name="1000147">
Optional parameters are shown in blue. Consult the on-line reference for information about when to use them (and not).<p>
</a>
<a name="1000148">
<h3> Cycle Buttons</h3>
</a>
<a name="1000149">
If the button to the right of a string gadget is available, you can press this to cycle through the valid alternatives for the parameter. The contents of the gadget will change as you click the button repeatedly.<p>
</a>
<a name="1000150">
UPPERCASE text entered by the cycle button should be kept as is. Occasionally, a text in lowercase may appear, which you should change to a proper value.<p>
</a>
<a name="1000151">
For example, if the text "obj" is shown as one of the cycle alternatives, this means you should replace "obj" with a proper object number.<p>
</a>
<a name="1000152">
<h3> Graphical Editing</h3>
</a>
<a name="1000153">
A lot of parameters have to do with specifying co-ordinates, positions and other stuff related to a backdrop picture. You very sledom have to enter the values of these parameters manually - instead, there are a number of special functions to let you do this graphically.<p>
</a>
<a name="1000154">
If a statement or command contain parameters which can be edited in this way, one or more of the special editing buttons beneath the string gadgets will become available. They also have keyboard short-cuts in the form of keys [F1] to [F8]. <p>
</a>
<a name="1003903">
Usually, the editor finds the relevant backdrop picture and room script to use automatically, but may occasionally ask you for a file name when it cannot decide which part of the adventure you are referring to.<p>
</a>
<a name="1003904">
Sometimes, the editor asks "Reload the object and image data?". If you haven't altered any images, or switched rooms or anything since the last time you used the graphical editing functions, you can answer "no", which speeds up the process. <p>
</a>
<a name="1003712">
If the backdrop picture is one of the rooms in your game, all previously defined objects placed in that room are also shown for reference. In many cases, floors and paths are also shown, with their respective numbers shown close to the center of the each floor and path. If the backdrop picture is wider than the screen, use the left and right cursor keys to scroll it.<p>
</a>
<a name="1003713">
Note: If objects overlap, the editor does not bother to sort them in the proper order. <p>
</a>
<a name="1000157">
The details of all the "graphical editing" operations are explained below, and there is also a brief help text on a screen directly below the picture you are about to edit. Once you are done, press "Enter" to save the changes, or "Esc" to cancel. <p>
</a>
<a name="1003866">
<h3> Important Tips</h3>
</a>
<ul>
<a name="1003868">
<li>Make sure all statements and commands specifying picture file names, which help the editor choose the right file, are entered as early as possible in the script-writing process. 
</a>
<a name="1003869">
<li>Remember that the editor mainly loads data from the files saved to disk, not from unsaved versions of the files still in the editor. Therefore, you should usually save changes before going to the parameter editor.
</a>
<a name="1003928">
<li>When selecting character images in multiple character games, note that most character-related statements and commands expect you to specify the image of character 1, which will be replaced by the corresponding image for the currently controlled character automatically. See <a href="graal22.htm#999600">``Multiple Characters and Inventories'' on page 46</a>.
</a>
</ul>
<a name="1003870">
Now, a closer look at the "graphical editing" buttons:<p>
</a>
<a name="1000164">
<h3> &lt;Area&gt; [F1]</h3>
</a>
<a name="1000165">
An area or "frame" is a rectangle that can be moved around the screen and re-sized. It is used to cut out clipart graphics, and for specifying areas for exits, floors, and a number of other things. <p>
</a>
<a name="1003721">
To re-size, click and drag the bottom left corner (the little square) of the rectangle. To move the rectangle, click and drag anywhere else on the screen.<p>
</a>
<a name="1000167">
If you use this option to edit the cut-out frames for images, you will get a number of rectangles on screen corresponding to the number of images to be cut out by the ...IMGS: statement. Use the leftmost rectangle to re-size: all duplicate frames will also be re-sized automatically. To alter the spacing between the frames, use the up and down cursor keys.<p><img src="ge-area.gif"><p>
<p>
</a>
<dl>
<dl>
<dl>
<dl>
<dl>
<dl>
<a name="1000171">
<dt> Editing areas for an IMGS: statement. If you look closely, you may be able to see the 10 cut-out frames on the second row of images in this screen shot (it's easier in real life :).
</a>
</dl>
</dl>
</dl>
</dl>
</dl>
</dl>
<a name="1000173">
<h3> &lt;Position&gt; [F2]</h3>
</a>
<a name="1000174">
This edits the position of an image, and possibly also the image number.<p>
</a>
<a name="1000175">
If the previous position and image used are known, the object or image will start out in its old position. <p>
</a>
<a name="1000176">
Click and hold the mouse button. Drag the mouse to move the image to the desired location and release. (If it's an object, a copy of the image will remain the object's previous position when you drag the image.)<p>
</a>
<a name="1000177">
To select another image, use the up and down cursor keys.<p>
</a>
<a name="1000178">
To flip the image left/right, press the "x" key.<p>
</a>
<a name="1000179">
Note: When you save the changes with the "Enter" key, the selected image will normally be placed in the "image" parameter. However, if the "image" parameter previously contained an animation sequence or a PTRN specification, it will NOT be affected. This is to prevent a lot of hard work being undone by an over-smart editor...<p>
</a>
<a name="1003750">
<p><img src="ge-floor.gif"><p>
<p>
</a>
<dl>
<dl>
<dl>
<dl>
<dl>
<dl>
<a name="1000183">
<dt> In some cases, the position of all floors are shown in the backdrop picture to make it easier to pick the correct location for new graphic bits &amp; pieces...
</a>
</dl>
</dl>
</dl>
</dl>
</dl>
</dl>
<a name="1000184">
<h3> &lt;Pastepos&gt; [F3]</h3>
</a>
<a name="1000185">
This is exactly the same as editing an image position, except the parameters specify the upper left corner of the image, not the hotspot position. This is nothing YOU have to worry about - the Editor will make the correct button available and also take care of which co-ordinate goes where.<p>
</a>
<a name="1000186">
<h3> &lt;Char.pos&gt; [F4]</h3>
</a>
<a name="1000187">
Very similar to the previous two, but only available when editing an object. This sets the main character's position relative to the object, used in the MOBJ command. The image used for the main character can also be altered. The same rules as for the object positioning apply.<p>
</a>
<a name="1003841">
As from GRAAL 2.2, the Editor asks you if the character width should be taken into consideration. Answering "yes" means GRAAL will calculate the position of the edge of the character closest to the object, rather than the center of the image. This is only a concern if you have multiple characters with varying widths that can try to manipulate the object.<p>
</a>
<a name="1000188">
<h3> &lt;Line&gt; [F5]</h3>
</a>
<a name="1000189">
This one edits the line for a PATH: statement. Each point on the line (there may be up to 6 of them) has a "handle" in the form of a small square. Just click within the handle and drag to move the point to a new place.<p>
</a>
<a name="1000190">
To add a new point, press the "arrow up" key. The new point will be inserted between the last and the second last point.<p>
</a>
<a name="1000191">
To delete a point, press the "arrow down" key. It is always the second last point that is deleted.<p>
</a>
<a name="1000192">
<h3> &lt;Ink&gt; [F6]</h3>
</a>
<a name="1000193">
This one's a little different. Many commands require colour numbers to be specified, and this helps to pick the correct palette index number directly from the palette of the relevant backdrop picture.<p><img src="ge-ink.gif"><p>
<p>
</a>
<dl>
<dl>
<dl>
<dl>
<dl>
<dl>
<a name="1000197">
<dt> Selecting a colour by clicking.
</a>
</dl>
</dl>
</dl>
</dl>
</dl>
</dl>
<a name="1000198">
When the picture is shown, a palette overlays the upper left corner of the picture. The text above the screen tells you to click on a colour - the "normal ink" colour for things like text displays, and the "background ink", which is the colour most functions use to erase or clean up unwanted parts of the picture.<p>
</a>
<a name="1000199">
The "highlight ink" colour is only used in the sentence display area. It is the colour used when a completed sentence is highlighted during command execution.<p>
</a>
<a name="1000200">
<h3> &lt;File&gt; [F7]</h3>
</a>
<a name="1000201">
Not a very graphical function, but this button can be used to select a file name. If you have an AGA machine, the file requester that pops up will show only files of certain types, depending on the statement or command you are currently editing. For example, for the BG_IFF: statement, only picture files will be shown; for the TRACK command, only music modules will be shown. The filter settings can be changed using the tooltypes in the GRAAL Editor icon. See the end of this chapter. If it's a room script that is wanted, the Editor always uses the special "load room" requester which also shows the room descriptions.<p>
</a>
<a name="1002559">
<h3> &lt;3D&gt; [F8]</h3>
</a>
<a name="1002560">
This one edits the position of the 3D scaling lines in the 3D: statement. Just drag each line to its proper position along the y axis. Each line has a box attached to the top - the box represents the scale of the character, so the line with the smallest box should be the one furthest up the picture, and so on.<p>
</a>
<a name="1000202">
<h3> Inserting New Statements or Commands Using &lt;Edit Parameters&gt;</h3>
</a>
<a name="1000203">
If you place the cursor on an empty line and use &lt;Edit Parameters&gt;, a list requester pops up asking you if you wish to insert a new statement. All valid statements (according to the script type) are shown in the list. Select a statement with the up and down arrow keys, or with the mouse. With a statement selected, you can also click the &lt;?&gt; button or press [Help] to read the amigaguide help for the statement.<p>
</a>
<a name="1000204">
Select the statement with [Enter], the &lt;OK&gt; button, or by clicking it a second time with the mouse. A new line containing the statement will be inserted at the cursor position, and the parameter editor window is opened automatically.<p>
</a>
<a name="1000205">
Similarly, positioning the cursor on a line that has a statement, but neither on the statement nor the existing command names, brings up a requester asking if you wish to insert a new condition or command. Be careful not to insert a new command in the middle of parameters belonging to another command...<p>
</a>
<a name="1000206">
Note: scene scripts can't contain statements. Therefore, it's always the condition/command list that appears when using the &lt;Edit Parameters&gt; function in an empty space.<p>
</a>
<a name="1000207">
<h2>22.8	 Icon Tooltypes</h2>
</a>
<a name="1000208">
Some aspects of the Editor's operation can be changed using the following tooltypes:<p>
</a>
<a name="1000209">
SCREEN=WB|NTSC|PAL<br>	WB: The editor will open in the current Workbench screen <br>	mode. NTSC: The screen opens in hires NTSC mode. PAL: The <br>	screen open in hires PAL mode.<p>
</a>
<a name="1000210">
(Note: The SCREEN tooltype only works with AGA machines.)<p>
</a>
<a name="1000211">
GRAAL=name	Sets the name of the GRAAL driver program being started<br>	with the Editor\xab s &lt;RUN!&gt; button.<p>
</a>
<a name="1000212">
IMAGEFILTER=filter<br>	Specifies which files should be shown by the file requester <br>	when the FILE button in the Parameter Editor window is <br>	used to find images. The default is<p>
</a>
<a name="1000213">
	#?.iff|#?.pic|#?.i16|#?.i32|#?.i64<p>
</a>
<a name="1000214">
TRACKFILTER=filter<br>	Specifies which files should be shown by the file requester <br>	when the FILE button in the Parameter Editor window is <br>	used to find music modules. The default is<p>
</a>
<a name="1000215">
	#?.trk|#?.track|#?.mod|#?.sng<p>
</a>
<a name="1000216">
SAMPLEFILTER=filter<br>	Specifies which files should be shown by the file requester <br>	when the FILE button in the Parameter Editor window is <br>	used to find samples for sound effects. The default is<p>
</a>
<a name="1000217">
	#?.snd|#?.raw|#?.8svx<p>
</a>
<a name="1000218">
CHECKONSAVE=YES|NO<br>	If this is set to yes, a syntax check will be automatically <br>	performed as soon as you try to save a script file. If an error <br>	occurs and you click the &lt;Cancel&gt; button in the error report <br>	box, the script will not be saved. Clicking &lt;Continue&gt; allows <br>	you to save the script with the errors in it.<p>
</a>
<a name="1002557">
PAINTAPP=path:name [arguments]<br>	The path and name of a paint program, which can be launched<br>	directly from the Editor's GRAAL menu. Some paint programs<br>	may accept command line arguments and even a file name. In <br>	this case, put {f} in the place of the file name - GRAAL will <br>	then open a file requester, using the imagefilter specification, <br>	before starting the paint application. (This works wonderfully<br>	well with DPaint.)<p>
</a>
<a name="1000219">
<h2>22.9	 Editor Keyboard Shortcuts</h2>
</a>
<a name="1002535">
("a" means the key must be combined with the right [Amiga] key.)<p>
</a>
<a name="1000220">
a[3]   	Open new window &amp; Load any file           <br>a[4]   	Open new window &amp; Load graal.main          <br>a[5]   	Open new window &amp; Load .room script           <br>a[6]   	Open new window &amp; Load .section script           <br>a[7]   	Open new window &amp; Load .scene script           <br>a[8]   	Open new window &amp; Load .ptrn script<p>
</a>
<a name="1000221">
a[S]	Save                   <br>a[A]	Save As                         <br>a[P]	Print<br>a[?]	About                            <br>a[Q]	Quit           <p>
</a>
<a name="1000223">
a[W]	Select Window           <br>a[I]	Insert Mode                      <br>a[O]	Overstrike Mode                                                        <br>a[F]	Find           <br>a[N]	Find Next           <br>a[R]   	Replace          <br>a[1]   	Mark Block Start                 <br>a[2]   	Mark Block End                  <br>a[T]   	Top           <br>a[B]   	Bottom          <br>a[C]   	Copy           <br>a[X]   	Cut          <br>a[V]   	Paste          <br>a[D]   	Delete Current Line<br>a[Z]   	Undo "Delete Current Line"<br>a[J]   	Stack windows<br>a[L]   	Tile windows horizontally<br>a[M]   	Tile windows vertically<p>
</a>
<a name="1001541">
a[K]	Check Syntax           <br>a[E]	Edit Parameters <br>a[G]	Launch GRAAL<br>a[H]   	Create and load GREP report<br>a[U]	Launch paint program<p>
</a>
<a name="1002547">
[Shift] + [Left Arrow]    		Start of line <br>[Shift] + [Right Arrow]   		End of line <br>[Shift] + [Up Arrow]      		Page up <br>[Shift] + [Down Arrow]    		Page down <br>[Ctrl]  + [Right Arrow]   		Next parameter ( ";" character ) <br><p>
</a>
<a name="1000225">
[Help]     	Show Amigaguide help for current statement / command<p>
</a>
<a name="1000226">
[Esc]      	Close current window / requester <br>[Enter]    	Exit current input string gadget, or close requester and <br>	execute function (depending on current situation). <br>[Tab]      	Activate next input string gadget (can only be done if previous <br>	string gadget has been deactivated with [Enter] first). <p>
</a>
<a name="1001536">
[F1]	Run GRAAL from Editing Window<br>[F2]-[F5]	Quick locate buttons in Editing Window<p>
</a>
<a name="1001525">
[F1]-[F8]  	Editing buttons in Parameter Editing Window<p>
</a>
<a name="1000227">
<h1>23	 Hints and Tips</h1>
</a>
<a name="1000228">
Here are some general hints and tips that may prove useful.<p>
</a>
<a name="1000230">
<h2>23.1	 Flags</h2>
</a>
<ul>
<a name="1000231">
<li>Avoid setting flags in cutscenes, if you have a choice. It's hard to keep track of the games' status in the main script files if the setting of flags is "hidden from sight" in the cutscenes. (And forget I mentioned I've done just the opposite in a few places. Do as I say, not as I do! :-)
</a>
<a name="1000232">
<li>Since all variables have the initial value 0, it is good practice to let that value represent the initial state of the object, room, situation, etc.
</a>
<a name="1000233">
<li>Use room flags for all things that relate to the scene as a whole, rather than the flags of a particular object.
</a>
<a name="1000234">
<li>Remember that ALL aspects of room objects and section objects get reset as soon as you leave the room or section. You can compensate for this using room flags to track room object states, and then set the objects up in whatever way they should be by using DACT: statements.
</a>
<a name="1000235">
<li>Use the room flags for room 0 as "global flags" pertaining to the game as a whole. Room 0 is never used as a "real" room in any adventure.
</a>
</ul>
<a name="1002529">
<h2>23.2	 Diverse</h2>
</a>
<ul>
<a name="1002530">
<li>During the development of a game, you often wish to start the game in an odd location with the objects and flags required set up in a special way. To keep your proper game scripts "clean", set up a special testing room and call this as the START_ROOM:. Get objects and set flags using DACT:s, and in the last DACT:, simply GOTO the location you wish to test.
</a>
<a name="1002909">
<li>Keep a template containing comments for all the ACTION: statements in a separate file, and copy it to the end of each new room and section script. This way, you have a map over what command has what number handy in all scripts.
</a>
</ul>
<a name="1002904">
<p>
</a>
<a name="1000236">
<h1>24	 Questions and Answers</h1>
</a>
<a name="1000237">
Q: Anything I should think about when assigning BOB numbers to objects?<p>
</a>
<a name="1000238">
A: Use numbers below 60. Make sure a BOB number is never used for more than one thing at a time in the same room. Otherwise, no: No information is connected to or "belongs to" BOB numbers and their use, so there are no other fixed rules.<p>
</a>
<a name="1000239">
<br>Q: What about animation channels then?<p>
</a>
<a name="1000240">
A: Same thing. Look up the reserved channel numbers in graal.guide, and make sure you never try to use the same channel for two things in the same room!<p>
</a>
<a name="1000241">
<br>Q: What are the rules for room object use?<p>
</a>
<a name="1000242">
A: A room object can only exist in one room - therefore, it can never be picked up or added to the inventory. Nor can you use its object flags for very much, because they will be reset each time you exit the room.<p>
</a>
<a name="1000243">
ROBJ references should only exist in room scripts, never in .sect or graal.main!<p>
</a>
<a name="1000244">
<br>Q: What are the rules for section object use?<p>
</a>
<a name="1000245">
A: A section object only exists within one section, and preferably disappears totally during the first visit to the section - otherwise, you must keep track of how the objects have been handled via room flags or such devices, if you happen to re-enter the section.<p>
</a>
<a name="1000246">
In other words, take particular care if your adventure is designed in such a way that you can go back to, for example, section 1 from section 2 - not only must you be sure that section 1 still looks okay with respect to section object use, but also, the section 2 section objects will suffer the same problems! Even if you haven't "solved" section 2 yet completely, going back to section 1 will end your first visit to section 2 and thus reset your section objects for section 2!!<p>
</a>
<a name="1000247">
SOBJ references should only be used in room and section scripts, not in the main script.<p>
</a>
<a name="1000248">
<br>Q: I need some very precise movement paths for my character in some situations, and the floor system is not quite up to the job.<p>
</a>
<a name="1000249">
A: There are a couple of ways.<p>
</a>
<a name="1000250">
A) Try using PATH: statements. <p>
</a>
<a name="1000251">
These allow you to connect otherwise unconnected floors using "twisting" paths. Read more about the room PATH: statement in the on-line reference.<p>
</a>
<a name="1000252">
B) Use an un-named exit.<p>
</a>
<a name="1000253">
When you specify an EXIT: with no description, GRAAL shows no exit name in the scene area, nor does it put a "Go to ..." message in the sentence box when the exit is clicked. That way the un-named exit is just a "clickable area" in the scene area, and you can use ACTION: 0;... statements for it to do anything you like.<p>
</a>
<ul>
<a name="1000254">
<li>Put an un-named exit over the destination on the screen your character should reach using a special movement or animation.
</a>
<a name="1000255">
<li>In the ACTION: statements, use whatever commands you need to transport the character to the destination point: Perhaps first an ordinary CMOVE to the closest edge of the actual floors, and then OMOVE 0... to make the final part (up the ladder, down the hole, or whatever).
</a>
</ul>
<a name="1000256">
Note: Remember, if you move the character outside the normal floor area, you are in a bit of trouble if he must also be able to return: If you click outside your unnamed exit, the normal floor system will try to move the character the normal way, and if it is no longer in any floor area... well, problems arise. They can be dealt with, though, using some careful planning. The easiest way is to make sure the player does not get the opportunity of clicking anywhere before the character is safely back on a legal floor again! Some clever use of a number of un-named exits together with SHOWEXIT and HIDEEXIT commands may do the trick.<p>
</a>
<a name="1000257">
<br>Q: I have the need for menu-style pictures with multiple user options.<p>
</a>
<a name="1000258">
A: Yes, why not indeed? Just use EXIT: statements with no name/description to define the clickable areas needed on screen, and then ACTION: 0;... statements to handle the player input. <p>
</a>
<a name="1000259">
Or, define room objects that are actually buttons.<p>
</a>
<a name="1000260">
Or, use the multiple inventories and put your menu selecting in a special inventory, then access them with some special "select" command.<p>
</a>
<a name="1000261">
There's more than one way to fling an otter...<p>
</a>
<a name="1000262">
<br>Q: I want a way to show the player's score at any time!<p>
</a>
<a name="1000263">
A: The neatest (and quickest) way is probably to put a "SCORE" button in the command area using the VERB_ZONE: and VERB_TEXT: statements in the main script. VERB_TEXT: allows you to define "direct verbs", that is, commands that do not wait for or use an object. If you define a verb "SCORE" and make that a direct verb, you can then use a TEXT command to display the score held in a flag (preferably a room flag for room 0 - as mentioned elsewhere, these make excellent "global flags").<p>
</a>
<a name="1000264">
<p>
</a>
<a name="1000265">
Q: I don't quite understand the FLOOR: statements.<p>
</a>
<a name="1000266">
A: The best description is in graal.guide. Make sure you read ALL the information about FLOOR: and PATH: there - it's even got some diagrams! Then look at one of the rooms in the demo adventure to put theory to practice.<p>
</a>
<a name="1000267">
<br>Q: I'm trying to run the GRAAL editor and GRAAL in parallel, but changes I make to the scripts in the editor do not seem to take effect, even though I'm sure I have saved them to disk.<p>
</a>
<a name="1000268">
A: Check this:<p>
</a>
<ul>
<a name="1000269">
<li>You must exit the room / situation where updates were made and then re-enter to force a reload of the scripts in question. Alternatively, use the "Go to" button in the on-line monitor, which also forces a reload.
</a>
<a name="1000270">
<li>You must have MAX_CACHE: 0 in graal.main before starting GRAAL for this. Otherwise, an old copy of the script file still in memory will probably be used instead of your updated version. Alternatively, as soon as you save the script to disk, use a CLI shell to copy it to RAM:
</a>
<a name="1000271">
<li>Changes to graal.main NEVER take effect without restarting the game. 
</a>
</ul>
<a name="1000272">
<br>Q: After playing a tune with the TRACK command, samples played with the SAM command get caught in a loop!<p>
</a>
<a name="1000273">
A: Naughty you - you have probably used the undocumented MED-module feature of GRAAL! It can play MED modules (MMD0 and MMD1 formats), provided you have the file extension ".med" in the module name. However, this causes the above bug in the sample routines to appear - this is Amos's fault. I know there exists an Amos bugfix or work-around for this, but I DON'T HAVE IT. If anyone has seen it, mail it pronto, and the med support will be made official!<p>
</a>
<a name="1002920">
Q: The command area behaves strangely - it doesn't go away when I tell it to in CUTSCENE commands.<p>
</a>
<a name="1002921">
A: You have probably not put it back correctly in a previous cutscene. All sequences of events that start with either CUTSCENE ...,NF or CUTSCENE ...,F must end with an equivalent CUTSCENE ...,N or CUTSCENE ...,S. ALWAYS restore the command area before doing a DSET - it may seem the DSET restores it for you after the dialogue has ended, but not really 100%. This goes for the COMAREA command, too. COMAREA OFF is just another way of saying CUTSCENE "blank file",NF, and COMAREA ON is equivalent to CUTSCENE "blank file",N<p>
</a>
<a name="1003771">
Q: The song I'm playing with the TRACK command doesn't stop after playing through once, but starts over in a weird tempo.<p>
</a>
<a name="1003772">
A: Unfortunately, the tracker "stop song" command 0FFE stopped working with the tracker command set I started using in GRAAL 2.1. Fortunately, there is a way around this: At the very end of the song, put a blank block, and have that block repeat itself by putting a tracker "jump" command (0B..) in it.<p>
</a>
<a name="1002922">
Q: 1. A scaled character changes its size when it starts moving/stops moving. <br>2. A character following the controlled character is not of the same size!<p>
</a>
<a name="1002931">
A: You have been unlucky with the way the 3D scaling zones (in the room 3D: statement) coincide with the FLOOR: settings. There are a number of things you can try to make it all look nicer:<p>
</a>
<ul>
<a name="1002935">
<li>Make sure the 3D zone boundaries are not set too close to a "character position" like EXIT: points, START_POS: points or object-handling positions. This gets rid of problem 1.
</a>
<a name="1002939">
<li>Make sure each floor is within one and only one scaling zone, and add some space for the following character\xab s y offset around the floor edges as well. Then connect the floors with paths. This should get rid of problem 2.
</a>
</ul>
<a name="1000274">
<h1>25	 Index</h1>
</a>
<a name="1006874">
<h2> Numerics</h2>
</a>
<a name="1006877">
3D <a href="graal22.htm#999362">25, </a><a href="graal22.htm#999772">59</a><p>
</a>
<a name="1006879">
<h2> A</h2>
</a>
<a name="1006881">
ACTION statement <a href="graal22.htm#1002803">33</a><p>
</a>
<a name="1006883">
AMAL <a href="graal22.htm#999318">22</a><p>
</a>
<a name="1006885">
animation <a href="graal22.htm#999258">19</a><p>
</a>
<a name="1006887">
complex patterns <a href="graal22.htm#999749">57</a><p>
</a>
<a name="1006889">
language <a href="graal22.htm#999315">22</a><p>
</a>
<a name="1006891">
main character <a href="graal22.htm#999735">56</a><p>
</a>
<a name="1006893">
<h2> B</h2>
</a>
<a name="1006895">
backdrop pictures <a href="graal22.htm#999352">24</a><p>
</a>
<a name="1006897">
BOB <a href="graal22.htm#999262">19</a><p>
</a>
<a name="1006899">
hotspots <a href="graal22.htm#999777">59</a><p>
</a>
<a name="1006901">
number <a href="graal22.htm#999262">19</a><p>
</a>
<a name="1006903">
<h2> C</h2>
</a>
<a name="1006904">
character<p>
</a>
<a name="1006906">
main character <a href="graal22.htm#999237">18</a><p>
</a>
<a name="1006907">
characters<p>
</a>
<a name="1006909">
alternate <a href="graal22.htm#999604">48</a><p>
</a>
<a name="1006911">
following <a href="graal22.htm#999681">52</a><p>
</a>
<a name="1006913">
height and width <a href="graal22.htm#999641">50</a><p>
</a>
<a name="1006915">
speaking partners <a href="graal22.htm#999526">42</a><p>
</a>
<a name="1006917">
switching <a href="graal22.htm#999654">51</a><p>
</a>
<a name="1006919">
width <a href="graal22.htm#999414">29</a><p>
</a>
<a name="1006921">
clipart pictures <a href="graal22.htm#999279">20</a><p>
</a>
<a name="1006923">
commands <a href="graal22.htm#999136">10</a><p>
</a>
<a name="1006925">
executing via monitor <a href="graal22.htm#999874">69</a><p>
</a>
<a name="1006927">
timer <a href="graal22.htm#1001803">64</a><p>
</a>
<a name="1006929">
comments <a href="graal22.htm#999124">10</a><p>
</a>
<a name="1006931">
conditions <a href="graal22.htm#999136">10</a><p>
</a>
<a name="1006933">
cutscenes <a href="graal22.htm#999788">61</a><p>
</a>
<a name="1006935">
called from other cutscenes <a href="graal22.htm#999801">62</a><p>
</a>
<a name="1006937">
ending with Esc <a href="graal22.htm#999795">62</a><p>
</a>
<a name="1006939">
<h2> D</h2>
</a>
<a name="1006941">
DACT statement <a href="graal22.htm#999514">38</a><p>
</a>
<a name="1006943">
date (in-game) <a href="graal22.htm#1001823">64</a><p>
</a>
<a name="1006945">
dialogues <a href="graal22.htm#999523">42</a><p>
</a>
<a name="1006948">
driver <a href="graal22.htm#999073">8, </a><a href="graal22.htm#999179">13</a><p>
</a>
<a name="1006950">
<h2> E</h2>
</a>
<a name="1006952">
error messages <a href="graal22.htm#999183">14</a><p>
</a>
<a name="1006954">
errors and problems <a href="graal22.htm#1000237">96</a><p>
</a>
<a name="1006956">
EXIT command <a href="graal22.htm#999469">34</a><p>
</a>
<a name="1006959">
exits <a href="graal22.htm#999368">25, </a><a href="graal22.htm#999499">37</a><p>
</a>
<a name="1006961">
<h2> F</h2>
</a>
<a name="1006965">
flags <a href="graal22.htm#1003124">39, </a><a href="graal22.htm#999550">44, </a><a href="graal22.htm#1000230">95</a><p>
</a>
<a name="1006967">
floors <a href="graal22.htm#999364">25</a><p>
</a>
<a name="1006968">
fonts<p>
</a>
<a name="1006970">
changing <a href="graal22.htm#999225">17</a><p>
</a>
<a name="1006972">
frames <a href="graal22.htm#999321">22</a><p>
</a>
<a name="1006974">
in animations <a href="graal22.htm#999742">57</a><p>
</a>
<a name="1006976">
UPDATE statement <a href="graal22.htm#999344">24</a><p>
</a>
<a name="1006979">
<h2> H</h2>
</a>
<a name="1006981">
hotspot <a href="graal22.htm#999780">59</a><p>
</a>
<a name="1006983">
<h2> I</h2>
</a>
<a name="1006985">
image bank <a href="graal22.htm#999268">20</a><p>
</a>
<a name="1006986">
images<p>
</a>
<a name="1006989">
flipped <a href="graal22.htm#999306">21, </a><a href="graal22.htm#999767">58</a><p>
</a>
<a name="1006990">
inventories<p>
</a>
<a name="1006992">
list <a href="graal22.htm#999895">70</a><p>
</a>
<a name="1006994">
switching <a href="graal22.htm#999662">51</a><p>
</a>
<a name="1007001">
<h2> O</h2>
</a>
<a name="1007003">
objects <a href="graal22.htm#999381">27</a><p>
</a>
<a name="1007005">
list <a href="graal22.htm#999891">70</a><p>
</a>
<a name="1007007">
objects vs "dumb" graphics <a href="graal22.htm#999383">27</a><p>
</a>
<a name="1007011">
<h2> R</h2>
</a>
<a name="1007012">
rooms<p>
</a>
<a name="1007014">
list <a href="graal22.htm#999893">70</a><p>
</a>
<a name="1007016">
<h2> S</h2>
</a>
<a name="1007019">
saved games <a href="graal22.htm#999193">15, </a><a href="graal22.htm#1005721">17</a><p>
</a>
<a name="1007020">
scripts<p>
</a>
<a name="1007023">
.ptrn <a href="graal22.htm#999175">13, </a><a href="graal22.htm#999749">57</a><p>
</a>
<a name="1007025">
.room <a href="graal22.htm#999155">12</a><p>
</a>
<a name="1007028">
.scene <a href="graal22.htm#999171">13, </a><a href="graal22.htm#999788">61</a><p>
</a>
<a name="1007031">
.section <a href="graal22.htm#1005618">13, </a><a href="graal22.htm#999446">32</a><p>
</a>
<a name="1007033">
graal.main <a href="graal22.htm#999144">12</a><p>
</a>
<a name="1007035">
line types <a href="graal22.htm#999122">10</a><p>
</a>
<a name="1007037">
stall anims <a href="graal22.htm#1001811">64</a><p>
</a>
<a name="1007039">
statements <a href="graal22.htm#999133">10</a><p>
</a>
<a name="1007041">
still image <a href="graal22.htm#999256">19</a><p>
</a>
<a name="1007043">
string variables <a href="graal22.htm#1003134">39</a><p>
</a>
<a name="1007045">
<h2> T</h2>
</a>
<a name="1007047">
time (in-game) <a href="graal22.htm#1001823">64</a><p>
</a>
<a name="1007049">
timers <a href="graal22.htm#1001799">64</a><p>
</a>
<a name="1007051">
trace <a href="graal22.htm#999899">70</a><p>
</a>
<a name="996744">
<p>
</a>

<p><hr>

<h5>Last Modified: 04:39pm , August 10, 1998</h5>
</body>
</html>
