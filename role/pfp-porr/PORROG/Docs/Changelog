Changelog for Porrog
====================
Remember, kids, a Changelog is for describing changes in code, and isn't
 very worthwhile when only one person is making em.

Will add one when the project takes off.
It should be: changes to existing code should be described.
Routines newly added or removed should be *mentioned*.

V0.06
=====
Added file utils.c, with function u64toa(), which is declared in porrog_defs.h;
 this is to avoid the stupid stuff with printf("%lld") which doesn't seem to
 be very standard, and was probably wrotng anyways.

 -Have I done something about the freebsd issue?

Changed usage of x^y in ctrl.c to pow(x,y) doh...

Added "graphics.c" with functions for asciifying little bitmaps of
 our own format.

Added REPTYPE_FILE flag to crash.h, to deal with errors working with
 external files.

Added "Ticker" element to player_t and monster_t

Changed ctrl_loop to process player+monster movement using the
 new time system.

Changed ctrl_loop to regenerate player HP (not monsters yet) and spawn
 new monsters based on new time system

Changed ctrl_loop to show splash screen when killed.

Added NEW_DOOR compile-time option to config.h, to control use of
 new door code (represents closed state of door as a dummy item)

Changed draw_map() to display PTL_DOOR as PTL_ODOOR if NEW_DOOR set.

Changed build_door() to place a dummy door item in the square of a
 newly built door (which by default is closed) if NEW_DOOR set.

Changed skim_item() to actually describe problems found that cause crashes

Added dungeon.c with functions open_door() and close_door(), as methods
 to manipulate doors. All such operations should now use these (but test
 open/closeability first). Added header file dungeon_p.h for it.
 Also has functions isUncloseable() and isUnopenable() to be called
 before attempting to do close_door() or open_door().

Changed p_open_door(), p_close_door(), and m_open_door() to use the new
 open_door() and close_door() functions, after testing isUnopenable and
 isUncloseable. Appropriate messages are given for the new cases.

Changed add_room_items() to use IG_DUMMY rather than IG_LASTGROUP for
 max group number to pick from (so we don't keep finding closed doors
 floating in the middle of rooms).

Changed remake_doors() to place the dummy door items on closed doors (if
 NEW_DOOR is defined)

Added a leveltype_t enumeration to enums.h, and added an element of
 this type named "Type" to levelmap_t, to determine type of level.

Changed the intro message in main().

Added checkForTile() function to dungeon.c and dungeon_p.h.
Added userSelectDir() function to ui.c and ui.h.
Added FACING_TO_X() and FACING_TO_Y() macros to dungeon_p.h
Changed p_open_door() and p_close_door() further to make use of these
functions to give decent UI to door manipulation, and also to make
functions smaller!

Added isInvletterAvailable() to item.c and item_p.h, and changed
 p_get_item() to use this in determining reuse of inventory letters
 from previously held items.

Moved the "Known" element from typedata structures (specifically in
 the potions typedata) into itemtype_t for cleaner processing;
 changed all functions using Typedata.Potion.Known to reflect this.

Added Probability element top itemtype_t, changed type of the Weight
 element there, and also set Type to use the itemgroup_t enumeration
 as it should have from day 1!!!.
 Added weight and probability arguments to new_itemtype() and push_itype().

Added IG_STAFF to itemgroup_t, added the toolgroup_t enumeration to enums.h
 and added IG_STAFF to apply_main() and push_itype().

Added wandinst_t, and rodinst_t to item_t.h and to item_inst_data_t union,
 replacing the Charges element.
Added scrolldata_t, wanddata_t, staffdata_t, roddata_t, and tooldata_t
 to item_t.h and to item_typedata_t union.

Changed macros in i_item.c (and some function calls) to supply weight +
 probability data; added a DEF_STAFF() macro, added several new tools,
 changed DEF_TOOL to supply tool related data. Changed new_mobtype to
 supply weight+probability data for corpses.

Added it_freqtot[] array to globals.c and item_p.h, and added code to
 i_init() to initialise the itemgroup arrays, which I can't believe I
 hadn't done before!!! push_itype() now increments it_freqtot[] by
 given probability (after checking for overflow!)

Added ITEM_PROBABILITY option to config.h, to control operation of
 add_room_items(); added getItemtypeByProbability() to be used for this.

Added nextItemByGroupThenList() to item.c and item_p.h for use in
 ordering lists for new version of displayHeap() function.
 (Then rewrote this new function because it was badly flawed).
 Added sortInventoryGroup() to same files for use by the above
 function- it gives the ordering semantics whilst nextItemByGroupThenList
 does the grunt work of searching.

Cleaned stale comments out of combinable_item() and renamed it to
 combinableItem() to reflect new naming scheme(+renamed references to it).

*Actually* changed p_hit_m() to call m_die() last, as I *apparently* only
 fixed this bug in m_hit_m() last time. WTF?! I must have been tired.

Started a list of functions in NOTES/FUNCTIONS, to help me remember
 everything and give help to any poor soul that feels like hacking on
 the game (such people should bear in mind that I have my own ideas of
 what I want the game to be like, though!!).

Added syscurses.h to include system-specific CURSES headers, and supply
 appropriate functions for doing colour (PDCurses doesn't seem to have
 color_set() for some reason).

Added satiation_t enumeration to enums.h, and p_eat() and p_tryEat()
 to player.c and player_p.h. New code disabled with NO_EAT define.
 Added SatiationStatus to player_t, to make it easier to note changes in
 satiation status. Added p_incSatiation(), p_decSatiation(), and
 p_setSatiation() to player_p.h and player.c. Will probably have setting
 implemented by decrementing or incrementing according to requirements.
 Added descSatiation() to player.c and player_p.h, to give word for state.
 init_player() now sets SatiationStatus element on startup.

Made a good few changes that I FORGOT to mention in this changelog...

Finally got around to properly removing add_item from item.c, and
 removing (already commented out) references to it.

Adjusted colour initialisation in main.c and helpmain.c having realised
 that we were allocating one more than needed.

Adding getItemByInvletter() ? For use by only one or 2 functions.

Changed "Featureidx" element of maploc_t (in structures.h) from char to
 unsigned char because of compiler warnings (although in this case, the
 potential problem of array subscripts of type char shouldn't occur).
 Similarly changed definition of "byte" in porrog_defs.h to unsigned char,
 but "byte" type appears to be only used in dXrng.c (which is pretty much
 the oldest surviving part of the program...). Not sure if any uses of
 "byte" expect it to be signed, but most (all??) parts use it for an
 array subscript so I think not.

Added helper function sprintempty() that is basically equivalent to
 sprintf(string,""), to cut out compiler warnings (it is presumably
 a lot faster than using sprintf for that, too!!). Defined in utils.c
 and declared in porrog_defs.h

Changed all (now somewhat inexplicable to me) references to colour pair
 *8* in the help code to use colour pair *0* (which is plain old white
 on black). Worried that I may have used 8 for some reason I since
 forgot rather than just a stupid mistake...

For similar purposes to the FUNCTIONS file, I started a CODINGSTYLE file
 in the NOTES directory. It's currently more complete than the former.

Added pcolour_t enumeration to syscurses.h (names colour pairs in a more
 friendly way than the COLOR_CYAN+9 type nonsense that I'd been messing
 about with previously!!). Couldn't put it in enums.h because it HAD to
 have curses.h included previously. At least... HEY! I could have
 implemented that differently in fact!!!
 CORRECTION: Now pcolour_t is in enums.h because I found my brain and
 figured out how to do it right. See:

Added syscurses.c with init_colours() function to set up the colours in
 such a way as to stop the pcolour_t definition from needing curses.h.
 init_colours() is declared in syscurses.h. ALL source files that had
 previously used start_color(), init_pair() etc, now just call init_colours().

Changed elements "Col" and "Colour" of itemtype_t and mobtype_t respectively
 to be of type pcolour_t. Not sure if colour is used for monsters yet (nope!).
 Started(?) changing colour assignments for items to use the new enumerations
 rather than the curses stuff. Changing(?) calls to [w]color_set() to use
 [w]setpcolour()... now new_mobtype() also sets Colour element to PCOL_DWHITE
 rather than leaving it."col" arg of new_itemtype() is now of pcolour_t
 rather than char(!).

push_mtype() now accepts a "col" argument to set monster colour.

Fixed up quaff_main() to print the drinking message that had been sprintfed
 (and previously *ignored*!), and to replace that "Assuming you're not dead"
 nonsense. It also checks if you can be given the bottle before doing so.

Changed end of ctrl_loop() to put graphic screens for saving (not yet
 supported, but working towards it...) and quitting, in addition to the
 previous screen for dying.

Created file save.c whilst *thinking* about how to dump game data to a
 file. Contains no functions yet!!

Created file messages.c with array of string constants for frequent
 usage, declared in porrog_defs.h, with enumerated type commonstring_t
 to access it in enums.h.

Alteread p_init_inv() such that whip appears before gimp suit (so player's
 inventory letters are in order).

Renamed get_itemtype_by_name(), first_unused_invletter(),
 tag_invletter_usage(), free_item(), new_itemtype(), new_item(), skim_item(),
 place_item() to new scheme.

Added stoupper() to utils.c and porrog_defs.h, converts string buffer to
 upper case.

Changed water_potion_effect() and healing_potion_effect() to add some
 satiation when drunk.

Attempted to fix bug in replace_items() (which, due to gnarly code for the
 "endcache" system, would make some items disappear, although they'd
 apparently still be there if you returned again in other circumstances).
 Whether this fix will work or not will obviously show with time ;)

Changed help_load_cts() to accept the '?' key to give help on help (which
 is just another help page).

Created script "boil.pl" to add or change boilerplate (copyright notes etc)
 on files between the comments "START BOILERPLATE" and "--END BOILERPLATE".
 Took time to put these tags in each of the source files, but if I ever
 need to change the boilerplate *again* it should be pretty quick work.
 Added "testboiler.c" (and "testboiler.c.orig") file(s) to test the script.
 (these files do nothing).

Added "ROGUE_TUNNELS" compile-time option to control whether the tunnels
 look like those of Rogue/Nethack, etc or of Adom/*Band etc. Added code
 to calc_los() to take this into account to do so.

Changed add_room_items() to prevent food or coinage from being created
 cursed (which would be pretty stupid, even for Porrog!)


V0.05b
======
Changed p_hit_m() and m_hit_m() to call m_die() *last*, after reports
of bus errors from OSX.
 [ERRATUM: I apparently only changed one of these at this point!]

V0.05
=====
Added colour argument to new_itemtype(); is currently being calculated
 based purely on item group. draw_map() draws in colour, nothing else
 does yet.

new_item() now makes any containers explicitly empty (have found them
 without NULL pointers before, causing segfaults).

Properly worked out format for help files, and implemented parser for
 them. Which soon ended up as the whole browsable help system I'd
 had in mind. AFAICT it's all functional now.

Filled in helpmain.c (it was included in V0.04 but was empty and unused),
 with a main() function to create a secondary executable, porroghelp,
 that gives a supplementary, standalone help browser, for testing help
 pages and things like that. People could use it in their own project or
 something, too.

Tried making combine_items(). Changed p_get_item() and place_item() to
 make use of it... Then realised it was a bad approach. Changed fn to
 combineable_item(), which only checks, and doesn't do any combining.
 NOW NEED TO CHANGE OTHER FUNCTIONS AGAIN!

Changed new_item() to take a quantity count.

Removed calls to add_item(); they should now all use new_item()+ place_item().

Added lots of functions for describing objects in various ways

Added functions for describing tiles and dungeon features.

Added files religion.c and religion_p.h, including functions for describing
 religions.

Added files potions.c and potions.h, including quaff_main(), shuffle_potions()
 and some simple functions to place in potion's function pointers.

Added potionuse_t to enums.h: this type describes what sort of thing a
 potion is being used for. To pass as an argument to potion's function
 pointers.

Changed p_init_inv() to also pick random quantities for certain items of
 initial player inventory (mostly money).

Added Inventend element to player_t structure: is pointer to LAST element
 of inventory list (we still keep the first element too...), so we can
 tag new items onto the end instead, making the inventory look nicer.
 p_get_item() and p_discard_item() use this to place items at the end
 of the inventory (and update it when taking items off the end). This
 behaviour is cancelled if OLDINVENT is set.

Spotted the ringbuffer code was screwed up. Fixed it (?) in show_mrb(), noted
 possibility of it in free_mrb(), and HAVENT DONE it in the buglog stuff.

Added weapondata_t type, which gets filled in with new data in i_init.c

Added attackroll() to combat.c, which produces a random number between
 -100 and +100, but tending to be around 0 much of the time. Needs
 much testing to settle on a good mapping (the extreme cases should only
 occur rarely); now moved this to attackroll.c to ease testing it.

Added aroll_histo.c file as test harness for attackroll(). aroll_histo is
 not normally created by the makefile, but make clean will normally
 delete it (so yeah, I changed the makefile too).

Changed m_hit_m() to work with the new tht, tev, dmg calculations. Doesn't
 deal with equipment yet as monsters don't have any.

Added m_gainexp() to monster.c

Changed ctrl_loop() so monsters can regenerate (but around 1 HP per 20 turns,
 rather than the 1HP per 8 for the player).

V0.04
=====
Changed push_itype() to return a pointer to the itemtype created;
Changed the macros in i_init to use that pointer to fill
 in the item details! First use of this is setting coverage and
 protection values for items of armour, but will add other stuff too.

Changed the functions in memutils to remember what *types* of things
 are being mallocced and freed, so when the numbers at the end are
 wrong, you can zoom in on what's out of kilter. For this I
 had to add enumerated type strgrp_t to the enums.h header.

Now calls free_everything() when exiting ctrl_loop().

Moved the compile-time configuration options from the makefile into
 config.h, giving the advantage that now "make" can see when the
 options have been changed and can remake everything without you
 having to do a "make clean" first.  config.h is now included by
 porrog_defs.h, for simplicity.

Added race.c and race_p.h for calculating global values for stats
 and stuff (based on racial ranges).

player_init() now sets player's stats according to the scheme
 worked out by Jonathan and I on July 9th. Still haven't got
 all stats decided, nor any skills. Added a Training structure
 to player_t.h; there might be one added to monsters too.

Changed show_status() to display stats and armour info, etc.

Changed m_hit_p() to take armour into account (does it properly).
 Still doesn't account for weapons, stats, random damage amounts, etc.
 m_hit_m and p_hit_m remain unchanged.

Added ring buffer code to ui.c (and vars in globals.c). I eventually
 made the ring-buffer display code scrollable, too.

Added similar ring buffer code to crash.c, in functions bugger()
 and dump_buglog(). crash() now calls dump_buglog(), as you need
 the buglogs most when the game crashes!!

Debug messages in ai.c that were formerly displayed through show_messages()
 and controlled by compile-time options, are now logged with bugger().

Added find_door(region,x,y) to mapgen.c; returns entrance_t of door found
 at coords. If it can't find it, it complains, tries again but harder.
 If it fails again it crash()es, as it's a bug.

Added an "Open" element to the entrance_t structure, to allow door status
 to be persistent over level changes; build_door() always sets this to 0;
 remake_door() uses it to decide what tile-type to place (PTL_DOOR or PTL_ODOOR)
 ;p_open_door() and p_close_door() use find_door() to get the entrance_t
 structure to update, and update it. m_open_door() does likewise.

Changed the 'r' command to not try to call find_room() when in a tunnel.
 Of course, this command is losing relevance, and some time 'r' will be "read".

Added get_itemtype_by_name function to item.c, for use in setting up initial
 player inventory, etc. Also added new_item function, that does half of
 what add_item does; add_item now calls new_item.

Added a preliminary isinclass() function to item.c for classifying itemtypes.
 An item type can be in numerous different item classes.

Put container helper-functions in apply.c, to allow more user friendly
 container manipulation function to be put in ui.c that doesn't have to
 do much container processing itself.

And I went and did that (moved the higher-level part of apply_container()
 to ui.c). Except it still uses show_messages in places where it really
 shouldn't: the key options should be displayed in a little pop-up window
 or something like that.

Added free_item() to item.c; it frees any contents a container might
 have before freeing the item.

ARG! I'd forgotten that I'd made the map display taller, and this was
 causing the player to sometimes reach places where the display would
 run over the edge of the map (causing a crash). It USED to be lines 1
 to 22; now it's lines 0 to 23. So, the possible coords for the top-left
 corner of the screen should now be 2 units further north than it used
 to be. The points the scrolling centres around should be different
 too... but I'm not sure what exactly?

Changed the test parameters of the for loops in mkmap_p1(), after I
 realised they weren't covering the whole map properly.

Changed the main directory name policy to include the version number
 (so new versions don't end up going in the same directory as old
 ones any more).

V0.03
=====
Trimmed out a couple of spurious files, added a few more that may
 be merged into others. Same old same old.

V0.02
=====
(nearly) All globals moved into globals.c

Several header files split into typedefs and prototypes, some further
 split into "public" prototypes and prototypes of helper functions
 used by higher level functions such as make_map().


