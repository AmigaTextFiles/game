# MakeFile for QuakeTools

CC=@CC@
LD=@LD@
AS=@AS@
AR=@AR@
RAN=@RANLIB@

WARN = -Wall -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations
OPTI = -fpeephole -fno-float-store -ffunction-cse -ffast-math -fstrength-reduce \
       -frerun-cse-after-loop -fschedule-insns -fschedule-insns2 -freg-struct-return \
       -fforce-addr \
       -fmove-all-movables -freduce-all-givs -frerun-loop-opt	# egcs
#       -fsyntax-only -ansi
DEFS = @DEFS@ -DPARENTDIR="../" -DCURRENTDIR="./"
INCL = -I. -I@top_srcdir@/src/include -I@includedir@
LIBL = -L. -L@top_srcdir@/lib #-L@libdir@

# highly optimized flags
CFLAGS =@CFLAGS@ -O3 $(WARN) $(OPTI) $(DEFS) $(INCL) $(EXTRAOPTS) -fomit-frame-pointer
LDFLAGS=@LDFLAGS@ -O3 $(WARN) $(OPTI) $(DEFS) $(LIBL) $(EXTRAOPTS) -fomit-frame-pointer -s
ASFLAGS=

#profileflags
CPFLAGS =@CFLAGS@ $(WARN) $(DEFS) $(INCL) -DNOASM -DDEBUG_C -DPROFILE -DVERBOSE		# -pg
LDPFLAGS=@LDFLAGS@ $(WARN) $(DEFS) $(LIBL) -DNOASM -DDEBUG_C -DPROFILE -DVERBOSE	# -pg
ASPFLAGS=
#gcovflags
CVFLAGS =$(CFLAGS) -DPROFILE -ftest-coverage -fprofile-arcs
LDVFLAGS=$(LDFLAGS) -DPROFILE -ftest-coverage -fprofile-arcs
ASVFLAGS=$(ASFLAGS)
CBFLAGS =$(CFLAGS) -DPROFILE -fbranch-probabilities
LDBFLAGS=$(LDFLAGS) -DPROFILE -fbranch-probabilities
ASBFLAGS=$(ASFLAGS)

# common rules
.PHONY:  default profile coverage branch all utils install ansi test \
	clean cleanprofile cleancoverage cleanall distclean backup restore

.SUFFIXES:
.SUFFIXES: .c .o _4.o _6.o _p.o _b.o _v.o .S

# try assembler first
%.o %_4.o %_6.o: %.S
	$(CC) $(ASFLAGS) -c $< -o $@
# if no assembler try direct from C
%_p.o: %.S
	$(CC) $(ASPFLAGS) -c $< -o $@
# if no assembler try direct from C
%_v.o: %.S
	$(CC) $(ASVFLAGS) -c $< -o $@
# if no assembler try direct from C
%_b.o: %.S
	$(CC) $(ASBFLAGS) -c $< -o $@
# if no assembler try direct from C
%.o %_4.o %_6.o: %.c
	$(CC) $(CFLAGS) -c $< -o $@
# if no assembler try direct from C
%_p.o: %.c
	$(CC) $(CPFLAGS) -c $< -o $@
# if no assembler try direct from C
%_v.o: %.c
	$(CC) $(CVFLAGS) -c $< -o $@
# if no assembler try direct from C
%_b.o: %.c
	$(CC) $(CBFLAGS) -c $< -o $@
# this is only for manual use
%.S: %.c
	$(CC) $(CFLAGS) -fverbose-asm -S $< -o $@

# if no assembler try direct from C
%_proto: %.c
	@GPROTO@ -f"extern %R %N%P;\n" -sN -o$@ $<
%.cstrings: %.c
	@CSTRINGS@ -c <$< >$@
%.hstrings: %.h
	@CSTRINGS@ -c <$< >$@
