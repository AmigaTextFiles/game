; patch data files

echo "Checking installed files..."

unset pak0len
unset pak1len
unset oldpak0len
unset newpak0len
unset oldpak1len
unset newpak1len

set oldpak0len 21714275
set newpak0len 22704056

set oldpak1len 76958474
set newpak1len 75601170

list data1/pak0.pak lformat "%l" >env:pak0len
list data1/pak1.pak lformat "%l" >env:pak1len


if val "$pak0len" eq "$oldpak0len"
 echo "Updating data1/pak0.pak..."
 xdelta patch patchdata/data1/pak0.pak.103_111 data1/pak0.pak
 echo "Validating..."
 list pak0.pak lformat "%l" > env:pak0len
 if val "$pak0len" eq "$newpak0len"
   echo "OK"
   delete >nil: data1/pak0.pak
   copy pak0.pak data1/ MOVE QUIET
 else
   echo "Failed."
 endif
else
 echo "data1/pak0.pak is already updated"
endif

if val "$pak1len" eq "$oldpak1len"
 echo "Updating data1/pak1.pak..."
 xdelta patch patchdata/data1/pak1.pak.103_111 data1/pak1.pak
 echo "Validating..."
 list pak1.pak lformat "%l" > env:pak1len
 if val "$pak1len" eq "$newpak1len"
   echo "OK"
   delete >nil: data1/pak1.pak
   copy pak1.pak data1/ MOVE QUIET
 else
   echo "Failed."
 endif
else
 echo "data1/pak1.pak is already updated"
endif


unset pak0len
unset pak1len
unset oldpak0len
unset newpak0len
unset oldpak1len
unset newpak1len

