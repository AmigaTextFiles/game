// 1. INCLUDES -----------------------------------------------------------

#ifdef __amigaos4__
    #ifndef __USE_INLINE__
        #define __USE_INLINE__ // define this as early as possible
    #endif
#endif
#ifdef __LCLINT__
    typedef char* STRPTR;
    typedef char* CONST_STRPTR;
    typedef char  TEXT;
    #define ASM
    #define REG(x)
    #define __inline
#endif

#include <exec/types.h>
#include <exec/memory.h>
#include <dos/dos.h>
#include <intuition/intuition.h>
#define ALL_REACTION_CLASSES
#define ALL_REACTION_MACROS
#include <reaction/reaction.h>
#ifndef __MORPHOS__
    #include <gadgets/clock.h>
#endif

#include <proto/dos.h>
#include <proto/exec.h>
#include <proto/graphics.h>
#include <proto/intuition.h>
#include <clib/alib_protos.h>

#include <ctype.h>
#include <stdio.h>                           /* FILE, printf() */
#include <stdlib.h>                          /* EXIT_SUCCESS, EXIT_FAILURE */
#include <string.h>
#include <assert.h>

#ifdef LATTICE
    #include <dos.h>                         // geta4()
#endif

#include "mce.h"

/* 2. DEFINES ------------------------------------------------------------ */

// main window
#define GID_DW_LY1   0 /* root layout */
#define GID_DW_SB1   1
#define GID_DW_IN1   2
#define GID_DW_IN2   3
#define GID_DW_IN3   4
#define GID_DW_IN4   5
#define GID_DW_IN5   6
#define GID_DW_IN6   7
#define GID_DW_IN7   8
#define GID_DW_IN8   9
#define GID_DW_IN9  10
#define GID_DW_IN10 11
#define GID_DW_IN11 12
#define GID_DW_IN20 13
#define GID_DW_IN21 14
#define GID_DW_IN22 15
#define GID_DW_IN23 16 // region
#define GID_DW_IN24 17 // hour
#define GID_DW_IN25 18 // minute
#define GID_DW_IN26 19 // X-loc
#define GID_DW_IN27 20 // Y-loc
#define GID_DW_IN28 21 // day
#define GID_DW_CH1  22
#define GID_DW_CH2  23
#define GID_DW_CH3  24
#define GID_DW_ST1  25
#define GID_DW_BU1  26
#define GID_DW_BU2  27
#define GID_DW_BU3  28
#define GID_DW_BU4  29
#define GID_DW_BU5  30
#define GID_DW_BU6  31
#define GID_DW_BU7  32
#define GID_DW_BU8  33
#define GID_DW_BU9  34
#define GID_DW_BU10 35
#define GID_DW_BU11 36
#define GID_DW_BU12 37
#define GID_DW_BU13 38
#define GID_DW_BU14 39
#define GID_DW_BU15 40 // maximize party
#define GID_DW_LB2  41
#define GID_DW_LB6  42 // month
#define GID_DW_CL1  43 // clock
#define GID_DW_SP1  44 // map
#define GID_DW_ST2  45 // contents

// items subwindow
#define GID_DW_LY2  46
#define GID_DW_LB1  47
#define GID_DW_LB3  48
#define GID_DW_LB4  49
#define GID_DW_LB5  50
#define GID_DW_CB1  51
#define GID_DW_CB2  52
#define GID_DW_IN14 53
#define GID_DW_IN15 54
#define GID_DW_IN16 55
#define GID_DW_IN17 56
#define GID_DW_IN18 57
#define GID_DW_IN19 58
#define GID_DW_CH4  59
#define GID_DW_CH5  60
#define GID_DW_CH6  61
#define GID_DW_RA1  62

#define GIDS_DW     GID_DW_RA1

#define ItemButton(x) LAYOUT_AddChild, gadgets[GID_DW_BU1 + x] = (struct Gadget*) ZButtonObject, GA_ID, GID_DW_BU1 + x, GA_RelVerify, TRUE, BUTTON_Justification, LCJ_LEFT, ButtonEnd

#define KIND_BREAKABLE    0
#define KIND_USESPERDAY   1

#define MONTHS           23 // 0..22

#define MAPWIDTH         64
#define MAPHEIGHT        64
#define MAPSCALE          3
#define SCALEDWIDTH     (MAPWIDTH  * MAPSCALE)
#define SCALEDHEIGHT    (MAPHEIGHT * MAPSCALE)

// 3. MODULE FUNCTIONS ---------------------------------------------------

MODULE void readgadgets(void);
MODULE void writegadgets(UBYTE mode);
MODULE void serialize(void);
MODULE void itemwindow(void);
MODULE void enable(ULONG state, ULONG whichin);
MODULE void maximize_man(int whichman);
MODULE void drawpoint(int x, int y, int colour);
MODULE void dw_leftorup(UWORD qual, int* location);
MODULE void dw_rightordown(UWORD qual, int* location);

/* 4. EXPORTED VARIABLES -------------------------------------------------

(none)

5. IMPORTED VARIABLES ------------------------------------------------- */

IMPORT int                  function,
                            loaded,
                            page,
                            serializemode;
IMPORT TEXT                 pathname[MAX_PATH + 1];
IMPORT LONG                 pens[PENS];
IMPORT ULONG                offset,
                            showtoolbar;
IMPORT UBYTE                IOBuffer[IOBUFFERSIZE];
IMPORT struct IBox          winbox[FUNCTIONS + 1];
IMPORT struct List          SpeedBarList;
IMPORT struct Hook          ToolHookStruct,
                            ToolSubHookStruct;
IMPORT struct Menu*         MenuPtr;
IMPORT struct Screen       *CustomScreenPtr,
                           *ScreenPtr;
IMPORT struct DiskObject*   IconifiedIcon;
IMPORT struct Library*      TickBoxBase;
IMPORT struct MsgPtr*       AppPort;
IMPORT struct HintInfo*     HintInfoPtr;
IMPORT struct Gadget*       gadgets[GIDS_MAX + 1];
IMPORT struct DrawInfo*     DrawInfoPtr;
IMPORT struct Image        *aissimage[AISSIMAGES],
                           *image[BITMAPS];
IMPORT struct Window       *MainWindowPtr,
                           *SubWindowPtr;
IMPORT Object              *WinObject,
                           *SubWinObject;
IMPORT struct RastPort      wpa8rastport[2];
IMPORT UBYTE*               byteptr1[MAXHEIGHT];
IMPORT __aligned UBYTE      display1[GFXINIT(MAXWIDTH, MAXHEIGHT)];
#ifndef __MORPHOS__
    IMPORT struct ClassLibrary* ClockBase;
    IMPORT Class*               ClockClass;
    IMPORT UWORD*               MouseData;
#endif

// function pointers
IMPORT FLAG (* tool_open)      (FLAG loadas);
IMPORT void (* tool_save)      (FLAG saveas);
IMPORT void (* tool_close)     (void);
IMPORT void (* tool_loop)      (ULONG gid, ULONG code);
IMPORT void (* tool_exit)      (void);
IMPORT FLAG (* tool_subgadget) (ULONG gid, UWORD code);

// 6. MODULE VARIABLES ---------------------------------------------------

MODULE ULONG                food,
                            gold,
                            men,
                            who, // current page
                            month,
                            day,
                            hour,
                            minute,
                            loc_x,
                            loc_y,
                            region;
MODULE struct List          InvokedPowersList[3],
                            ItemsList,
                            MonthList,
                            SkillsList;
MODULE int                  whichitem;

MODULE const STRPTR CharacterOptions[5 + 1] =
{ "1",
  "2",
  "3",
  "4",
  "5",
  NULL
}, RaceOptions[5 + 1] =
{ "Human",
  "Elf",
  "Dwarf",
  "Dark Elf",
  "Troll",
  NULL
}, ClassOptions[10 + 1] =
{ "Barbarian",
  "Cleric",
  "Monk",
  "Paladin",
  "Ranger",
  "Scholar",
  "Sorcerer",
  "Thief",
  "Visionary",
  "Wizard",
  NULL
}, SkillOptions[31] =
{ "Armoured skin",
  "Axe",
  "Berserking",
  "Detect traps",
  "Disarm traps",
  "Fencing",
  "Fire runes",
  "Hunting",
  "Ice runes",
  "Illusion",
  "Item lore",
  "Karate",
  "Kung fu",
  "Mace",
  "Metal runes",
  "Monster lore",
  "Persuasiveness",
  "Possession",
  "Potion lore",
  "Priesthood",
  "Shaman",
  "Spirit runes",
  "Summoning",
  "Sword",
  "Tactics",
  "View items",
  "View land",
  "View mind",
  "View room",
  "Weapon lore",
  "Wind runes"
// no NULL is required
}, ItemOptions[31] =
{ "Nothing",
  "2-handed sword",
  "Amulet",
  "Battle axe",
  "Broad sword",
  "Chain",           //  5
  "Cloth",
  "Crown",
  "Dagger",
  "Demon Crystal",
  "Figurine",        // 10
  "Gem",
  "Lantern",
  "Leather",
  "Mace",
  "Medallion",       // 15
  "Morning star",
  "Orb of Evertime",
  "Ring",
  "Plate",
  "Rod",             // 20
  "Salve",
  "Scale",
  "Short sword",
  "Small axe",
  "Staff",           // 25
  "Talisman",
  "Torch",
  "Vial #1",
  "Vial #2",
  "Wand"             // 30
// no NULL is required
}, QualityOptions[8 + 1] =
{ "Normal",
  "Crystal",
  "Gold",
  "Jade",
  "Jewel encrusted",
  "Platinum",
  "Silver",
  "Well made",
  NULL
}, KindOptions[2 + 1] =
{ "Breakability:",
  "Uses per day:",
  NULL
}, ConstantPowerOptions[10 + 1] =
{ "None",
  "Armoured skin",
  "Berserking",
  "Detect traps",
  "God runes",
  "Hunting",
  "Monster lore",
  "Persuasiveness",
  "Tactics",
  "View mind",
  NULL
}, InvokedPowerOptions[43] =
{ "None",            //  0
  "Armour",
  "Break Bonds",
  "Breath of Life",
  "Chains",
  "Chill",           //  5
  "Clumsiness",
  "Crystalight",
  "Cure Poison",
  "Death Blade",
  "Et Cetera",       // 10
  "Fire Storm",
  "Flame Shield",
  "Flame Strike",
  "Freeze",
  "Freedom",         // 15
  "Hail Storm",
  "Heal",
  "Ice Shield",
  "Illusion",
  "Magic Torch",     // 20
  "Melt",
  "Poison",
  "Possession",
  "Power Leech",
  "Resurrect",       // 25
  "Rust Armour",
  "Sanctuary",
  "Slow",
  "Spirit Wrack",
  "Still Air",       // 30
  "Strength",
  "Summon",
  "Sword",
  "Tempest",
  "The End",         // 35
  "Transferrence",
  "Weaken",
  "Wings",
  "Wings of Victory",
  "Wither Strike",   // 40
  "Wind Walk",       // 41
  "Youth"            // 42
}, MonthOptions[MONTHS] =
{ "Ruby",            //  0
  "Ebony",           //  1
  "Gold",            //  2
  "Comet",           //  3
  "Spirit",          //  4
  "Dragon",          //  5
  "Rose",            //  6
  "Sword",           //  7
  "Unicorn",         //  8
  "Metal",           //  9
  "Lotus",           // 10
  "Axe",             // 11
  "Panther",         // 12
  "Ice",             // 13
  "Mandrake",        // 14
  "Aurora",          // 15
  "Onyx",            // 16
  "Phoenix",         // 17
  "Wind",            // 18
  "Jade",            // 19
  "Fire",            // 20
  "Hyacinth",        // 21
  "Coyote"           // 22
// no NULL is required
};

#ifndef __MORPHOS__
MODULE const UWORD CHIP LocalMouseData[4 + (13 * 2)] =
{   0x0000, 0x0000, // reserved

/*  .RR. .... .... ....    . = Transparent (%00)
    .R.R .... .... ....    R = Red         (%01)
    .R.. R.R. R.RR ....    K = Black       (%10) (unused)
    ..R. RR.R .R.. R...    B = Bone        (%11) (unused)
    ..R. .R.. .... R...
    ...R .R.. .... .R..
    RR.R .... .... .R..
    R.RR .... .... .R..
    .R.. .... .... .R..
    ..R. .... .... R...
    ...R RR.. .... R...
    .... ..R. ...R ....
    .... ...R RRR. ....

    Plane 0 Plane 1 */
    0x6000, 0x0000,
    0x5000, 0x0000,
    0x4AB0, 0x0000,
    0x2D48, 0x0000,
    0x2408, 0x0000,
    0x1404, 0x0000,
    0xD004, 0x0000,
    0xB004, 0x0000,
    0x4004, 0x0000,
    0x2008, 0x0000,
    0x1C08, 0x0000,
    0x0210, 0x0000,
    0x01E0, 0x0000,

    0x0000, 0x0000  // reserved
};
#endif

MODULE TEXT dw_map[][MAPHEIGHT][MAPWIDTH + 1] = {
{ /* water regions
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"................................................................", //  0
"................................................................", //  1
"................................................................", //  2
"................................................................", //  3
"................................................................", //  4
"................................................................", //  5
"................................................................", //  6
"................................................................", //  7
"................................................................", //  8
"................................................................", //  9
"................................................................", // 10
"................................................................", // 11
"................................................................", // 12
"................................................................", // 13
"................................................................", // 14
"................................................................", // 15
"................................................................", // 16
"................................................................", // 17
"................................................................", // 18
"................................................................", // 19
"................................................................", // 20
"................................................................", // 21
"................................................................", // 22
"................................................................", // 23
"................................................................", // 24
"................................................................", // 25
"................................................................", // 26
"................................................................", // 27
"................................................................", // 28
"................................................................", // 29
"................................................................", // 30
"................................................................", // 31
"................................................................", // 32
"................................................................", // 33
"................................................................", // 34
"................................................................", // 35
"................................................................", // 36
"................................................................", // 37
"................................................................", // 38
"................................................................", // 39
"................................................................", // 40
"................................................................", // 41
"................................................................", // 42
"................................................................", // 43
"................................................................", // 44
"................................................................", // 45
"................................................................", // 46
"................................................................", // 47
"................................................................", // 48
"................................................................", // 49
"................................................................", // 50
"................................................................", // 51
"................................................................", // 52
"................................................................", // 53
"................................................................", // 54
"................................................................", // 55
"................................................................", // 56
"................................................................", // 57
"................................................................", // 58
"................................................................", // 59
"................................................................", // 60
"................................................................", // 61
"................................................................", // 62
"................................................................", // 63
}, { /* unknown regions
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", //  0
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", //  1
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", //  2
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", //  3
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", //  4
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", //  5
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", //  6
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", //  7
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", //  8
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", //  9
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 10
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 11
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 12
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 13
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 14
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 15
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 16
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 17
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 18
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 19
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 20
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 21
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 22
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 23
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 24
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 25
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 26
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 27
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 28
"+++++++++++++++++++++++++++++++???++++++++++++++++++++++++++++++", // 29
"++++++++++++++++++++++++++++++?+++?+++++++++++++++++++++++++++++", // 30
"++++++++++++++++++++++++++++++++++?+++++++++++++++++++++++++++++", // 31
"++++++++++++++++++++++++++++++++??++++++++++++++++++++++++++++++", // 32
"++++++++++++++++++++++++++++++++?+++++++++++++++++++++++++++++++", // 33
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 34
"++++++++++++++++++++++++++++++++?+++++++++++++++++++++++++++++++", // 35
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 36
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 37
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 38
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 39
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 40
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 41
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 42
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 43
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 44
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 45
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 46
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 47
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 48
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 49
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 50
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 51
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 52
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 53
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 54
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 55
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 56
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 57
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 58
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 59
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 60
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 61
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 62
"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++", // 63
}, { /* region 12
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"................................................................", //  0
"................................................................", //  1
"................................................................", //  2
"................................................................", //  3
"................................................................", //  4
"................................................................", //  5
"................................................................", //  6
"................................................................", //  7
"................................................................", //  8
"................................................................", //  9
"................................................................", // 10
"................................................................", // 11
"................................................................", // 12
"................................................................", // 13
"................................................................", // 14
".....................................############.......########", // 15
"....................................############################", // 16
".................###############################################", // 17
"................################################################", // 18
"...............#################################################", // 19
"..............##################################################", // 20
"...............#################################################", // 21
"................################################################", // 22
".................###############################################", // 23
".................###############################################", // 24
".................#########---###################################", // 25
".................#########-*---#################################", // 26
".................#########------################################", // 27
".................#############--################################", // 28
".................#############--################################", // 29
"..................############--################################", // 30
"..................############---###############################", // 31
"..................############------------------################", // 32
"..................#############-----------------################", // 33
".................#############################--################", // 34
".................#############################--################", // 35
".................#############################--################", // 36
".................#############################--################", // 37
".................#############################--################", // 38
"................##############################--################", // 39
"...............###############################---###############", // 40
"...............###############################-----------------#", // 41
"...............################################-----------------", // 42
"...............##############################################---", // 43
"................##############################################--", // 44
"................##############################################--", // 45
"................##############################################--", // 46
"..............################################################--", // 47
".............#################################################--", // 48
".............#################################################--", // 49
".............###################################################", // 50
".............###################################################", // 51
".............###################################################", // 52
".............###################################################", // 53
"............###################################################-", // 54
"...........###################################################--", // 55
"...........###################################################--", // 56
"...........#####################################################", // 57
"...........#####################################################", // 58
"...........#####################################################", // 59
"..........######################################################", // 60
"..........######################################################", // 61
"..........######################################################", // 62
"..........######################################################", // 63
}, { /* region 13
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"...........#####################################################", //  0
"...........#####################################################", //  1
"...........#####################################################", //  2
"...........#####################################################", //  3
"..........######################################################", //  4
"..........######################################################", //  5
"..........######################################################", //  6
"..........######################################################", //  7
"..........######################################################", //  8
".........#######################################################", //  9
"........########################################################", // 10
"........########################################################", // 11
"........########################################################", // 12
"........########################################################", // 13
"........########################################################", // 14
"........########################################################", // 15
".......#########################################################", // 16
".......#########################################################", // 17
".......#########################################################", // 18
"........########################################################", // 19
"........########################################################", // 20
"........########################################################", // 21
"........########################################################", // 22
"........########################################################", // 23
"........########################################################", // 24
"........########################################################", // 25
"........########################################################", // 26
".........#######################################################", // 27
".........#######################################################", // 28
"..........######################################################", // 29
"..........######################################################", // 30
".........#######################################################", // 31
".........#######################################################", // 32
".........#######################################################", // 33
".........#######################################################", // 34
".........#######################################################", // 35
".........#######################################################", // 36
"..........######################################################", // 37
"...........#####################################################", // 38
"............#####################...............################", // 39
"............################........................############", // 40
"............################..........................##########", // 41
"............###############............................#########", // 42
"............#############.............#####.............########", // 43
"............#############............##*####............########", // 44
"............#############...........#########...........########", // 45
"............##############..........########...........#########", // 46
"............###############..........####.............##########", // 47
".............##############........................#############", // 48
".............################.....................##############", // 49
"..............################...................###############", // 50
"...............###############....................##############", // 51
"................##############..........#*##......##############", // 52
"...................##########################......#############", // 53
".......................######################.......############", // 54
"..............................##############...........#########", // 55
"................................................................", // 56
"................................................................", // 57
"................................................................", // 58
"................................................................", // 59
"................................................................", // 60
"................................................................", // 61
"................................................................", // 62
"................................................................", // 63
}, { /* region 21
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"................................................................", //  0
"................................................................", //  1
"................................................................", //  2
"................................................................", //  3
"................................................................", //  4
"................................................................", //  5
"...............&&&&&............................^^^.............", //  6
"...............&&&&&...........................^^^^^............", //  7
"............&&&&*&&&...........................^^*^^............", //  8
"...........&&&&&&&&............................^^&&^............", //  9
"...........&&&&&&&&.....&&.....................^&&&&............", // 10
"..........&&&&&&&&.....&&&....................&&&&&&............", // 11
".........&&&&&&&.......&&....................&&&&&&&............", // 12
".........&&&&&&&.............................&&&&&&.............", // 13
".........&&&&...............................&&&&&&&.............", // 14
".........&&.................................&&&&&&&.............", // 15
".........&..................................&&&&&&&&............", // 16
"............................................&&&&&&&&............", // 17
"............................................&&&&&&&&............", // 18
"............................................&&&&&&&&............", // 19
"............................................&&&&&&&&............", // 20
"..........................................&&&&&&&&&&............", // 21
"..............&&&&&&&.....................&&&&&&&&&&............", // 22
".............&&&&&.&&.....................&&&&&&&&&&&...........", // 23
".............&&&&..&&.....................&&&&&&&&&&&...........", // 24
".............&&&...&&......................&&&&&&&&&&...........", // 25
"...........&&&&&..&&&......................&&&&&&&&&&...........", // 26
"..........&&&&&...&&&......................&&&&&&&&&&...........", // 27
"..........&&&&...&&&......................&&&&&&&&&&............", // 28
"..........&&&...&&&.......................&&&&&&&&&&............", // 29
"..........&&&.*&&&&.......................&&&&&&&&&&............", // 30
"..........&&&&&&&&.......................&&&&&&&&&&&............", // 31
".........&&&&&&&&........................&&&&&&&&&&&............", // 32
".........&&&&&&&&........................&&&&&&&&&&&............", // 33
".........&&&&&&&........................&&&&&&&&&&&.............", // 34
".........&&&&&&&........................&&&&&&&&&&&.............", // 35
".........&&&&&&........................&&&&&&&&&&&&.............", // 36
"..........&&&.........................&&&&&&&&&&&&&.............", // 37
"......................................&&&&&&&&&&&&..............", // 38
".....................................&&&&&&&&&&&&&..............", // 39
".....................................&&&&&&&&&&&&&..............", // 40
"....................................&&&&&&&&&&&&&&..............", // 41
"....................................&&&&&&&&&&&&&&..............", // 42
"....................................&&&&&&&&&&&&&&&.............", // 43
"....................................&&&&&&&&&&&.&&&&............", // 44
".....................................&&&&&&&&&..&&&&............", // 45
"....................................&&&&&&&&&&..&&&&............", // 46
"....................................&&&&&&&&&....&&&&...........", // 47
"....................................&&&&&&&&&....&&&&&..........", // 48
"....................................&&&&&&&&.....&&&&&..........", // 49
"....................................&&&&&&&......&&&&&..........", // 50
"....................................&&&&&&&.......&&&&..........", // 51
".....................................&&&&&........&&&&..........", // 52
".....................................&&&&..........&&&..........", // 53
".....................................&&&&..........&&&..........", // 54
".....................................&&&&..........&&&..........", // 55
"......................................&&&..........&&&..........", // 56
"......................................&&...........&&&..........", // 57
".......................................&...........&&&..........", // 58
"...................................................&&...........", // 59
"................................................................", // 60
"................................................................", // 61
"................................................................", // 62
"................................................................", // 63
}, { /* region 22
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
".....................................&&&&..........&&&..........", //  0
"......................................&&&..........&&&..........", //  1
"......................................&&...........&&&..........", //  2
".......................................&...........&&&..........", //  3
"...................................................&&...........", //  4
"................................................................", //  5
"................................................................", //  6
"................................................................", //  7
"................................................................", //  8
"................................................................", //  9
"................................................................", // 10
"...................................##############*..............", // 11
"............................#######################.............", // 12
"......................############################..............", // 13
"..............###############################...................", // 14
"############################################....................", // 15
"########################################........................", // 16
"########################################........................", // 17
"######################################..........................", // 18
"#####################################...........................", // 19
"#####################################...........................", // 20
"#####################################...........................", // 21
"#####################################...........................", // 22
"#####################################...........................", // 23
"#####################################...........................", // 24
"#####################################...........................", // 25
"#####################################...........................", // 26
"####################################............................", // 27
"###################################.............................", // 28
"###################################.............................", // 29
"###################################.............................", // 30
"###################################.............................", // 31
"###################################.............................", // 32
"###################################.............................", // 33
"######################################..........................", // 34
"#######################################.........................", // 35
"#######################################.........................", // 36
"#######################################.........................", // 37
"#######################################.........................", // 38
"#######################################.........................", // 39
"#######################################.........................", // 40
"-------################################..##.....................", // 41
"--------##################################......................", // 42
"#####---#################################.......................", // 43
"######--#################################.......................", // 44
"######--#################################.......................", // 45
"######--#################################.......................", // 46
"######----################################......................", // 47
"######----################################......................", // 48
"########--################################......................", // 49
"########--################################......................", // 50
"########--################################......................", // 51
"########--################################......................", // 52
"########--################################......................", // 53
"#######---################################......................", // 54
"######--*-################################......................", // 55
"######---################################.......................", // 56
"########################################........................", // 57
"######################################..........................", // 58
"######################################..........................", // 59
"######################################..........................", // 60
"######################################..........................", // 61
"######################################..........................", // 62
"######################################..........................", // 63
}, { /* region 23
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"#########################################.......................", //  0
"########################################........................", //  1
"######################################..........................", //  2
"######################################..........................", //  3
"######################################..........................", //  4
"######################################..........................", //  5
"######################################..........................", //  6
"######################################..........................", //  7
"######################################..........................", //  8
"######################################..........................", //  9
"#####################################...........................", // 10
"####################################............................", // 11
"####################################............................", // 12
"####################################............................", // 13
"####################################............................", // 14
"####################################............................", // 15
"###################################.............................", // 16
"###################################.............................", // 17
"###################################.............................", // 18
"###################################.............................", // 19
"###################################.............................", // 20
"###################################.............................", // 21
"##################################..............................", // 22
"##################################..............................", // 23
"#################################...............................", // 24
"################################.........----...................", // 25
"################################.........------------...........", // 26
"################################.........------------...........", // 27
"################################..........-----------...........", // 28
"################################..........-------------.........", // 29
"###############################..............----------.........", // 30
"###############################.................-------.........", // 31
"###############################...........----.....----.........", // 32
"################################..........-------..---..........", // 33
"################################..........--*----..---..........", // 34
"################################..........-----..---............", // 35
"################################..........-----..---............", // 36
"###############################...........-----..---............", // 37
"###############################.................................", // 38
"###############################.................................", // 39
"##############################..................................", // 40
"#############################......................##...........", // 41
"#############################.....................####..........", // 42
"#############################.................#########.........", // 43
"#############################.............#########*####........", // 44
"############################.............###############........", // 45
"##########################..............################........", // 46
"##########################.............#################........", // 47
"##########################............##################........", // 48
"##########################............##################........", // 49
"##########################............##################........", // 50
"##########################.............#################........", // 51
"#########################...............###############.........", // 52
"#####################*##......................#######...........", // 53
"#######################.........................................", // 54
"................................................................", // 55
"................................................................", // 56
"................................................................", // 57
"................................................................", // 58
"................................................................", // 59
"................................................................", // 60
"................................................................", // 61
"................................................................", // 62
"................................................................", // 63
}, { /* region 25
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"................................................................", //  0
"................................................................", //  1
"................................................................", //  2
"................................................................", //  3
"................................................................", //  4
"................................................................", //  5
"................................................................", //  6
"................................................................", //  7
"................................................................", //  8
".........................................!!!!...................", //  9
"........................................!!!!!!..!!!!............", // 10
".........................................!!!!!...!!!!!..........", // 11
"..................................!!!!.....!!!...!!!!!..........", // 12
"..............................!!!!!!!!!..........!!!!...........", // 13
"................................!!!..!!!........!!!!!...........", // 14
"................................................!!!.............", // 15
"................................................!!!.............", // 16
"...................!!!!!!!!!!!!.........!!!......!..............", // 17
"................!!!!!!!!!!!!!!!!!.......!!!......!..............", // 18
"................!!!!!!!!!!!!!!!!!!..............................", // 19
"...............!!!!!!!!!!!!!!!!!!!..............................", // 20
"..............!!!!!!!!!!!!!!!!!!!!..............................", // 21
".............!!!!!!!!!!!!!!!!!!!!!!.............................", // 22
".............!!!!!!!!!!!!!!!!!!!!!!.............................", // 23
".............!!!!!!!!!!!!!!!!!!!!!!.............................", // 24
"............!!!!!!!!!!!!!!!!!!!!!!!.............................", // 25
"............!!!!!!!!!!!!!!!!!!!!!!!!............................", // 26
"...........!!!!!!!!!!!!!!!!!!!!!!!!!............................", // 27
"...........!!!!!!!!!!!!!!!!!!!!!!!!!............................", // 28
"...........!!!!!!!!!!!!^^^^!!!!!!!!!............................", // 29
"...........!!!!!!^^^^^^^^^^^^!!!!!!!.......................###..", // 30
"...........!!!!^^^^^^^^^^^^^^^^^!!!!.......................#####", // 31
"...........!!!^^^^^^^----^^^^^^^^!!!!......................#####", // 32
"..........!!!!!!!-*--------^^^^^^^!!!......................#####", // 33
"..........!!!!!!-------------^^^^^^^!.......................####", // 34
"..........!!!!!-----------------^^^^^^^^....^^^^^............###", // 35
"..........!!!!^--------------------^^^^^^^^^^^^^^^^^.........###", // 36
".........!!!!^^^^---------------------^^^^^^^^^^^^^^^........###", // 37
".........!!!!^^^^^^^^-----------------^^^^^^----^^^^^.........##", // 38
".........!!!!!^^^^^^^^^^---------^^^^------------^^^^.........##", // 39
".........!!!!!!!^^^^^^^^^^---^^^^^^^^^^^^^^^-----^^^^........---", // 40
".........!!!!!!!!!!!^^^^^^^^^^^^^^^^^^^^^^^^^----^^^.........---", // 41
"..........!!!!!!!!!!!!!!^^^^^^^^^^.......^^^.................---", // 42
"..........!!!!!!!!!!!!!!!^^^^^^^!!...........................---", // 43
".............!!!!!!!!!!!!!!!!!!!!..............................^", // 44
"................!!!!!!!!!!!!!!!.................................", // 45
".................!!!!!!!........................................", // 46
"................................................................", // 47
"................................................................", // 48
"................................................................", // 49
"................................................................", // 50
"................................................................", // 51
"................................................................", // 52
"................................................................", // 53
"................................................................", // 54
"................................................................", // 55
"................................................................", // 56
"................................................................", // 57
"................................................................", // 58
"................................................................", // 59
"................................................................", // 60
"................................................................", // 61
"................................................................", // 62
"................................................................", // 63
}, { /* region 33
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"................................................................", //  0
"................................................................",
"................................................................",
"................................................................",
"................................................................",
"................................................................", //  5
"................................................................",
"................................................................",
"................................................................",
"................................................................",
"................................................................", // 10
"................................................................",
"................................................................",
"................................................................",
".....................^^^^^......................................",
"....................^^^^*^^^^^^.................................", // 15
"....................^^..=.......................................",
".......................--------.................................",
"....................----------..................................",
"......................--------..................................",
"................................................................", // 20
"................................................................",
"................................................................",
"................................................................",
"................................................................",
"................$$$$$...........................................", // 25
"..............$$$$*$$$$$$.......................................",
"...............$$$$$$$$$$$$$$...................................",
"................$$$$$$$$$$$$$$$$................................",
"................$$$$$$$$...$$$$$$$$$$$$$$$$$$$$$$$..............",
".................$$$$$$$...$$$$$$$$$$$$$$$$$$$$$*$$-............", // 30
"...................$$$$$$.$$-------.........--------............",
".....................$$$..---------.........*-------------------",
".....................$$$.------------..........-----------------",
"....................$$.....-------------.--....-----------------",
"............-----..$$$.---.-----------...-----------------------", // 35
"............-----......*--.-----------.-------------------------",
"............--*-----------.-----------.-------------...---------",
"..............---------....------*.....-------------...------...",
"..............----......-------------------------...............",
"...........-------.------------------------------..*--..........", // 40
"...........-------=---------------------------......--..........",
"...........-----.....-------------------------....*---..-------#",
"...........-----.....------------------------------------#######",
"..........---...---------------------------------------#########",
"..........---...-----------------...-----#######################", // 45
"..........--...------------------...-##################%%%%%%%%%",
"..........--...------------------..-#######%%%%%%%%%%%%%%%%%%%%%",
".............-----------------------##########%%%%%%%%%%%%%%%%%%",
".............---------------------################%%%%%%%%%.....",
".............$-----------------###########%%%%%%%##.............", // 50
"............$$--..--------############%%%%%%*%%%%%%.............",
"..........$$$$--...-----#########%%%%%%%%%%%%%%%%%-.............",
"..........$$$$$$...#############%%%%%%%%%%%%%%%%................",
"...........$$*$....###%%%%%%%%%%%%%%%%%%%%%%%%%%.....%%.........",
"............$$....##%%%%%%%%%%%%%%%%%%%%*%%%%%%-....%%%--.......", // 55
"................####%%%%%%...........................%---.......",
"................####%%%.........................................",
".................###%%%.........................................",
"................####%%%.........................................",
"................####%%%%-.-%%%%########.##$$$$...$$$$$$$$$.$$$$$", // 60
"...............#####%%%%%.%%%%%########.##$$$$..$$$$$$$$$$.$$$$$",
".......$$$$$$$.#####%%%%..%%%%%########..-$$$$$.....-%%%$$..$$$$",
"......$$$$$###.#####%%%%.%%%%%%#########=-$$$$*......-%%%$$.$$$$", // 63
}, { /* region 34
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"................####%%%%%%...........................%---.......", //  0
"................####%%%.........................................",
".................###%%%.........................................",
"................####%%%.........................................",
"................####%%%%-.-%%%%########.##$$$$...$$$$$$$$$.$$$$$",
"...............#####%%%%%.%%%%%########.##$$$$..$$$$$$$$$$.$$$$$", //  5
".......$$$$$$$.####%%%%%..%%%%%########..-$$$$$.....-%%%$$..$$$$",
"......$$$$$###.###%#%%%..%%%%%##########=-$$$$*......-%%%$$.$$$$",
"......$$$#####.#####%%%..%%%%###########.-$$$$........%*%$$.$$$$",
"......$$*#####.####%%%%.%%%%%######-----....$$.........%%$$.$$$$",
"......$$######.####%%%..%%%%%######-------$..$.........%%$$.$$$$", // 10
"......$####....###.....%%#%########-------$$.$.........%%$..$$$$",
"......#####.#####.-##%%%##%###-----------$$$...........%%$.$$$$$",
"......##..........####%#######-----------$$$...........%%%.$$$$$",
".........##########################-----$$$$...........%%..$$$$$",
".......############################-----$$$...........%%%..$$$$$", // 15
"......#######################---###-----$$$...........-*-.$$$$$$",
"......#####--##############------------$$$$%-......-%.....$$$$$$",
"......###------###########-------------$$$%%%%.....%%%%*%%$$$$$$",
"......--------------------------------$$$##%%%%%%%%%%%%%%%$$$$$$",
".....---------------------------------$$###%%%%%%%%%%%%%%$$$$$$$", // 20
"......--------------------------------$$####%%%%%%%%%%%%%$$--$$$",
"......#####---------------------------$$###%%%%%%%%%%%%%%$#---$-",
"......#######------------------------*$-###%%%%%%%%%%%%%%##-----",
"......########..------------------------##%%%%%%%%%%%%%%%##-----",
"......###*####..-----------------------###%%%%%%%%%%%%%%%##-----", // 25
"......########.-----------------------###%%%%%%%%%%%%%%%%##-----",
".......######-.-------------..-------####%%%%%%%%%%%%%%%##------",
".........###...-------------..------####%%%%%%%%%%%%%%%%##------",
"...............---------------..---###%%%%%%%%%%%%%%%%%##-------",
"................--------------..---#%%%%%%%%%%%%%%%%%%%##-------", // 30
".............-----------------..---#%..%%%%%%%%%%%%%%%.=.-------",
".............-------------.......-##-...%%%%%%%%%%%....#....----",
".............-------------.......*......-%..%%%%%%%.-###--------",
"....................------.........---......-*%%%%%.%###--------",
"...................................---...---....%%-.###---------", // 35
".................................-----...-*-........##----------",
".................................----....--...-%%%%##-----------",
".................---------............-%......%%%%###-----------",
".................---------.....#......%%%.-%%%%%####------------",
"................---..--------.##......%%..%%%%%##*##------------", // 40
"................---..--------..####...%%..%%%%######------------",
".........................----...####%%%%%%%%%#######------------",
".........................----#...##%%%%%%%%#########------------",
".........................----##..##%%%%%%###########------------",
"...........................---#*###%%#########*#####------------", // 45
"....................----...---#####################-------------",
"..................------...-------------##########------------..",
"..................*---...-----------...----######-------------.-",
"..................----...-----------...-----####--------------.-",
"....................---------*---.......----#*##--------------..", // 50 Note that X63,Y50 of this region doesn't
"....................-------------.........--###-----------------", //    correctly match X7,Y50 of region 44
"..................------------...----..-..--##------------------", //    (this is a bug in the game).
"...................-----------...----..-----#-------------------",
"...................------------------------###------------------",
"....................-----------------------##-------------------", // 55
"....................---------------...----###-----------------..",
"....................---------------...----###-----------------..",
"......................----------..........-##-----------------..",
"..........................------.....................----.......",
"................................................................", // 60
"..................................###############...............",
"........................#################*#########.............",
".....................##############################.............", // 63
}, { /* region 35
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"....................---------------...----###-----------------..", //  0
"....................---------------...----###-----------------..",
"......................----------..........-##-----------------..",
"..........................------.....................----.......",
"................................................................",
"..................................###############...............", //  5
"........................#################*#########.............",
".....................##############################.............",
"..................################################..............",
"................##########*#######################..............",
"..............###################################...............", // 10
".............########################...........................",
".............#######################............................",
".............######################..........%%.................",
".............#########......................%%%.................",
"..............#######.....................%%%*%.................", // 15
"..............######...............%%%%%%%%%%%%%................",
"...............####.............%%%%%%%%%%%%%%%%................",
"...............................%%%%%...%%%%%%%%%........%%%.....",
".........................%%....%%%%..*.%%%%%%%%.......%%%%%%....",
"........................%%%....%%%%..%..%%%..%%%.....%%%%%%%....", // 20
"........................%%%%...%%%%%....%%..%%%%....%%%%%%%%....",
".......................%%%%%...%%%%%%..%%%.%%%%%...%%%%%%%%%....",
"......................%%%%%%....%%%%%.%%%..%%%%%..%%%%%%%%%%....",
"..................%%..%%%%%%....%%%%%.%%%..%%%%...%%%%%%%%%%....",
".................%%%..%%%%%%....%%%%%..%%...........%%%%%%%%....", // 25
"................%%%%..%%%%%.....%%%%%.....%%%%%%.%%...%%%%%%....",
"...............%%%%%%.%%%%.....%%%%%..%%%%%%%%%%.%%%%.%%%%%%....",
"..............%%%%%%%.%%%%...%%%%%%..%%%%%%%%%%%.%%%%.%%%%%.....",
"..............%%%%%*..%%%%..%%%%%%%%%%%%%%%%%%%%.%%%%%%%%%%.....",
"...###.......%%%%%%%.%%%%%%%%%%%%%%%%%%%%%%%%%%..%%%%%%%%%%.....", // 30
"...#########%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%......%%%%%%%###......", // 31
"...#########%%%%%%%%%%%%%%%%%%%%%%%%%%%%%.....%%%%%%%%###.......", // 32
"...###########%%%%%%%%%%%%%%%%%%%%%%%%%%%.....%%%%%%#####.......", // 33
"....###########%%%%%%%%%%%%%%%%%%%%%%%%%%%...%%%%%%#####-.......", // 34
".....##############%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#####--.......", // 35
".....#####*#############%%%%%%%%%%%%%%%%%%%%%%%%%%####---.......", // 36
".....################################*%%%%%%%%%%#####----.......", // 37
"......##############################################-----.......", // 38
"......##############################################----........", // 39
".....--------######################################----.........", // 40
".....----------------###########################------..........", // 41
".....----------------------------##########----------...........", // 42
".....------------------------------------------------...........", // 43
".......^^^^-----------------------------------------............", // 44
"........^^^^^^--------------------------------------............", // 45
"........^^^^^^^^-----------------------------------.............", // 46
"..........^^^^^^^^-------------------^----......................", // 47
"............^^^^^^^-----------------^^----......................", // 48
"..............^^^^^^---------------^^^---.......................", // 49
"...............^^^^^^^^^----------^^^^--........................", // 50
".................^^^^^^^^^^^^^-^^^^^^--.........................", // 51
"...................^^^^^^^^^^^-^^^^^^...........................", // 52
"....................^^*--------^^^^^............................", // 53
".....................^^^-^^^^^^^^^..............................", // 54
".....................^^^-^^^^^..................................", // 55
"......................^^--^^....................................", // 56
"......................^^^-^.....................................", // 57
".......................^^*^.....................................", // 58
"........................^^^.....................................", // 59
"................................................................", // 60
"................................................................", // 61
"................................................................", // 62
"................................................................", // 63
}, { /* region 36
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"................................................................", //  0
"................................................................", //  1
"................................................................", //  2
"................................................................", //  3
"................................................................", //  4
"................................................................", //  5
"................................................................", //  6
"................................................................", //  7
"................................................................", //  8
"................................................................", //  9
"................................................................", // 10
"................................................................", // 11
"................................................................", // 12
"................................................................", // 13
"................................................................", // 14
"................................................................", // 15
"................................................................", // 16
"................................................................", // 17
"................................................................", // 18
"................................................................", // 19
"...............$................................................", // 20
"...............$$...............................................", // 21
"..............$$$...............................................", // 22
"..............$$$$..............................................", // 23
"..............$$$$..............................................", // 24
"..............$$$$..............................................", // 25
"..............$$$$..............................................", // 26
"..............$$$$..............................................", // 27
"...............$$...............................................", // 28
"...............$$...............................................", // 29
"................................................................", // 30
"................................................................", // 31
"................................................................", // 32
"................................................................", // 33
"................................................................", // 34
"................................................................", // 35
"................................................................", // 36
"................................................................", // 37
"................................................................", // 38
"................................................................", // 39
"................................................................", // 40
"................................................................", // 41
"................................................................", // 42
"................................................................", // 43
"................................................................", // 44
"................................................................", // 45
"................................................................", // 46
"................................................................", // 47
"................................................................", // 48
"................................................................", // 49
"................................................................", // 50
"................................................................", // 51
"................................................................", // 52
"................................................................", // 53
"................................................................", // 54
"................................................................", // 55
"................................................................", // 56
"................................................................", // 57
"................................................................", // 58
"................................................................", // 59
"................................................................", // 60
"................................................................", // 61
"................................................................", // 62
"................................................................", // 63
}, { /* region 41
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"................................................................", //  0
"................................................................", //  1
"................................................................", //  2
"................................................................", //  3
"................................................................", //  4
"................................................................", //  5
"................................................................", //  6
"................................................................", //  7
"................................................................", //  8
"....................---.........................................", //  9
".................------...............................-----..---", // 10
".................----*-...................----------------------", // 11
"........----......-----...................----------------------", // 12
"........----......---.........................------------------", // 13
"........---.......---.........................------------------", // 14
"........---....................................-----------------", // 15
"...............................................-----------------", // 16
"...............................................-----------------", // 17
"....................---........................-----------------", // 18
"................-------........................-----------------", // 19
"................-------........................-----------------", // 20
"................-----........................-------------------", // 21
"................-----........................-------------------", // 22
"................-----........................-------------------", // 23
".................----........................-------------------", // 24
".................----.......................--------------------", // 25
"............................................-------*------------", // 26
".........................-----..............--------------------", // 27
".........----............-----..............--------------------", // 28
".........----............-----..............--------------------", // 29
".........----------......---*-..............--------------------", // 30
".........------------....--.................--------------------", // 31
".........------------....--................---------------------", // 32
"..........-----------......................---------------------", // 33
"..........-----------......................---------------------", // 34
"........-------............................---------------------", // 35
"........-------............................---------------------", // 36
"........-------............................---------------------", // 37
"........-------..........................-----------------------", // 38
"........-------..........................-----------------------", // 39
".........------..................-------------------------------", // 40
".................................-------------------------------", // 41
".................................-------------------------------", // 42
".................................-------------------------------", // 43
".........................---.....-------------------------------", // 44
".........................---...............----------..........-", // 45
".......................-------..................................", // 46
".......................-------..................................", // 47
"...........................---..................................", // 48
"................................................................", // 49
"................................................................", // 50
"................................................................", // 51
"................................................................", // 52
"................................................................", // 53
"................................................................", // 54
"................................................................", // 55
"................................................................", // 56
"................................................................", // 57
"................................................................", // 58
"................................................................", // 59
"................................................................", // 60
"................................................................", // 61
"................................................................", // 62
"................................................................", // 63
}, { /* region 43
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"................................................................", //  0
"................................................................",
"................................................................",
"................................................................",
"................................................................",
"................................................................", //  5
"................................................................",
"................................................................",
"................................................................",
"................................................................",
"..................................------........................", // 10
".............................-----------------..................",
".............................------------------------...........",
"........................-----------------------------...........",
"........................-------------------..=..-----...........",
"....................-----------------------.-*-.------..........", // 15
"....................-----------------------.---.------..........",
"....................-----------------------.....---...--........",
"..................-------------------------------.....--........",
"..................----...........----------------....---........",
"...............-------............-------------......-*-........", // 20
"...............-------............-------------.--...---........",
"..........--------..............--------------..--....--........",
"..........--------..............--------------..--....--........",
"..........-................-----------------------....--........",
"..........-................-*---------------------..............", // 25
"...........................-----------------------..............",
"...............................-------------------..............",
"...............................-----------------..-.............",
"...............................-----------------..-.............",
"............................-----------------------.............", // 30
"...................---..--------------------------..............", // 31
"----------.........--*..-----------------------$$$..............", // 32
"----------.........--------------------------$$$$...............", // 33
"----------...........-----$$$$$$-----------$$$$$$...............", // 34
"----------..................$$$$----------$$$$$$$$..............", // 35
"---------.....................$$$$$------$$$$$$$$$$.............", // 36
"---------.......$$$$............$$$$$---$$$$$$$$$$$.............", // 37
"-----.........$$$*$$.............##$$$$-$$$$$$$$$$$.............", // 38
"..............$$$$$$..............################..............", // 39
"....................................###*########................", // 40
".........................................#####..................", // 41
"-------##.......................................................", // 42
"-##########.....................................................", // 43
"###########.....................................................", // 44
"%##########.....................................................", // 45
"%%%%%%%%%%%.....................................................", // 46
"%%%%%%%%%%......................................................", // 47
"%%%%%%%%........................................................", // 48
"%%%.............................................................", // 49
"................................................................", // 50
"................................................................", // 51
"................................................................", // 52
"................................................................", // 53
"................................................................", // 54
"-...............................................................", // 55
"-...............................................................", // 56
"................................................................", // 57
"................................................................", // 58
"................................................................", // 59
"$$.$$$$$$-------................................................", // 60
"$$.$$$$$$$$$----...........................$$$------............", // 61
"$$..$$$$$$$$$-------------...............$$$$*----...--.........", // 62
"%$$.$$$$$$$$$$$-----------.-------.......$$-------.----.........", // 63
}, { /* region 44
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"................................................................", //  0
"................................................................",
"................................................................",
"................................................................",
"$$.$$$$$$-------................................................",
"$$.$$$$$$$$$----...........................$$$------............", //  5
"$$..$$$$$$$$$-------------...............$$$$*----...--.........",
"%$$.$$$$$$$$$$$-----------.-------.......$$-------.----.........",
"%$$.$$$$$$$$$$$$--------...-------..-.......---...-------*......",
"%$$.$$$$$$$$$$$$--------...----------...........----------......",
"%$$.$$$$$$$$$$$----------------------......-----------..........", // 10
"%$..$$$$$$$$$$--------------------*.........-------.............",
"%$.$$$$$$$$$$----------------------.........-------.............",
"%%.$$$$$$$$$---------------------..........-----................",
"%..$$$$$$$$----------------------...............................",
"%..$$$$$$$$----------------------...............................", // 15
"-.$$$$$$$$*---------------------$........---...........---......",
"..$$$$$$$$----------------------$$.......-*-..-........-.-......",
"%%$$$$$$$-----------------------$$........-----......---........",
"%%$$$$$$$------------------------$$-.................---........",
"%$$$$$$$-------------------------$$$................$-----......", // 20
"%$$--$$$------------------------$$$$$.............$$$-----......",
"%$#---$-----------------------$$$$$$$$$$$$$$$$$$$$$$-----*......",
"%##--------------------------$$$$$$$$$$$$$-$$$$$$$$-------......",
"%##----------------------*-$$$$$$$$$$$$----$$$$$$$--------......",
"%##----------------------$$$$$$$$$$$$$--*-$$$$$$$$------........", // 25
"%##----------------------$$$$$$$$$$$$$---$$$$$$$$$------........",
"##----------------------$$$$$$$$$$$$$$-$$$$$$$$$$-------........",
"##---------------------$$$$$$$$$$$$$$$$$$$$$$$$------...........",
"#---------------------$$$$$$$$$$$$$$$$$$$$$$---------...........",
"#---------------------$$$$$$$$$$$$$$$$$$-------------...........", // 30
".--------------------$$$$$$$$$$$$$$$$$$----------......--.......", // 31
"....----------------$$$$$$$$$$$$$$$$$$-----------......--.......", // 32
"--------------------$$$$$$$$$$$$$$$$-------------....---........", // 33
"-------------------$$$$$$$$$$$$$$$$---------.........---........", // 34
"------------------$$$$$$$$$$$$$$$-----------.........---........", // 35
"----------------$$$$$$$$$$$$$$$$$---------........---*-.........", // 36
"--------------$$$$$$$$$$...$$$$$$---------........-----.........", // 37
"------------$$$$$$$$$$$.....$$$$-------------...................", // 38
"----------*$$$$$-------.....$$$--------------...................", // 39
"----------$$-----...........$$$-------------.......*--..........", // 40
"-------------...............$$--------------....------..........", // 41
"-------------..----..--*...$$-------------.......----...........", // 42
"----------.....*---..--..-$$--------------.......--.............", // 43
"----------...........--..--------------------..----.............", // 44
"----------..----....---...---------------..--..----.............", // 45
"-------.....----....*--...---------------..-------..............", // 46
"------..--------..........-----------....---------..............", // 47
"------.----..-.........--------------....-------................", // 48
"------.----........-...-----------.......-----..................", // 49
"------.---...---------------------.......--.....................", // 50
"--------.....---------------...------..----.....................", // 51
"--------..------------------...-*----..----.....................", // 52
"--------..----------------.........--------.....................", // 53
"--------..----------------.........--------.....................", // 54
"--------..----------------............-----.....................", // 55
"------......----------................--........................", // 56
"------......----.....................---........................", // 57
"------..........................................................", // 58
"-...............................................................", // 59
"................................................................", // 60
"................................................................", // 61
"................................................................", // 62
"................................................................", // 63
}, { /* region 45
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"------......----------................--........................", //  0
"------......----.....................---........................", //  1
"------..........................................................", //  2
"-...............................................................", //  3
"................................................................", //  4
"................................................................", //  5
"................................................................", //  6
"................................................................", //  7
"................................................................", //  8
"................................................................", //  9
"................................................................", // 10
"................................................................",
"................................................................",
"................................................................",
"................................................................",
"................................................................", // 15
"................................................................",
"................................................................",
"%%%.............................................................",
"%%%%............................................................",
"%%%%............................................................", // 20
"%%%%............................................................",
"%%%%............................................................",
"%%%%.........................----...............................",
"%%%%.........................----...............................",
"%%%%.........................------.............................", // 25
"%%%%...........................----.............................",
"%%%%...........................----.............................",
"%%%.............................................................",
"%%%..............-..............................................",
"%%%..............--.............................................", // 30
"##..............----............................................", // 31
"#...............-.--............................................", // 32
"#...............................................................", // 33
"-...............................................................", // 34
"-..............................-----............................", // 35
"-..............................-$$$-............................", // 36
"-..............................-$$$-............................", // 37
"-..............................-$$$---..........................", // 38
"...............................-$$$$$-..........................", // 39
"...............................-$$$$$-..........................", // 40
"...............................-------..........................", // 41
"................................................................", // 42
"................................................................", // 43
"................................................................", // 44
"................................................................", // 45
"................................................................", // 46
"................................................................", // 47
"................................................................", // 48
"................................................................", // 49
"................................................................", // 50
"................................................................", // 51
"................................................................", // 52
"................................................................", // 53
"................................................................", // 54
"................................................................", // 55
"................................................................", // 56
"................................................................", // 57
"................................................................", // 58
"................................................................", // 59
"................................................................", // 60
"................................................................", // 61
"................................................................", // 62
"................................................................", // 63
}, { /* region 51
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"................................................................", //  0
"................................................................", //  1
"................................................................", //  2
"................................................................", //  3
"................................................................", //  4
"................................................................", //  5
".......................................-------------............", //  6
".......................................----^^^^^----............", //  7
".......................................---^^^*^^^---............", //  8
"....................................-----^^^...^^^-----.........", //  9
"---..-----------....................-----^^.....^^-----.........", // 10
"--------------------................-----^^.....^^-----.........", // 11
"--------------------................-----^^^...^^^-----.........", // 12
"--------------------..................----^^^.^^^----...........", // 13
"--------------------..................-----^^.^^-----...........", // 14
"--------------*-----..................-----^^.^^-----...........", // 15
"----------------------................----^^^.^^^----...........", // 16
"----------------------..........................................", // 17
"------------------------........................................", // 18
"------------------------........................................", // 19
"------------------------........................................", // 20
"------------------------.......----.............................", // 21
"--------------------------.....----.............................", // 22
"--------------------------.....---*---..........................", // 23
"----------------------------...-------..........................", // 24
"----------------------------....................................", // 25
"--------------------------------................................", // 26
"-----------------------------------------.......................", // 27
"------------------------------------------------------..........", // 28
"----------------------------------------------------*-..........", // 29
"------------------------------------------------------..........", // 30
"------------------------------------------------------..........", // 31
"-----------------------------------------------------...........", // 32
"-----------------------------------------------------...........", // 33
"-----------------------------------------------------...........", // 34
"--------------------------------------------------..............", // 35
"--------------------------------------------------..............", // 36
"--------------------------------------------------..............", // 37
"--------------------------------------------------..............", // 38
"-----------------------------*---------------------.............", // 39
"---------------------------------------------------.............", // 40
"----------------------------------------------------............", // 41
"----------------------------------------------------............", // 42
"----------------------------------------------------............", // 43
"----------------------------------------------------............", // 44
".......---------------------------------------------............", // 45
"............----------------------------------------............", // 46
"................-----------------------------------.............", // 47
".....................------------------------------.............", // 48
".....................-------------------------------............", // 49
".............................-----------------------............", // 50
".............................-----------------------............", // 51
"....................................---------------.............", // 52
"....................................---------------.............", // 53
"....................................---------------.............", // 54
"....................................---------------.............", // 55
"....................................---------------.............", // 56
"......................................------------..............", // 57
"......................................------------..............", // 58
"......................................------------..............", // 59
"...............---....................------------..............", // 60
"...............---...................-------------..............", // 61
".............-----...................-------------..............", // 62
"............------...................-------------..............", // 63
}, { /* region 52
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"....................................---------------.............", //  0
"......................................------------..............", //  1
"......................................------------..............", //  2
"......................................------------..............", //  3
"...............---....................------------..............", //  4
"...............---...................-------------..............", //  5
".............-----...................-------------..............", //  6
"............------...................-------------..............", //  7
"...........---------.....................---------..............", //  8
"...........---------.....................---------..............", //  9
"...........---------.....................---------..............", // 10
"...........---------.....................---------..............", // 11
"...........----------....................-------................", // 12
"...........----------......................-----................", // 13
"...........----------......................-----................", // 14
"...........----------......................-----................", // 15
".........------------...........................................", // 16
".........--------------.........................................", // 17
".........--------------.........................................", // 18
"........---------------.........................................", // 19
"........---------------.........................................", // 20
"........---------------.........................................", // 21
"........---------------.........................................", // 22
".........--------------.........................................", // 23
".........--------------.........................................", // 24
".........--------------.........................................", // 25
".........--------------.........................................", // 26
".........------------...........................................", // 27
"........-------------...........................................", // 28
"........-------------...........................................", // 29
"........--------------..........................................", // 30
"........--------------*.........................................", // 31
"........-----------------.......................................", // 32
".........----------------........----...........................", // 33
".........----------------------------...........................", // 34
".........-------------------------------------..................", // 35
"...............----------...------------------..................", // 36
"...............----------...-*-------------------------.........", // 37
"...............----------......------------------------.........", // 38
"...............------------....-----*------------------.........", // 39
".............-----------------------------------------..........", // 40
".............-----------------------------------------..........", // 41
".................----------------------....-----------..........", // 42
".................----------------------.........................", // 43
"................................................................", // 44
"................................................................", // 45
"................................................................", // 46
"................................................................", // 47
"................................................................", // 48
"................................................................", // 49
"................................................................", // 50
"................................................................", // 51
"................................................................", // 52
"................................................................", // 53
"................................................................", // 54
"................................................................", // 55
"................................................................", // 56
"................................................................", // 57
"................................................................", // 58
"................................................................", // 59
"................................................................", // 60
"................................................................", // 61
"................................................................", // 62
"................................................................", // 63
}, { /* region 54
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"................................................................", //  0
"................................................................", //  1
"................................................................", //  2
"................................................................", //  3
"................................................................", //  4
"................................................................", //  5
"................................................................", //  6
"................................................................", //  7
"................................................................", //  8
"................................................................", //  9
"................................................................", // 10
"................................................................", // 11
"................................................................", // 12
"..................................-----.........................", // 13
"..............................-------------.....................", // 14
".............................---------------....................", // 15
".............................--^^^^^^^^^-----...................", // 16
"............................--^^^....^^^^^---...................", // 17
"............................-^^...^^^^^^^^^--...................", // 18
"............................^^^.^^^^..^^^^^--...................", // 19
"...........................^^^^.^^.....^^^^--...................", // 20
"..........................................^--...................", // 21
"...........................^^^^^^.^...^^^.^--...................", // 22
"............................^^^^^.^^^^^^^.^--...................", // 23
"............................--^^^.......^.^--...................", // 24
"............................----^^^.^^^-^^^--...................", // 25
".............................----^^.^^^*^^---...................", // 26
"..............................----^...^^^---....................", // 27
"...............................---^^^^^^---.....................", // 28
"................................---^^^^---......................", // 29
"................................----------......................", // 30
".................................--------.......................", // 31
"................................................................", // 32
"................................................................", // 33
"................................................................", // 34
"................................................................", // 35
"................................................................", // 36
"................................................................", // 37
"................................................................", // 38
"................................................................", // 39
"................................................................", // 40
"................................................................", // 41
"................................................................", // 42
"................................................................", // 43
"................................................................", // 44
"................................................................", // 45
"................................................................", // 46
"................................................................", // 47
"................................................................", // 48
"................................................................", // 49
"................................................................", // 50
"................................................................", // 51
"................................................................", // 52
"................................................................", // 53
"................................................................", // 54
"................................................................", // 55
"................................................................", // 56
"................................................................", // 57
"................................................................", // 58
"................................................................", // 59
"................................................................", // 60
"................................................................", // 61
"................................................................", // 62
"................................................................", // 63
}, { /* region 55
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"................................................................", //  0
"................................................................", //  1
"................................................................", //  2
"................................................................", //  3
"................................................................", //  4
"................................................................", //  5
"................................................................", //  6
"................................................................", //  7
"................................................................", //  8
"................................................................", //  9
"................................................................", // 10
"................................................................", // 11
"................................................................", // 12
"................................................................", // 13
"................................................................", // 14
"................................................................", // 15
"................................................................", // 16
"......................................-----....----.............", // 17
".....................................-------..-----.............", // 18
"....................................----------------............", // 19
"...................................-----------------............", // 20
"..................................---..--..---------............", // 21
"..................................-....--..----*---.............", // 22
"...........................................--------.............", // 23
"............................................-------.............", // 24
"............................................------..............", // 25
"............................................------..............", // 26
"............................................-----...............", // 27
"............................................-----...............", // 28
"..........................................------................", // 29
"..........................................-----.................", // 30
"..........................................-----.................", // 31
"..........................................-----.................", // 32
".........................................------.................", // 33
".........................................-----..................", // 34
".........................................-----..................", // 35
".........................................-----..................", // 36
"........................................------..................", // 37
"........................................------..................", // 38
"........................................------..................", // 39
"........................................------..................", // 40
"........................................-----...................", // 41
"........................................-----...................", // 42
"........................................------..................", // 43
".........................................-----..................", // 44
".........................................-----..................", // 45
"........................................------..................", // 46
"........................................------..................", // 47
"........................................------..................", // 48
"........................................------..................", // 49
"........................................------..................", // 50
"........................................------..................", // 51
"........................................------..................", // 52
"........................................-------.................", // 53
"........................................-------.................", // 54
"........................................-------.................", // 55
"........................................--------................", // 56
"........................................--------................", // 57
"........................................--------................", // 58
"........................................--------................", // 59
"........................................--------................", // 60
"........................................--------................", // 61
".......................................----^^---................", // 62
".......................................---^^^^---...............", // 63
}, { /* region 56
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"........................................--------................", //  0
"........................................--------................", //  1
"........................................--------................", //  2
"........................................--------................", //  3
"........................................--------................", //  4
"........................................--------................", //  5
".......................................----^^---................", //  6
".......................................---^^^^---...............", //  7
"...................................^^^^^^^^^^^^^^^^^............", //  8
"..................................^^^^^^^^^^^^^^^^^^^...........", //  9
".................................^^^^^!!!!!!!!!!!!^^^^..........", // 10
".................................^^^^!!!!!!!!!!!!!!^^^^^........", // 11
"................................^^^^!!!!!!!!!!!!!!!!^^^^^^......", // 12
"................................^^^^!!!!!^^^^^-!!!!!!^^^^^^^....", // 13
"...............................^^^^^!!!!^-------!!!!!^^^^^^^^---", // 14
"..............................^^^^^^!!!^^-------^!!!!^^^^^^^^^--", // 15
"............................^^^^^^^^!!!^--------^^!!!^^^^^^^^^^^", // 16
"...........................^^^^^^^^^!!!^---*-*---^!!!^^^^^^^^^^^", // 17
"..........................^^^^^^^^^^!!!!^---------!!!^^^^^^^^^^^", // 18
".........................^^^^^^^^^^^!!!!^^-----^^!!!!^^^^^^^^^^^", // 19
"........................^^^^^^^^^^^^^!!!!-----^^!!!!!^^^^^^^^^^^", // 20
"........................^^^^^^^^^^^^^!!!!!-^^^^^!!!!!^^^^^^^^^^-", // 21
"........................^^^^^^^^^^^^^!!!!!!!!!!!!!!!^^^^^^^^----", // 22
".......................^^^^^^^^^^^^^^^!!!!!!!!!!!!!^^^^^^^^.....", // 23
".......................^^^^^^^^^^^^^^^^!!!!!!!!!!!!^^^^^^^......", // 24
"......................-^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^........", // 25
".....................---^^^^^^^^^^^^^^^^^^^^^^^^^^^^^...........", // 26
"....................-------........^^^^^^^^^^^^^^^^.............", // 27
"....................------...............^^^^^^^^...............", // 28
"....................-----.......................................", // 29
"..................-------.......................................", // 30
"..................------........................................", // 31
"..................------...........$$$$$$$$$....................", // 32
"..................------..........$$$$$$$$$$$$$$$...............", // 33
"..................------..........$$$$$$*$$$$$$$$$..............", // 34
"................--------...........$$$$$$$$$$$$$$$..............", // 35
"................-------..............$$$$$$$$$$$$...............", // 36
"................-------...............$$$$$$$$..................", // 37
"................----.................$$$$$$$....................", // 38
"...............-----................$$$$$$$.........$$..........", // 39
"...............-------..............$$$$$$$.....$..$$$..........", // 40
"...............-------.........................$$$$$$$..........", // 41
"...............--------..........................$$$$...........", // 42
"...............---------........................$$$$$...........", // 43
"...............-----------.....................$$$..............", // 44
"...............-----*------.....................................", // 45
".................----------.....................................", // 46
".................----------.....................................", // 47
".................----------.....................................", // 48
"..................------........................................", // 49
"....................----........................................", // 50
"................................................................", // 51
"................................................................", // 52
"................................................................", // 53
"................................................................", // 54
"................................................................", // 55
"................................................................", // 56
"................................................................", // 57
"................................................................", // 58
"................................................................", // 59
"................................................................", // 60
"................................................................", // 61
"................................................................", // 62
"................................................................", // 63
}, { /* region 64
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"................................................................", //  0
"................................................................", //  1
"................................................................", //  2
"................................................................", //  3
"................................................................", //  4
"................................................................", //  5
"................................................................", //  6
"................................................................", //  7
"................................................................", //  8
"................................................................", //  9
"................................................................", // 10
"................................................................", // 11
"................................................................", // 12
"................................................................", // 13
"................................................................", // 14
"................................................................", // 15
"................................................................", // 16
"................................................................", // 17
"................................................................", // 18
"................................................................", // 19
"................................................................", // 20
"................................................................", // 21
"................................................................", // 22
"................................................................", // 23
"................................................................", // 24
"................................................................", // 25
"................................................................", // 26
"........................--------................................", // 27
".......................-------------............................", // 28
"................----------#####------...........................", // 29
"...............---------###########---..........................", // 30
"...............--------#####^^^#####---.........................", // 31
"...............----########^^^^^^###---.........................", // 32
"...............---#########^^^---####---........................", // 33
"...............--#########^^^--^^^###----.......................", // 34
"...............-##########^^^-^^^^^-------......................", // 35
"...............###########^^---^^^^^------......................", // 36
"...............############^*-^^^.^^------......................", // 37
"...............############^^^^......-----......................", // 38
"................^###########^^^..---..---.......................", // 39
"................^^##########^^^^..--..---.......................", // 40
"................^^###########^^^^...............................", // 41
"................^^############^^^...............................", // 42
"................^^#############^^^..............................", // 43
"................^^^############^^^^.............................", // 44
".................^^^############^^^.............................", // 45
".................^^^^###########^^^.............................", // 46
".................^^^^^########^^^^^.............................", // 47
"..................^^^^^^^*^^^^^^^^..............................", // 48
"....................^^^^^.^^^^^^................................", // 49
".......................^^^^^^...................................", // 50
"................................................................", // 51
"................................................................", // 52
"................................................................", // 53
"................................................................", // 54
"................................................................", // 55
"................................................................", // 56
"................................................................", // 57
"................................................................", // 58
"................................................................", // 59
"................................................................", // 60
"................................................................", // 61
"................................................................", // 62
"................................................................", // 63
}, { /* region 66
 0000000000111111111122222222223333333333444444444455555555556666
 0123456789012345678901234567890123456789012345678901234567890123 */
"................................................................", //  0
"................................................................", //  1
"................................................................", //  2
"................................................................", //  3
"................................................................", //  4
"................................................................", //  5
"................................................................", //  6
"................................................................", //  7
"................................................................", //  8
"................................................................", //  9
"................................................................", // 10
"................................................................", // 11
"^^..............................................................", // 12
"^^^^....---.....................................................", // 13
"^^^^^--------...................................................", // 14
"^^^^^^-----------...............................................", // 15
"^^^^^^^^--------------..........................................", // 16
"^^^^^^^^---------------------...................................", // 17
"^^^^^^^^--------------------------..............................", // 18
"^^^^^^^^--------------------------..............................", // 19
"^^^^^^^^--------------------------..............................", // 20
"^^^^^^^----.....------------------..............................", // 21
"^^^^----...........---------------..............................", // 22
"^^^.................-------------...............................", // 23
"^^.....................----------...............................", // 24
"...........................---------............................", // 25
".............................--------...........................", // 26
".............................---------..........................", // 27
"..............................--------..........................", // 28
"..............................---------.........................", // 29
"..............................----------........................", // 30
".................................-------........................", // 31
".................................--------.......................", // 32
".................................--------.......................", // 33
"..................................---------.....................", // 34
"..................................----------....................", // 35
"...................................---------....................", // 36
".....................................--------...................", // 37
".....................................----------.................", // 38
".....................................----------.................", // 39
"......................................---------.................", // 40
".......................................---------................", // 41
".......................................-----------..............", // 42
"........................................------------............", // 43
".........................................-------------..........", // 44
"..........................................--------------........", // 45
"...........................................-------------........", // 46
"............................................------*---..........", // 47
"............................................----..----..........", // 48
".............................................---..----..........", // 49
"..............................................----------........", // 50
"...............................................---------........", // 51
"..................................................----..........", // 52
"..................................................----..........", // 53
"................................................................", // 54
"................................................................", // 55
"................................................................", // 56
"................................................................", // 57
"................................................................", // 58
"................................................................", // 59
"................................................................", // 60
"................................................................", // 61
"................................................................", // 62
"................................................................", // 63
} };

MODULE const ULONG vartofile_class[10] = {  2,  4,  3,  1,  0,  9,  7,  5,  8,  6 },
                   filetovar_class[10] = {  4,  3,  0,  2,  1,  7,  9,  6,  8,  5 },
                   vartofile_power[43] = {  0,  8, 29, 31,  5, 15, 21, 36, 33,  6, //  0- 9 None-Death Blade
                                           38,  2,  3,  1, 17, 30, 14, 32, 18, 25, // 10-19 Etc.-Illusion
                                           35, 28, 39, 26, 41,  9, 37, 22, 16, 19, // 20-29 Magic Torch-Spirit Wrack
                                           11,  7, 24,  4, 10, 42, 34, 20, 13, 12, // 30-39 Still Air-Wings of Victory
                                           23, 27, 40 },                           // 40-42 Wither Strike-Youth
                   filetovar_power[43] = {  0, 13, 11, 12, 33,  4,  9, 31,  1, 25,
                                           34, 30, 39, 38, 16,  5, 28, 14, 18, 29,
                                           37,  6,  7, 40, 32, 19, 23, 41, 21,  2,
                                           15,  3, 17,  8, 36, 20,  7, 26, 10, 22,
                                           42, 24, 35 },
                   vartofile_const[10] = {  0,  7,  0,  4,  9,  2,  5,  3,  1,  6 },
                   filetovar_const[9]  = {  2,  8,  5,  7,  3,  6,  9,  1,  4 },
                   vartofile_quali[8]  = {  0,  5,  6,  4,  8,  7,  3,  2 },
                   filetovar_quali[9]  = {  0,  0,  7,  6,  3,  1,  2,  4,  5 };

/* 7. MODULE STRUCTURES -------------------------------------------------- */

MODULE struct
{  TEXT  name[9 + 1];
   ULONG race, theclass,
         spd, str, iq, end, ski,
         level,
         maxhp, curhp, maxsp, cursp,
         xp,
         skill[31];
   struct
   {   ULONG thing,
             cursed,
             identified,
             constant[2],
             dormant[2],
             dormantpts[2],
             invoked,
             invokedpts,
             breakability,
             usesperday,
             kind, // corresponds to the radio gadget
             quality;
       SLONG plusminus;
   } item[10];
} man[5];

// items[a].filecode is the same as vartofile_items[a]
MODULE struct
{   const UBYTE  filecode;
    const STRPTR name;
} items[31] = {
{255, "Nothing"},         //  0
{  7, "2-handed sword"},  // "2-hand sword" in game
{ 20, "Amulet"},
{  6, "Battle axe"},
{  5, "Broad sword"},
{ 10, "Chain"},           //  5
{  9, "Cloth"},
{ 13, "Crown"},
{  0, "Dagger"},
{ 29, "Demon Crystal"},
{ 22, "Figurine"},        // 10
{ 19, "Gem"},
{ 27, "Lantern"},
{  9, "Leather"},
{  3, "Mace"},
{ 21, "Medallion"},       // 15
{  4, "Morning star"},
{ 29, "Orb of Evertime"}, // "Orb/Evertime" in game
{ 15, "Ring"},
{ 12, "Plate"},
{ 18, "Rod"},             // 20
{ 24, "Salve"},
{ 11, "Scale"},
{  2, "Short sword"},
{  1, "Small axe"},
{ 17, "Staff"},           // 25
{ 23, "Talisman"},
{ 26, "Torch"},
{ 14, "Vial #1"},         // "Vial" in game
{ 25, "Vial #2"},         // "Vial" in game
{ 16, "Wand"}             // 30
};

/* 8. CODE --------------------------------------------------------------- */

EXPORT void dw_main(void)
{   PERSIST FLAG first = TRUE;

    if (first)
    {   first = FALSE;

        // dw_preinit()
        NewList(&InvokedPowersList[0]);
        NewList(&InvokedPowersList[1]);
        NewList(&InvokedPowersList[2]);
        NewList(&ItemsList);
        NewList(&SkillsList);
        NewList(&MonthList);

        // dw_init()
        lb_makelist(&InvokedPowersList[0], InvokedPowerOptions, 43);
        lb_makelist(&InvokedPowersList[1], InvokedPowerOptions, 43);
        lb_makelist(&InvokedPowersList[2], InvokedPowerOptions, 43);
        lb_makelist(&ItemsList,            ItemOptions,         31);
        lb_makechecklist(&SkillsList,      SkillOptions,        31);
        lb_makelist(&MonthList,            MonthOptions,        MONTHS);
    }

    tool_open      = dw_open;
    tool_loop      = dw_loop;
    tool_save      = dw_save;
    tool_close     = dw_close;
    tool_exit      = dw_exit;
    tool_subgadget = dw_subgadget;

    if (loaded != FUNC_DW && !dw_open(TRUE))
    {   function = page = FUNC_MENU;
        return;
    } // implied else
    loaded = FUNC_DW;

    dw_getpens();
    make_speedbar_list(GID_DW_SB1);
    make_clock(GID_DW_CL1);
    load_aiss_images( 6,  8);
    load_aiss_images(10, 10);

    InitHook(&ToolHookStruct, (ULONG (*)())ToolHookFunc, NULL);
    lockscreen();

    if (!(WinObject =
    NewToolWindow,
        WA_SizeGadget,                                     TRUE,
        WA_ThinSizeGadget,                                 TRUE,
        WINDOW_Position,                                   WPOS_CENTERMOUSE,
        WINDOW_ParentGroup,                                gadgets[GID_DW_LY1] = (struct Gadget*)
        VLayoutObject,
            LAYOUT_SpaceOuter,                             TRUE,
            LAYOUT_SpaceInner,                             TRUE,
            AddHLayout,
                AddToolbar(GID_DW_SB1),
                AddSpace,
                CHILD_WeightedWidth,                       50,
                AddVLayout,
                    AddSpace,
                    CHILD_WeightedHeight,                  50,
                    MaximizeButton(GID_DW_BU15, "Maximize Party"),
                    CHILD_WeightedHeight,                  0,
                    AddSpace,
                    CHILD_WeightedHeight,                  50,
                LayoutEnd,
                CHILD_WeightedWidth,                       0,
                AddSpace,
                CHILD_WeightedWidth,                       50,
            LayoutEnd,
            CHILD_WeightedHeight,                          0,
            AddHLayout,
                LAYOUT_VertAlignment,                      LALIGN_CENTER,
                AddSpace,
                AddLabel("Character #:"),
                CHILD_WeightedWidth,                       0,
                LAYOUT_AddChild,                           gadgets[GID_DW_CH3] = (struct Gadget*)
                PopUpObject,
                    GA_ID,                                 GID_DW_CH3,
                    GA_RelVerify,                          TRUE,
                    CHOOSER_LabelArray,                    &CharacterOptions,
                PopUpEnd,
                CHILD_WeightedWidth,                       0,
                AddLabel("of"),
                LAYOUT_AddChild,                           gadgets[GID_DW_IN20] = (struct Gadget*)
                IntegerObject,
                    GA_ID,                                 GID_DW_IN20,
                    GA_RelVerify,                          TRUE,
                    GA_TabCycle,                           TRUE,
                    INTEGER_Minimum,                       0,
                    INTEGER_Maximum,                       5,
                    INTEGER_MinVisible,                    1 + 1,
                IntegerEnd,
                AddSpace,
            LayoutEnd,
            CHILD_WeightedHeight,                          0,
            AddVLayout,
                LAYOUT_BevelStyle,                         BVS_GROUP,
                LAYOUT_SpaceOuter,                         TRUE,
                AddHLayout,
                    AddVLayout,
                        AddVLayout,
                            LAYOUT_AddChild,               gadgets[GID_DW_ST1] = (struct Gadget*)
                            StringObject,
                                GA_ID,                     GID_DW_ST1,
                                GA_TabCycle,               TRUE,
                                GA_RelVerify,              TRUE,
                                STRINGA_TextVal,           man[who].name,
                                STRINGA_MaxChars,          9 + 1,
#ifdef __amigaos4__
                                STRINGA_RelVerifySpecial,  TRUE,
#endif
                            StringEnd,
                            Label("Name:"),
                            AddHLayout,
                                LAYOUT_VertAlignment,      LALIGN_CENTER,
                                LAYOUT_AddChild,           gadgets[GID_DW_IN2] = (struct Gadget*)
                                IntegerObject,
                                    GA_ID,                 GID_DW_IN2,
                                    GA_TabCycle,           TRUE,
                                    INTEGER_Minimum,       0,
                                    INTEGER_Maximum,       32767,
                                    INTEGER_MinVisible,    5 + 1,
                                IntegerEnd,
                                AddLabel("of"),
                                LAYOUT_AddChild,           gadgets[GID_DW_IN3] = (struct Gadget*)
                                IntegerObject,
                                    GA_ID,                 GID_DW_IN3,
                                    GA_TabCycle,           TRUE,
                                    INTEGER_Minimum,       0,
                                    INTEGER_Maximum,       32767,
                                    INTEGER_MinVisible,    5 + 1,
                                IntegerEnd,
                            LayoutEnd,
                            Label("Hit Points:"),
                            CHILD_WeightedHeight,          0,
                            AddHLayout,
                                LAYOUT_VertAlignment,      LALIGN_CENTER,
                                LAYOUT_AddChild,           gadgets[GID_DW_IN4] = (struct Gadget*)
                                IntegerObject,
                                    GA_ID,                 GID_DW_IN4,
                                    GA_TabCycle,           TRUE,
                                    INTEGER_Minimum,       0,
                                    INTEGER_Maximum,       32767,
                                    INTEGER_MinVisible,    5 + 1,
                                IntegerEnd,
                                AddLabel("of"),
                                LAYOUT_AddChild,           gadgets[GID_DW_IN5] = (struct Gadget*)
                                IntegerObject,
                                    GA_ID,                 GID_DW_IN5,
                                    GA_TabCycle,           TRUE,
                                    INTEGER_Minimum,       0,
                                    INTEGER_Maximum,       32767,
                                    INTEGER_MinVisible,    5 + 1,
                                IntegerEnd,
                            LayoutEnd,
                            Label("Spell Points:"),
                            CHILD_WeightedHeight,          0,
                            LAYOUT_AddChild,               gadgets[GID_DW_CH1] = (struct Gadget*)
                            PopUpObject,
                                GA_ID,                     GID_DW_CH1,
                                CHOOSER_LabelArray,        &RaceOptions,
                            PopUpEnd,
                            Label("Race:"),
                            LAYOUT_AddChild,               gadgets[GID_DW_CH2] = (struct Gadget*)
                            PopUpObject,
                                GA_ID,                     GID_DW_CH2,
                                CHOOSER_LabelArray,        &ClassOptions,
                            PopUpEnd,
                            Label("Class:"),
                            LAYOUT_AddChild,               gadgets[GID_DW_IN21] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                     GID_DW_IN21,
                                GA_TabCycle,               TRUE,
                                INTEGER_Minimum,           0,
                                INTEGER_Maximum,           255,
                                INTEGER_MinVisible,        3 + 1,
                            IntegerEnd,
                            Label("Level:"),
                            LAYOUT_AddChild,               gadgets[GID_DW_IN22] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                     GID_DW_IN22,
                                GA_TabCycle,               TRUE,
                                INTEGER_Minimum,           0,
                                INTEGER_Maximum,           2147483647,
                                INTEGER_MinVisible,        10 + 1,
                            IntegerEnd,
                            Label("XP:"),
                        LayoutEnd,
                        CHILD_WeightedHeight,              0,
                        AddVLayout,
                            LAYOUT_BevelStyle,             BVS_GROUP,
                            LAYOUT_Label,                  "Skills",
                            LAYOUT_AddChild,               gadgets[GID_DW_LB2] = (struct Gadget*)
                            ListBrowserObject,
                                GA_ID,                     GID_DW_LB2,
                                LISTBROWSER_Labels,        (ULONG) &SkillsList,
                                LISTBROWSER_ShowSelected,  TRUE,
                                LISTBROWSER_AutoWheel,     FALSE,
                            ListBrowserEnd,
                            CHILD_MinHeight,               96,
                            HTripleButton(GID_DW_BU13, GID_DW_BU14, GID_DW_BU11),
                        LayoutEnd,
                    LayoutEnd,
                    AddVLayout,
                        AddVLayout,
                            AddVLayout,
                                LAYOUT_BevelStyle,         BVS_SBAR_VERT,
                                LAYOUT_SpaceOuter,         TRUE,
                                LAYOUT_Label,              "Attributes",
                                LAYOUT_AddChild,           gadgets[GID_DW_IN6] = (struct Gadget*)
                                IntegerObject,
                                    GA_ID,                 GID_DW_IN6,
                                    GA_TabCycle,           TRUE,
                                    INTEGER_Minimum,       0,
                                    INTEGER_Maximum,       255,
                                    INTEGER_MinVisible,    3 + 1,
                                IntegerEnd,
                                Label("Speed:"),
                                LAYOUT_AddChild,           gadgets[GID_DW_IN7] = (struct Gadget*)
                                IntegerObject,
                                    GA_ID,                 GID_DW_IN7,
                                    GA_TabCycle,           TRUE,
                                    INTEGER_Minimum,       0,
                                    INTEGER_Maximum,       255,
                                    INTEGER_MinVisible,    3 + 1,
                                IntegerEnd,
                                Label("Strength:"),
                                LAYOUT_AddChild,           gadgets[GID_DW_IN8] = (struct Gadget*)
                                IntegerObject,
                                    GA_ID,                 GID_DW_IN8,
                                    GA_TabCycle,           TRUE,
                                    INTEGER_Minimum,       0,
                                    INTEGER_Maximum,       255,
                                    INTEGER_MinVisible,    3 + 1,
                                IntegerEnd,
                                Label("Intellect:"),
                                LAYOUT_AddChild,           gadgets[GID_DW_IN9] = (struct Gadget*)
                                IntegerObject,
                                    GA_ID,                 GID_DW_IN9,
                                    GA_TabCycle,           TRUE,
                                    INTEGER_Minimum,       0,
                                    INTEGER_Maximum,       255,
                                    INTEGER_MinVisible,    3 + 1,
                                IntegerEnd,
                                Label("Endurance:"),
                                LAYOUT_AddChild,           gadgets[GID_DW_IN10] = (struct Gadget*)
                                IntegerObject,
                                    GA_ID,                 GID_DW_IN10,
                                    GA_TabCycle,           TRUE,
                                    INTEGER_Minimum,       0,
                                    INTEGER_Maximum,       255,
                                    INTEGER_MinVisible,    3 + 1,
                                IntegerEnd,
                                Label("Skill:"),
                            LayoutEnd,
                        LayoutEnd,
                        CHILD_WeightedHeight,              0,
                        AddVLayout,
                            LAYOUT_BevelStyle,             BVS_GROUP,
                            LAYOUT_Label,                  "Inventory",
                            ItemButton(0),
                            ItemButton(1),
                            ItemButton(2),
                            ItemButton(3),
                            ItemButton(4),
                            ItemButton(5),
                            ItemButton(6),
                            ItemButton(7),
                            ItemButton(8),
                            ItemButton(9),
                        LayoutEnd,
                    LayoutEnd,
                LayoutEnd,
                MaximizeButton(GID_DW_BU12, "Maximize Character"),
                CHILD_WeightedHeight,                      0,
            LayoutEnd,
            CHILD_WeightedHeight,                          75,
            AddHLayout,
                LAYOUT_SpaceOuter,                         TRUE,
                LAYOUT_SpaceInner,                         TRUE,
                LAYOUT_BevelStyle,                         BVS_FIELD,
                LAYOUT_Label,                              "When & Where",
                AddVLayout,
                    AddHLayout,
                        LAYOUT_VertAlignment,              LALIGN_CENTER,
                        AddVLayout,
                            AddLabel("Month:"),
                            CHILD_WeightedHeight,          0,
                            LAYOUT_AddChild,               gadgets[GID_DW_LB6] = (struct Gadget*)
                            ListBrowserObject,
                                GA_ID,                     GID_DW_LB6,
                                GA_RelVerify,              TRUE,
                                LISTBROWSER_Labels,        (ULONG) &MonthList,
                                LISTBROWSER_ShowSelected,  TRUE,
                                LISTBROWSER_AutoWheel,     FALSE,
                            ListBrowserEnd,
                            CHILD_MinWidth,                92,
                        LayoutEnd,
                        AddLabel("Day:"),
                        LAYOUT_AddChild,                   gadgets[GID_DW_IN28] = (struct Gadget*)
                        IntegerObject,
                            GA_ID,                         GID_DW_IN28,
                            GA_TabCycle,                   TRUE,
                            INTEGER_Minimum,               1,
                            INTEGER_Maximum,               34,
                            INTEGER_Number,                day,
                            INTEGER_MinVisible,            2 + 1,
                        IntegerEnd,
                        CHILD_WeightedWidth,               0,
                        AddLabel("Time:"),
                        LAYOUT_AddChild,                   gadgets[GID_DW_IN24] = (struct Gadget*)
                        IntegerObject,
                            GA_ID,                         GID_DW_IN24,
                            GA_TabCycle,                   TRUE,
                            GA_RelVerify,                  TRUE,
                            INTEGER_Minimum,               0,
                            INTEGER_Maximum,               23,
                            INTEGER_Number,                hour,
                            INTEGER_MinVisible,            2 + 1,
                        IntegerEnd,
                        CHILD_WeightedWidth,               0,
                        AddLabel(":"),
                        LAYOUT_AddChild,                   gadgets[GID_DW_IN25] = (struct Gadget*)
                        IntegerObject,
                            GA_ID,                         GID_DW_IN25,
                            GA_TabCycle,                   TRUE,
                            GA_RelVerify,                  TRUE,
                            INTEGER_Minimum,               0,
                            INTEGER_Maximum,               59,
                            INTEGER_Number,                minute,
                            INTEGER_MinVisible,            2 + 1,
                        IntegerEnd,
                        CHILD_WeightedWidth,               0,
#ifndef __MORPHOS__
                        ClockBase ? LAYOUT_AddChild      : TAG_IGNORE, gadgets[GID_DW_CL1],
                        ClockBase ? CHILD_MinWidth       : TAG_IGNORE,  64,
                        ClockBase ? CHILD_MinHeight      : TAG_IGNORE,  64,
#endif
                        AddVLayout,
                            LAYOUT_AddChild,               gadgets[GID_DW_SP1] = (struct Gadget*)
                            SpaceObject,
                                GA_ID,                     GID_DW_SP1,
                                SPACE_MinWidth,            SCALEDWIDTH,
                                SPACE_MinHeight,           SCALEDHEIGHT,
                                SPACE_BevelStyle,          BVS_FIELD,
                                SPACE_Transparent,         TRUE,
                            SpaceEnd,
                            CHILD_WeightedWidth,           0,
                            CHILD_WeightedHeight,          0,
                        LayoutEnd,
                    LayoutEnd,
                    AddHLayout,
                        LAYOUT_VertAlignment,              LALIGN_CENTER,
                        AddLabel("_X:"),
                        LAYOUT_AddChild,                   gadgets[GID_DW_IN26] = (struct Gadget*)
                        IntegerObject,
                            GA_ID,                         GID_DW_IN26,
                            GA_TabCycle,                   TRUE,
                            GA_RelVerify,                  TRUE,
                            INTEGER_Minimum,               4,
                            INTEGER_Maximum,               59,
                            INTEGER_Number,                loc_x,
                            INTEGER_MinVisible,            2 + 1,
                        IntegerEnd,
                        CHILD_WeightedWidth,               0,
                        AddLabel("_Y:"),
                        LAYOUT_AddChild,                   gadgets[GID_DW_IN27] = (struct Gadget*)
                        IntegerObject,
                            GA_ID,                         GID_DW_IN27,
                            GA_TabCycle,                   TRUE,
                            GA_RelVerify,                  TRUE,
                            INTEGER_Minimum,               4,
                            INTEGER_Maximum,               59,
                            INTEGER_Number,                loc_y,
                            INTEGER_MinVisible,            2 + 1,
                        IntegerEnd,
                        CHILD_WeightedWidth,               0,
                        AddLabel("_Region:"),
                        LAYOUT_AddChild,                   gadgets[GID_DW_IN23] = (struct Gadget*)
                        IntegerObject,
                            GA_ID,                         GID_DW_IN23,
                            GA_TabCycle,                   TRUE,
                            GA_RelVerify,                  TRUE,
                            INTEGER_Minimum,               0,
                            INTEGER_Maximum,               255,
                            INTEGER_Number,                region,
                            INTEGER_MinVisible,            3 + 1,
                        IntegerEnd,
                        CHILD_WeightedWidth,               0,
                        AddLabel("Contents:"),
                        LAYOUT_AddChild,                   gadgets[GID_DW_ST2] = (struct Gadget*)
                        StringObject,
                            GA_ID,                         GID_DW_ST2,
                            GA_ReadOnly,                   TRUE,
                            STRINGA_TextVal,               "",
                            STRINGA_MaxChars,              64 + 1,
                        StringEnd,
                    LayoutEnd,
                    CHILD_WeightedHeight,                  0,
                LayoutEnd,
            LayoutEnd,
            CHILD_WeightedHeight,                          25,
            AddHLayout,
                LAYOUT_VertAlignment,                      LALIGN_CENTER,
                AddLabel("_Gold:"),
                LAYOUT_AddChild,                           gadgets[GID_DW_IN1] = (struct Gadget*)
                IntegerObject,
                    GA_ID,                                 GID_DW_IN1,
                    GA_TabCycle,                           TRUE,
                    INTEGER_Minimum,                       0,
                    INTEGER_Maximum,                       999999999,
                    INTEGER_MinVisible,                    9 + 1,
                IntegerEnd,
                AddLabel("_Food:"),
                LAYOUT_AddChild,                           gadgets[GID_DW_IN11] = (struct Gadget*)
                IntegerObject,
                    GA_ID,                                 GID_DW_IN11,
                    GA_TabCycle,                           TRUE,
                    INTEGER_Minimum,                       0,
                    INTEGER_Maximum,                       255,
                    INTEGER_MinVisible,                    3 + 1,
                IntegerEnd,
            LayoutEnd,
            CHILD_WeightedHeight,                          0,
        LayoutEnd,
        CHILD_NominalSize,                                 TRUE,
    WindowEnd))
    {   rq("Can't create gadgets!");
    }
    unlockscreen();
    openwindow(GID_DW_SB1);

    setup_bm(0, SCALEDWIDTH, SCALEDHEIGHT, MainWindowPtr);

#ifndef __MORPHOS__
    MouseData = (UWORD*) LocalMouseData;
    setpointer(FALSE, WinObject, MainWindowPtr, TRUE);
#endif
    // dw_drawmap();
    writegadgets(0);
    DISCARD ActivateLayoutGadget(gadgets[GID_DW_LY1], MainWindowPtr, NULL, (Object) gadgets[GID_DW_ST1]);
    loop();
    readgadgets();
    closewindow();
}

EXPORT void dw_loop(ULONG gid, UNUSED ULONG code)
{   int    i;
    STRPTR stringptr;
#ifndef __MORPHOS__
    ULONG  seconds;
#endif

    switch (gid)
    {
    case GID_DW_ST1:
        DISCARD GetAttr(STRINGA_TextVal, (Object*) gadgets[GID_DW_ST1], (ULONG*) &stringptr);
        strcpy(man[who].name, stringptr);
    acase GID_DW_CH3:
        readgadgets();
        DISCARD GetAttr(CHOOSER_Selected, (Object*) gadgets[GID_DW_CH3], (ULONG*) &who);
        writegadgets(0);
    acase GID_DW_BU11:
        readgadgets();
        for (i = 0; i < 31; i++)
        {   man[who].skill[i] = FALSE;
        }
        writegadgets(2);
    acase GID_DW_BU12:
        readgadgets();
        maximize_man(who);
        writegadgets(0);
    acase GID_DW_BU13:
        readgadgets();
        for (i = 0; i < 31; i++)
        {   man[who].skill[i] = TRUE;
        }
        writegadgets(2);
    acase GID_DW_BU14:
        readgadgets();
        for (i = 0; i < 31; i++)
        {   if (man[who].skill[i])
            {   man[who].skill[i] = FALSE;
            } else
            {   man[who].skill[i] = TRUE;
            }
        }
        writegadgets(2);
    acase GID_DW_BU15:
        readgadgets();
        for (i = 0; i < (int) men; i++)
        {   maximize_man(i);
        }
        food =       200;
        gold = 900000000;
        writegadgets(0);
    acase GID_DW_IN20:
        DISCARD GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN20], (ULONG*) &men);
    acase GID_DW_LB6:
        DISCARD GetAttr(LISTBROWSER_Selected, (Object*) gadgets[GID_DW_LB6 ], (ULONG*) &month);
#ifndef __MORPHOS__
    acase GID_DW_CL1:
        // assert(ClockBase);
        DISCARD GetAttr(CLOCKGA_Time,     (Object*) gadgets[GID_DW_CL1 ], (ULONG*) &seconds);
        seconds %= 86400               ; // seconds in day
        hour    =  seconds / 3600      ; // seconds in hour
        minute  = (seconds % 3600) / 60; // seconds in minute
        DISCARD SetGadgetAttrs(gadgets[GID_DW_IN24], MainWindowPtr, NULL, INTEGER_Number, hour,   TAG_END); // autorefreshes
        DISCARD SetGadgetAttrs(gadgets[GID_DW_IN25], MainWindowPtr, NULL, INTEGER_Number, minute, TAG_END); // autorefreshes
#endif
    acase GID_DW_IN23:
        DISCARD GetAttr(INTEGER_Number,   (Object*) gadgets[GID_DW_IN23], (ULONG*) &region);
        dw_drawmap();
    acase GID_DW_IN24:
        DISCARD GetAttr(INTEGER_Number,   (Object*) gadgets[GID_DW_IN24], (ULONG*) &hour);
#ifndef __MORPHOS__
        if (ClockBase)
        {   DISCARD SetGadgetAttrs(gadgets[GID_DW_CL1], MainWindowPtr, NULL, CLOCKGA_Time, ((hour * 60) + minute) * 60, TAG_END); // autorefreshes
        }
#endif
    acase GID_DW_IN25:
        DISCARD GetAttr(INTEGER_Number,   (Object*) gadgets[GID_DW_IN25], (ULONG*) &minute);
#ifndef __MORPHOS__
        if (ClockBase)
        {   DISCARD SetGadgetAttrs(gadgets[GID_DW_CL1], MainWindowPtr, NULL, CLOCKGA_Time, ((hour * 60) + minute) * 60, TAG_END); // autorefreshes
        }
#endif
    acase GID_DW_IN26:
        DISCARD GetAttr(INTEGER_Number,   (Object*) gadgets[GID_DW_IN26], (ULONG*) &loc_x);
        dw_drawmap();
    acase GID_DW_IN27:
        DISCARD GetAttr(INTEGER_Number,   (Object*) gadgets[GID_DW_IN27], (ULONG*) &loc_y);
        dw_drawmap();
    adefault:
        if (gid >= GID_DW_BU1 && gid <= GID_DW_BU10)
        {   whichitem = gid - GID_DW_BU1;
            itemwindow();
}   }   }

EXPORT FLAG dw_open(FLAG loadas)
{   if (gameopen(loadas))
    {   who = 0;
        serializemode = SERIALIZE_READ;
        serialize();
        writegadgets(0);
        return TRUE;
    } // implied else
    return FALSE;
}

MODULE void writegadgets(UBYTE mode)
{   ULONG        i, j;
    FLAG         found;
    struct Node* NodePtr;

    if
    (   page != FUNC_DW
     || !MainWindowPtr
    )
    {   return;
    } // implied else

    if (mode == 0)
    {   // general

        SetGadgetAttrs(gadgets[GID_DW_IN20], MainWindowPtr, NULL, INTEGER_Number,          men,               TAG_END); // this autorefreshes

        SetGadgetAttrs(gadgets[GID_DW_IN1 ], MainWindowPtr, NULL, INTEGER_Number,          gold,              TAG_END); // this autorefreshes
        SetGadgetAttrs(gadgets[GID_DW_IN11], MainWindowPtr, NULL, INTEGER_Number,          food,              TAG_END); // this autorefreshes

        SetGadgetAttrs(gadgets[GID_DW_CH3 ], MainWindowPtr, NULL, CHOOSER_Selected, (WORD) who,               TAG_END); // we must explicitly refresh

        SetGadgetAttrs(gadgets[GID_DW_ST1 ], MainWindowPtr, NULL, STRINGA_TextVal,         man[who].name,     TAG_END); // this autorefreshes

        SetGadgetAttrs(gadgets[GID_DW_IN2 ], MainWindowPtr, NULL, INTEGER_Number,          man[who].curhp,    TAG_END); // this autorefreshes
        SetGadgetAttrs(gadgets[GID_DW_IN3 ], MainWindowPtr, NULL, INTEGER_Number,          man[who].maxhp,    TAG_END); // this autorefreshes
        SetGadgetAttrs(gadgets[GID_DW_IN4 ], MainWindowPtr, NULL, INTEGER_Number,          man[who].cursp,    TAG_END); // this autorefreshes
        SetGadgetAttrs(gadgets[GID_DW_IN5 ], MainWindowPtr, NULL, INTEGER_Number,          man[who].maxsp,    TAG_END); // this autorefreshes

        SetGadgetAttrs(gadgets[GID_DW_CH1 ], MainWindowPtr, NULL, CHOOSER_Selected, (WORD) man[who].race,     TAG_END); // we must explicitly refresh
        SetGadgetAttrs(gadgets[GID_DW_CH2 ], MainWindowPtr, NULL, CHOOSER_Selected, (WORD) man[who].theclass, TAG_END); // we must explicitly refresh

        SetGadgetAttrs(gadgets[GID_DW_IN21], MainWindowPtr, NULL, INTEGER_Number,          man[who].level,    TAG_END); // this autorefreshes
        SetGadgetAttrs(gadgets[GID_DW_IN22], MainWindowPtr, NULL, INTEGER_Number,          man[who].xp,       TAG_END); // this autorefreshes

        // attributes
        SetGadgetAttrs(gadgets[GID_DW_IN6 ], MainWindowPtr, NULL, INTEGER_Number,          man[who].spd,      TAG_END); // this autorefreshes
        SetGadgetAttrs(gadgets[GID_DW_IN7 ], MainWindowPtr, NULL, INTEGER_Number,          man[who].str,      TAG_END); // this autorefreshes
        SetGadgetAttrs(gadgets[GID_DW_IN8 ], MainWindowPtr, NULL, INTEGER_Number,          man[who].iq,       TAG_END); // this autorefreshes
        SetGadgetAttrs(gadgets[GID_DW_IN9 ], MainWindowPtr, NULL, INTEGER_Number,          man[who].end,      TAG_END); // this autorefreshes
        SetGadgetAttrs(gadgets[GID_DW_IN10], MainWindowPtr, NULL, INTEGER_Number,          man[who].ski,      TAG_END); // this autorefreshes

        SetGadgetAttrs(gadgets[GID_DW_LB6 ], MainWindowPtr, NULL, LISTBROWSER_Selected,    month,             TAG_END);
        SetGadgetAttrs(gadgets[GID_DW_LB6 ], MainWindowPtr, NULL, LISTBROWSER_MakeVisible, month,             TAG_END);

        SetGadgetAttrs(gadgets[GID_DW_IN23], MainWindowPtr, NULL, INTEGER_Number,          region,            TAG_END); // this autorefreshes
        SetGadgetAttrs(gadgets[GID_DW_IN26], MainWindowPtr, NULL, INTEGER_Number,          loc_x,             TAG_END); // this autorefreshes
        SetGadgetAttrs(gadgets[GID_DW_IN27], MainWindowPtr, NULL, INTEGER_Number,          loc_y,             TAG_END); // this autorefreshes
        SetGadgetAttrs(gadgets[GID_DW_IN28], MainWindowPtr, NULL, INTEGER_Number,          day,               TAG_END); // this autorefreshes
        SetGadgetAttrs(gadgets[GID_DW_IN24], MainWindowPtr, NULL, INTEGER_Number,          hour,              TAG_END); // this autorefreshes
        SetGadgetAttrs(gadgets[GID_DW_IN25], MainWindowPtr, NULL, INTEGER_Number,          minute,            TAG_END); // this autorefreshes

        RefreshGadgets((struct Gadget*) gadgets[GID_DW_CH3], MainWindowPtr, NULL);
        RefreshGadgets((struct Gadget*) gadgets[GID_DW_CH1], MainWindowPtr, NULL);
        RefreshGadgets((struct Gadget*) gadgets[GID_DW_CH2], MainWindowPtr, NULL);
        RefreshGadgets((struct Gadget*) gadgets[GID_DW_LB6], MainWindowPtr, NULL);

#ifndef __MORPHOS__
        if (ClockBase)
        {   DISCARD SetGadgetAttrs(gadgets[GID_DW_CL1], MainWindowPtr, NULL, CLOCKGA_Time, ((hour * 60) + minute) * 60, TAG_END); // autorefreshes
        }
#endif

        dw_drawmap();
    }

    if (mode != 2)
    {   // items
        for (i = 0; i < 10; i++)
        {   if (man[who].item[i].thing != 255)
            {   found = FALSE;

                for (j = 1; j < 31; j++)
                {   if (items[j].filecode == man[who].item[i].thing)
                    {   DISCARD SetGadgetAttrs
                        (   gadgets[GID_DW_BU1 + i], MainWindowPtr, NULL,
                            GA_Text, items[j].name,
                        TAG_END);
                        found = TRUE;
                        break;
                }   }

                if (!found)
                {   // we should not reach this point normally
                    DISCARD SetGadgetAttrs
                    (   gadgets[GID_DW_BU1 + i], MainWindowPtr, NULL,
                        GA_Text, "?",
                    TAG_END);
            }   }
            else
            {   DISCARD SetGadgetAttrs
                (   gadgets[GID_DW_BU1 + i], MainWindowPtr, NULL,
                    GA_Text, "-",
                TAG_END);
            }
    }   }

    if (mode != 1)
    {   // skills
        // assert(SkillsListPtr.lh_Head->ln_Succ); // the list is non-empty
        DISCARD SetGadgetAttrs(gadgets[GID_DW_LB2], MainWindowPtr, NULL, LISTBROWSER_Labels, (ULONG) ~0, TAG_END); // detach
        i = 0;
        // Walk the list
        for
        (   NodePtr = SkillsList.lh_Head;
            NodePtr->ln_Succ;
            NodePtr = NodePtr->ln_Succ
        )
        {   DISCARD SetListBrowserNodeAttrs(NodePtr, LBNA_Checked, (BOOL) man[who].skill[i], TAG_END);
            i++;
        }
        DISCARD SetGadgetAttrs(gadgets[GID_DW_LB2], MainWindowPtr, NULL, LISTBROWSER_Labels, &SkillsList, TAG_END); // reattach
        RefreshGadgets((struct Gadget*) gadgets[GID_DW_LB2], MainWindowPtr, NULL);
}   }

MODULE void readgadgets(void)
{   int          i;
    STRPTR       stringptr;
    struct Node* NodePtr;

    // deliberately doesn't read "character #" gadget.

    GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN20], (ULONG*) &men);
    GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN1 ], (ULONG*) &gold);
    GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN11], (ULONG*) &food);

 // GetAttr(LISTBROWSER_Selected, (Object*) gadgets[GID_DW_LB6 ], (ULONG*) &month);
 // GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN23], (ULONG*) &region);
 // GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN24], (ULONG*) &hour);
 // GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN25], (ULONG*) &minute);
 // GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN26], (ULONG*) &loc_x);
 // GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN27], (ULONG*) &loc_y);
    GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN28], (ULONG*) &day);

    // general
    GetAttr(STRINGA_TextVal,      (Object*) gadgets[GID_DW_ST1 ], (ULONG*) &stringptr); strcpy(man[who].name, stringptr);
    GetAttr(CHOOSER_Selected,     (Object*) gadgets[GID_DW_CH1 ], (ULONG*) &man[who].race);
    GetAttr(CHOOSER_Selected,     (Object*) gadgets[GID_DW_CH2 ], (ULONG*) &man[who].theclass);
    GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN2 ], (ULONG*) &man[who].curhp);
    GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN3 ], (ULONG*) &man[who].maxhp);
    GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN4 ], (ULONG*) &man[who].cursp);
    GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN5 ], (ULONG*) &man[who].maxsp);
    GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN21], (ULONG*) &man[who].level);
    GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN22], (ULONG*) &man[who].xp);

    // attributes
    GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN6 ], (ULONG*) &man[who].spd);
    GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN7 ], (ULONG*) &man[who].str);
    GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN8 ], (ULONG*) &man[who].iq);
    GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN9 ], (ULONG*) &man[who].end);
    GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN10], (ULONG*) &man[who].ski);

    // assert(SkillsList.lh_Head->ln_Succ); // the list is non-empty
    i = 0;
    // Walk the list
    for
    (   NodePtr = SkillsList.lh_Head;
        NodePtr->ln_Succ;
        NodePtr = NodePtr->ln_Succ
    )
    {   DISCARD GetListBrowserNodeAttrs(NodePtr, LBNA_Checked, (ULONG*) &man[who].skill[i]);
        i++;
}   }

MODULE void serialize(void)
{   int   i, j;
    ULONG temp;

    offset = 0;

    for (i = 0; i < 5; i++)
    {   if (serializemode == SERIALIZE_READ)
        {   strcpy(man[i].name, (char*) &IOBuffer[offset]); // 0..11
        } else
        {   // assert(serializemode == SERIALIZE_WRITE);
            strcpy((char*) &IOBuffer[offset], man[i].name);
        }
        offset += 12;

        for (j = 0; j < 10; j++) // 12..181 (170 bytes)
        {   serialize1(&man[i].item[j].thing);               //  +0
            if (serializemode == SERIALIZE_READ)
            {   serialize1(&temp);                           //  +1
                man[i].item[j].dormant[0] = filetovar_power[temp];
            } else
            {   // assert(serializemode == SERIALIZE_WRITE);
                temp = vartofile_power[man[i].item[j].dormant[0]];
                serialize1(&temp);
            }
            serialize1(&man[i].item[j].dormantpts[0]);       //  +2                  //  +2
            if (serializemode == SERIALIZE_READ)
            {   serialize1(&temp);                           //  +3
                man[i].item[j].dormant[1] = filetovar_power[temp];
            } else
            {   // assert(serializemode == SERIALIZE_WRITE);
                temp = vartofile_power[man[i].item[j].dormant[1]];
                serialize1(&temp);
            }
            serialize1(&man[i].item[j].dormantpts[1]);       //  +4
            if (serializemode == SERIALIZE_READ)
            {   serialize1(&man[i].item[j].usesperday);      //  +5
                if (man[i].item[j].usesperday < 100)
                {   man[i].item[j].breakability = 0;
                    man[i].item[j].kind = KIND_USESPERDAY;
                } else
                {   man[i].item[j].breakability = man[i].item[j].usesperday - 100;
                    man[i].item[j].usesperday = 0;
                    man[i].item[j].kind = KIND_BREAKABLE;
            }   }
            else
            {   // assert(serializemode == SERIALIZE_WRITE);
                if (man[i].item[j].kind == KIND_USESPERDAY)
                {   serialize1(&man[i].item[j].usesperday);
                } else
                {   // assert(man[i].item[j].kind == KIND_BREAKABLE);
                    temp = man[i].item[j].breakability + 100;
                    serialize1(&temp);
            }   }
            offset++;                                        //  +6
            if (serializemode == SERIALIZE_READ)
            {   serialize1(&temp);                           //  +7
                man[i].item[j].invoked = filetovar_power[temp];
            } else
            {   // assert(serializemode == SERIALIZE_WRITE);
                temp = vartofile_power[man[i].item[j].invoked];
                serialize1(&temp);
            }
            serialize1(&man[i].item[j].invokedpts);          //  +8
            if (serializemode == SERIALIZE_READ)
            {   serialize1(&temp);                           //  +9
                man[i].item[j].constant[0] = filetovar_const[temp];
                if (!getubyte())                             // +10
                {   man[i].item[j].constant[0] = 0;
                }
                serialize1(&temp);                           // +11
                man[i].item[j].constant[1] = filetovar_const[temp];
                if (!getubyte())                             // +12
                {   man[i].item[j].constant[1] = 0;
            }   }
            else
            {   // assert(serializemode == SERIALIZE_WRITE);
                if (man[i].item[j].constant[0])
                {   IOBuffer[offset++] = vartofile_const[man[i].item[j].constant[0]];
                    IOBuffer[offset++] = 1;
                } else
                {   IOBuffer[offset++] = 0;
                    IOBuffer[offset++] = 0;
                }
                if (man[i].item[j].constant[1])
                {   IOBuffer[offset++] = vartofile_const[man[i].item[j].constant[1]];
                    IOBuffer[offset++] = 1;
                } else
                {   IOBuffer[offset++] = 0;
                    IOBuffer[offset++] = 0;
            }   }
            serialize1(&man[i].item[j].cursed);              // +13
            if (serializemode == SERIALIZE_READ)
            {   serialize1(&temp);                           // +14
                man[i].item[j].plusminus = temp - 10;
                serialize1(&temp);                           // +15
                man[i].item[j].quality = filetovar_quali[temp];
            } else
            {   // assert(serializemode == SERIALIZE_WRITE);
                temp = man[i].item[j].plusminus + 10;
                serialize1(&temp);
                temp = vartofile_quali[man[i].item[j].quality];
                serialize1(&temp);
            }
            serialize1(&man[i].item[j].identified);          // +16
        }
        offset += 14;                     // 182..195
        serialize4(&man[i].xp);           // 196..199
        for (j = 0; j < 31; j++)
        {   serialize1(&man[i].skill[j]); // 200..230
        }
        offset += 13;
        serialize1(&man[i].level);        // 244
        serialize1(&man[i].race);         // 245
        if (serializemode == SERIALIZE_READ)
        {   serialize1(&temp);            // 246
            man[i].theclass = filetovar_class[temp];
        } else
        {   // assert(serializemode == SERIALIZE_WRITE);
            temp = vartofile_class[man[i].theclass];
            serialize1(&temp);
        }
        serialize1(&man[i].spd);          // 247
        serialize1(&man[i].str);          // 248
        serialize1(&man[i].iq);           // 249
        serialize1(&man[i].end);          // 250
        serialize1(&man[i].ski);          // 251
        serialize1(&man[i].maxhp);        // 252
        serialize1(&man[i].curhp);        // 253
        serialize1(&man[i].maxsp);        // 254
        serialize1(&man[i].cursp);        // 255
        offset += 4;                      // 256..259
    }

    offset = 1310;
    serialize4(&gold);                    // 1310..1313
    offset = 1454;
    serialize1(&men);                     // 1454
    serialize1(&food);                    // 1455
    offset = 0x5B1;
    serialize1(&month);                   // $5B1
    serialize1(&day);                     // $5B2

    if (serializemode == SERIALIZE_READ)
    {   serialize1(&temp);                // $5B3
        hour = (temp == 24) ? 0 : temp;
        serialize1(&temp);                // $5B4
        minute = (temp - 1) * 6;
    } else
    {   // assert(serializemode == SERIALIZE_WRITE);
        temp = (hour == 0) ? 24 : hour;
        serialize1(&temp);                // $5B3
        temp = (minute / 6) + 1;
        serialize1(&temp);                // $5B4
    }

    serialize1(&loc_x);                   // $5B5
    serialize1(&loc_y);                   // $5B6
    serialize1(&region);                  // $5B7
}

EXPORT void dw_save(FLAG saveas)
{   readgadgets();
    serializemode = SERIALIZE_WRITE;
    serialize();
    gamesave("#?PARTY.DAT#?", "Demon's Winter", saveas, 1494, FLAG_S, FALSE);
}

MODULE void itemwindow(void)
{   int i,
        ordinal = 0; // initalized to suppress spurious SAS/C optimizer warnings

    InitHook(&ToolSubHookStruct, (ULONG (*)()) ToolSubHookFunc, NULL);
    lockscreen();

    if (!(SubWinObject =
    NewSubWindow,
        WA_Title,                                  "Choose Item",
        WA_SizeGadget,                             TRUE,
        WA_ThinSizeGadget,                         TRUE,
        WINDOW_Position,                           WPOS_CENTERMOUSE,
        WINDOW_UniqueID,                           "demon-1",
        WINDOW_ParentGroup,                        gadgets[GID_DW_LY2] = (struct Gadget*)
        VLayoutObject,
            LAYOUT_SpaceOuter,                     TRUE,
            LAYOUT_SpaceInner,                     TRUE,
            LAYOUT_DeferLayout,                    TRUE,
            AddHLayout,
                LAYOUT_AddChild,                   gadgets[GID_DW_LB1] = (struct Gadget*)
                ListBrowserObject,
                    GA_ID,                         GID_DW_LB1,
                    GA_RelVerify,                  TRUE,
                    LISTBROWSER_Labels,            (ULONG) &ItemsList,
                    LISTBROWSER_MinVisible,        1,
                    LISTBROWSER_ShowSelected,      TRUE,
                    LISTBROWSER_AutoWheel,         FALSE,
                ListBrowserEnd,
                AddVLayout,
                    AddHLayout,
                        LAYOUT_VertAlignment,      LALIGN_CENTER,
                        LAYOUT_AddChild,           gadgets[GID_DW_CB1] = (struct Gadget*)
                        TickOrCheckBoxObject,
                            GA_ID,                 GID_DW_CB1,
                        End,
                        CHILD_WeightedWidth,       0,
                        AddLabel("Cursed"),
                        CHILD_WeightedWidth,       0,
                        AddSpace,
                    LayoutEnd,
                    AddHLayout,
                        LAYOUT_VertAlignment,      LALIGN_CENTER,
                        LAYOUT_AddChild,           gadgets[GID_DW_CB2] = (struct Gadget*)
                        TickOrCheckBoxObject,
                            GA_ID,                 GID_DW_CB2,
                        End,
                        CHILD_WeightedWidth,       0,
                        AddLabel("Identified"),
                        CHILD_WeightedWidth,       0,
                        AddSpace,
                    LayoutEnd,
                    AddHLayout,
                        LAYOUT_VertAlignment,      LALIGN_CENTER,
                        AddLabel("Plus/Minus:"),
                        LAYOUT_AddChild,           gadgets[GID_DW_IN14] = (struct Gadget*)
                        IntegerObject,
                            GA_ID,                 GID_DW_IN14,
                            GA_TabCycle,           TRUE,
                            INTEGER_Minimum,       -10,
                            INTEGER_Maximum,       245,
                            INTEGER_MinVisible,    3 + 1,
                        IntegerEnd,
                    LayoutEnd,
                    AddHLayout,
                        LAYOUT_VertAlignment,      LALIGN_CENTER,
                        AddLabel("Quality:"),
                        LAYOUT_AddChild,           gadgets[GID_DW_CH6] = (struct Gadget*)
                        PopUpObject,
                            GA_ID,                 GID_DW_CH6,
                            CHOOSER_LabelArray,    &QualityOptions,
                        PopUpEnd,
                    LayoutEnd,
                LayoutEnd,
                CHILD_WeightedWidth,               0,
            LayoutEnd,
            CHILD_WeightedHeight,                  50,
            AddHLayout,
                AddVLayout,
                    LAYOUT_BevelStyle,             BVS_GROUP,
                    LAYOUT_Label,                  "Invoked Power",
                    LAYOUT_AddChild,               gadgets[GID_DW_LB3] = (struct Gadget*)
                    ListBrowserObject,
                        GA_ID,                     GID_DW_LB3,
                        GA_RelVerify,              TRUE,
                        LISTBROWSER_Labels,        (ULONG) &InvokedPowersList[0],
                        LISTBROWSER_MinVisible,    1,
                        LISTBROWSER_ShowSelected,  TRUE,
                        LISTBROWSER_AutoWheel,     FALSE,
                    ListBrowserEnd,
                    AddHLayout,
                        LAYOUT_VertAlignment,      LALIGN_CENTER,
                        AddLabel("Pts:"),
                        LAYOUT_AddChild,           gadgets[GID_DW_IN15] = (struct Gadget*)
                        IntegerObject,
                            GA_ID,                 GID_DW_IN15,
                            GA_TabCycle,           TRUE,
                            INTEGER_Minimum,       1,
                            INTEGER_Maximum,       255,
                            INTEGER_MinVisible,    3 + 1,
                        IntegerEnd,
                    LayoutEnd,
                    CHILD_WeightedHeight,          0,
                    AddHLayout,
                        LAYOUT_VertAlignment,      LALIGN_CENTER,
                        LAYOUT_AddChild,           gadgets[GID_DW_RA1] = (struct Gadget*)
                        RadioButtonObject,
                            GA_ID,                 GID_DW_RA1,
                            GA_RelVerify,          TRUE,
                            GA_Text,               KindOptions,
                        RadioButtonEnd,
                        AddVLayout,
                            LAYOUT_AddChild,       gadgets[GID_DW_IN18] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,             GID_DW_IN18,
                                GA_TabCycle,       TRUE,
                                INTEGER_Minimum,   0,
                                INTEGER_Maximum,   100,
                                INTEGER_MinVisible,3 + 1,
                            IntegerEnd,
                            LAYOUT_AddChild,       gadgets[GID_DW_IN19] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,             GID_DW_IN19,
                                GA_TabCycle,       TRUE,
                                INTEGER_Minimum,   0,
                                INTEGER_Maximum,   99,
                                INTEGER_MinVisible,2 + 1,
                            IntegerEnd,
                        LayoutEnd,
                    LayoutEnd,
                    CHILD_WeightedHeight,          0,
                LayoutEnd,
                AddVLayout,
                    LAYOUT_BevelStyle,             BVS_GROUP,
                    LAYOUT_Label,                  "1st Dormant Power",
                    LAYOUT_AddChild,               gadgets[GID_DW_LB4] = (struct Gadget*)
                    ListBrowserObject,
                        GA_ID,                     GID_DW_LB4,
                        GA_RelVerify,              TRUE,
                        LISTBROWSER_Labels,        (ULONG) &InvokedPowersList[1],
                        LISTBROWSER_MinVisible,    1,
                        LISTBROWSER_ShowSelected,  TRUE,
                        LISTBROWSER_AutoWheel,     FALSE,
                    ListBrowserEnd,
                    AddHLayout,
                        LAYOUT_VertAlignment,      LALIGN_CENTER,
                        AddLabel("Pts:"),
                        LAYOUT_AddChild,           gadgets[GID_DW_IN16] = (struct Gadget*)
                        IntegerObject,
                            GA_ID,                 GID_DW_IN16,
                            GA_TabCycle,           TRUE,
                            INTEGER_Minimum,       1,
                            INTEGER_Maximum,       255,
                            INTEGER_MinVisible,    3 + 1,
                        IntegerEnd,
                    LayoutEnd,
                    CHILD_WeightedHeight,          0,
                LayoutEnd,
                AddVLayout,
                    LAYOUT_BevelStyle,             BVS_GROUP,
                    LAYOUT_Label,                  "2nd Dormant Power",
                    LAYOUT_AddChild,               gadgets[GID_DW_LB5] = (struct Gadget*)
                    ListBrowserObject,
                        GA_ID,                     GID_DW_LB5,
                        GA_RelVerify,              TRUE,
                        LISTBROWSER_Labels,        (ULONG) &InvokedPowersList[2],
                        LISTBROWSER_MinVisible,    1,
                        LISTBROWSER_ShowSelected,  TRUE,
                        LISTBROWSER_AutoWheel,     FALSE,
                    ListBrowserEnd,
                    AddHLayout,
                        LAYOUT_VertAlignment,      LALIGN_CENTER,
                        AddLabel("Pts:"),
                        LAYOUT_AddChild,           gadgets[GID_DW_IN17] = (struct Gadget*)
                        IntegerObject,
                            GA_ID,                 GID_DW_IN17,
                            GA_TabCycle,           TRUE,
                            INTEGER_Minimum,       1,
                            INTEGER_Maximum,       255,
                            INTEGER_MinVisible,    3 + 1,
                        IntegerEnd,
                    LayoutEnd,
                    CHILD_WeightedHeight,          0,
                LayoutEnd,
            LayoutEnd,
            CHILD_WeightedHeight,                  50,
            AddHLayout,
                LAYOUT_VertAlignment,              LALIGN_CENTER,
                AddLabel("1st constant power:"),
                LAYOUT_AddChild,                   gadgets[GID_DW_CH4] = (struct Gadget*)
                PopUpObject,
                    GA_ID,                         GID_DW_CH4,
                    CHOOSER_LabelArray,            &ConstantPowerOptions,
                PopUpEnd,
                AddLabel("2nd constant power:"),
                LAYOUT_AddChild,                   gadgets[GID_DW_CH5] = (struct Gadget*)
                PopUpObject,
                    GA_ID,                         GID_DW_CH5,
                    CHOOSER_LabelArray,            &ConstantPowerOptions,
                PopUpEnd,
            LayoutEnd,
            CHILD_WeightedHeight,                  0,
        LayoutEnd,
    WindowEnd))
    {   rq("Can't create gadgets!");
    }
    unlockscreen();
    if (!(SubWindowPtr = (struct Window*) RA_OpenWindow(SubWinObject)))
    {   rq("Can't open window!");
    }
#ifdef MEASUREWINDOWS
    printf(" %d%d\n", SubWindowPtr->Width, SubWindowPtr->Height);
#endif

    for (i = 0; i < 31; i++)
    {   if (man[who].item[whichitem].thing == items[i].filecode)
        {   DISCARD SetGadgetAttrs(gadgets[GID_DW_LB1], SubWindowPtr, NULL, LISTBROWSER_Selected, i, TAG_END);
            ordinal = i;
            break;
    }   }
    RefreshGadgets((struct Gadget*) gadgets[GID_DW_LB1], SubWindowPtr, NULL);
    DISCARD SetGadgetAttrs(gadgets[GID_DW_LB1], SubWindowPtr, NULL, LISTBROWSER_MakeVisible, (ULONG) ordinal, TAG_END);
    RefreshGadgets((struct Gadget*) gadgets[GID_DW_LB1], SubWindowPtr, NULL);

    SetGadgetAttrs(gadgets[GID_DW_CB1 ], SubWindowPtr, NULL, GA_Selected,          (BOOL) man[who].item[whichitem].cursed       , TAG_END);
    RefreshGadgets((struct Gadget*) gadgets[GID_DW_CB1], SubWindowPtr, NULL);
    SetGadgetAttrs(gadgets[GID_DW_CB2 ], SubWindowPtr, NULL, GA_Selected,          (BOOL) man[who].item[whichitem].identified   , TAG_END);
    RefreshGadgets((struct Gadget*) gadgets[GID_DW_CB2], SubWindowPtr, NULL);
    SetGadgetAttrs(gadgets[GID_DW_IN14], SubWindowPtr, NULL, INTEGER_Number,              man[who].item[whichitem].plusminus    , TAG_END);
    SetGadgetAttrs(gadgets[GID_DW_CH6 ], SubWindowPtr, NULL, CHOOSER_Selected,     (WORD) man[who].item[whichitem].quality      , TAG_END);
    SetGadgetAttrs(gadgets[GID_DW_LB3 ], SubWindowPtr, NULL, LISTBROWSER_Selected,        man[who].item[whichitem].invoked      , TAG_END);
    SetGadgetAttrs(gadgets[GID_DW_IN15], SubWindowPtr, NULL, INTEGER_Number,              man[who].item[whichitem].invokedpts   , TAG_END);
    SetGadgetAttrs(gadgets[GID_DW_RA1 ], SubWindowPtr, NULL, RADIOBUTTON_Selected, (WORD) man[who].item[whichitem].kind         , TAG_END);
    RefreshGadgets((struct Gadget*) gadgets[GID_DW_RA1], SubWindowPtr, NULL);
    SetGadgetAttrs(gadgets[GID_DW_IN18], SubWindowPtr, NULL, INTEGER_Number,              man[who].item[whichitem].breakability , TAG_END);
    SetGadgetAttrs(gadgets[GID_DW_IN19], SubWindowPtr, NULL, INTEGER_Number,              man[who].item[whichitem].usesperday   , TAG_END);
    SetGadgetAttrs(gadgets[GID_DW_LB4 ], SubWindowPtr, NULL, LISTBROWSER_Selected,        man[who].item[whichitem].dormant[0]   , TAG_END);
    SetGadgetAttrs(gadgets[GID_DW_IN16], SubWindowPtr, NULL, INTEGER_Number,              man[who].item[whichitem].dormantpts[0], TAG_END);
    SetGadgetAttrs(gadgets[GID_DW_LB5 ], SubWindowPtr, NULL, LISTBROWSER_Selected,        man[who].item[whichitem].dormant[1]   , TAG_END);
    SetGadgetAttrs(gadgets[GID_DW_IN17], SubWindowPtr, NULL, INTEGER_Number,              man[who].item[whichitem].dormantpts[1], TAG_END);
    SetGadgetAttrs(gadgets[GID_DW_CH4 ], SubWindowPtr, NULL, CHOOSER_Selected,     (WORD) man[who].item[whichitem].constant[0]  , TAG_END);
    SetGadgetAttrs(gadgets[GID_DW_CH5 ], SubWindowPtr, NULL, CHOOSER_Selected,     (WORD) man[who].item[whichitem].constant[1]  , TAG_END);
    enable(man[who].item[whichitem].invoked,    GID_DW_IN15);
    enable(man[who].item[whichitem].dormant[0], GID_DW_IN16);
    enable(man[who].item[whichitem].dormant[1], GID_DW_IN17);

    subloop();

    // doesn't need to read "item" listbrowser
    DISCARD GetAttr(GA_Selected,          (Object*) gadgets[GID_DW_CB1 ], (ULONG*) &man[who].item[whichitem].cursed        );
    DISCARD GetAttr(GA_Selected,          (Object*) gadgets[GID_DW_CB2 ], (ULONG*) &man[who].item[whichitem].identified    );
    DISCARD GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN14], (ULONG*) &man[who].item[whichitem].plusminus     );
    DISCARD GetAttr(CHOOSER_Selected,     (Object*) gadgets[GID_DW_CH6 ], (ULONG*) &man[who].item[whichitem].quality       );
    DISCARD GetAttr(LISTBROWSER_Selected, (Object*) gadgets[GID_DW_LB3 ], (ULONG*) &man[who].item[whichitem].invoked       );
    DISCARD GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN15], (ULONG*) &man[who].item[whichitem].invokedpts    );
    // doesn't need to read radiobutton gadget
    DISCARD GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN18], (ULONG*) &man[who].item[whichitem].breakability  );
    DISCARD GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN19], (ULONG*) &man[who].item[whichitem].usesperday    );
    DISCARD GetAttr(LISTBROWSER_Selected, (Object*) gadgets[GID_DW_LB4 ], (ULONG*) &man[who].item[whichitem].dormant[0]    );
    DISCARD GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN16], (ULONG*) &man[who].item[whichitem].dormantpts[0] );
    DISCARD GetAttr(LISTBROWSER_Selected, (Object*) gadgets[GID_DW_LB5 ], (ULONG*) &man[who].item[whichitem].dormant[1]    );
    DISCARD GetAttr(INTEGER_Number,       (Object*) gadgets[GID_DW_IN17], (ULONG*) &man[who].item[whichitem].dormantpts[1] );
    DISCARD GetAttr(CHOOSER_Selected,     (Object*) gadgets[GID_DW_CH4 ], (ULONG*) &man[who].item[whichitem].constant[0]   );
    DISCARD GetAttr(CHOOSER_Selected,     (Object*) gadgets[GID_DW_CH5 ], (ULONG*) &man[who].item[whichitem].constant[1]   );

    DisposeObject(SubWinObject);
    SubWinObject = NULL;
    SubWindowPtr = NULL;
}

EXPORT void dw_die(void)
{   lb_clearlist(&InvokedPowersList[0]);
    lb_clearlist(&InvokedPowersList[1]);
    lb_clearlist(&InvokedPowersList[2]);
    lb_clearlist(&ItemsList);
    lb_clearlist(&SkillsList);
    lb_clearlist(&MonthList);
}

EXPORT void dw_close(void) { ; }
EXPORT void dw_exit(void)  { ; }

MODULE void enable(ULONG state, ULONG whichin)
{   // this function is not as general as the name suggests

    if (state)
    {   DISCARD SetGadgetAttrs(gadgets[whichin], SubWindowPtr, NULL, GA_Disabled, FALSE, TAG_END);
        // integers autorefresh
        DISCARD ActivateLayoutGadget(gadgets[GID_DW_LY2], SubWindowPtr, NULL, (Object) gadgets[whichin]);
    } else
    {   DISCARD SetGadgetAttrs(gadgets[whichin], SubWindowPtr, NULL, GA_Disabled, TRUE, TAG_END);
        // integers autorefresh
}   }

EXPORT FLAG dw_subgadget(ULONG gid, UWORD code)
{   switch (gid)
    {
    case GID_DW_LB1:
        man[who].item[whichitem].thing = items[code].filecode;
        writegadgets(1); // just items
    acase GID_DW_RA1:
        DISCARD GetAttr(RADIOBUTTON_Selected, (Object*) gadgets[GID_DW_RA1], (ULONG*) &man[who].item[whichitem].kind);
        if (man[who].item[whichitem].kind == KIND_BREAKABLE)
        {   DISCARD SetGadgetAttrs(gadgets[GID_DW_IN18], SubWindowPtr, NULL, GA_Disabled, FALSE, TAG_END); // this autorefreshes
            DISCARD SetGadgetAttrs(gadgets[GID_DW_IN19], SubWindowPtr, NULL, GA_Disabled, TRUE,  TAG_END); // this autorefreshes
            DISCARD ActivateLayoutGadget(gadgets[GID_DW_LY2], SubWindowPtr, NULL, (Object) gadgets[GID_DW_IN18]);
        } else
        {   // assert(man[who].items[whichitem].kind == KIND_USESPERDAY);
            DISCARD SetGadgetAttrs(gadgets[GID_DW_IN18], SubWindowPtr, NULL, GA_Disabled, TRUE,  TAG_END); // this autorefreshes
            DISCARD SetGadgetAttrs(gadgets[GID_DW_IN19], SubWindowPtr, NULL, GA_Disabled, FALSE, TAG_END); // this autorefreshes
            DISCARD ActivateLayoutGadget(gadgets[GID_DW_LY2], SubWindowPtr, NULL, (Object) gadgets[GID_DW_IN19]);
        }
    acase GID_DW_LB3:
        enable(code, GID_DW_IN15);
    acase GID_DW_LB4:
        enable(code, GID_DW_IN16);
    acase GID_DW_LB5:
        enable(code, GID_DW_IN17);
    }

    return FALSE;
}

EXPORT FLAG dw_subkey(UWORD code, UWORD qual)
{   switch (code)
    {
    case SCAN_RETURN:
    case SCAN_ENTER:
        return TRUE;
    acase SCAN_UP:
    case NM_WHEEL_UP:
        lb_scroll_up(GID_DW_LB1, SubWindowPtr, qual);
    acase SCAN_DOWN:
    case NM_WHEEL_DOWN:
        lb_scroll_down(GID_DW_LB1, SubWindowPtr, qual);
    }

    return FALSE;
}

EXPORT void dw_uniconify(void)
{   dw_getpens();

#ifndef __MORPHOS__
    if (ClockBase)
    {   RefreshGList((struct Gadget *) gadgets[GID_DW_CL1], MainWindowPtr, NULL, 1);
    }
#endif

    dw_drawmap();
}

MODULE void maximize_man(int whichman)
{   int i;

    man[whichman].curhp =
    man[whichman].maxhp =
    man[whichman].cursp =
    man[whichman].maxsp =     30000;

    man[whichman].spd   =
    man[whichman].str   =
    man[whichman].iq    =
    man[whichman].end   =
    man[whichman].ski   =
    man[whichman].level =       200;

    man[whichman].xp    = 900000000; // 900 million

    for (i = 0; i < 31; i++)
    {   man[whichman].skill[i] = TRUE;
}   }

EXPORT void dw_drawmap(void)
{   TRANSIENT int  i,
                   index,
                   x, y;
    TRANSIENT FLAG ok;

#define SPECIALS 90
PERSIST struct
{   int    region, x, y;
    STRPTR desc;
} specials[SPECIALS] = {
{ 12, 27, 26, "Ynoth"                    },
{ 13, 39, 44, "Lumisle Island"           },
{ 13, 41, 52, "Land's Edge"              },
{ 21, 16,  8, "Ruined temple"            },
{ 21, 49,  8, "Crystal Cave"             },
{ 21, 14, 30, "Aurora"                   },
{ 22, 49, 11, "Temple of Balmur"         },
{ 22,  8, 55, "Dungeon"                  },
{ 23, 44, 34, "College of Summoning"     },
{ 23, 51, 44, "Loven"                    },
{ 23, 21, 53, "Mojured"                  },
{ 25, 18, 33, "College of Fire runes"    },
{ 33, 24, 15, "Temple of Balmur"         },
{ 33, 18, 26, "Temple of Theryni"        },
{ 33, 48, 30, "Temple of Volobews"       },
{ 33, 44, 32, "Iris"                     },
{ 33, 23, 36, "College of Weapon lore"   },
{ 33, 14, 37, "College of Sword"         },
{ 33, 33, 38, "Chandris"                 },
{ 33, 51, 40, "Dragontooth"              },
{ 33, 50, 42, "Temple of Maldorath"      },
{ 33, 44, 51, "Temple of Omizeh"         },
{ 33, 13, 54, "College of Monster lore"  },
{ 33, 40, 55, "Urlock"                   },
{ 33, 46, 63, "College"                  },
{ 34, 46,  7, "College of View land"     },
{ 34, 55,  8, "Temple of Gamur"          },
{ 34,  8,  9, "College of View room"     },
{ 34, 55, 16, "Temple of the Death God"  },
{ 34, 55, 18, "Hall of Bones"            },
{ 34, 37, 23, "Alynhawk"                 },
{ 34,  9, 25, "Temple of Illo"           },
{ 34, 33, 33, "Temple of Camear"         },
{ 34, 45, 34, "Akistu"                   },
{ 34, 42, 36, "Temple of Vemarkn"        },
{ 34, 49, 40, "College of Hunting"       },
{ 34, 31, 45, "Seaside"                  },
{ 34, 46, 45, "Elbarat"                  },
{ 34, 18, 48, "College of Sword"         },
{ 34, 29, 50, "Ruins"                    },
{ 34, 45, 50, "Kobold camp"              },
{ 34, 41, 62, "Temple"                   },
{ 35, 41,  6, "Temple of Camear"         },
{ 35, 26,  9, "Woodhaven"                },
{ 35, 45, 15, "Temple of Acisc"          },
{ 35, 37, 19, "College of Wind runes"    },
{ 35, 19, 29, "College of Hunting"       },
{ 35, 10, 36, "Idlewood"                 },
{ 35, 37, 37, "Temple of Gamur"          },
{ 35, 22, 53, "Temple of Volobews"       },
{ 35, 25, 58, "College of Metal runes"   },
{ 41, 21, 11, "College of Possession"    },
{ 41, 28, 30, "College of Illusion"      },
{ 41, 51, 26, "Temple of Volobews"       },
{ 43, 45, 15, "Irondome"                 },
{ 43, 54, 20, "College of Karate"        },
{ 43, 28, 25, "College of Axe"           },
{ 43, 21, 32, "College of Mace"          },
{ 43, 17, 38, "College of Illusion"      },
{ 43, 39, 40, "Asaht"                    },
{ 43, 45, 62, "College"                  },
{ 44, 45,  6, "College of Berserking"    },
{ 44, 57,  8, "Myrquacid"                },
{ 44, 34, 11, "New Gleon"                },
{ 44, 10, 16, "Temple of Camear"         },
{ 44, 42, 17, "Temple of Maldorath"      },
{ 44, 57, 22, "Janthrin"                 },
{ 44, 25, 24, "Erguard"                  },
{ 44, 40, 25, "College of Item lore"     },
{ 44, 53, 36, "College of Karate"        },
{ 44, 10, 39, "Paladine"                 },
{ 44, 51, 40, "Temple of Vemarkn"        },
{ 44, 23, 42, "College of View mind"     },
{ 44, 15, 43, "College of Armoured skin" },
{ 44, 20, 46, "College of View items"    },
{ 44, 32, 52, "Pirate's Cove"            },
{ 51, 45,  8, "Dungeon"                  },
{ 51, 14, 15, "Temple of Gamur"          },
{ 51, 34, 23, "College of Spirit runes"  },
{ 51, 52, 29, "College of View mind"     },
{ 51, 29, 39, "College of Kung fu"       },
{ 52, 22, 31, "Terlabba"                 },
{ 52, 29, 37, "College of Fencing"       },
{ 52, 36, 39, "College of Armoured skin" },
{ 54, 39, 26, "Pool"                     },
{ 56, 43, 17, "Dungeon"                  },
{ 56, 45, 17, "Dungeon"                  },
{ 56, 40, 34, "Chapel"                   },
{ 64, 28, 37, "Small stone hut"          },
{ 64, 25, 48, "Castle"                   },
};

    if
    (   region <  11
     || region >  77
     || region %  10 == 0
     || region %  10 >  7
    )
    {   index = 1;           //        ->  1 (unknown)
    } elif (region >= 12 && region <= 13)
    {   index = region - 10; // 12..13 ->  2.. 3
    } elif (region >= 21 && region <= 23)
    {   index = region - 17; // 21..23 ->  4.. 6
    } elif (region == 25)
    {   index = 7;           // 25     ->  7
    } elif (region >= 33 && region <= 36)
    {   index = region - 25; // 33..36 ->  8..11
    } elif (region == 41)
    {   index = 12;          // 41     -> 12
    } elif (region >= 43 && region <= 45)
    {   index = region - 30; // 43..45 -> 13..15
    } elif (region >= 51 && region <= 52)
    {   index = region - 35; // 51..52 -> 16..17
    } elif (region >= 54 && region <= 56)
    {   index = region - 36; // 54..46 -> 18..20
    } elif (region == 64)
    {   index = 21;          // 64     -> 21
    } elif (region == 66)
    {   index = 22;          // 66     -> 22
    } else
    {   index = 0;           //        ->  0 (water)
    }        

    for (y = 0; y < MAPHEIGHT; y++)
    {   for (x = 0; x < MAPWIDTH; x++)
        {   switch (dw_map[index][y][x])
            {
            case  '.':           drawpoint(x, y,  3); // blue
            acase '#':           drawpoint(x, y,  4); // dark green
            acase '-': case '=': drawpoint(x, y,  5); // yellow
            acase '$':           drawpoint(x, y,  6); // light green
            acase '^':           drawpoint(x, y,  7); // grey
            acase '*':           drawpoint(x, y, 10); // red
            acase '%':           drawpoint(x, y, 11); // cyan
            acase '!':           drawpoint(x, y, 12); // dark red
            acase '&': case '?': drawpoint(x, y, 13); // light grey
            adefault :           drawpoint(x, y,  8); // purple
    }   }   }

    switch (dw_map[index][loc_y][loc_x])
    {
    case '*':
        ok = FALSE;
        for (i = 0; i < SPECIALS; i++)
        {   if
            (   region == (ULONG) specials[i].region
             && loc_x  == (ULONG) specials[i].x
             && loc_y  == (ULONG) specials[i].y
            )
            {   DISCARD SetGadgetAttrs
                (   gadgets[GID_DW_ST2],
                    MainWindowPtr, NULL,
                    STRINGA_TextVal, specials[i].desc,
                TAG_END);
                ok = TRUE;
                break; // for speed
        }   }
        if (!ok)
        {   DISCARD SetGadgetAttrs
            (   gadgets[GID_DW_ST2],
                MainWindowPtr, NULL,
                STRINGA_TextVal, "?", // this can happen
            TAG_END);
        }
    acase '.': SetGadgetAttrs(gadgets[GID_DW_ST2], MainWindowPtr, NULL, STRINGA_TextVal, "Water"       , TAG_END);
    acase '=': SetGadgetAttrs(gadgets[GID_DW_ST2], MainWindowPtr, NULL, STRINGA_TextVal, "Bridge"      , TAG_END);
    acase '#': SetGadgetAttrs(gadgets[GID_DW_ST2], MainWindowPtr, NULL, STRINGA_TextVal, "Forest"      , TAG_END);
    acase '-': SetGadgetAttrs(gadgets[GID_DW_ST2], MainWindowPtr, NULL, STRINGA_TextVal, "Desert/beach", TAG_END);
    acase '$': SetGadgetAttrs(gadgets[GID_DW_ST2], MainWindowPtr, NULL, STRINGA_TextVal, "Plains"      , TAG_END);
    acase '^': SetGadgetAttrs(gadgets[GID_DW_ST2], MainWindowPtr, NULL, STRINGA_TextVal, "Mountains"   , TAG_END);
    acase '%': SetGadgetAttrs(gadgets[GID_DW_ST2], MainWindowPtr, NULL, STRINGA_TextVal, "Swamp"       , TAG_END);
    acase '!': SetGadgetAttrs(gadgets[GID_DW_ST2], MainWindowPtr, NULL, STRINGA_TextVal, "Lava"        , TAG_END);
    acase '&': SetGadgetAttrs(gadgets[GID_DW_ST2], MainWindowPtr, NULL, STRINGA_TextVal, "Snow"        , TAG_END);
    adefault : SetGadgetAttrs(gadgets[GID_DW_ST2], MainWindowPtr, NULL, STRINGA_TextVal, "?"           , TAG_END);
    }

    for (x = 0; x < MAPWIDTH; x++)
    {   if (x != (int) loc_x)
        {   drawpoint(x, loc_y, 9);
    }   }
    for (y = 0; y < MAPHEIGHT; y++)
    {   if (y != (int) loc_y)
        {   drawpoint(loc_x, y, 9);
    }   }

    DISCARD WritePixelArray8
    (   MainWindowPtr->RPort,
        gadgets[GID_DW_SP1]->LeftEdge,
        gadgets[GID_DW_SP1]->TopEdge,
        gadgets[GID_DW_SP1]->LeftEdge + SCALEDWIDTH  - 1,
        gadgets[GID_DW_SP1]->TopEdge  + SCALEDHEIGHT - 1,
        display1,
        &wpa8rastport[0]
    );
}

MODULE void drawpoint(int x, int y, int colour)
{   int xx, yy;

    for (yy = 0; yy < MAPSCALE; yy++)
    {   for (xx = 0; xx < MAPSCALE; xx++)
        {   *(byteptr1[(y * MAPSCALE) + yy] + (x * MAPSCALE) + xx) = pens[colour];
}   }   }

EXPORT void dw_getpens(void)
{   getclockpens(); // 0..2

    lockscreen();

    pens[ 3] = FindColor(ScreenPtr->ViewPort.ColorMap, 0x00000000, 0x00000000, 0xFFFFFFFF, -1); // blue
    pens[ 4] = FindColor(ScreenPtr->ViewPort.ColorMap, 0x00000000, 0x88888888, 0x00000000, -1); // dark green
    pens[ 5] = FindColor(ScreenPtr->ViewPort.ColorMap, 0xFFFFFFFF, 0xFFFFFFFF, 0x00000000, -1); // yellow
    pens[ 6] = FindColor(ScreenPtr->ViewPort.ColorMap, 0x00000000, 0xFFFFFFFF, 0x00000000, -1); // light green
    pens[ 7] = FindColor(ScreenPtr->ViewPort.ColorMap, 0x88888888, 0x88888888, 0x88888888, -1); // grey
    pens[ 8] = FindColor(ScreenPtr->ViewPort.ColorMap, 0xFFFFFFFF, 0x00000000, 0xFFFFFFFF, -1); // purple
    pens[ 9] = FindColor(ScreenPtr->ViewPort.ColorMap, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, -1); // white
    pens[10] = FindColor(ScreenPtr->ViewPort.ColorMap, 0xFFFFFFFF, 0x00000000, 0x00000000, -1); // red
    pens[11] = FindColor(ScreenPtr->ViewPort.ColorMap, 0x00000000, 0xFFFFFFFF, 0xFFFFFFFF, -1); // cyan
    pens[12] = FindColor(ScreenPtr->ViewPort.ColorMap, 0x88888888, 0x00000000, 0x00000000, -1); // dark red
    pens[13] = FindColor(ScreenPtr->ViewPort.ColorMap, 0xCCCCCCCC, 0xCCCCCCCC, 0xCCCCCCCC, -1); // light grey

    unlockscreen();
}

EXPORT void dw_lmb(SWORD mousex, SWORD mousey)
{   if (!mouseisover(GID_DW_SP1, mousex, mousey))
    {   return;
    }

    loc_x = (mousex - gadgets[GID_DW_SP1]->LeftEdge) / MAPSCALE;
    if (loc_x < 4) loc_x = 4; elif (loc_x > 60) loc_x = 59;

    loc_y = (mousey - gadgets[GID_DW_SP1]->TopEdge ) / MAPSCALE;
    if (loc_y < 4) loc_y = 4; elif (loc_y > 60) loc_y = 59;

    dw_drawmap();
    DISCARD SetGadgetAttrs(gadgets[GID_DW_IN26], MainWindowPtr, NULL, INTEGER_Number, loc_x,  TAG_END); // autorefreshes
    DISCARD SetGadgetAttrs(gadgets[GID_DW_IN27], MainWindowPtr, NULL, INTEGER_Number, loc_y,  TAG_END); // autorefreshes
}

EXPORT void dw_key(UBYTE scancode, UWORD qual, SWORD mousex, SWORD mousey)
{   switch (scancode)
    {
    case SCAN_UP:
    case NM_WHEEL_UP:
        if     (mouseisover(GID_DW_LB6, mousex, mousey))
        {   lb_move_up(     GID_DW_LB6, MainWindowPtr, qual, &month, 0, 5);
        } elif (mouseisover(GID_DW_LB2, mousex, mousey))
        {   lb_scroll_up(   GID_DW_LB2, MainWindowPtr, qual);
        } else
        {   dw_leftorup(   qual, (int*) &loc_y);
        }
    acase SCAN_DOWN:
    case NM_WHEEL_DOWN:
        if     (mouseisover(GID_DW_LB6, mousex, mousey))
        {   lb_move_down(   GID_DW_LB6, MainWindowPtr, qual, &month, MONTHS - 1, 5);
        } elif (mouseisover(GID_DW_LB2, mousex, mousey))
        {   lb_scroll_down( GID_DW_LB2, MainWindowPtr, qual);
        } else
        {   dw_rightordown(qual, (int*) &loc_y);
        }
    acase SCAN_LEFT:
    case SCAN_N4:
        dw_leftorup(   qual, (int*) &loc_x);
    acase SCAN_RIGHT:
    case SCAN_N6:
        dw_rightordown(qual, (int*) &loc_x);
    acase SCAN_N8:
        dw_leftorup(   qual, (int*) &loc_y);
    acase SCAN_N5:
    case SCAN_N2:
        dw_rightordown(qual, (int*) &loc_y);
    acase SCAN_N1:
        dw_leftorup(   qual, (int*) &loc_x);
        dw_rightordown(qual, (int*) &loc_y);
    acase SCAN_N3:
        dw_rightordown(qual, (int*) &loc_x);
        dw_rightordown(qual, (int*) &loc_y);
    acase SCAN_N7:
        dw_leftorup(   qual, (int*) &loc_x);
        dw_leftorup(   qual, (int*) &loc_y);
    acase SCAN_N9:
        dw_rightordown(qual, (int*) &loc_x);
        dw_leftorup(   qual, (int*) &loc_y);
    acase SCAN_F:
        DISCARD ActivateLayoutGadget(gadgets[GID_DW_LY1], MainWindowPtr, NULL, (Object) gadgets[GID_DW_IN11]);
        return;
    acase SCAN_G:
        DISCARD ActivateLayoutGadget(gadgets[GID_DW_LY1], MainWindowPtr, NULL, (Object) gadgets[GID_DW_IN1 ]);
        return;
    acase SCAN_R:
        DISCARD ActivateLayoutGadget(gadgets[GID_DW_LY1], MainWindowPtr, NULL, (Object) gadgets[GID_DW_IN23]);
        return;
    acase SCAN_X:
        DISCARD ActivateLayoutGadget(gadgets[GID_DW_LY1], MainWindowPtr, NULL, (Object) gadgets[GID_DW_IN26]);
        return;
    acase SCAN_Y:
        DISCARD ActivateLayoutGadget(gadgets[GID_DW_LY1], MainWindowPtr, NULL, (Object) gadgets[GID_DW_IN27]);
        return;
    adefault:
        return;
    }

    if (region < 11 || region > 77 || region % 10 == 0 || region % 10 > 7)
    {   if   (loc_x <  4) loc_x =  4;
        elif (loc_x > 59) loc_x = 59;
        if   (loc_y <  4) loc_y =  4;
        elif (loc_y > 59) loc_y = 59;
    } else
    {   if   (loc_x < 4)
        {   if (region >= 21)
            {   region -= 10;
                loc_x  += 56;
            } else
            {   loc_x  =   4;
        }   }
        elif (loc_x > 59)
        {   if (region <= 67)
            {   region += 10;
                loc_x  -= 56;
            } else
            {   loc_x  =  59;
        }   }

        if   (loc_y < 4)
        {   if (region % 10 >= 2)
            {   region--;
                loc_y  += 56;
            } else
            {   loc_y  =   4;
        }   }
        elif (loc_y > 59)
        {   if (region % 10 <= 6)
            {   region++;
                loc_y  -= 56;
            } else
            {   loc_y  =  59;
    }   }   }

    dw_drawmap();
    DISCARD SetGadgetAttrs(gadgets[GID_DW_IN26], MainWindowPtr, NULL, INTEGER_Number, loc_x,  TAG_END); // autorefreshes
    DISCARD SetGadgetAttrs(gadgets[GID_DW_IN27], MainWindowPtr, NULL, INTEGER_Number, loc_y,  TAG_END); // autorefreshes
    DISCARD SetGadgetAttrs(gadgets[GID_DW_IN23], MainWindowPtr, NULL, INTEGER_Number, region, TAG_END); // autorefreshes
}

MODULE void dw_leftorup(UWORD qual, int* location)
{   if
    (   (qual & IEQUALIFIER_LSHIFT)
     || (qual & IEQUALIFIER_RSHIFT)
     || (qual & IEQUALIFIER_CONTROL)
    )
    {   *location = 3;
    } elif
    (   (qual & IEQUALIFIER_LALT)
     || (qual & IEQUALIFIER_RALT)
    )
    {   *location -= 5;
    } else
    {   (*location)--;
}   }
MODULE void dw_rightordown(UWORD qual, int* location)
{   if
    (   (qual & IEQUALIFIER_LSHIFT)
     || (qual & IEQUALIFIER_RSHIFT)
     || (qual & IEQUALIFIER_CONTROL)
    )
    {   *location = 60;
    } elif
    (   (qual & IEQUALIFIER_LALT)
     || (qual & IEQUALIFIER_RALT)
    )
    {   *location += 5;
    } else
    {   (*location)++;
}   }

EXPORT void dw_tick(SWORD mousex, SWORD mousey)
{   if (mouseisover(GID_DW_SP1, mousex, mousey))
    {   setpointer(TRUE , WinObject, MainWindowPtr, FALSE);
    } else
    {   setpointer(FALSE, WinObject, MainWindowPtr, FALSE);
}   }
