// 1. INCLUDES -----------------------------------------------------------

#ifdef __amigaos4__
    #ifndef __USE_INLINE__
        #define __USE_INLINE__ // define this as early as possible
    #endif
#endif
#ifdef __LCLINT__
    typedef char* STRPTR;
    typedef char* CONST_STRPTR;
    typedef char  TEXT;
    #define ASM
    #define REG(x)
    #define __inline
#endif

#include <exec/types.h>
#include <exec/memory.h>
#include <dos/dos.h>
#include <intuition/intuition.h>
#include <datatypes/datatypesclass.h>
#include <datatypes/pictureclass.h>
#define ALL_REACTION_CLASSES
#define ALL_REACTION_MACROS
#include <reaction/reaction.h>

#include <proto/datatypes.h>
#include <proto/dos.h>
#include <proto/exec.h>
#include <proto/graphics.h>
#include <proto/intuition.h>
#include <clib/alib_protos.h>

#include <ctype.h>
#include <stdio.h>                           /* FILE, printf() */
#include <stdlib.h>                          /* EXIT_SUCCESS, EXIT_FAILURE */
#include <string.h>
#include <assert.h>

#ifdef LATTICE
    #include <dos.h>                         // geta4()
#endif

#include "mce.h"

// 2. DEFINES ------------------------------------------------------------

// #define CHECKTILES
// whether to check for invalid tiles when loading

// main window
#define GID_GAR_LY1   0 // root layout
#define GID_GAR_SB1   1 // toolbar
#define GID_GAR_BU1   2 // clear level
#define GID_GAR_BU2   3 // edit high scores
#define GID_GAR_SP1   4 // map
#define GID_GAR_SP2   5 // tiles
#define GID_GAR_LY3   6 // map
#define GID_GAR_LY4   7 // tiles
#define GID_GAR_IN31  8 // level
#define GID_GAR_SL1   9 // level
#define GID_GAR_ST31 10 // level name
#define GID_GAR_ST32 11 // level contents
#define GID_GAR_ST33 12 // tile contents
#define GID_GAR_CH1  13 // game
#define GID_GAR_CB1  14 // draw background?

// high scores editor
#define GID_GAR_LY2  15
#define GID_GAR_IN1  16
#define GID_GAR_IN2  17
#define GID_GAR_IN3  18
#define GID_GAR_IN4  19
#define GID_GAR_IN5  20
#define GID_GAR_IN6  21
#define GID_GAR_IN7  22
#define GID_GAR_IN8  23
#define GID_GAR_IN9  24
#define GID_GAR_IN10 25
#define GID_GAR_IN11 26
#define GID_GAR_IN12 27
#define GID_GAR_IN13 28
#define GID_GAR_IN14 29
#define GID_GAR_IN15 30
#define GID_GAR_IN16 31
#define GID_GAR_IN17 32
#define GID_GAR_IN18 33
#define GID_GAR_IN19 34
#define GID_GAR_IN20 35
#define GID_GAR_IN21 36
#define GID_GAR_IN22 37
#define GID_GAR_IN23 38
#define GID_GAR_IN24 39
#define GID_GAR_IN25 40
#define GID_GAR_IN26 41
#define GID_GAR_IN27 42
#define GID_GAR_IN28 43
#define GID_GAR_IN29 44
#define GID_GAR_IN30 45
#define GID_GAR_ST1  46
#define GID_GAR_ST2  47
#define GID_GAR_ST3  48
#define GID_GAR_ST4  49
#define GID_GAR_ST5  50
#define GID_GAR_ST6  51
#define GID_GAR_ST7  52
#define GID_GAR_ST8  53
#define GID_GAR_ST9  54
#define GID_GAR_ST10 55
#define GID_GAR_ST11 56
#define GID_GAR_ST12 57
#define GID_GAR_ST13 58
#define GID_GAR_ST14 59
#define GID_GAR_ST15 60
#define GID_GAR_ST16 61
#define GID_GAR_ST17 62
#define GID_GAR_ST18 63
#define GID_GAR_ST19 64
#define GID_GAR_ST20 65
#define GID_GAR_ST21 66
#define GID_GAR_ST22 67
#define GID_GAR_ST23 68
#define GID_GAR_ST24 69
#define GID_GAR_ST25 70
#define GID_GAR_ST26 71
#define GID_GAR_ST27 72
#define GID_GAR_ST28 73
#define GID_GAR_ST29 74
#define GID_GAR_ST30 75
#define GID_GAR_BU3  76 // clear high scores

#define GIDS_GAR     GID_GAR_BU3

#define TILESX                3 // width  of tile gadget in tiles
#define TILESY               32 // height of tile gadget in tiles

#define TILES_WIDTH         (TILESX * 16)
#define TILES_HEIGHT        (TILESY * 16)

#define MAP_WIDTH           512
#define MAP_HEIGHT          512

#define GARRISON1             0
#define GARRISON2             1

// 3. MODULE FUNCTIONS ---------------------------------------------------

MODULE void readgadgets(void);
MODULE void writegadgets(void);
MODULE void serialize(void);
MODULE void eithergadgets(void);
MODULE void gar_drawmappart(int x, int y);
MODULE void gar_updatetiles(void);
MODULE void hiscoreswindow(void);
MODULE int tileoffset(int x, int y, int whichlevel);

/* 4. EXPORTED VARIABLES -------------------------------------------------

(none)

5. IMPORTED VARIABLES ------------------------------------------------- */

IMPORT FLAG                 crosshair;
IMPORT int                  function,
                            gadmode,
                            loaded,
                            page,
                            serializemode,
                            stringextra,
                            tilewidth,
                            tileheight;
IMPORT TEXT                 pathname[MAX_PATH + 1];
IMPORT LONG                 pens[PENS];
IMPORT ULONG                offset,
                            showtoolbar;
IMPORT UBYTE                IOBuffer[IOBUFFERSIZE],
                            stamp;
IMPORT __aligned UBYTE      display1[DISPLAY1SIZE],
                            display2[DISPLAY2SIZE];
IMPORT UBYTE               *byteptr1[DISPLAY1HEIGHT],
                           *byteptr2[DISPLAY2HEIGHT];
IMPORT struct Hook          ToolHookStruct,
                            ToolSubHookStruct;
IMPORT struct IBox          winbox[FUNCTIONS + 1];
IMPORT struct List          SpeedBarList;
IMPORT struct RastPort      wpa8rastport[2];
IMPORT struct HintInfo*     HintInfoPtr;
IMPORT struct Menu*         MenuPtr;
IMPORT struct DiskObject*   IconifiedIcon;
IMPORT struct MsgPtr*       AppPort;
IMPORT struct Gadget*       gadgets[GIDS_MAX + 1];
IMPORT struct DrawInfo*     DrawInfoPtr;
IMPORT struct Image        *aissimage[AISSIMAGES],
                           *fimage[FUNCTIONS + 1],
                           *image[BITMAPS];
IMPORT struct Screen       *CustomScreenPtr,
                           *ScreenPtr;
IMPORT struct Window       *MainWindowPtr,
                           *SubWindowPtr;
IMPORT Object              *WinObject,
                           *SubWinObject;

// function pointers
IMPORT FLAG (* tool_open)      (FLAG loadas);
IMPORT void (* tool_save)      (FLAG saveas);
IMPORT void (* tool_close)     (void);
IMPORT void (* tool_loop)      (ULONG gid, ULONG code);
IMPORT void (* tool_exit)      (void);
IMPORT FLAG (* tool_subgadget) (ULONG gid);

// 6. MODULE VARIABLES ---------------------------------------------------

MODULE FLAG                 lmb;
MODULE TEXT                 levelname[128][28 + 1],
                            name[6][5][4 + 1];
MODULE UWORD                levelcolour[128][2];
MODULE ULONG                drawbg             = TRUE,
                            game,
                            level              = 1,
                            score[6][5];

// 7. MODULE ARRAYS/STRUCTURES -------------------------------------------

MODULE const STRPTR GameOptions[2 + 1] =
{ "Garrison 1",
  "Garrison 2",
  NULL
};

#define INV 0x59 // invalid
MODULE const int code_to_gad[256] =
{    0, // $00 -> $00
     1,
     2,
     3,
     4,
     5,
     6,
     7,
     8,
     9,
    10,
    11,
    12,
    13,
    14,
    15,
    16, // $10 -> $10 
    17,
    18,
    19,
    20,
    21,
    22,
    23,
    24,
    25,
    26,
    27,
    28,
    29,
    30,
    31,
    32, // $20 -> $20 
    33, // $21 -> $21 
    34, // $22 -> $22 
    35, // $23 -> $23 
    36, // $24 -> $24 
    37, // $25 -> $25 
    38, // $26 -> $26 
    39, // $27 -> $27 
    40, // $28 -> $28 
   INV, // $29        
  0x29, // $2A -> $29 
   INV, // $2B        
  0x2A, // $2C -> $2A 
   INV, // $2D        
   INV, // $2E        
  0x2B, // $2F -> $2B 
  0x2C, // $30 -> $2C 
   INV, // $31        
  0x2D, // $32 -> $2D 
  0x2E, // $33 -> $2E 
  0x2F, // $34 -> $2F 
  0x30, // $35 -> $30 
  0x31, // $36 -> $31 
  0x32, // $37 -> $32 
  0x33, // $38 -> $33 
  0x34, // $39 -> $34 
  0x35, // $3A -> $35 
  0x36, // $3B -> $36 
   INV, // $3C        
   INV, // $3D        
   INV, // $3E        
   INV, // $3F        
  0x37, // $40 -> $37 
  0x38, // $41 -> $38 
  0x39, // $42 -> $39 
  0x3A, // $43 -> $3A 
  0x3B, // $44 -> $3B 
  0x3C, // $45 -> $3C 
  0x3D, // $46 -> $3D 
  0x3E, // $47 -> $3E 
  0x3F, // $48 -> $3F 
  0x40, // $49 -> $40 
  0x41, // $4A -> $41 
  0x42, // $4B -> $42 
  0x43, // $4C -> $43 
  0x44, // $4D -> $44 
  0x45, // $4E -> $45 
  0x46, // $4F -> $46 
  0x47, // $50 -> $47 
  0x48, // $51 -> $48 
  0x49, // $52 -> $49 
  0x4A, // $53 -> $4A 
  0x4B, // $54 -> $4B 
   INV, // $55        
   INV, // $56        
   INV, // $57        
   INV, // $58        
   INV, // $59        
   INV, // $5A        
   INV, // $5B        
   INV, // $5C        
   INV, // $5D        
   INV, // $5E        
   INV, // $5F        
   INV, // $60        
   INV, // $61        
   INV, // $62        
   INV, // $63        
   INV, // $64        
   INV, // $65        
   INV, // $66        
   INV, // $67        
   INV, // $68        
   INV, // $69        
   INV, // $6A        
   INV, // $6B        
   INV, // $6C        
   INV, // $6D        
   INV, // $6E        
   INV, // $6F        
   INV, // $70        
   INV, // $71        
   INV, // $72        
   INV, // $73        
   INV, // $74        
   INV, // $75        
   INV, // $76        
   INV, // $77        
   INV, // $78        
   INV, // $79        
   INV, // $7A        
   INV, // $7B        
   INV, // $7C        
   INV, // $7D        
   INV, // $7E        
  0x4C, // $7F -> $4C 
   INV, // $80        
   INV, // $81        
   INV, // $82        
   INV, // $83        
   INV, // $84        
   INV, // $85        
   INV, // $86        
   INV, // $87        
   INV, // $88        
   INV, // $89        
   INV, // $8A        
   INV, // $8B        
   INV, // $8C        
   INV, // $8D        
   INV, // $8E        
   INV, // $8F        
   INV, // $90        
   INV, // $91        
   INV, // $92        
   INV, // $93        
   INV, // $94        
   INV, // $95        
   INV, // $96        
   INV, // $97        
   INV, // $98        
   INV, // $99        
   INV, // $9A        
   INV, // $9B        
   INV, // $9C        
   INV, // $9D        
   INV, // $9E        
   INV, // $9F        
   INV, // $A0        
   INV, // $A1        
   INV, // $A2        
   INV, // $A3        
   INV, // $A4        
   INV, // $A5        
   INV, // $A6        
   INV, // $A7        
   INV, // $A8        
   INV, // $A9        
   INV, // $AA        
   INV, // $AB        
   INV, // $AC        
   INV, // $AD        
   INV, // $AE        
   INV, // $AF        
   INV, // $B0        
   INV, // $B1        
   INV, // $B2        
   INV, // $B3        
   INV, // $B4        
   INV, // $B5        
   INV, // $B6        
   INV, // $B7        
   INV, // $B8        
   INV, // $B9        
   INV, // $BA        
   INV, // $BB        
   INV, // $BC        
   INV, // $BD        
   INV, // $BE        
   INV, // $BF        
   INV, // $C0        
   INV, // $C1        
   INV, // $C2        
   INV, // $C3        
   INV, // $C4        
   INV, // $C5        
   INV, // $C6        
   INV, // $C7        
   INV, // $C8        
   INV, // $C9        
   INV, // $CA        
   INV, // $CB        
   INV, // $CC        
   INV, // $CD        
   INV, // $CE        
   INV, // $CF        
   INV, // $D0        
   INV, // $D1        
   INV, // $D2        
   INV, // $D3        
   INV, // $D4        
   INV, // $D5        
   INV, // $D6        
   INV, // $D7        
   INV, // $D8        
   INV, // $D9        
   INV, // $DA        
   INV, // $DB        
   INV, // $DC        
   INV, // $DD        
   INV, // $DE        
   INV, // $DF        
   INV, // $E0        
   INV, // $E1        
   INV, // $E2        
   INV, // $E3        
   INV, // $E4        
   INV, // $E5        
   INV, // $E6        
   INV, // $E7        
  0x4D, // $E8 -> $4D 
  0x4E, // $E9 -> $4E 
  0x4F, // $EA -> $4F 
  0x50, // $EB -> $50 
  0x51, // $EC -> $51 
   INV, // $ED        
   INV, // $EE        
   INV, // $EF        
   INV, // $F0        
   INV, // $F1        
   INV, // $F2        
   INV, // $F3        
   INV, // $F4        
   INV, // $F5        
   INV, // $F6        
   INV, // $F7        
   INV, // $F8        
  0x52, // $F9 -> $52
  0x53, // $FA -> $53 
  0x54, // $FB -> $54 
  0x55, // $FC -> $55 
  0x56, // $FD -> $56 
  0x57, // $FE -> $57 
  0x58, // $FF -> $58
};

/* These tiles are not used in any of the official levels
   (and hence not supported by the editor):
 $29: destroyed stalagmite
 $2B: destroyed horizontal door
 $2D: destroyed vertical door
 $2E: wall disappear
 $31: corruption
 $3C: N wall terminus
 $3D: N-S wall
 $3E: nothing?
 $3F: nothing?
 $40..$7E
 $80..$E7
 $ED..$F8 */

MODULE const int gad_to_code[] =
{    0, // $00 -> $00
     1,
     2,
     3,
     4,
     5,
     6,
     7,
     8,
     9,
    10,
    11,
    12,
    13,
    14,
    15,
    16, // $10 -> $10
    17,
    18,
    19,
    20,
    21,
    22,
    23,
    24,
    25,
    26,
    27,
    28,
    29,
    30,
    31,
    32, // $20 -> $20
    33, // $21 -> $21
    34, // $22 -> $22
    35, // $23 -> $23
    36, // $24 -> $24
    37, // $25 -> $25
    38, // $26 -> $26
    39, // $27 -> $27
    40, // $28 -> $28
  0x2A, // $29 -> $2A
  0x2C, // $2A -> $2C
  0x2F, // $2B -> $2F
  0x30, // $2C -> $30
  0x32, // $2D -> $32
  0x33, // $2E -> $33
  0x34, // $2F -> $34
  0x35, // $30 -> $35
  0x36, // $31 -> $36
  0x37, // $32 -> $37
  0x38, // $33 -> $38
  0x39, // $34 -> $39
  0x3A, // $35 -> $3A
  0x3B, // $36 -> $3B
  0x40, // $37 -> $40
  0x41, // $38 -> $41
  0x42, // $39 -> $42
  0x43, // $3A -> $43
  0x44, // $3B -> $44
  0x45, // $3C -> $45
  0x46, // $3D -> $46
  0x47, // $3E -> $47
  0x48, // $3F -> $48
  0x49, // $40 -> $49
  0x4A, // $41 -> $4A
  0x4B, // $42 -> $4B
  0x4C, // $43 -> $4C
  0x4D, // $44 -> $4D
  0x4E, // $45 -> $4E
  0x4F, // $46 -> $4F
  0x50, // $47 -> $50
  0x51, // $48 -> $51
  0x52, // $49 -> $52
  0x53, // $4A -> $53
  0x54, // $4B -> $54
  0x7F, // $4C -> $7F
  0xE8, // $4D -> $E8
  0xE9, // $4E -> $E9
  0xEA, // $4F -> $EA
  0xEB, // $50 -> $EB
  0xEC, // $51 -> $EC
  0xF9, // $5E -> $F9
  0xFA, // $5F -> $FA
  0xFB, // $60 -> $FB
  0xFC, // $61 -> $FC
  0xFD, // $62 -> $FD
  0xFE, // $63 -> $FE
  0xFF, // $64 -> $FF
};

MODULE const TEXT gfx[][16][16 + 1] = {
{ "9VVVVVVVVVVVVVVD", // $00 stalagmite
  "9999VVVVVVVVDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999888888DDDDD",
  "999988888888DDDD",
  "999988888888DDDD",
  "9998888888888DDD",
  "99988888888888DD",
  "99888888888888DD",
  "988888888888888D",
  "988888888888888D",
  "8888888888888888",
},
{ "9VVVVVVVVVVVVVVD", // $01 N terminus
  "9999VVVVVVVVDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
},
{ "VVVVVVVVVVVVVVDD", // $02 E terminus
  "VVVVVVVVVVVVDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "88888888888DDDDD",
  "888888888888DDDD",
  "888888888888DDDD",
  "8888888888888DDD",
  "88888888888888DD",
  "88888888888888DD",
  "888888888888888D",
  "8888888888888888",
},
{ "99999111111DDDDD", // $03 S terminus
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999888888DDDDD",
  "999988888888DDDD",
  "999988888888DDDD",
  "9998888888888DDD",
  "9998888888888DDD",
  "99888888888888DD",
  "988888888888888D",
  "988888888888888D",
  "8888888888888888",
},
{ "9VVVVVVVVVVVVVVV", // $04 W terminus
  "999VVVVVVVVVVVVV",
  "9999911111111111",
  "9999911111111111",
  "9999911111111111",
  "9999911111111111",
  "9999911111111111",
  "9999911111111111",
  "9999988888888888",
  "9999888888888888",
  "9999888888888888",
  "9998888888888888",
  "9988888888888888",
  "9888888888888888",
  "9888888888888888",
  "8888888888888888",
},
{ "99999111111DDDDD", // $05 vertical wall
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
},
{ "VVVVVVVVVVVVVVVV", // $06 horizontal wall
  "VVVVVVVVVVVVVVVV",
  "1111111111111111",
  "1111111111111111",
  "1111111111111111",
  "1111111111111111",
  "1111111111111111",
  "1111111111111111",
  "8888888888888888",
  "8888888888888888",
  "8888888888888888",
  "8888888888888888",
  "8888888888888888",
  "8888888888888888",
  "8888888888888888",
  "8888888888888888",
},
{ "VVVVVVVVVVVVVVVV", // $07 W/E/S junction
  "VVVVVVVVVVVVVVVV",
  "1111111111111111",
  "1111111111111111",
  "1111111111111111",
  "1111111111111111",
  "1111111111111111",
  "1111111111111111",
  "8888811111188888",
  "88889111111D8888",
  "88889111111D8888",
  "88899111111DD888",
  "88899111111DD888",
  "88999111111DDD88",
  "88999111111DDD88",
  "89999111111DDDD8",
},
{ "V9999111111DDDDD", // $08 N/S/W junction
  "VVVVV111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "88888111111DDDDD",
  "88889111111DDDDD",
  "88889111111DDDDD",
  "88899111111DDDDD",
  "88899111111DDDDD",
  "88999111111DDDDD",
  "88999111111DDDDD",
  "89999111111DDDDD",
},
{ "VV999111111DDDVV", // $09 W/E/N junction
  "VVVV9111111DVVVV",
  "1111111111111111",
  "1111111111111111",
  "1111111111111111",
  "1111111111111111",
  "1111111111111111",
  "1111111111111111",
  "8888888888888888",
  "8888888888888888",
  "8888888888888888",
  "8888888888888888",
  "8888888888888888",
  "8888888888888888",
  "8888888888888888",
  "8888888888888888",
},
{ "99999111111DDDVV", // $0A N/S/E junction
  "99999111111DVVVV",
  "9999911111111111",
  "9999911111111111",
  "9999911111111111",
  "9999911111111111",
  "9999911111111111",
  "9999911111111111",
  "9999911111188888",
  "99999111111D8888",
  "99999111111D8888",
  "99999111111DD888",
  "99999111111DD888",
  "99999111111DDD88",
  "99999111111DDD88",
  "99999111111DDDD8",
},
{ "9VVVVVVVVVVVVVVV", // $0B top left wall
  "999VVVVVVVVVVVVV",
  "9999911111111111",
  "9999911111111111",
  "9999911111111111",
  "9999911111111111",
  "9999911111111111",
  "9999911111111111",
  "9999911111188888",
  "99999111111D8888",
  "99999111111D8888",
  "99999111111DD888",
  "99999111111DD888",
  "99999111111DDD88",
  "99999111111DDD88",
  "99999111111DDDD8",
},
{ "VVVVVVVVVVVVVVVD", // $0C top right wall
  "VVVVVVVVVVVVVDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "88888111111DDDDD",
  "88889111111DDDDD",
  "88889111111DDDDD",
  "88899111111DDDDD",
  "88899111111DDDDD",
  "88999111111DDDDD",
  "88999111111DDDDD",
  "89999111111DDDDD",
},
{ "VV999111111DDDDD", // $0D bottom right wall
  "VVVV9111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "11111111111DDDDD",
  "88888888888DDDDD",
  "888888888888DDDD",
  "888888888888DDDD",
  "8888888888888DDD",
  "88888888888888DD",
  "888888888888888D",
  "888888888888888D",
  "8888888888888888",
},
{ "99999111111DDDVV", // $0E bottom left wall
  "99999111111DVVVV",
  "9999911111111111",
  "9999911111111111",
  "9999911111111111",
  "9999911111111111",
  "9999911111111111",
  "9999911111111111",
  "9999988888888888",
  "9999888888888888",
  "9999888888888888",
  "9998888888888888",
  "9988888888888888",
  "9888888888888888",
  "9888888888888888",
  "8888888888888888",
},
{ "VVVVV111111VVVVV", // $0F 4-way junction
  "VVVVV111111VVVVV",
  "1111111111111111",
  "1111111111111111",
  "1111111111111111",
  "1111111111111111",
  "1111111111111111",
  "1111111111111111",
  "8888811111188888",
  "88889111111D8888",
  "88889111111D8888",
  "88899111111DD888",
  "88899111111DD888",
  "88999111111DDD88",
  "88999111111DDD88",
  "89999111111DDDD8",
},
{ "OOOOOOOOOOOOOOOO", // $10 floor
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $11 floor
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $12 floor
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $13 floor
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "0000000000000000", // $14 true exit
  "0000000000000000",
  "0000000000000000",
  "0000000000000000",
  "0000000000000000",
  "0011010101011100",
  "0010011101001000",
  "0011001001001000",
  "0010011101001000",
  "0011010101001000",
  "0000000000000000",
  "0000000000000000",
  "0000000000000000",
  "0000000000000000",
  "0000000000000000",
  "0000000000000000",
},
{ "OOOOOOOOOO00000O", // $15 unlockable stalagmite
  "OOOOOOO00000000O",
  "OOO000000000000O",
  "OOO0V111177V000O",
  "OOO011111777000O",
  "OOO0111UU77700OO",
  "OOO0111UU77700OO",
  "OOO011UUUU7700OO",
  "OOO011UUUU7700OO",
  "OOO01UUUUUU700OO",
  "OOO01UUUUUU70OOO",
  "OOO0UUUUUUUU0OOO",
  "OOO0000000000OOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOO00000O", // $16 N terminus for unlockable
  "OOOOOOO00000000O",
  "OOO000000000000O",
  "OOO0VMM1177V000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
},
{ "OOOOOOOOOOOOOOOO", // $17 E terminus for unlockable
  "000000000000000O",
  "000000000000000O",
  "000000000000000O",
  "11111111177V000O",
  "111111111777000O",
  "UUUUUUUUU77700OO",
  "UUUUUUUUUU7700OO",
  "UUUUUUUUUU7700OO",
  "UUUUUUUUUU7700OO",
  "UUUUUUUUUUU70OOO",
  "UUUUUUUUUUU70OOO",
  "0000000000000OOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOO0MMM11777000O", // $18 S terminus for unlockable
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMMUU77700OO",
  "OOO0MMMUU77700OO",
  "OOO0MMUUUU7700OO",
  "OOO0MMUUUU7700OO",
  "OOO0MUUUUUU70OOO",
  "OOO0MUUUUUU70OOO",
  "OOO0UUUUUUUU0OOO",
  "OOO0000000000OOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $19 W terminus for unlockable
  "OOOOOOOOOO000000",
  "OOOOOOO000000000",
  "OOO0000000000000",
  "OOO0V11111111111",
  "OOO0111111111111",
  "OOO0111UUUUUUUUU",
  "OOO011UUUUUUUUUU",
  "OOO011UUUUUUUUUU",
  "OOO011UUUUUUUUUU",
  "OOO01UUUUUUUUUUU",
  "OOO01UUUUUUUUUUU",
  "OOO0000000000000",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOO0MMM11777000O", // $1A N-S unlockable
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
},
{ "OOOOOOOOOOOOOOOO", // $1B E-W unlockable
  "0000000000000000",
  "0000000000000000",
  "0000000000000000",
  "1111111111111111",
  "1111111111111111",
  "UUUUUUUUUUUUUUUU",
  "UUUUUUUUUUUUUUUU",
  "UUUUUUUUUUUUUUUU",
  "UUUUUUUUUUUUUUUU",
  "UUUUUUUUUUUUUUUU",
  "UUUUUUUUUUUUUUUU",
  "0000000000000000",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $1C NW corner for unlockable
  "OOOOOOOOOOOO0000",
  "OOOOOOO000000000",
  "OOO0000000000000",
  "OOO0VMM111111111",
  "OOO0MMM111111111",
  "OOO0MMM117UUUUUU",
  "OOO0MMM117UUUUUU",
  "OOO0MMM1177UUUUU",
  "OOO0MMM1177UUUUU",
  "OOO0MMM11777UUUU",
  "OOO0MMM11777UUUU",
  "OOO0MMM117770000",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
},
{ "OOOOOOOOOOOOOOOO", // $1D NE corner for unlockable
  "000000000000000O",
  "000000000000000O",
  "000000000000000O",
  "11111111177V000O",
  "111111111777000O",
  "UUUUUUM11777000O",
  "UUUUUUM11777000O",
  "UUUUUMM11777000O",
  "UUUUUMM11777000O",
  "UUUUMMM11777000O",
  "UUUUMMM11777000O",
  "0000MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
  "OOO0MMM11777000O",
},
{ "OOO0MMM11777000O", // $1E SE corner for unlockable
  "0000MMM11777000O",
  "0000MMM11777000O",
  "0000MMM11777000O",
  "111111111777000O",
  "111111111777000O",
  "UUUUUUUUU77700OO",
  "UUUUUUUUUU7700OO",
  "UUUUUUUUUU7700OO",
  "UUUUUUUUUU7700OO",
  "UUUUUUUUUUU70OOO",
  "UUUUUUUUUUUU0OOO",
  "0000000000000OOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOO0MMM11777000O", // $1F SW corner for unlockable
  "OOO0MMM117770000",
  "OOO0MMM117770000",
  "OOO0MMM117770000",
  "OOO0MMM111111111",
  "OOO0MMM111111111",
  "OOO0MMMUUUUUUUUU",
  "OOO0MMMUUUUUUUUU",
  "OOO0MMUUUUUUUUUU",
  "OOO0MMUUUUUUUUUU",
  "OOO0MUUUUUUUUUUU",
  "OOO0UUUUUUUUUUUU",
  "OOO0000000000000",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "0000000000000000", // $20
  "0000333333333300",
  "0003322222332300",
  "0033222222222300",
  "0332233333222300",
  "0322332232322300",
  "0323323223322300",
  "0323333233322300",
  "0332332333322300",
  "0033322222222300",
  "0033322222222330",
  "0333233333322330",
  "0332222323322230",
  "0323322233332330",
  "0333333330033300",
  "0000000000000000",
},
{ "OOOOOOOOOOOOOOOO", // $21 teleport
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOHHHHOOOOO",
  "OOOOOHH0000HHOOO",
  "OOOOOH0VPPV0HOOO",
  "OOOOH0VPHHPV0HOO",
  "OOOOH0PHMMHP0HOO",
  "OOOOH0PHMMHP0HOO",
  "OOOOH0VPHHPV0HOO",
  "OOOOOH0VPPV0HOOO",
  "OOOOOHH0000HHOOO",
  "OOOOOOOHHHHOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $22 glue
  "OVOOVOU1OO1OOOU1",
  "OO1O1OOOOOO1OOOO",
  "1OOUOVOOOUOOOOUO",
  "O1OOOO1U1OOUOOV1",
  "OVOOOOOUOOVO1OOU",
  "OOOUOO1OOO1OOOOO",
  "O1OO1OOOOOOOUO1O",
  "OVOOOOOOVOOOOOOV",
  "OOOO1OOOOO1O1VUU",
  "OO1UOVOOUOUOU1OO",
  "OOOOOOO1OOOOOOVO",
  "OOVO1OOOOUOOVOO1",
  "O1OOOVOOO1OOOOOO",
  "OUOOOO1OOOVO1OOV",
  "1OO1OVOOOUOOOO1O",
},
{ "OOOOOOOOOOOOOOOO", // $23 health trap (blue)
  "OOOOOOOOVVOOOOOO",
  "OOOOOOOOUUOOOOOO",
  "OOOOOOOVUUVOOOOO",
  "OOOOOOVU11UVOOOO",
  "OOOOOVU1PP1UVOOO",
  "OOOVUU1PHHP1UUVO",
  "OOOVUU1PHHP1UUVO",
  "OOOOOVU1PP1UVOOO",
  "OOOOOOVU11UVOOOO",
  "OOOOOOOVUUVOOOOO",
  "OOOOOOOOUUOOOOOO",
  "OOOOOOOOVVOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $24 explosive trap (red)
  "OOOOOOOOVVOOOOOO",
  "OOOOOOOOUUOOOOOO",
  "OOOOOOOVUUVOOOOO",
  "OOOOOOVU11UVOOOO",
  "OOOOOVU1QQ1UVOOO",
  "OOOVUU1QIIQ1UUVO",
  "OOOVUU1QIIQ1UUVO",
  "OOOOOVU1QQ1UVOOO",
  "OOOOOOVU11UVOOOO",
  "OOOOOOOVUUVOOOOO",
  "OOOOOOOOUUOOOOOO",
  "OOOOOOOOVVOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $25 stun trap (yellow)
  "OOOOOOOOVVOOOOOO",
  "OOOOOOOOUUOOOOOO",
  "OOOOOOOVUUVOOOOO",
  "OOOOOOVU11UVOOOO",
  "OOOOOVU1RR1UVOOO",
  "OOOVUU1RJJR1UUVO",
  "OOOVUU1RJJR1UUVO",
  "OOOOOVU1RR1UVOOO",
  "OOOOOOVU11UVOOOO",
  "OOOOOOOVUUVOOOOO",
  "OOOOOOOOUUOOOOOO",
  "OOOOOOOOVVOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $26 score trap (purple)
  "OOOOOOOOVVOOOOOO",
  "OOOOOOOOUUOOOOOO",
  "OOOOOOOVUUVOOOOO",
  "OOOOOOVU11UVOOOO",
  "OOOOOVU1KK1UVOOO",
  "OOOVUU1KSSK1UUVO",
  "OOOVUU1KSSK1UUVO",
  "OOOOOVU1KK1UVOOO",
  "OOOOOOVU11UVOOOO",
  "OOOOOOOVUUVOOOOO",
  "OOOOOOOOUUOOOOOO",
  "OOOOOOOOVVOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $27 char trap (green)
  "OOOOOOOOVVOOOOOO",
  "OOOOOOOOUUOOOOOO",
  "OOOOOOOVUUVOOOOO",
  "OOOOOOVU11UVOOOO",
  "OOOOOVU1TT1UVOOO",
  "OOOVUU1TLLT1UUVO",
  "OOOVUU1TLLT1UUVO",
  "OOOOOVU1TT1UVOOO",
  "OOOOOOVU11UVOOOO",
  "OOOOOOOVUUVOOOOO",
  "OOOOOOOOUUOOOOOO",
  "OOOOOOOOVVOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "0000000000000000", // $28 destructable door
  "0M00VVVVVVVV00V0",
  "0MMM00000000VVV0",
  "0MMMM011110VVVV0",
  "0MMMM011110VVVV0",
  "0MMMM011110VVVV0",
  "0MMMM000000VVVV0",
  "0MMM0UUUUUU0VVV0",
  "0MMM0UUUUUU0VVV0",
  "0MM0UUUUUUUU0VV0",
  "0MM0UUUUUUUU0VV0",
  "0M0UUUUUUUUUU0V0",
  "0M0UUUUUUUUUU0V0",
  "00UUUUUUUUUUUU00",
  "00UUUUUUUUUUUU00",
  "0000000000000000",
},
{ "99999111111DDDDD", // $2A vertical destructable
  "999900000000DDDD",
  "9900M011110V00DD",
  "00MMM011110VVV00",
  "0MMMM011110VVVV0",
  "0MMMM011110VVVV0",
  "0MMMM011110VVVV0",
  "0MMMM011110VVVV0",
  "0MMMM011110VVVV0",
  "0MMMM011110VVVV0",
  "0MMMM011110VVVV0",
  "0MMMM011110VVVV0",
  "0MMMM011110VVVV0",
  "0M000000000000V0",
  "00999111111DDD00",
  "99999111111DDDDD",
},
{ "VVV0000000000VVV", // $2C horizontal destructable
  "V00VVVVVVVVVV00V",
  "1000000000000001",
  "1011111111111101",
  "1011111111111101",
  "1011111111111101",
  "1011111111111101",
  "1000000000000001",
  "80UUUUUUUUUUUU08",
  "80UUUUUUUUUUUU08",
  "880UUUUUUUUUU088",
  "880UUUUUUUUUU088",
  "880UUUUUUUUUU088",
  "880UUUUUUUUUU088",
  "8880UUUUUUUU0888",
  "8880000000000888",
},
{ "OOOOOOOOOOOOOOOO", // $2F magic block
  "OOOOOOOOOOOOOOOO",
  "OOOOOOO3333OOOOO",
  "OOOOO33555533OOO",
  "OOOOO35QIIQ53OOO",
  "OOOO35QIRRIQ53OO",
  "OOOO35IRJJRI53OO",
  "OOOO35IRJJRI53OO",
  "OOOO35QIRRIQ53OO",
  "OOOOO35QIIQ53OOO",
  "OOOOO33555533OOO",
  "OOOOOOO3333OOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "9VVVVVVVVVVVVVVD", // $30 blinking stalagmite
  "9999VVVVVVVVDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999888888DDDDD",
  "999988888888DDDD",
  "999988888888DDDD",
  "9998888888888DDD",
  "99988888888888DD",
  "99888888888888DD",
  "988888888888888D",
  "988888888888888D",
  "8888888888888888",
},
{ "JOOOROOOROOOJOOR", // $32 wall disappear
  "OROOOOROOOOROOOO",
  "OOOROJOJOJOOOORO",
  "OJOOOOOOOOROOJOJ",
  "OOOJOOOROOOJOOOO",
  "JROOROOOOOROOOOO",
  "OOOOOOJOROJOOORJ",
  "JOOROOOOOOOOJOOO",
  "ROOOJOROJOOOOOJO",
  "OOJOOOOOOOROOOOO",
  "JOOOOROOOOOOJORO",
  "OOROROOROJROOOOO",
  "ROOOOOOOOOOOJOOR",
  "OOOOOOOOROJOOROO",
  "ORORROOOROOOOOOO",
  "JOOJOOROOOROOJOR",
},
{ "JOOOROOOROOOJOOR", // $33 wall disappear
  "OROOOOROOOOROOOO",
  "OOOROJOJOJOOOORO",
  "OJOOOOOOOOROOJOJ",
  "OOOJOOOROOOJOOOO",
  "JROOROOOOOROOOOO",
  "OOOOOOJOROJOOORJ",
  "JOOROOOOOOOOJOOO",
  "ROOOJOROJOOOOOJO",
  "OOJOOOOOOOROOOOO",
  "JOOOOROOOOOOJORO",
  "OOROROOROJROOOOO",
  "ROOOOOOOOOOOJOOR",
  "OOOOOOOOROJOOROO",
  "ORORROOOROOOOOOO",
  "JOOJOOROOOROOJOR",
},
{ "JOOOROOOROOOJOOR", // $34 wall disappear
  "OROOOOROOOOROOOO",
  "OOOROJOJOJOOOORO",
  "OJOOOOOOOOROOJOJ",
  "OOOJOOOROOOJOOOO",
  "JROOROOOOOROOOOO",
  "OOOOOOJOROJOOORJ",
  "JOOROOOOOOOOJOOO",
  "ROOOJOROJOOOOOJO",
  "OOJOOOOOOOROOOOO",
  "JOOOOROOOOOOJORO",
  "OOROROOROJROOOOO",
  "ROOOOOOOOOOOJOOR",
  "OOOOOOOOROJOOROO",
  "ORORROOOROOOOOOO",
  "JOOJOOROOOROOJOR",
},
{ "JOOOROOOROOOJOOR", // $35 wall disappear
  "OROOOOROOOOROOOO",
  "OOOROJOJOJOOOORO",
  "OJOOOOOOOOROOJOJ",
  "OOOJOOOROOOJOOOO",
  "JROOROOOOOROOOOO",
  "OOOOOOJOROJOOORJ",
  "JOOROOOOOOOOJOOO",
  "ROOOJOROJOOOOOJO",
  "OOJOOOOOOOROOOOO",
  "JOOOOROOOOOOJORO",
  "OOROROOROJROOOOO",
  "ROOOOOOOOOOOJOOR",
  "OOOOOOOOROJOOROO",
  "ORORROOOROOOOOOO",
  "JOOJOOROOOROOJOR",
},
{ "JOOOROOOROOOJOOR", // $36 wall disappear
  "OROOOOROOOOROOOO",
  "OOOROJOJOJOOOORO",
  "OJOOOOOOOOROOJOJ",
  "OOOJOOOROOOJOOOO",
  "JROOROOOOOROOOOO",
  "OOOOOOJOROJOOORJ",
  "JOOROOOOOOOOJOOO",
  "ROOOJOROJOOOOOJO",
  "OOJOOOOOOOROOOOO",
  "JOOOOROOOOOOJORO",
  "OOROROOROJROOOOO",
  "ROOOOOOOOOOOJOOR",
  "OOOOOOOOROJOOROO",
  "ORORROOOROOOOOOO",
  "JOOJOOROOOROOJOR",
},
{ "9VVVVVVVVVVVVVVD", // $37 false wall?
  "9999VVVVVVVVDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999888888DDDDD",
  "999988888888DDDD",
  "999988888888DDDD",
  "9998888888888DDD",
  "99988888888888DD",
  "99888888888888DD",
  "988888888888888D",
  "988888888888888D",
  "8888888888888888",
},
{ "9VVVVVVVVVVVVVVD", // $38 false wall?
  "9999VVVVVVVVDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999888888DDDDD",
  "999988888888DDDD",
  "999988888888DDDD",
  "9998888888888DDD",
  "99988888888888DD",
  "99888888888888DD",
  "988888888888888D",
  "988888888888888D",
  "8888888888888888",
},
{ "9VVVVVVVVVVVVVVD", // $39 false wall?
  "9999VVVVVVVVDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999888888DDDDD",
  "999988888888DDDD",
  "999988888888DDDD",
  "9998888888888DDD",
  "99988888888888DD",
  "99888888888888DD",
  "988888888888888D",
  "988888888888888D",
  "8888888888888888",
},
{ "9VVVVVVVVVVVVVVD", // $3A false wall?
  "9999VVVVVVVVDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999888888DDDDD",
  "999988888888DDDD",
  "999988888888DDDD",
  "9998888888888DDD",
  "99988888888888DD",
  "99888888888888DD",
  "988888888888888D",
  "988888888888888D",
  "8888888888888888",
},
{ "9VVVVVVVVVVVVVVD", // $3B false wall?
  "9999VVVVVVVVDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999111111DDDDD",
  "99999888888DDDDD",
  "999988888888DDDD",
  "999988888888DDDD",
  "9998888888888DDD",
  "99988888888888DD",
  "99888888888888DD",
  "988888888888888D",
  "988888888888888D",
  "8888888888888888",
},
{ "OOO00000000000OO", // $40 treasure chest
  "OO0555555555000O",
  "O553333R33335500",
  "444444RJR4444440",
  "O6VTVVVVVKVPV600",
  "O6TLTRJRVVPHP600",
  "O6VTVVRVUVVPV600",
  "O6VQVVVUMUVRV600",
  "O6QIQUVVUVRJR600",
  "O6VQVV3VV3VRV600",
  "O6MVVL3KVAMVA600",
  "O666666666666600",
  "O555555J5555550O",
  "O05555555555500O",
  "OO000000000000OO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $41 treasure sack
  "OOOOOOOOOO555OOO",
  "OOOOOOOO553350OO",
  "OOOOOOO55344350O",
  "OOOOOOO53444435O",
  "OOOOOOO53444435O",
  "OOOOOOOF6344350O",
  "OOOOO5555F33550O",
  "OOOO5333565550OO",
  "OGVRVRV35F6OOOOO",
  "OIVRVVRV5606FOOO",
  "GURJRVJRVFO00OOO",
  "VGVRVRVVO06OOOOO",
  "OIGIRJRGOO0OOOOO",
  "OOJGVRVOOOOOOOOO",
  "OOOOJVOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $42 destroyable food
  "OOOOOOOCCOOOOOOO",
  "OOOOOOC55COOOOOO",
  "OOOO664CC4OOOOOO",
  "OOO6334554OOOOOO",
  "OOO43C644C4OO00O",
  "OOO5C66CCCC40000",
  "OOOC6666CCCC500O",
  "OO4CV6V6VCV450OO",
  "OO4C6V66CVC450OO",
  "OO4CV6V6VCV450OO",
  "OOO4CCCCC4450OOO",
  "OOO5544444550OOO",
  "OOOO05555550OOOO",
  "OOOOO000000OOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $43 food #1
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOO1OOOOO",
  "OOOOOOOOO11OOOOO",
  "OOOO544555OO5O1O",
  "OOOO45544555O11O",
  "OOO554445444445O",
  "OOP5444544445PHO",
  "OP5444544445LIPH",
  "OP544454445ILIPH",
  "OHP555L555IJPPHH",
  "OHPPPLIJIILPPPH0",
  "O0HHHPPPPPPHHH0O",
  "OO000HHHHHH000OO",
  "OOOOO000000OOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $44 food #2
  "OO11OOOOOOOOOOOO",
  "OO11OOOOOOOOOOOO",
  "O111C444OOOOOOOO",
  "O1O1CN644444OOOO",
  "OOO6N6N644111OOO",
  "OOON6N6NN41FI11O",
  "OO0PN6N6N11NNI1O",
  "O0PTN6N611N1NI1O",
  "O0PJTTN61NN1NF1P",
  "O0PJITN61NNNF11P",
  "O0PPJJT411N111PP",
  "O00PPJIT4111PPP0",
  "OO0PPPTJTJPPPP0O",
  "OOO00PPPPPP000OO",
  "OOOOO000000OOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $45 key
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOGG0OO",
  "OOOOOOOOOOG0OG0O",
  "OGGGGGGGGGG0OG0O",
  "O0G0G00000G00G0O",
  "OOGOGOOOOO0GG0OO",
  "OO0O0OOOOOO00OOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $46 scroll
  "OO5OOOOOOOOOO5OO",
  "O333OOOOOOOO333O",
  "OE6E66666666E6E0",
  "OE6EVV6VVV6VE6E0",
  "OE6E66666666E6E0",
  "OE6EV6VV6VV6E6E0",
  "OE6E66666666E6E0",
  "OE6EVV6V6V6VE6E0",
  "OE6E66666666E6E0",
  "OE6EVV6V6VVVE6E0",
  "OE6E66666666E6E0",
  "O333000000003330",
  "OO50OOOOOOOOO50O",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOF6F6F0OOOOOO", // $47 necklace
  "OOF6F000F6F0OOOO",
  "OF6000OO00F60OOO",
  "O600OOOOOO0F60OO",
  "OF0OOOOOOOO0F0OO",
  "O60OOOOOGGCF60OO",
  "OF60OOOGGVGC00OO",
  "O0F0OOOGVGVC0OOO",
  "OO6F0O6CGVCCF60O",
  "OO060OF0CCCF000O",
  "OOOF0O6000060OOO",
  "OOO60OF0OO600OOO",
  "OOOF0O60OO00OOOO",
  "OOO6F6F0OOOOOOOO",
  "OOO0FF00OOOOOOOO",
  "OOOO000OOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $48 blue potion w/ red cross (speed)
  "OOOOOOO25OOOOOOO",
  "OOOOOOO45OOOOOOO",
  "OOOOOOOHPOOOOOOO",
  "OOOOOOOHPOOOOOOO",
  "OOOOOOOHPOOOO0OO",
  "OOOOOOOHPOOO00OO",
  "OOOOOOHHPP000OOO",
  "OOOOOHHHPPP00OOO",
  "OOOOHH7I7PBD0OOO",
  "OOOOH7III7BD0OOO",
  "OOOOH77I77BP0OOO",
  "OOOO0H777BP0OOOO",
  "OOOOO0DDDD0OOOOO",
  "OOOOOO0000OOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $49 blue potion w/ yellow cross (hand-to-hand)
  "OOOOOOO25OOOOOOO",
  "OOOOOOO45OOOOOOO",
  "OOOOOOOHPOOOOOOO",
  "OOOOOOOHPOOOOOOO",
  "OOOOOOOHPOOOO0OO",
  "OOOOOOOHPOOO00OO",
  "OOOOOOHHPP000OOO",
  "OOOOOHHHPPP00OOO",
  "OOOOHH7J7PBD0OOO",
  "OOOOH7JJJ7BD0OOO",
  "OOOOH77J77BP0OOO",
  "OOOO0H777BP0OOOO",
  "OOOOO0DDDD0OOOOO",
  "OOOOOO0000OOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $4A blue potion w/ white cross (magic)
  "OOOOOOO25OOOOOOO",
  "OOOOOOO45OOOOOOO",
  "OOOOOOOHPOOOOOOO",
  "OOOOOOOHPOOOOOOO",
  "OOOOOOOHPOOOO0OO",
  "OOOOOOOHPOOO00OO",
  "OOOOOOHHPP000OOO",
  "OOOOOHHHPPP00OOO",
  "OOOOHH7M7PBD0OOO",
  "OOOOH7MMM7BD0OOO",
  "OOOOH77M77BP0OOO",
  "OOOO0H777BP0OOOO",
  "OOOOO0DDDD0OOOOO",
  "OOOOOO0000OOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $4B blue potion w/ purple cross (armour)
  "OOOOOOO25OOOOOOO",
  "OOOOOOO45OOOOOOO",
  "OOOOOOOHPOOOOOOO",
  "OOOOOOOHPOOOOOOO",
  "OOOOOOOHPOOOO0OO",
  "OOOOOOOHPOOO00OO",
  "OOOOOOHHPP000OOO",
  "OOOOOHHHPPP00OOO",
  "OOOOHH7K7PBD0OOO",
  "OOOOH7KKK7BD0OOO",
  "OOOOH77K77BP0OOO",
  "OOOO0H777BP0OOOO",
  "OOOOO0DDDD0OOOOO",
  "OOOOOO0000OOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $4D blue potion w/ green cross (shot speed)
  "OOOOOOO25OOOOOOO",
  "OOOOOOO45OOOOOOO",
  "OOOOOOOHPOOOOOOO",
  "OOOOOOOHPOOOOOOO",
  "OOOOOOOHPOOOO0OO",
  "OOOOOOOHPOOO00OO",
  "OOOOOOHHPP000OOO",
  "OOOOOHTTTPP00OOO",
  "OOOOHTT4TTBD0OOO",
  "OOOOHT444TBD0OOO",
  "OOOOHTT4TTBP0OOO",
  "OOOO0HTTTBP0OOOO",
  "OOOOO0DDDD0OOOOO",
  "OOOOOO0000OOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $4D blue potion w/ orange cross (firepower)
  "OOOOOOO25OOOOOOO",
  "OOOOOOO45OOOOOOO",
  "OOOOOOOHPOOOOOOO",
  "OOOOOOOHPOOOOOOO",
  "OOOOOOOHPOOOO0OO",
  "OOOOOOOHPOOO00OO",
  "OOOOOOHHPP000OOO",
  "OOOOOHHHPPP00OOO",
  "OOOOHH747PBD0OOO",
  "OOOOH74447BD0OOO",
  "OOOOH77477BP0OOO",
  "OOOO0H777BP0OOOO",
  "OOOOO0DDDD0OOOOO",
  "OOOOOO0000OOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $4E destroyable food?
  "OOOOOOOCCOOOOOOO",
  "OOOOOOC553OOOOOO",
  "OOOO664C33OOOOOO",
  "OOO6334553OOOOOO",
  "OOO43C644C3OO00O",
  "OOO5C36CC3C40000",
  "OOOC3666CCCC500O",
  "OO4C6666C3C450OO",
  "OO4C36363C3450OO",
  "OO43C663CCC350OO",
  "OOO4CCC3CC350OOO",
  "OOO5543CC4530OOO",
  "OOOO03555550OOOO",
  "OOOOO000000OOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $4F grey potion (poison)
  "OOOOOOO25OOOOOOO",
  "OOOOOOO45EOOOOOO",
  "OOOOOOOHEEOOOOOO",
  "OOOOOOOEEOOOOOOO",
  "OOOOOOOHEOOOO0OO",
  "OOOOOOEEPOOO00OO",
  "OOOOOAEHEP000OOO",
  "OOOOAHEHEPE00OOO",
  "OOOOEEAAAEAE0OOO",
  "OOOOEAAAEEAE0OOO",
  "OOOOEAAEAAEP0OOO",
  "OOOO0EEAAEP0OOOO",
  "OOOOO0PEEE0OOOOO",
  "OOOOOO0000OOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOO00000OOOOO", // $50 miscellaneous event
  "OOOOOVVVV000OOOO",
  "OOOOVLLLLV000OOO",
  "OOOVLLLLLLV000OO",
  "OOVLLLVVLLLV00OO",
  "OOVLLV00VLLV00OO",
  "OOVVLV0OVLLV00OO",
  "OOOVVOOVLLV00OOO",
  "OOOOOOVLLV00OOOO",
  "OOOOOVLLV00OOOOO",
  "OOOOOVLLV00OOOOO",
  "OOOOOVVV00OOOOOO",
  "OOOOOOVV000OOOOO",
  "OOOOOVLLV00OOOOO",
  "OOOOOVLLV0OOOOOO",
  "OOOOOOVVVOOOOOOO",
},
{ "O000000000000000", // $51 medicine
  "VVVVVVVVVVVVVVV0",
  "V1111111111111V0",
  "V11111III11111V0",
  "V11111III11111V0",
  "V111IIIIIII111V0",
  "V111IIIIIII111V0",
  "V111IIIIIII111V0",
  "V11111III11111V0",
  "V11111III11111V0",
  "V1111111111111V0",
  "VVVVVVVVVVVVVVV0",
  "V11111RRR11111V0",
  "0V11111111111V0O",
  "O0VVVVVVVVVVV0OO",
  "OO00000000000OOO",
},
{ "OOOOOOOVOOVOOOOO", // $52 magic shots
  "OOOOVOVAVVAVOOOO",
  "OOOVAVAHAVHAVOOO",
  "OOVAVAH1HAVHAVOO",
  "OVAHVVAHAVHVVOOO",
  "OOVVAVVAVVVAVOOO",
  "OOVAHAVVHAVHAVOO",
  "OVAHVHAVAVH1HAVO",
  "OOVVAVVAVAVVAVOO",
  "OVVAHAVVAHVAVVOO",
  "OVAH1HAVHVAHAVOO",
  "OOVAHAVVVAH1HAVO",
  "OOOVAVHAVVAHAVOO",
  "OOOOVVAVVVVAVOOO",
  "OOOOOOVOOOOVOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOO000000OOOOO", // $53 freeze
  "OOOVVVVVV0000OOO",
  "OOVLLLLLLVV000OO",
  "OVLLLLLLLLLV000O",
  "OVLLVLLLLLLLV00O",
  "OOVVVLLVVVLLV0OO",
  "OOOOVLLV00VVOOOO",
  "OOOOVLLVVV000OOO",
  "OOOVLLLLLLV0OOOO",
  "OOVLLLLLLV0OOOOO",
  "OOVVVLLVV0OOOOOO",
  "OOVVVLLV00OOOOOO",
  "OOVLLLLV00OOOOOO",
  "OOVLLLLV0OOOOOOO",
  "OOOVLLV0OOOOOOOO",
  "OOOOVVOOOOOOOOOO",
},
{ "OOOOOOOO000OOOOO", // $54 cross
  "OOOOOOCCC000OOOO",
  "OOOOOCGQGC00OOOO",
  "OOOOOCQIQC00OOOO",
  "OOOOOCGQGC0000OO",
  "OOOCCCCGCCCC000O",
  "OOCGTGCGCGTGC00O",
  "OOCTLTGGGTLTC00O",
  "OOCGTGCGCGTGC0OO",
  "OOOCCCCGCCCCOOOO",
  "OOOOOOCGC00OOOOO",
  "OOOOOOCGC000OOOO",
  "OOOOOCCPCC00OOOO",
  "OOOOOCPHPC00OOOO",
  "OOOOOCCPCC0OOOOO",
  "OOOOOOCCCOOOOOOO",
},
{ "SSSSSSSSSSSSSSSS", // $7F start
  "SSSSSSSSSSSSSSSS",
  "SSSSSSSSSSSSSSSS",
  "SSSSSSSSSSSSSSSS",
  "SSSSSSSSSSSSSSSS",
  "SSSSSSSSSSSSSSSS",
  "SSSSSSSSSSSSSSSS",
  "SSSSSSSSSSSSSSSS",
  "SSSSSSSSSSSSSSSS",
  "SSSSSSSSSSSSSSSS",
  "SSSSSSSSSSSSSSSS",
  "SSSSSSSSSSSSSSSS",
  "SSSSSSSSSSSSSSSS",
  "SSSSSSSSSSSSSSSS",
  "SSSSSSSSSSSSSSSS",
  "SSSSSSSSSSSSSSSS",
},
{ "VV000000000000UU", // $E8 monster generator
  "1V300VV00VV003UU",
  "1113VVVVVVVV3UUU",
  "U1U13EVVVVE0UVUV",
  "U1U11PETTE00UVUV",
  "UU111EETTEE0UUVV",
  "UU111TSEEST0UUVV",
  "U1U113PHHP00UVUV",
  "U1U113DHHP0UUVUV",
  "UU11331HH033UUVV",
  "UU1131111113UUVV",
  "U1U3111111113VUV",
  "U1311111111113UV",
  "133111111111133U",
  "U31111111111113U",
  "U11OOOOOOOOOO11U",
},
{ "VV000000000000UU", // $E9 monster generator
  "1V300VV00VV003UU",
  "1113VVVVVVVV3UUU",
  "U1U13EVVVVE0UVUV",
  "U1U11PETTE00UVUV",
  "UU111EETTEE0UUVV",
  "UU111TSEEST0UUVV",
  "U1U113PHHP00UVUV",
  "U1U113DHHP0UUVUV",
  "UU11331HH033UUVV",
  "UU1131111113UUVV",
  "U1U3111111113VUV",
  "U1311111111113UV",
  "133111111111133U",
  "U31111111111113U",
  "U11OOOOOOOOOO11U",
},
{ "VV000000000000UU", // $EA monster generator
  "1V300VV00VV003UU",
  "1113VVVVVVVV3UUU",
  "U1U13EVVVVE0UVUV",
  "U1U11PETTE00UVUV",
  "UU111EETTEE0UUVV",
  "UU111TSEEST0UUVV",
  "U1U113PHHP00UVUV",
  "U1U113DHHP0UUVUV",
  "UU11331HH033UUVV",
  "UU1131111113UUVV",
  "U1U3111111113VUV",
  "U1311111111113UV",
  "133111111111133U",
  "U31111111111113U",
  "U11OOOOOOOOOO11U",
},
{ "VV000000000000UU", // $EB monster generator
  "1V300VV00VV003UU",
  "1113VVVVVVVV3UUU",
  "U1U13EVVVVE0UVUV",
  "U1U11PETTE00UVUV",
  "UU111EETTEE0UUVV",
  "UU111TSEEST0UUVV",
  "U1U113PHHP00UVUV",
  "U1U113DHHP0UUVUV",
  "UU11331HH033UUVV",
  "UU1131111113UUVV",
  "U1U3111111113VUV",
  "U1311111111113UV",
  "133111111111133U",
  "U31111111111113U",
  "U11OOOOOOOOOO11U",
},
{ "OOOOOOOOOOOOOOOO", // $EC ghost generator
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOO11OOOOOO",
  "OOOOOV11VVOOOOOO",
  "OOOOOV1VVOOOOOOO",
  "OOOO11V11V1OOOOO",
  "OOOOVV11V1VOOOOO",
  "OOOO1O1011VOOOOO",
  "OOOOOVV11V1VOOOO",
  "OOOOO11V91VOOOOO",
  "OOOOOV1VVVOOOOOO",
  "OOOOVOVOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $F9 slime?
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $FA
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $FB
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $FC
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $FD
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // $FE
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "OOOOOOOOOOOOOOOO", // 88 $FF
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
  "OOOOOOOOOOOOOOOO",
},
{ "VVVVVVVVVVVVVVVV", // 89 others
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
} };

MODULE const TEXT bg[9][16][16 + 1] = {
{ "33E353E333E333E3", // 1st pattern
  "EEEEEEEEEEEEEEEE",
  "E533E553E553E353",
  "EEEEEEEEEEEEEEEE",
  "33E555E335E335E3",
  "EEEEEEEEEEEEEEEE",
  "E353E353E335E333",
  "EEEEEEEEEEEEEEEE",
  "35E335E335E335E3",
  "EEEEEEEEEEEEEEEE",
  "E353E353E533E533",
  "EEEEEEEEEEEEEEEE",
  "33E353E353E335E3",
  "EEEEEEEEEEEEEEEE",
  "E555E333E335E353",
  "EEEEEEEEEEEEEEEE",
},
{ "9889V99999999999", // 2nd pattern
  "8899V98999899999",
  "8998V98999998888",
  "9988V9889899999V",
  "V999V99999999989",
  "V999V89998899899",
  "9998V9899899899V",
  "VVVVVVVVVVVVVVVV",
  "8899VV899V999988",
  "9899V8999V899999",
  "9998V99898V99999",
  "8998V89998998889",
  "9999V99899999989",
  "88VVV98899899999",
  "8V98V99999899898",
  "9998V98999999998",
},
{ "99999999V8V99999", // 3rd pattern
  "99VVVVVVV8V99999",
  "99V888888V999999",
  "99V888888V999999",
  "99V88888V9999999",
  "99VV8888V9999999",
  "999V8888V9999999",
  "999VV888V9999999",
  "9999V888V9999999",
  "9999V888V9999999",
  "999VV888V999VVVV",
  "VVVV8888VV9V8888",
  "888888888V9V8888",
  "88VVVVVV8V9V8888",
  "VVV9999VVV9VV88V",
  "99999999VVV9VVVV",
},
{ "9888899989889999", // 4th pattern
  "8988899898898889",
  "8989999888889999",
  "9899898889989988",
  "9998998988898998",
  "9989899899889999",
  "9899989999889888",
  "9988889888998999",
  "9889988888899899",
  "9989989998998889",
  "8999899888999988",
  "9889898998989898",
  "8999889988899999",
  "9899989899998899",
  "9898888898889899",
  "8899888999989998",
},
{ "0888888908888900", // 5th pattern
  "0888888909888890",
  "0098889000999980",
  "8809990888000888",
  "8890008888008888",
  "8890888888908888",
  "9909888888909889",
  "0088999888900990",
  "8888809999080008",
  "8888900008888088",
  "8899908888888988",
  "8890008888888908",
  "9900880999999009",
  "0088888000888880",
  "0888888908888880",
  "0888888908888900",
},
{ "9999999899898999", // 6th pattern
  "9989998998989998",
  "9899989989899988",
  "8999899888999889",
  "9998998898988899",
  "8889888989888999",
  "8998889898899998",
  "9989898988999989",
  "9898989889999889",
  "8989898899989898",
  "8898989989898889",
  "8989999888988899",
  "9888998889888998",
  "9889988998889989",
  "8899889988899888",
  "8998899888998889",
},
{ "VVVVVVVVVVVVVVVV", // 7th pattern
  "V8888888V9999999",
  "V8888888V9999999",
  "V8888888V9999999",
  "V8888888V9999999",
  "V8888888V9999999",
  "V8888888V9999999",
  "V8888888V9999999",
  "VVVVVVVVVVVVVVVV",
  "V9999999V8888888",
  "V9999999V8888888",
  "V9999999V8888888",
  "V9999999V8888888",
  "V9999999V8888888",
  "V9999999V8888888",
  "V9999999V8888888",
},
{ "TLTVVVTLTLTVVVLT", // 8th pattern
  "LTVTTTVTLTVTTTVT",
  "TVTLLLTVTVTLLLTV",
  "VTLLTLLTVTLLTLLT",
  "VTLTTTLTVTLTTTLT",
  "VTLLTLLTVTLLTLLT",
  "TVTLLLTVTVTLLLTV",
  "LTVTTTVTLTVTTTVT",
  "TLTVVVTLTLTVVVLT",
  "LTVTTTVTLTVTTTVT",
  "TVTLLLTVTVTLLLTV",
  "VTLLTLLTVTLLTLLT",
  "VTLTTTLTVTLTTTLT",
  "VTLLTLLTVTLLTLLT",
  "TVTLLLTVTVTLLLTV",
  "LTVTTTVTLTVTTTVT",
},
{ "VVVVVVVVVVVVVVVV", // no background
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
  "VVVVVVVVVVVVVVVV",
} };

// 8. CODE ---------------------------------------------------------------

EXPORT void gar_main(void)
{   tool_open      = gar_open;
    tool_loop      = gar_loop;
    tool_save      = gar_save;
    tool_close     = gar_close;
    tool_exit      = gar_exit;
    tool_subgadget = gar_subgadget;

    if (loaded != FUNC_GARRISON)
    {   stamp = 0x10;
        if (!gar_open(TRUE))
        {   function = page = FUNC_MENU;
            return;
        } // implied else
        loaded = FUNC_GARRISON;
    }

    make_speedbar_list(GID_GAR_SB1);
    load_aiss_images(9, 9);
    gar_getpens();

    InitHook(&ToolHookStruct, (ULONG (*)())ToolHookFunc, NULL);
    lockscreen();

    if (!(WinObject =
    NewToolWindow,
        WINDOW_Position,                                   WPOS_CENTERMOUSE,
        WINDOW_ParentGroup,                                gadgets[GID_GAR_LY1] = (struct Gadget*)
        VLayoutObject,
            LAYOUT_SpaceOuter,                             TRUE,
            AddHLayout,
                AddToolbar(GID_GAR_SB1),
                AddSpace,
                CHILD_WeightedWidth,                       50,
                AddHLayout,
                    LAYOUT_VertAlignment,                  LALIGN_CENTER,
                    LAYOUT_AddChild,                       gadgets[GID_GAR_CH1] = (struct Gadget*)
                    PopUpObject,
                        GA_ID,                             GID_GAR_CH1,
                        CHOOSER_LabelArray,                &GameOptions,
                    ChooserEnd,
                    Label("Game:"),
                    CHILD_WeightedHeight,                  0,
                LayoutEnd,
                CHILD_WeightedWidth,                       0,
                AddSpace,
                CHILD_WeightedWidth,                       50,
            LayoutEnd,
            CHILD_WeightedHeight,                          0,
            AddVLayout,
                LAYOUT_Label,                              "Level Editor",
                LAYOUT_SpaceOuter,                         TRUE,
                LAYOUT_BevelStyle,                         BVS_GROUP,
                AddVLayout,
                    AddHLayout,
                        LAYOUT_VertAlignment,              LALIGN_CENTER,
                        LAYOUT_AddChild,                   gadgets[GID_GAR_IN31] = (struct Gadget*)
                        IntegerObject,
                            GA_ID,                         GID_GAR_IN31,
                            GA_TabCycle,                   TRUE,
                            GA_RelVerify,                  TRUE,
                            INTEGER_Minimum,               1,
                            INTEGER_Maximum,               128,
                            INTEGER_MinVisible,            3 + 1,
                        IntegerEnd,
                        CHILD_WeightedWidth,               0,
                        Label("_Level:"),
                        LAYOUT_AddChild,                   gadgets[GID_GAR_SL1] = (struct Gadget*)
                        SliderObject,
                            GA_ID,                         GID_GAR_SL1,
                            GA_RelVerify,                  TRUE,
                            SLIDER_Min,                    1,
                            SLIDER_Max,                    128,
                            SLIDER_KnobDelta,              1,
                            SLIDER_Orientation,            SLIDER_HORIZONTAL,
                         // SLIDER_Ticks,                  128, // too wide
                        SliderEnd,
                        AddLabel("of 128"),
                        CHILD_WeightedWidth,               0,
                    LayoutEnd,
                    AddHLayout,
                        LAYOUT_AddChild,                   gadgets[GID_GAR_LY3] = (struct Gadget*)
                        VLayoutObject,
                            LAYOUT_Label,                  "Level",
                            LAYOUT_SpaceOuter,             TRUE,
                            LAYOUT_BevelStyle,             BVS_GROUP,
                            LAYOUT_AddChild,               gadgets[GID_GAR_SP1] = (struct Gadget*)
                            SpaceObject,
                                GA_ID,                     GID_GAR_SP1,
                                GA_Width,                  MAP_WIDTH,
                                GA_Height,                 MAP_HEIGHT,
                                SPACE_BevelStyle,          BVS_NONE,
                                SPACE_Transparent,         TRUE,
                            SpaceEnd,
                            CHILD_MinWidth,                MAP_WIDTH,
                            CHILD_MinHeight,               MAP_HEIGHT,
                            CHILD_MaxWidth,                MAP_WIDTH,
                            CHILD_MaxHeight,               MAP_HEIGHT,
                            AddHLayout,
                                AddVLayout,
                                    AddSpace,
                                    ClearButton(GID_GAR_BU1, "Clear Level"),
                                    CHILD_WeightedHeight,  0,
                                LayoutEnd,
                                CHILD_WeightedWidth,       0,
                                AddVLayout,
                                    LAYOUT_AddChild,       gadgets[GID_GAR_ST32] = (struct Gadget*)
                                    StringObject,
                                        GA_ID,             GID_GAR_ST32,
                                        GA_ReadOnly,       TRUE,
                                        STRINGA_MaxChars,  2 + 1,
                                        STRINGA_MinVisible,2 + stringextra,
                                    StringEnd,
                                    Label("Contents: $"),
                                    LAYOUT_AddChild,       gadgets[GID_GAR_ST31] = (struct Gadget*)
                                    StringObject,
                                        GA_ID,             GID_GAR_ST31,
                                        GA_TabCycle,       TRUE,
                                        GA_RelVerify,      TRUE,
                                        STRINGA_MaxChars,  28 + 1,
                                        STRINGA_MinVisible,28 + 1,
                                    StringEnd,
                                    Label("Level Name:"),
                                    LAYOUT_AddChild,       gadgets[GID_GAR_CB1] = (struct Gadget*)
                                    TickOrCheckBoxObject,
                                        GA_ID,             GID_GAR_CB1,
                                        GA_RelVerify,      TRUE,
                                        GA_Selected,       drawbg,
                                        GA_Text,           "Draw _background?",
                                    End,
                                LayoutEnd,
                            LayoutEnd,
                        LayoutEnd,
                        CHILD_WeightedWidth,               100,
                        CHILD_WeightedHeight,              100,
                        LAYOUT_AddChild,                   gadgets[GID_GAR_LY4] = (struct Gadget*)
                        VLayoutObject,
                            LAYOUT_Label,                  "Tiles",
                            LAYOUT_SpaceOuter,             TRUE,
                            LAYOUT_BevelStyle,             BVS_GROUP,
                            LAYOUT_AddChild,               gadgets[GID_GAR_SP2] = (struct Gadget*)
                            SpaceObject,
                                GA_ID,                     GID_GAR_SP2,
                                GA_Width,                  TILES_WIDTH,
                                GA_Height,                 TILES_HEIGHT,
                                SPACE_BevelStyle,          BVS_NONE,
                                SPACE_Transparent,         TRUE,
                            SpaceEnd,
                            CHILD_MinWidth,                TILES_WIDTH,
                            CHILD_MinHeight,               TILES_HEIGHT,
                            CHILD_MaxWidth,                TILES_WIDTH,
                            CHILD_MaxHeight,               TILES_HEIGHT,
                            CHILD_WeightedHeight,          0,
                            LAYOUT_AddChild,               gadgets[GID_GAR_ST33] = (struct Gadget*)
                            StringObject,
                                GA_ID,                     GID_GAR_ST33,
                                GA_ReadOnly,               TRUE,
                                STRINGA_MaxChars,          2 + 1,
                                STRINGA_MinVisible,        2 + stringextra,
                            StringEnd,
                            Label("$"),
                            CHILD_WeightedHeight,          0,
                            AddSpace,
                        LayoutEnd,
                        CHILD_WeightedWidth,               0,
                    LayoutEnd,
                LayoutEnd,
                CHILD_WeightedWidth,                       0,
            LayoutEnd,
            LAYOUT_AddChild,                               gadgets[GID_GAR_BU2] = (struct Gadget*)
            ZButtonObject,
                GA_ID,                                     GID_GAR_BU2,
                GA_RelVerify,                              TRUE,
                GA_Text,                                   "Edit _High Scores...",
            ButtonEnd,
        LayoutEnd,
    WindowEnd))
    {   rq("Can't create gadgets!");
    }
    unlockscreen();
    openwindow(GID_GAR_SB1);

    setup_bm(0, MAP_WIDTH  , MAP_HEIGHT  , MainWindowPtr);
    setup_bm(1, TILES_WIDTH, TILES_HEIGHT, MainWindowPtr);

    writegadgets();
    lmb = FALSE;
    loop();
    readgadgets();
    closewindow();
}

EXPORT void gar_getpens(void)
{   TRANSIENT int   i;
    PERSIST   UWORD idealcolour[32] = {
0x000, // 0  0 black
0xFFF, // 1    white
0xECA, // 2
0x864, // 3
0xC62, // 4
0x842, // 5  5
0xEA7, // 6
0xAAD, // 7
0x79C, // 8    changeable
0x7DF, // 9    changeable
0x04E, // A 10
0xC8F, // B    unused?
0xF95, // C
0x06A, // D
0x997, // E
0xD98, // F 15
0xFB2, // G
0x6AD, // H
0xE44, // I
0xEE3, // J
0xE6D, // K 20
0x2C7, // L
0xDDE, // M
0xFBC, // N
0xF0F, // O    transparent
0x36B, // P 25
0xB22, // Q
0xBB0, // R
0xA3B, // S
0x282, // T
0x99A, // U 30
0x556, // V 31
};

    idealcolour[8] = levelcolour[level - 1][0];
    idealcolour[9] = levelcolour[level - 1][1];

    lockscreen();
    for (i = 0; i < 32; i++)
    {   pens[i] = FindColor
        (   ScreenPtr->ViewPort.ColorMap,
            ((idealcolour[i] & 0x0F00) >> 8) * 0x11111111,
            ((idealcolour[i] & 0x00F0) >> 4) * 0x11111111,
            ( idealcolour[i] & 0x000F      ) * 0x11111111,
            -1
        );
    }
    unlockscreen();
}

EXPORT void gar_loop(ULONG gid, UNUSED ULONG code)
{   int x, y;

    switch (gid)
    {
    case GID_GAR_BU1:
        for (y = 0; y < 32; y++)
        {   for (x = 0; x < 32; x++)
            {   IOBuffer[tileoffset(x, y, level)] = 0x10;
        }   }
        gar_drawmap(FALSE);
    acase GID_GAR_BU2:
        hiscoreswindow();
    acase GID_GAR_SL1:
        gadmode = SERIALIZE_READ;
        either_sl(GID_GAR_SL1, &level);
        readgadgets();
        gar_getpens();
        writegadgets();
    acase GID_GAR_IN31:
        gadmode = SERIALIZE_READ;
        either_in(GID_GAR_IN31, &level);
        readgadgets();
        gar_getpens();
        writegadgets();
    acase GID_GAR_CB1:
        DISCARD GetAttr(GA_Selected, (Object*) gadgets[GID_GAR_CB1], &drawbg);
        gar_drawmap(TRUE);
}   }

EXPORT FLAG gar_open(FLAG loadas)
{   if (!gameopen(loadas))
    {   return FALSE;
    } // implied else

    serializemode = SERIALIZE_READ;
    serialize();
    writegadgets();
    return TRUE;
}

MODULE void writegadgets(void)
{   if
    (   page != FUNC_GARRISON
     || !MainWindowPtr
    )
    {   return;
    } // implied else

    gadmode = SERIALIZE_WRITE;
    eithergadgets();
    either_sl(GID_GAR_SL1 , &level);
    either_in(GID_GAR_IN31, &level);
    gar_drawmap(TRUE);
}

MODULE void readgadgets(void)
{   gadmode = SERIALIZE_READ;
    eithergadgets();
}

EXPORT void gar_save(FLAG saveas)
{   int  count,
         whichlevel,
         x, y;
    TEXT tempstring[22 + 1]; // enough for "Level 128 has no exit!"

    readgadgets();

    for (whichlevel = 0; whichlevel < 128; whichlevel++)
    {   count = 0;
        for (y = 0; y < 32; y++)
        {   for (x = 0; x < 32; x++)
            {   if (IOBuffer[tileoffset(x, y, whichlevel)] == 0x7F)
                {   count++;
        }   }   }
        if (count == 0) // multiple exits are OK
        {   sprintf(tempstring, "Level %d has no exit!", whichlevel + 1);
            say(tempstring, REQIMAGE_WARNING);
            return;
    }   }

    serializemode = SERIALIZE_WRITE;
    serialize();
    gamesave("#?", "Garrison 1 & 2", saveas, 737280, FLAG_H | FLAG_L, FALSE);
}

MODULE void eithergadgets(void)
{   either_ch(GID_GAR_CH1 , &game);
    either_st(GID_GAR_ST31, levelname[level - 1]);
}

EXPORT void gar_close(void) { ; }


MODULE void serialize(void)
{   FLAG  ok;
    TEXT  tempstring[28 + 1];
    int   gap1, gap2,
          i, j, k,
          length;
#ifdef CHECKTILES
    UBYTE whichtile;
    int   x, y;
#endif

    if (serializemode == SERIALIZE_READ)
    {   if
        (   IOBuffer[0] == 'G'
         && IOBuffer[1] == 'A'
         && IOBuffer[2] == 'R'
         && IOBuffer[3] == 'R'
        )
        {   game = GARRISON1;
        } elif
        (   IOBuffer[0] == 0
         && IOBuffer[1] == 0
         && IOBuffer[2] == 0
         && IOBuffer[3] == 0
        )
        {   game = GARRISON2;
        } else
        {   rq("Unknown file format!");
    }   }
    else
    {   // assert(serializemode == SERIALIZE_WRITE);
        switch (game)
        {
        case  GARRISON1: IOBuffer[0] = 'G'; IOBuffer[1] = 'A'; IOBuffer[2] = IOBuffer[3] = 'R' ;
        acase GARRISON2: IOBuffer[0] =      IOBuffer[1] =      IOBuffer[2] = IOBuffer[3] = 0x00;
    }   }

    offset = 0x1200;

    for (i = 0; i < 6; i++)
    {   for (j = 0; j < 5; j++)
        {   if (serializemode == SERIALIZE_READ)
            {   score[i][j] = (((IOBuffer[offset    ] & 0xF0) >> 4) * 10000000)
                            + ( (IOBuffer[offset    ] & 0x0F)       *  1000000)
                            + (((IOBuffer[offset + 1] & 0xF0) >> 4) *   100000)
                            + ( (IOBuffer[offset + 1] & 0x0F)       *    10000)
                            + (((IOBuffer[offset + 2] & 0xF0) >> 4) *     1000)
                            + ( (IOBuffer[offset + 2] & 0x0F)       *      100)
                            + (((IOBuffer[offset + 3] & 0xF0) >> 4) *       10)
                            +   (IOBuffer[offset + 3] & 0x0F);
                offset += 4;

                for (k = 0; k < 4; k++)
                {   name[i][j][k] = IOBuffer[offset++];
                }
                name[i][j][4] = EOS;
            } else
            {   // assert(serializemode == SERIALIZE_WRITE);

                IOBuffer[offset    ] =  ((score[i][j] / 10000000)            << 4)
                                     |   (score[i][j] % 10000000) / 1000000;
                IOBuffer[offset + 1] = (((score[i][j] %  1000000) /  100000) << 4)
                                     |  ((score[i][j] %   100000) %   10000);
                IOBuffer[offset + 2] = (((score[i][j] %    10000) /    1000) << 4)
                                     |  ((score[i][j] %     1000) %     100);
                IOBuffer[offset + 3] = (((score[i][j] %      100) /      10) << 4)
                                     |   (score[i][j] %       10)           ;
                offset += 4;

                ok = TRUE;
                for (k = 0; k < 4; k++)
                {   if (!ok || name[i][j][k] == EOS)
                    {   ok = FALSE;
                        IOBuffer[offset++] = ' ';
                    } else
                    {   IOBuffer[offset++] = name[i][j][k];
    }   }   }   }   }

    for (i = 0; i < 128; i++)
    {   if (i < 64)
        {   offset = 0x5A08 + (i * 64);
        } else
        {   offset = 0x3808 + (i * 64);
        }

        if (serializemode == SERIALIZE_READ)
        {   zstrncpy(levelname[i], (char*) &IOBuffer[offset], 28);
            ok = FALSE;
            k = 0;
            for (j = 0; j < 28; j++)
            {   if (ok || levelname[i][j] != ' ')
                {   ok = TRUE;
                    levelname[i][k++] = levelname[i][j];
            }   }
            levelname[i][k] = EOS;
            if (k >= 1)
            {   for (j = k - 1; j >= 0; j--)
                {   if (levelname[i][j] != ' ')
                    {   break;
                    }
                    levelname[i][j] = EOS;
        }   }   }
        else
        {   // assert(serializemode == SERIALIZE_WRITE);
            length = strlen(levelname[i]);
            gap1   =
            gap2   = (28 - length) / 2;
            if (length % 2)
            {   gap2++;
            }
            if (gap1 >= 1)
            {   for (j = 0; j < gap1; j++)
                {  tempstring[j] = ' ';
            }   }
            for (j = 0; j < length; j++)
            {   tempstring[gap1 + j] = toupper(levelname[i][j]);
            }
            if (gap2 >= 1)
            {   for (j = 0; j < gap2; j++)
                {  tempstring[gap1 + length + j] = ' ';
            }   }
            tempstring[gap1 + length + gap2] = EOS;
            zstrncpy((char*) &IOBuffer[offset], tempstring, 28);
        }
        offset += 30;
        serialize2uword(&levelcolour[i][0]);
        serialize2uword(&levelcolour[i][1]);
        offset += 30;
    }

#ifdef CHECKTILES
    if (serializemode == SERIALIZE_READ)
    {   for (i = 1; i <= 128; i++)
        {   for (y = 0; y < 32; y++)
            {   for (x = 0; x < 32; x++)
                {   whichtile = IOBuffer[tileoffset(x, y, i)];
                    if
                    (    whichtile == 0x29
                     ||  whichtile == 0x2B
                     ||  whichtile == 0x2D
                     ||  whichtile == 0x2E
                     ||  whichtile == 0x31
                     || (whichtile >= 0x3C && whichtile <= 0x3F)
                     || (whichtile >= 0x55 && whichtile <= 0x7E)
                     || (whichtile >= 0x80 && whichtile <= 0xE7)
                    )
                    {   printf("Invalid tile ($%02X) at %2d,%2d on level %3d!\n", whichtile, x, y, i);
    }   }   }   }   }
#endif
}

EXPORT void gar_exit(void) { ; }

EXPORT void gar_drawmap(FLAG all)
{   TEXT  value;
    UBYTE whichtile;
    int   floor,
          index,
          x,  y,
          xx, yy;

    floor = drawbg ? ((level - 1) % 8) : 8;
    for (y = 0; y < 32; y++)
    {   for (x = 0; x < 32; x++)
        {   whichtile = IOBuffer[tileoffset(x, y, level)];
            index     = code_to_gad[whichtile];
            for (yy = 0; yy < 16; yy++)
            {   for (xx = 0; xx < 16; xx++)
                {   if (gfx[index][yy][xx] == 'O')
                    {   value = bg[floor][yy][xx];
                    } else
                    {   value = gfx[index][yy][xx];
                    }
                    if (value >= 'A')
                    {   *(byteptr1[(y * 16) + yy] + (x * 16) + xx) = pens[value - 'A' + 10];
                    } else
                    {   *(byteptr1[(y * 16) + yy] + (x * 16) + xx) = pens[value - '0'     ];
    }   }   }   }   }

    DISCARD WritePixelArray8
    (   MainWindowPtr->RPort,
        gadgets[GID_GAR_SP1]->LeftEdge,
        gadgets[GID_GAR_SP1]->TopEdge,
        gadgets[GID_GAR_SP1]->LeftEdge + MAP_WIDTH  - 1,
        gadgets[GID_GAR_SP1]->TopEdge  + MAP_HEIGHT - 1,
        display1,
        &wpa8rastport[0]
    );

    if (all)
    {   gar_updatetiles();
}   }

MODULE void gar_drawmappart(int x, int y)
{   TEXT  value;
    UBYTE whichtile;
    int   floor,
          index,
          xx, yy;

    floor = drawbg ? ((level - 1) % 8) : 8;
    whichtile = IOBuffer[tileoffset(x, y, level)];
    index     = code_to_gad[whichtile];
    for (yy = 0; yy < 16; yy++)
    {   for (xx = 0; xx < 16; xx++)
        {   if (gfx[index][yy][xx] == 'O')
            {   value = bg[floor][yy][xx];
            } else
            {   value = gfx[index][yy][xx];
            }
            if (value >= 'A')
            {   *(byteptr1[(y * 16) + yy] + (x * 16) + xx) = pens[value - 'A' + 10];
            } else
            {   *(byteptr1[(y * 16) + yy] + (x * 16) + xx) = pens[value - '0'     ];
    }   }   }

    DISCARD WritePixelArray8
    (   MainWindowPtr->RPort,
        gadgets[GID_GAR_SP1]->LeftEdge,
        gadgets[GID_GAR_SP1]->TopEdge  + (y * 16),
        gadgets[GID_GAR_SP1]->LeftEdge + MAP_WIDTH -  1,
        gadgets[GID_GAR_SP1]->TopEdge  + (y * 16) + 15,
        &display1[GFXINIT(MAP_WIDTH, (y * 16))],
        &wpa8rastport[0]
    );
}

MODULE void gar_updatetiles(void)
{   TEXT  value;
    UBYTE whichtile;
    int   floor,
          index,
          x,  y,
          xx, yy;

    floor = drawbg ? ((level - 1) % 8) : 8;
    for (y = 0; y < TILESY; y++)
    {   for (x = 0; x < TILESX; x++)
        {   index = (y * TILESX) + x;
            if (index >= 0x59)
            {   index = 0x59;
                whichtile = 0x80;
            } else
            {   whichtile = gad_to_code[index];
            }
            for (yy = 0; yy < 16; yy++)
            {   for (xx = 0; xx < 16; xx++)
                {   if
                    (   stamp  == whichtile
                     && (   xx <=  1
                         || xx >= 14
                         || yy <=  1
                         || yy >= 14
                    )   )
                    {   *(byteptr2[(y * 16) + yy] + (x * 16) + xx) = pens[1]; // white
                    } else
                    {   if (gfx[index][yy][xx] == 'O')
                        {   value = bg[floor][yy][xx];
                        } else
                        {   value = gfx[index][yy][xx];
                        }
                        if (value >= 'A')
                        {   *(byteptr2[(y * 16) + yy] + (x * 16) + xx) = pens[value - 'A' + 10];
                        } else
                        {   *(byteptr2[(y * 16) + yy] + (x * 16) + xx) = pens[value - '0'     ];
    }   }   }   }   }   }

    DISCARD WritePixelArray8
    (   MainWindowPtr->RPort,
        gadgets[GID_GAR_SP2]->LeftEdge,
        gadgets[GID_GAR_SP2]->TopEdge,
        gadgets[GID_GAR_SP2]->LeftEdge + TILES_WIDTH  - 1,
        gadgets[GID_GAR_SP2]->TopEdge  + TILES_HEIGHT - 1,
        display2,
        &wpa8rastport[1]
    );
}

EXPORT void gar_uniconify(void)
{   gar_getpens();
    gar_drawmap(TRUE);
}

EXPORT void gar_tick(SWORD mousex, SWORD mousey)
{   TRANSIENT UBYTE whichtile;
    TRANSIENT int   index,
                    x, y;
    TRANSIENT TEXT  newcontents[2][2 + 1];
    PERSIST   TEXT  oldcontents[2][2 + 1];

    if
    (   mouseisover(GID_GAR_SP1, mousex, mousey)
     || mouseisover(GID_GAR_SP2, mousex, mousey)
    )
    {   setpointer(TRUE , WinObject, MainWindowPtr, FALSE);
    } else
    {   setpointer(FALSE, WinObject, MainWindowPtr, FALSE);
    }

    if (mouseisover(GID_GAR_SP1, mousex, mousey))
    {   x = (mousex - gadgets[GID_GAR_SP1]->LeftEdge) / 16;
        y = (mousey - gadgets[GID_GAR_SP1]->TopEdge ) / 16;
        whichtile = IOBuffer[tileoffset(x, y, level)];
        sprintf(newcontents[0], "%02X", whichtile);
    } else
    {   newcontents[0][0] = '-';
        newcontents[0][1] = EOS;
    }
    if (strcmp(newcontents[0], oldcontents[0]))
    {   SetGadgetAttrs(gadgets[GID_GAR_ST32], MainWindowPtr, NULL, STRINGA_TextVal, newcontents[0], TAG_END); // this autorefreshes
        strcpy(oldcontents[0], newcontents[0]);
    }

    if (mouseisover(GID_GAR_SP2, mousex, mousey))
    {   x = (mousex - gadgets[GID_GAR_SP2]->LeftEdge) / 16;
        y = (mousey - gadgets[GID_GAR_SP2]->TopEdge ) / 16;
        index = (y * TILESX) + x;
        if (index >= 0x59)
        {   newcontents[1][0] = '-';
            newcontents[1][1] = EOS;
        } else
        {   whichtile = gad_to_code[index];
            sprintf(newcontents[1], "%02X", whichtile);
    }   }
    else
    {   sprintf(newcontents[1], "%02X", stamp);
    }

    if (strcmp(newcontents[1], oldcontents[1]))
    {   SetGadgetAttrs(gadgets[GID_GAR_ST33], MainWindowPtr, NULL, STRINGA_TextVal, newcontents[1], TAG_END); // this autorefreshes
        strcpy(oldcontents[1], newcontents[1]);
}   }

EXPORT void gar_mouse(SWORD mousex, SWORD mousey)
{   int x, y;

    if (lmb && mouseisover(GID_GAR_SP1, mousex, mousey))
    {   x = (mousex - gadgets[GID_GAR_SP1]->LeftEdge) / 16;
        y = (mousey - gadgets[GID_GAR_SP1]->TopEdge ) / 16;
        if (IOBuffer[tileoffset(x, y, level)] != stamp)
        {   IOBuffer[tileoffset(x, y, level)] = stamp;
            gar_drawmappart(x, y);
}   }   }

EXPORT void gar_lmb(SWORD mousex, SWORD mousey, UWORD code)
{   int index,
        x, y;

    if (code == SELECTUP)
    {   lmb = FALSE;
    } elif (code == SELECTDOWN) // this doesn't repeat
    {   lmb = TRUE;

        if (mouseisover(GID_GAR_SP1, mousex, mousey))
        {   x = (mousex - gadgets[GID_GAR_SP1]->LeftEdge) / 16;
            y = (mousey - gadgets[GID_GAR_SP1]->TopEdge ) / 16;

            if (IOBuffer[tileoffset(x, y, level)] != stamp)
            {   IOBuffer[tileoffset(x, y, level)] = stamp;
                gar_drawmappart(x, y);
        }   }
        elif (mouseisover(GID_GAR_SP2, mousex, mousey))
        {   x = (mousex - gadgets[GID_GAR_SP2]->LeftEdge) / 16;
            y = (mousey - gadgets[GID_GAR_SP2]->TopEdge ) / 16;
            index = (y * TILESX) + x;
            if (index < 0x59)
            {   stamp = gad_to_code[index];
                gar_updatetiles();
}   }   }   }

EXPORT void gar_key(UBYTE scancode, UWORD qual)
{   if
    (   scancode == SCAN_LEFT
     || scancode == SCAN_N4
    )
    {   if
        (   (qual & IEQUALIFIER_LSHIFT)
         || (qual & IEQUALIFIER_RSHIFT)
         || (qual & IEQUALIFIER_CONTROL)
        )
        {   if (level > 1)
            {   readgadgets();
                level = 1;
                gar_getpens();
                writegadgets();
        }   }
        elif
        (   (qual & IEQUALIFIER_LALT)
         || (qual & IEQUALIFIER_RALT)
        )
        {   if (level > 1)
            {   readgadgets();
                if (level < 1 + 5)
                {   level = 1;
                } else
                {   level -= 5;
                }
                gar_getpens();
                writegadgets();
        }   }
        else
        {   readgadgets();
            if (level == 1)
            {   level = 128;
            } else
            {   level--;
            }
            gar_getpens();
            writegadgets();
    }   }
    elif
    (   scancode == SCAN_RIGHT
     || scancode == SCAN_N6
    )
    {   if
        (   (qual & IEQUALIFIER_LSHIFT)
         || (qual & IEQUALIFIER_RSHIFT)
         || (qual & IEQUALIFIER_CONTROL)
        )
        {   if (level < 128)
            {   readgadgets();
                level = 128;
                gar_getpens();
                writegadgets();
        }   }
        elif
        (   (qual & IEQUALIFIER_LALT)
         || (qual & IEQUALIFIER_RALT)
        )
        {   if (level < 128)
            {   readgadgets();
                if (level > 128 - 5)
                {   level = 128;
                } else
                {   level += 5;
                }
                gar_getpens();
                writegadgets();
        }   }
        else
        {   readgadgets();
            if (level == 128)
            {   level = 1;
            } else
            {   level++;
            }
            gar_getpens();
            writegadgets();
}   }   }

MODULE void hiscoreswindow(void)
{   TRANSIENT int    i, j, k;
    TRANSIENT TEXT   tempstr[4 + 1];
    TRANSIENT ULONG  tempnum;
    TRANSIENT STRPTR stringptr;
    PERSIST   WORD   leftx  = -1,
                     topy   = -1,
                     width  = -1,
                     height = -1;

    load_fimage(FUNC_GARRISON);

    InitHook(&ToolSubHookStruct, (ULONG (*)()) ToolSubHookFunc, NULL);
    lockscreen();

    if (!(SubWinObject =
    NewSubWindow,
        WA_SizeGadget,                                 TRUE,
        WA_ThinSizeGadget,                             TRUE,
        WA_Title,                                      "Edit Hall of Fame (High Score Tables)",
        (leftx  != -1) ? WA_Left         : TAG_IGNORE, leftx,
        (topy   != -1) ? WA_Top          : TAG_IGNORE, topy,
        (width  != -1) ? WA_Width        : TAG_IGNORE, width,
        (height != -1) ? WA_Height       : TAG_IGNORE, height,
        (leftx  == -1) ? WINDOW_Position : TAG_IGNORE, WPOS_CENTERMOUSE,
        WINDOW_UniqueID,                               "gar-1",
        WINDOW_ParentGroup,                            gadgets[GID_GAR_LY2] = (struct Gadget*)
        VLayoutObject,
            GA_ID,                                     GID_GAR_LY2,
            LAYOUT_SpaceOuter,                         TRUE,
            LAYOUT_SpaceInner,                         TRUE,
            AddHLayout,
                AddSpace,
                AddFImage(FUNC_GARRISON),
                CHILD_WeightedWidth,                   0,
                AddSpace,
            LayoutEnd,
            CHILD_WeightedHeight,                      0,
            AddHLayout,
                AddVLayout,
                    AddVLayout,
                        LAYOUT_BevelStyle,             BVS_GROUP,
                        LAYOUT_SpaceOuter,             TRUE,
                        LAYOUT_Label,                  "Team",
                        LAYOUT_FillPen,                pens[23],
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN1] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN1,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[0][0],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST1] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST1,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[0][0],
                            StringEnd,
                        LayoutEnd,
                        Label("#1:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN2] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN2,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[0][1],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST2] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST2,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[0][1],
                            StringEnd,
                        LayoutEnd,
                        Label("#2:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN3] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN3,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[0][2],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST3] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST3,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[0][2],
                            StringEnd,
                        LayoutEnd,
                        Label("#3:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN4] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN4,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[0][3],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST4] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST4,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[0][3],
                            StringEnd,
                        LayoutEnd,
                        Label("#4:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN5] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN5,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[0][4],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST5] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST5,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[0][4],
                            StringEnd,
                        LayoutEnd,
                        Label("#5:"),
                    LayoutEnd,
                    AddVLayout,
                        LAYOUT_BevelStyle,             BVS_GROUP,
                        LAYOUT_SpaceOuter,             TRUE,
                        LAYOUT_Label,                  "Wizard",
                        LAYOUT_FillPen,                pens[25],
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN6] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN6,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[1][0],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST6] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST6,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[1][0],
                            StringEnd,
                        LayoutEnd,
                        Label("#1:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN7] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN7,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[1][1],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST7] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST7,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[1][1],
                            StringEnd,
                        LayoutEnd,
                        Label("#2:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN8] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN8,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[1][2],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST8] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST8,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[1][2],
                            StringEnd,
                        LayoutEnd,
                        Label("#3:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN9] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN9,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[1][3],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST9] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST9,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[1][3],
                            StringEnd,
                        LayoutEnd,
                        Label("#4:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN10] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN10,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[1][4],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST10] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST10,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[1][4],
                            StringEnd,
                        LayoutEnd,
                        Label("#5:"),
                    LayoutEnd,
                    AddVLayout,
                        LAYOUT_BevelStyle,             BVS_GROUP,
                        LAYOUT_SpaceOuter,             TRUE,
                        LAYOUT_Label,                  "Valkyrie",
                        LAYOUT_FillPen,                pens[27],
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN11] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN11,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[2][0],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST11] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST11,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[2][0],
                            StringEnd,
                        LayoutEnd,
                        Label("#1:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN12] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN12,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[2][1],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST12] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST12,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[2][1],
                            StringEnd,
                        LayoutEnd,
                        Label("#2:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN13] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN13,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[2][2],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST13] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST13,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[2][2],
                            StringEnd,
                        LayoutEnd,
                        Label("#3:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN14] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN14,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[2][3],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST14] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST14,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[2][3],
                            StringEnd,
                        LayoutEnd,
                        Label("#4:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN15] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN15,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[2][4],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST15] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST15,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[2][4],
                            StringEnd,
                        LayoutEnd,
                        Label("#5:"),
                    LayoutEnd,
                LayoutEnd,
                AddVLayout,
                    AddVLayout,
                        LAYOUT_BevelStyle,             BVS_GROUP,
                        LAYOUT_SpaceOuter,             TRUE,
                        LAYOUT_Label,                  "Warrior",
                        LAYOUT_FillPen,                pens[26],
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN16] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN16,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[3][0],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST16] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST16,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[3][0],
                            StringEnd,
                        LayoutEnd,
                        Label("#1:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN17] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN17,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[3][1],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST17] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST17,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[3][1],
                            StringEnd,
                        LayoutEnd,
                        Label("#2:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN18] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN18,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[3][2],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST18] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST18,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[3][2],
                            StringEnd,
                        LayoutEnd,
                        Label("#3:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN19] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN19,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[3][3],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST19] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST19,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[3][3],
                            StringEnd,
                        LayoutEnd,
                        Label("#4:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN20] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN20,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[3][4],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST20] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST20,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[3][4],
                            StringEnd,
                        LayoutEnd,
                        Label("#5:"),
                    LayoutEnd,
                    AddVLayout,
                        LAYOUT_BevelStyle,             BVS_GROUP,
                        LAYOUT_SpaceOuter,             TRUE,
                        LAYOUT_Label,                  "Elf",
                        LAYOUT_FillPen,                pens[29],
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN21] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN21,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[4][0],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST21] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST21,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[4][0],
                            StringEnd,
                        LayoutEnd,
                        Label("#1:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN22] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN22,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[4][1],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST22] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST22,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[4][1],
                            StringEnd,
                        LayoutEnd,
                        Label("#2:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN23] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN23,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[4][2],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST23] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST23,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[4][2],
                            StringEnd,
                        LayoutEnd,
                        Label("#3:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN24] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN24,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[4][3],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST24] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST24,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[4][3],
                            StringEnd,
                        LayoutEnd,
                        Label("#4:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN25] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN25,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[4][4],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST25] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST25,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[4][4],
                            StringEnd,
                        LayoutEnd,
                        Label("#5:"),
                    LayoutEnd,
                    AddVLayout,
                        LAYOUT_BevelStyle,             BVS_GROUP,
                        LAYOUT_SpaceOuter,             TRUE,
                        LAYOUT_Label,                  "Dwarf",
                        LAYOUT_FillPen,                pens[28],
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN26] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN26,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[5][0],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST26] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST26,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[5][0],
                            StringEnd,
                        LayoutEnd,
                        Label("#1:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN27] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN27,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[5][1],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST27] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST27,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[5][1],
                            StringEnd,
                        LayoutEnd,
                        Label("#2:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN28] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN28,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[5][2],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST28] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST28,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[5][2],
                            StringEnd,
                        LayoutEnd,
                        Label("#3:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN29] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN29,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[5][3],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST29] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST29,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[5][3],
                            StringEnd,
                        LayoutEnd,
                        Label("#4:"),
                        AddHLayout,
                            LAYOUT_AddChild,           gadgets[GID_GAR_IN30] = (struct Gadget*)
                            IntegerObject,
                                GA_ID,                 GID_GAR_IN30,
                                GA_TabCycle,           TRUE,
                                INTEGER_Minimum,       0,
                                INTEGER_Maximum,       99999999,
                                INTEGER_MinVisible,    8 + 1,
                                INTEGER_Number,        score[5][4],
                            IntegerEnd,
                            LAYOUT_AddChild,           gadgets[GID_GAR_ST30] = (struct Gadget*)
                            StringObject,
                                GA_ID,                 GID_GAR_ST30,
                                GA_TabCycle,           TRUE,
                                STRINGA_MaxChars,      4 + 1,
                                STRINGA_MinVisible,    4 + 1,
                                STRINGA_TextVal,       name[5][4],
                            StringEnd,
                        LayoutEnd,
                        Label("#5:"),
                    LayoutEnd,
                LayoutEnd,
            LayoutEnd,
            ClearButton(GID_GAR_BU3, "Clear High Scores"),
            CHILD_WeightedHeight,                      0,
        LayoutEnd,
    WindowEnd))
    {   rq("Can't create gadgets!");
    }
    unlockscreen();
    if (!(SubWindowPtr = (struct Window*) RA_OpenWindow(SubWinObject)))
    {   rq("Can't open window!");
    }
#ifdef MEASUREWINDOWS
    printf(" %d%d\n", SubWindowPtr->Width, SubWindowPtr->Height);
#endif

    DISCARD ActivateLayoutGadget(gadgets[GID_GAR_LY2], SubWindowPtr, NULL, (Object) gadgets[GID_GAR_IN1]);

    subloop();

    for (i = 0; i < 6; i++)
    {   for (j = 0; j < 5; j++)
        {   DISCARD GetAttr(INTEGER_Number,  (Object*) gadgets[GID_GAR_IN1 + (i * 5) + j], (ULONG*) &score[i][j]);
            DISCARD GetAttr(STRINGA_TextVal, (Object*) gadgets[GID_GAR_ST1 + (i * 5) + j], (ULONG*) &stringptr);
            strcpy(name[i][j], stringptr);
    }   }

    // This bubble sorts them from highest to lowest.

    for (i = 0; i < 6; i++)
    {   for (j = 0; j < 5 - 1; j++)
        {   for (k = 0; k < 5 - i - 1; k++)
            {   if
                (   score[i][k    ]
                  < score[i][k + 1]
                )
                {   tempnum         = score[i][k    ];
                    score[i][k    ] = score[i][k + 1];
                    score[i][k + 1] = tempnum;

                    strcpy(tempstr,        name[i][k    ]);
                    strcpy(name[i][k    ], name[i][k + 1]);
                    strcpy(name[i][k + 1], tempstr);
    }   }   }   }

    for (i = 0; i < 6; i++)
    {   for (j = 0; j < 5; j++)
        {   for (k = 0; k < 4; k++)
            {   name[i][j][k] = toupper(name[i][j][k]);
    }   }   }

    leftx  = SubWindowPtr->LeftEdge;
    topy   = SubWindowPtr->TopEdge;
    width  = SubWindowPtr->Width;
    height = SubWindowPtr->Height;

    DisposeObject(SubWinObject);
    SubWinObject = NULL;
    SubWindowPtr = NULL;
}

EXPORT FLAG gar_subkey(UWORD code)
{   switch (code)
    {
    case SCAN_RETURN:
    case SCAN_ENTER:
        return TRUE;
    }

    return FALSE;
}

EXPORT FLAG gar_subgadget(ULONG gid)
{   int i, j;

    switch (gid)
    {
    case GID_GAR_BU3:
        if (ask("Reset to...", "Factory defaults|Clear/zeroed") == 0) // factory defaults
        {   for (i = 0; i < 6; i++)
            {   strcpy(name[i][0], "ABC ");
                strcpy(name[i][1], "DEF ");
                strcpy(name[i][2], "GHI ");
                strcpy(name[i][3], "JKL ");
                strcpy(name[i][4], "MNO ");
                for (j = 0; j < 5; j++)
                {   score[i][j] = 10000;
        }   }   }
        else // clear/zeroed
        {   for (i = 0; i < 6; i++)
            {   for (j = 0; j < 5; j++)
                {   score[i][j] = 0;
                    name[i][j][0] =
                    name[i][j][1] =
                    name[i][j][2] =
                    name[i][j][3] = ' ';
        }   }   }

        for (i = 0; i < 6; i++)
        {   for (j = 0; j < 5; j++)
            {   SetGadgetAttrs(gadgets[GID_GAR_ST1 + (i * 5) + j], SubWindowPtr, NULL, STRINGA_TextVal, name[i][j],  TAG_END); // this autorefreshes
                SetGadgetAttrs(gadgets[GID_GAR_IN1 + (i * 5) + j], SubWindowPtr, NULL, INTEGER_Number,  score[i][j], TAG_END); // this autorefreshes
    }   }   }

    return FALSE;
}

MODULE int tileoffset(int x, int y, int whichlevel)
{  int localoffset;

   if ((whichlevel - 1) % 8 < 4)
   {   whichlevel += 4;
   } else
   {   whichlevel -= 4;
   }

   localoffset = 0x2A808 + (((whichlevel - 1) / 4) * 512) + (whichlevel * 1024) + (y * 32) + x;

   return localoffset;
}
