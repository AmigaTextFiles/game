Set Buffer 500



_VERSION$="$VER=SaveEd 1.02"+Chr$(10)+"© Rune J. Keller 20/02/2000"

_DIR$=Dir$

_PATH$=_DIR$

_PATHMAIN$=_DIR$+"Saves/"

_PATHSWAP$=_DIR$+"Saves/"

_AUTOCHANGE=0



Dim _OPTION$(47)
Dim _INFO$(47)
Dim _INFOTMP$(15)
Dim _GROUP$(47)
Dim _SUBGROUP$(47)
Dim _ADDRESS(47,15,7)
Dim _LENGTH(47)
Dim _VALUE(47)
Dim _MIN(47)
Dim _MAX(47)
Dim _VALUENAME$(47,255)
Dim _VALUENAMETMP$(255)
Dim _VALUENAMETMP(255)
Dim _PREVALUE(47,15)
Dim _PRESTRING$(47,15)
Dim V(47,15,7,9)
Dim _GROUPS(47)
Dim _SUBGROUPS(47)

Dim _OCCURRENCE(255)

Global _OPTION$()
Global _INFO$()
Global _INFOTMP$()
Global _GROUP$()
Global _SUBGROUP$()
Global _ADDRESS()
Global _LENGTH()
Global _VALUE()
Global _MIN()
Global _MAX()
Global _VALUENAME$()
Global _VALUENAMETMP$()
Global _VALUENAMETMP()
Global _PREVALUE()
Global _PRESTRING$()
Global V()
Global _GROUPS()
Global _SUBGROUPS()

Global _OCCURRENCE()

Global _OPTIONS



Gui Amiga 1

Amos To Back 

Gui Sensitive On 

Gui Open 1,1,20

Gui Remember On 



Do 
   
   
   
   _ACTION=Gui Wait
   
   _WINDOW=Gui Window
   
   _CODE=Gui Code
   
   _CODE$=Gui Code$
   
   
   
   If _WINDOW=1
      
      If _ACTION=-2
         
         _MENU=Gui Menu(1)
         
         If _MENU=1
            
            _ITEM=Gui Menu(2)
            
            If _ITEM=1
               
               Gosub _OPENMAIN
               
            Else If _ITEM=2
               
               If Length(10)>0
                  
                  Trap Wsave _PATHMAIN$,10
                  
                  If Errtrap>0
                     _ERROR[1,_PATHMAIN$]
                  End If 
                  
               End If 
               
            Else If _ITEM=3
               
               If Length(10)>0
                  
                  _PATHMAIN$=Gui Asl$("Write Main"+Chr$(0),Path$(_PATHMAIN$)+Chr$(0),Filename$(_PATHMAIN$)+Chr$(0),""+Chr$(0))
                  
                  If _PATHMAIN$<>""
                     
                     Trap Wsave _PATHMAIN$,10
                     
                     If Errtrap>0
                        _ERROR[1,_PATHMAIN$]
                     End If 
                     
                  End If 
               End If 
               
            Else If _ITEM=5
               
               Gosub _OPENMAIN
               
            Else If _ITEM=6
               
               If Length(11)>0
                  
                  Trap Wsave _PATHSWAP$,11
                  
                  If Errtrap>0
                     _ERROR[1,_PATHSWAP$]
                  End If 
                  
               End If 
               
            Else If _ITEM=7
               
               If Length(11)>0
                  
                  _PATHSWAP$=Gui Asl$("Write Swap"+Chr$(0),Path$(_PATHSWAP$)+Chr$(0),Filename$(_PATHSWAP$)+Chr$(0),""+Chr$(0))
                  
                  If _PATHSWAP$<>""
                     
                     Trap Wsave _PATHSWAP$,11
                     
                     If Errtrap>0
                        _ERROR[1,_PATHSWAP$]
                     End If 
                     
                  End If 
                  
               End If 
               
            Else If _ITEM=9
               
               _ABOUT
               
            Else If _ITEM=10
               
               Goto _QUIT
               
            End If 
            
         Else If _MENU=2
            
            _ITEM=Gui Menu(2)
            
            If _ITEM=1
               
               Trap Gui Open 2,2,20
               
               If _OPTIONS>0
                  Gui Set 2,0,1,Array(_OPTION$(0))
               End If 
               
            Else If _ITEM=2
               
               Trap Gui Open 3,3,20
               
               If Errtrap=0
                  
                  Gui Set 3,19,-1,1
                  Gui Set 3,19,1,0
                  Gui Set 3,19,2,0
                  Gui Set 3,19,0,0
                  
               End If 
               
            Else If _ITEM=3
               
               Trap Gui Open 4,4,20
               
            End If 
            
         Else If _MENU=3
            
            _ITEM=Gui Menu(2)

            If _ITEM=1

               Add _AUTOCHANGE,1,0 To 1

            End If 
            
         End If 
         
      Else If _ACTION=-1
         
         Goto _QUIT
         
      Else If _ACTION=0
         
         'Main File 
         
         _PATH$=Gui Read$(1,0)
         
      Else If _ACTION=1
         
         'Swap File 
         
         _PATHSWAP$=Gui Read$(1,2)
         
      Else If _ACTION=2
         
         'Open Main 
         
         Gosub _OPENMAIN
         
      Else If _ACTION=3
         
         'Open Swap 
         
         Gosub _OPENSWAP
         
      Else If _ACTION=4
         
         'Options 
         
         Gui Open 2,2,20
         
         Gosub _OPTIONS
         
      Else If _ACTION=6
         
         'Set 
         
         _CHEAT$=Gui Asl$("Set Fileformat"+Chr$(0),Path$(_DIR$+"Cheats/")+Chr$(0),""+Chr$(0),"#?.CHT"+Chr$(0))
         
         If _CHEAT$<>"" and Exist(_CHEAT$)
            
            Wload _CHEAT$,12
            
            _GETOPTIONS[10,12]
            
            _FORMAT$=Param$
            
            Gui Set 1,5,0,Varptr(_FORMAT$)
            
            Gosub _OPTIONS
            
         End If 
         
      Else If _ACTION=7
         
         'Search
         
         _SEARCH=True
         
         Gui Open 3,3,20
         
         Gui Set 3,19,-1,1
         Gui Set 3,19,1,0
         Gui Set 3,19,2,0
         Gui Set 3,19,0,0
         
      Else If _ACTION=8
         
         Trap Gui Open 4,4,20
         
      Else If _ACTION=9
         
         Goto _QUIT
         
      End If 
      
   Else If _WINDOW=2
      
      If _ACTION=-1
         
         _DUMMY=Gui Close(2)
         
      Else If _ACTION=0
         
         'List
         
         _OPTION=_CODE
         
         Gosub _OPTION
         
      Else If _ACTION=1
         
         'String
         
         _INPUT$=Gui Read$(2,1)
         
         If _AUTOCHANGE=1
            Goto _CHANGE
         End If 
         
      Else If _ACTION=2
         
         'Value 
         
         _INPUT=Val(Gui Read$(2,2))
         
         _DUMMY$=""+Chr$(0)
         
         If _INPUT>_MAX(_OPTION)
            
            _INPUT=_MAX(_OPTION)
            
            _ERROR[6,Str$(_INPUT)-" "]
            
            _INPUT$=Str$(_INPUT)-" "+Chr$(0)
            
            Gui Set 2,2,0,Varptr(_INPUT$)
            
         Else If _INPUT<_MIN(_OPTION)
            
            _INPUT=_MIN(_OPTION)
            
            _ERROR[7,Str$(_INPUT)-" "]
            
            _INPUT$=Str$(_INPUT)-" "+Chr$(0)
            
            Gui Set 2,2,0,Varptr(_INPUT$)
            
         End If 
         
         If _INPUT>-1 and _INPUT<256
            If _VALUENAME$(_OPTION,_INPUT)<>""
               Gui Set 2,3,0,Varptr(_VALUENAME$(_OPTION,_INPUT))
            Else 
               Gui Set 2,3,0,Varptr(_DUMMY$)
            End If 
         Else 
            Gui Set 2,3,0,Varptr(_DUMMY$)
         End If 
         
         If _AUTOCHANGE=1
            Goto _CHANGE
         End If 
         
      Else If _ACTION=3
         
         'Option Name 
         
      Else If _ACTION=4
         
         'Group 
         
         _GROUP=_CODE
         
         Gosub _OPTION
         
      Else If _ACTION=5
         
         'Change  
         
         _INPUT$=Gui Read$(2,1)
         
         _INPUT=Val(Gui Read$(2,2))
         
         _CHANGE:
         
         If _VALUE(_OPTION)=1 or _VALUE(_OPTION)=2 or _VALUE(_OPTION)=5
            
            If _VALUE(_OPTION)=5
               
               _VALUE$=Str$(_VALUE)-" "
               
               _VALUE=0
               
               For A=1 To Len(_VALUE$)
                  
                  _VALUE=_VALUE+Val(Mid$(_VALUE$,A,1))*16
                  
               Next 
               
            End If 
            
            If Length(10)>0
               If _LENGTH(_OPTION)=1
                  Poke Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP),_INPUT
               Else If _LENGTH(_OPTION)=2
                  Doke Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP),_INPUT
               Else If _LENGTH(_OPTION)=4
                  Loke Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP),_INPUT
               End If 
            Else 
               _ERROR[3,""]
            End If 
            
         Else If _VALUE(_OPTION)=3 or _VALUE(_OPTION)=4
            
            _STRING$=Left$(_INPUT$+String$(Chr$(0),_LENGTH(_OPTION)),_LENGTH(_OPTION))
            
            If Length(10)>0
               Poke$ Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP),_STRING$
            Else 
               _ERROR[3,""]
            End If 
            
         Else If _VALUE(_OPTION)=6
            
            If Length(10)>0
               If _LENGTH(_OPTION)=1
                  Poke Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP),_PREVALUE(_OPTION,_INPUT)
               Else If _LENGTH(_OPTION)=2
                  Doke Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP),_PREVALUE(_OPTION,_INPUT)
               Else If _LENGTH(_OPTION)=4
                  Loke Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP),_PREVALUE(_OPTION,_INPUT)
               End If 
            Else 
               _ERROR[3,""]
            End If 
            
         Else If _VALUE(_OPTION)=7
            
            _STRING$=Left$(_PRESTRING$(_OPTION,_INPUT)+String$(Chr$(0),_LENGTH(_OPTION)),_LENGTH(_OPTION))
            
            If Length(10)>0
               Poke$ Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP),_STRING$
            Else 
               _ERROR[3,""]
            End If 
            
         End If 
         
      Else If _ACTION=6
         
         'Reset 
         
         If _VALUE(_OPTION)=1 or _VALUE(_OPTION)=2 or _VALUE(_OPTION)=5 or _VALUE(_OPTION)=6
            
            If _VALUE(_OPTION)=5
               
               _VALUE$=Str$(_VALUE)-" "
               
               _VALUE=0
               
               For A=1 To Len(_VALUE$)
                  
                  _VALUE=_VALUE+Val(Mid$(_VALUE$,A,1))*16
                  
               Next 
               
            End If 
            
            If Length(10)>0 and Length(13)>0
               If _LENGTH(_OPTION)=1
                  Poke Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP),Peek(Start(13)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP))
               Else If _LENGTH(_OPTION)=2
                  Doke Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP),Deek(Start(13)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP))
               Else If _LENGTH(_OPTION)=4
                  Loke Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP),Leek(Start(13)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP))
               End If 
               Gosub _OPTION
            Else 
               _ERROR[3,""]
            End If 
            
         Else If _VALUE(_OPTION)=3 or _VALUE(_OPTION)=4 or _VALUE(_OPTION)=7
            
            _STRING$=Left$(_INPUT$+String$(Chr$(0),_LENGTH(_OPTION)),_LENGTH(_OPTION))
            
            If Length(10)>0 and Length(13)>0
               Poke$ Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP),Peek$(Start(13)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP),_LENGTH(_OPTION))
               Gosub _OPTION
            Else 
               _ERROR[3,""]
            End If 
            
         End If 
         
      Else If _ACTION=7
         
         'Info
         
      Else If _ACTION=8
         
         'Subgroup
         
         _SUBGROUP=_CODE
         
         Gosub _OPTION
         
      Else If _ACTION=9
         
         'Prevalue
         
         _VALUENAME=_CODE
         
         _INPUT=_VALUENAMETMP(_VALUENAME)
         
         _DUMMY$=Str$(_INPUT)-" "+Chr$(0)
         
         Gui Set 2,2,0,Varptr(_DUMMY$)
         
         Gui Set 2,3,0,Varptr(_VALUENAMETMP$(_VALUENAME))
         
         If _AUTOCHANGE=1
            Goto _CHANGE
         End If 
         
      End If 
      
   Else If _WINDOW=3
      
      If _ACTION=-1
         
         _DUMMY=Gui Close(3)
         
      Else If _ACTION=0
         
         'String
         
         _STRINGMAIN$=Gui Read$(3,0)
         
      Else If _ACTION=1
         
         'Swap String 
         
         _STRINGSWAP$=Gui Read$(3,1)
         
      Else If _ACTION=2
         
         'Value 
         
         _VALUEMAIN=Val(Gui Read$(3,2))
         
      Else If _ACTION=3
         
         'Swap Value  
         
         _VALUESWAP=Val(Gui Read$(3,3))
         
      Else If _ACTION=4
         
         'Search
         
         _STRINGMAIN$=Gui Read$(3,0)
         
         If Length(10)=0
            _ERROR[3,""]
            Goto _LOOP
         End If 
         
         Gui Off 1
         Trap Gui Off 2
         Gui Off 3
         
         _OCCURRENCES=0
         
         _LENGTH=Len(_STRINGMAIN$)
         
         For _ADR=0 To Length(10)-1
            
            If Upper$(Peek$(Start(10)+_ADR,Len(_STRINGMAIN$)))=Upper$(_STRINGMAIN$)
               
               _OCCURRENCE(_OCCURRENCES)=_ADR
               
               Inc _OCCURRENCES
               
               If _OCCURRENCES=256
                  
                  _ERROR[2,""]
                  
                  Exit 
                  
               End If 
               
            End If 
            
         Next 
         
         If _OCCURRENCES=0
            
            Gui Set 3,19,-1,1
            Gui Set 3,19,1,0
            Gui Set 3,19,2,0
            Gui Set 3,19,0,0
            
         Else 
            
            Gui Set 3,19,-1,0
            Gui Set 3,19,1,0
            Gui Set 3,19,2,_OCCURRENCES-1
            Gui Set 3,19,0,0
            
         End If 
         
         Gui On 1
         Trap Gui On 2
         Gui On 3
         
         _OCCURENCE=0
         
         Goto _OCCURRENCE
         
      Else If _ACTION=5
         
         'X-Search
         
         _STRINGMAIN$=Gui Read$(3,0)
         
         _STRINGSWAP$=Gui Read$(3,1)
         
         If Length(10)=0
            _ERROR[3,""]
            Goto _LOOP
         End If 
         
         If Length(11)=0
            _ERROR[4,""]
            Goto _LOOP
         End If 
         
         Gui Off 1
         Trap Gui Off 2
         Gui Off 3
         
         _OCCURRENCES=0
         
         _LENGTH=Len(_STRINGMAIN$)
         
         For _ADR=0 To Length(10)-1
            
            If Upper$(Peek$(Start(10)+_ADR,Len(_STRINGMAIN$)))=Upper$(_STRINGMAIN$) and Upper$(Peek$(Start(11)+_ADR,Len(_STRINGSWAP$)))=Upper$(_STRINGSWAP$)
               
               _OCCURRENCE(_OCCURRENCES)=_ADR
               
               Inc _OCCURRENCES
               
               If _OCCURRENCES=256
                  
                  _ERROR[2,""]
                  
                  Exit 
                  
               End If 
               
            End If 
            
         Next 
         
         If _OCCURRENCES=0
            
            Gui Set 3,19,-1,1
            Gui Set 3,19,1,0
            Gui Set 3,19,2,0
            Gui Set 3,19,0,0
            
         Else 
            
            Gui Set 3,19,-1,0
            Gui Set 3,19,1,0
            Gui Set 3,19,2,_OCCURRENCES-1
            Gui Set 3,19,0,0
            
         End If 
         
         Gui On 1
         Trap Gui On 2
         Gui On 3
         
         _OCCURENCE=0
         
         Goto _OCCURRENCE
         
      Else If _ACTION=6
         
         'Byte
         
         _VALUEMAIN=Val(Gui Read$(3,2))
         
         If Length(10)=0
            _ERROR[3,""]
            Goto _LOOP
         End If 
         
         If _VALUEMAIN>255 or _VALUEMAIN<-127
            
            _ERROR[5,""]
            
            If Param=0
               Goto _LOOP
            End If 
            
         End If 
         
         Gui Off 1
         Trap Gui Off 2
         Gui Off 3
         
         _OCCURRENCES=0
         
         _LENGTH=1
         
         For _ADR=0 To Length(10)-1
            
            If Peek(Start(10)+_ADR)=_VALUEMAIN
               
               _OCCURRENCE(_OCCURRENCES)=_ADR
               
               Inc _OCCURRENCES
               
               If _OCCURRENCES=256
                  
                  _ERROR[2,""]
                  
                  Exit 
                  
               End If 
               
            End If 
            
         Next 
         
         If _OCCURRENCES=0
            
            Gui Set 3,19,-1,1
            Gui Set 3,19,1,0
            Gui Set 3,19,2,0
            Gui Set 3,19,0,0
            
         Else 
            
            Gui Set 3,19,-1,0
            Gui Set 3,19,1,0
            Gui Set 3,19,2,_OCCURRENCES-1
            Gui Set 3,19,0,0
            
         End If 
         
         Gui On 1
         Trap Gui On 2
         Gui On 3
         
         _OCCURENCE=0
         
         Goto _OCCURRENCE
         
      Else If _ACTION=7
         
         'Word
         
         _VALUEMAIN=Val(Gui Read$(3,2))
         
         If Length(10)=0
            _ERROR[3,""]
            Goto _LOOP
         End If 
         
         If _VALUEMAIN>65535 or _VALUEMAIN<-32767
            
            _ERROR[5,""]
            
            If Param=0
               Goto _LOOP
            End If 
            
         End If 
         
         Gui Off 1
         Trap Gui Off 2
         Gui Off 3
         
         _OCCURRENCES=0
         
         _LENGTH=2
         
         For _ADR=0 To Length(10)-1
            
            If Deek(Start(10)+_ADR)=_VALUEMAIN
               
               _OCCURRENCE(_OCCURRENCES)=_ADR
               
               Inc _OCCURRENCES
               
               If _OCCURRENCES=256
                  
                  _ERROR[2,""]
                  
                  Exit 
                  
               End If 
               
            End If 
            
         Next 
         
         If _OCCURRENCES=0
            
            Gui Set 3,19,-1,1
            Gui Set 3,19,1,0
            Gui Set 3,19,2,0
            Gui Set 3,19,0,0
            
         Else 
            
            Gui Set 3,19,-1,0
            Gui Set 3,19,1,0
            Gui Set 3,19,2,_OCCURRENCES-1
            Gui Set 3,19,0,0
            
         End If 
         
         Gui On 1
         Trap Gui On 2
         Gui On 3
         
         _OCCURENCE=0
         
         Goto _OCCURRENCE
         
      Else If _ACTION=8
         
         'Long
         
         _VALUEMAIN=Val(Gui Read$(3,2))
         
         If Length(10)=0
            _ERROR[3,""]
            Goto _LOOP
         End If 
         
         Gui Off 1
         Trap Gui Off 2
         Gui Off 3
         
         _OCCURRENCES=0
         
         _LENGTH=4
         
         For _ADR=0 To Length(10)-1
            
            If Leek(Start(10)+_ADR)=_VALUEMAIN
               
               _OCCURRENCE(_OCCURRENCES)=_ADR
               
               Inc _OCCURRENCES
               
               If _OCCURRENCES=256
                  
                  _ERROR[2,""]
                  
                  Exit 
                  
               End If 
               
            End If 
            
         Next 
         
         If _OCCURRENCES=0
            
            Gui Set 3,19,-1,1
            Gui Set 3,19,1,0
            Gui Set 3,19,2,0
            Gui Set 3,19,0,0
            
         Else 
            
            Gui Set 3,19,-1,0
            Gui Set 3,19,1,0
            Gui Set 3,19,2,_OCCURRENCES-1
            Gui Set 3,19,0,0
            
         End If 
         
         Gui On 1
         Trap Gui On 2
         Gui On 3
         
         _OCCURENCE=0
         
         Goto _OCCURRENCE
         
      Else If _ACTION=9
         
         'X-Byte
         
         _VALUEMAIN=Val(Gui Read$(3,2))
         
         _VALUESWAP=Val(Gui Read$(3,3))
         
         If Length(10)=0
            _ERROR[3,""]
            Goto _LOOP
         End If 
         
         If Length(11)=0
            _ERROR[4,""]
            Goto _LOOP
         End If 
         
         If _VALUEMAIN>255 or _VALUEMAIN<-127 or _VALUESWAP>255 or _VALUESWAP<-127
            
            _ERROR[5,""]
            
            If Param=0
               Goto _LOOP
            End If 
            
         End If 
         
         Gui Off 1
         Trap Gui Off 2
         Gui Off 3
         
         _OCCURRENCES=0
         
         _LENGTH=1
         
         For _ADR=0 To Length(10)-1
            
            If Peek(Start(10)+_ADR)=_VALUEMAIN and Peek(Start(11)+_ADR)=_VALUESWAP
               
               _OCCURRENCE(_OCCURRENCES)=_ADR
               
               Inc _OCCURRENCES
               
               If _OCCURRENCES=256
                  
                  _ERROR[2,""]
                  
                  Exit 
                  
               End If 
               
            End If 
            
         Next 
         
         If _OCCURRENCES=0
            
            Gui Set 3,19,-1,1
            Gui Set 3,19,1,0
            Gui Set 3,19,2,0
            Gui Set 3,19,0,0
            
         Else 
            
            Gui Set 3,19,-1,0
            Gui Set 3,19,1,0
            Gui Set 3,19,2,_OCCURRENCES-1
            Gui Set 3,19,0,0
            
         End If 
         
         Gui On 1
         Trap Gui On 2
         Gui On 3
         
         _OCCURENCE=0
         
         Goto _OCCURRENCE
         
      Else If _ACTION=10
         
         'X-Word
         
         _VALUEMAIN=Val(Gui Read$(3,2))
         
         _VALUESWAP=Val(Gui Read$(3,3))
         
         If Length(10)=0
            _ERROR[3,""]
            Goto _LOOP
         End If 
         
         If Length(11)=0
            _ERROR[4,""]
            Goto _LOOP
         End If 
         
         If _VALUEMAIN>65535 or _VALUEMAIN<-32767 or _VALUESWAP>65535 or _VALUESWAP<-32767
            
            _ERROR[5,""]
            
            If Param=0
               Goto _LOOP
            End If 
            
         End If 
         
         Gui Off 1
         Trap Gui Off 2
         Gui Off 3
         
         _OCCURRENCES=0
         
         _LENGTH=2
         
         For _ADR=0 To Length(10)-1
            
            If Deek(Start(10)+_ADR)=_VALUEMAIN and Deek(Start(11)+_ADR)=_VALUESWAP
               
               _OCCURRENCE(_OCCURRENCES)=_ADR
               
               Inc _OCCURRENCES
               
               If _OCCURRENCES=256
                  
                  _ERROR[2,""]
                  
                  Exit 
                  
               End If 
               
            End If 
            
         Next 
         
         If _OCCURRENCES=0
            
            Gui Set 3,19,-1,1
            Gui Set 3,19,1,0
            Gui Set 3,19,2,0
            Gui Set 3,19,0,0
            
         Else 
            
            Gui Set 3,19,-1,0
            Gui Set 3,19,1,0
            Gui Set 3,19,2,_OCCURRENCES-1
            Gui Set 3,19,0,0
            
         End If 
         
         Gui On 1
         Trap Gui On 2
         Gui On 3
         
         _OCCURENCE=0
         
         Goto _OCCURRENCE
         
      Else If _ACTION=11
         
         'X-Long
         
         _VALUEMAIN=Val(Gui Read$(3,2))
         
         _VALUESWAP=Val(Gui Read$(3,3))
         
         If Length(10)=0
            _ERROR[3,""]
            Goto _LOOP
         End If 
         
         If Length(11)=0
            _ERROR[4,""]
            Goto _LOOP
         End If 
         
         Gui Off 1
         Trap Gui Off 2
         Gui Off 3
         
         _OCCURRENCES=0
         
         _LENGTH=4
         
         For _ADR=0 To Length(10)-1
            
            If Leek(Start(10)+_ADR)=_VALUEMAIN and Leek(Start(11)+_ADR)=_VALUESWAP
               
               _OCCURRENCE(_OCCURRENCES)=_ADR
               
               Inc _OCCURRENCES
               
               If _OCCURRENCES=256
                  
                  _ERROR[2,""]
                  
                  Exit 
                  
               End If 
               
            End If 
            
         Next 
         
         If _OCCURRENCES=0
            
            Gui Set 3,19,-1,1
            Gui Set 3,19,1,0
            Gui Set 3,19,2,0
            Gui Set 3,19,0,0
            
         Else 
            
            Gui Set 3,19,-1,0
            Gui Set 3,19,1,0
            Gui Set 3,19,2,_OCCURRENCES-1
            Gui Set 3,19,0,0
            
         End If 
         
         Gui On 1
         Trap Gui On 2
         Gui On 3
         
         _OCCURENCE=0
         
         Goto _OCCURRENCE
         
      Else If _ACTION=12
         
         '(Poke) String 
         
         _STRINGPOKE$=Gui Read$(3,12)
         
      Else If _ACTION=13
         
         'Length
         
         _LENGTHPOKE=Val(Gui Read$(3,13))
         
      Else If _ACTION=14
         
         'Poke (String) 
         
         _STRINGPOKE$=Gui Read$(3,12)
         
         _LENGTHPOKE=Val(Gui Read$(3,13))
         
         _STRING$=Left$(_STRINGPOKE$+String$(Chr$(0),_LENGTHPOKE),_LENGTHPOKE)
         
         Poke$ Start(10)+_ADDRESSPOKE,_STRING$
         
      Else If _ACTION=15
         
         '(Poke) Value
         
         _VALUEPOKE=Val(Gui Read$(3,15))
         
      Else If _ACTION=16
         
         'Poke (Value)
         
         _ADDRESSPOKE=Val(Gui Read$(3,20))
         
         _VALUEPOKE=Val(Gui Read$(3,15))
         
         Poke Start(10)+_ADDRESSPOKE,_VALUEPOKE
         
      Else If _ACTION=17
         
         'Doke (Value)  
         
         _ADDRESSPOKE=Val(Gui Read$(3,20))
         
         _VALUEPOKE=Val(Gui Read$(3,15))
         
         Doke Start(10)+_ADDRESSPOKE,_VALUEPOKE
         
      Else If _ACTION=18
         
         'Loke (Value)
         
         _ADDRESSPOKE=Val(Gui Read$(3,20))
         
         _VALUEPOKE=Val(Gui Read$(3,15))
         
         Loke Start(10)+_ADDRESSPOKE,_VALUEPOKE
         
      Else If _ACTION=19
         
         'Occurence 
         
         _OCCURRENCE=_CODE
         
         _OCCURRENCE:
         
         _ADDRESSPOKE=_OCCURRENCE(_OCCURRENCE)
         
         _ADDRESSPOKE$=Str$(_ADDRESSPOKE)-" "+Chr$(0)
         
         Gui Set 3,20,0,Varptr(_ADDRESSPOKE$)
         
         If _LENGTH=1
            
            _STRING$=Peek$(Start(10)+_ADDRESSPOKE,1)+Chr$(0)
            
            _VALUE$=Str$(Peek(Start(10)+_ADDRESSPOKE))-" "+Chr$(0)
            
         Else If _LENGTH=2
            
            _STRING$=Peek$(Start(10)+_ADDRESSPOKE,2)+Chr$(0)
            
            _VALUE$=Str$(Deek(Start(10)+_ADDRESSPOKE))-" "+Chr$(0)
            
         Else If _LENGTH=4
            
            _STRING$=Peek$(Start(10)+_ADDRESSPOKE,4)+Chr$(0)
            
            _VALUE$=Str$(Leek(Start(10)+_ADDRESSPOKE))-" "+Chr$(0)
            
         Else 
            
            _STRING$=Peek$(Start(10)+_ADDRESSPOKE,_LENGTH)+Chr$(0)
            
            _VALUE$="-"+Chr$(0)
            
         End If 
         
         Gui Set 3,12,0,Varptr(_STRING$)
         
         Gui Set 3,15,0,Varptr(_VALUE$)
         
      Else If _ACTION=20
         
         'Address 
         
         _ADDRESSPOKE=Val(Gui Read$(3,20))
         
      Else If _ACTION=21
         
         'Step
         
         _VALUESTEP=Val(Gui Read$(3,21))
         
      Else If _ACTION=22
         
         'S-Byte
         
         _VALUEMAIN=Val(Gui Read$(3,2))
         
         _VALUESWAP=Val(Gui Read$(3,3))
         
         _VALUESTEP=Val(Gui Read$(3,21))
         
         If Length(10)=0
            _ERROR[3,""]
            Goto _LOOP
         End If 
         
         If _VALUEMAIN>255 or _VALUEMAIN<-127
            
            _ERROR[5,""]
            
            If Param=0
               Goto _LOOP
            End If 
            
         End If 
         
         Gui Off 1
         Trap Gui Off 2
         Gui Off 3
         
         _OCCURRENCES=0
         
         _LENGTH=1
         
         For _ADR=0 To Length(10)-1
            
            If Peek(Start(10)+_ADR)=_VALUEMAIN
               
               _TMPSTEP=1
               
               While _ADR+_TMPSTEP*_VALUESTEP<Length(10)
                  
                  If Peek(Start(10)+_ADR+_TMPSTEP*_VALUESTEP)=_VALUESWAP
                     
                     _OCCURRENCE(_OCCURRENCES)=_ADR
                     
                     Inc _OCCURRENCES
                     
                     If _OCCURRENCES=256
                        
                        _ERROR[2,""]
                        
                        Exit 
                        
                     End If 
                     
                     Exit 
                     
                  End If 
                  
                  Inc _TMPSTEP
                  
               Wend 
               
            End If 
            
         Next 
         
         If _OCCURRENCES=0
            
            Gui Set 3,19,-1,1
            Gui Set 3,19,1,0
            Gui Set 3,19,2,0
            Gui Set 3,19,0,0
            
         Else 
            
            Gui Set 3,19,-1,0
            Gui Set 3,19,1,0
            Gui Set 3,19,2,_OCCURRENCES-1
            Gui Set 3,19,0,0
            
         End If 
         
         Gui On 1
         Trap Gui On 2
         Gui On 3
         
         _OCCURENCE=0
         
         Goto _OCCURRENCE
         
      Else If _ACTION=23
         
         'S-Word
         
         _VALUEMAIN=Val(Gui Read$(3,2))
         
         _VALUESWAP=Val(Gui Read$(3,3))
         
         _VALUESTEP=Val(Gui Read$(3,21))
         
         If Length(10)=0
            _ERROR[3,""]
            Goto _LOOP
         End If 
         
         If _VALUEMAIN>65535 or _VALUEMAIN<-32767
            
            _ERROR[5,""]
            
            If Param=0
               Goto _LOOP
            End If 
            
         End If 
         
         Gui Off 1
         Trap Gui Off 2
         Gui Off 3
         
         _OCCURRENCES=0
         
         _LENGTH=2
         
         For _ADR=0 To Length(10)-1
            
            If Deek(Start(10)+_ADR)=_VALUEMAIN
               
               _TMPSTEP=1
               
               While _ADR+_TMPSTEP*_VALUESTEP<Length(10)
                  
                  If Deek(Start(10)+_ADR+_TMPSTEP*_VALUESTEP)=_VALUESWAP
                     
                     _OCCURRENCE(_OCCURRENCES)=_ADR
                     
                     Inc _OCCURRENCES
                     
                     If _OCCURRENCES=256
                        
                        _ERROR[2,""]
                        
                        Exit 
                        
                     End If 
                     
                     Exit 
                     
                  End If 
                  
                  Inc _TMPSTEP
                  
               Wend 
               
            End If 
            
         Next 
         
         If _OCCURRENCES=0
            
            Gui Set 3,19,-1,1
            Gui Set 3,19,1,0
            Gui Set 3,19,2,0
            Gui Set 3,19,0,0
            
         Else 
            
            Gui Set 3,19,-1,0
            Gui Set 3,19,1,0
            Gui Set 3,19,2,_OCCURRENCES-1
            Gui Set 3,19,0,0
            
         End If 
         
         Gui On 1
         Trap Gui On 2
         Gui On 3
         
         _OCCURENCE=0
         
         Goto _OCCURRENCE
         
      Else If _ACTION=24
         
         'S-Long
         
         _VALUEMAIN=Val(Gui Read$(3,2))
         
         _VALUESWAP=Val(Gui Read$(3,3))
         
         _VALUESTEP=Val(Gui Read$(3,21))
         
         If Length(10)=0
            _ERROR[3,""]
            Goto _LOOP
         End If 
         
         Gui Off 1
         Trap Gui Off 2
         Gui Off 3
         
         _OCCURRENCES=0
         
         _LENGTH=4
         
         For _ADR=0 To Length(10)-1
            
            If Leek(Start(10)+_ADR)=_VALUEMAIN
               
               _TMPSTEP=1
               
               While _ADR+_TMPSTEP*_VALUESTEP<Length(10)
                  
                  If Leek(Start(10)+_ADR+_TMPSTEP*_VALUESTEP)=_VALUESWAP
                     
                     _OCCURRENCE(_OCCURRENCES)=_ADR
                     
                     Inc _OCCURRENCES
                     
                     If _OCCURRENCES=256
                        
                        _ERROR[2,""]
                        
                        Exit 
                        
                     End If 
                     
                     Exit 
                     
                  End If 
                  
                  Inc _TMPSTEP
                  
               Wend 
               
            End If 
            
         Next 
         
         If _OCCURRENCES=0
            
            Gui Set 3,19,-1,1
            Gui Set 3,19,1,0
            Gui Set 3,19,2,0
            Gui Set 3,19,0,0
            
         Else 
            
            Gui Set 3,19,-1,0
            Gui Set 3,19,1,0
            Gui Set 3,19,2,_OCCURRENCES-1
            Gui Set 3,19,0,0
            
         End If 
         
         Gui On 1
         Trap Gui On 2
         Gui On 3
         
         _OCCURENCE=0
         
         Goto _OCCURRENCE
         
      End If 
      
   Else If _WINDOW=4
      
      If _ACTION=-1
         
         _DUMMY=Gui Close(4)
         
      Else If _ACTION=0
         
      Else If _ACTION=1
         
      Else If _ACTION=2
         
         'Address 
         
         _ADDRESS=Val(Gui Read$(4,2))
         
         If _ADDRESS<0
            _ADDRESS=0
         Else If _ADDRESS>Length(10)-1
            _ADDRESS=Length(10)-1
         End If 
         
         _DISPLAY:
         
         Gui Gfx 0,4
         
         _TMPADR=_ADDRESS-_ADDRESS mod 8
         
         For _LINE=-4 To 4
            
            _TEXT$=Right$("00000"+Hex$(_TMPADR+_LINE*8)-"$",5)+": "
            
            Gui Text 20,110+_LINE*16,_TEXT$
            
            For B=0 To 7
               
               P=Peek(Start(10)+_TMPADR+_LINE*8+B)
               
               If _TMPADR+_LINE*8+B=_ADDRESS
                  
                  Gui Paper 1
                  Gui Pen 0
                  
                  P$=Str$(P)-" "+Chr$(0)
                  Gui Set 4,3,0,Varptr(P$)
                  
               Else 
                  
                  Gui Paper 0
                  Gui Pen 1
                  
               End If 
               
               _TEXT$=Right$("00"+Hex$(P)-"$",2)+" "
               
               If _TMPADR+_LINE*8+B<0 or _TMPADR+_LINE*8+B>Length(10)-1
                  Gui Text 64+B*19,110+_LINE*16," "
               Else 
                  Gui Text 64+B*19,110+_LINE*16,_TEXT$
               End If 
               
               If P<32
                  _TEXT$="_"
               Else 
                  _TEXT$=Chr$(P)
               End If 
               
               If _TMPADR+_LINE*8+B<0 or _TMPADR+_LINE*8+B>Length(10)-1
                  Gui Text 232+B*10,110+_LINE*16," "
               Else 
                  Gui Text 232+B*10,110+_LINE*16,_TEXT$
               End If 
               
            Next 
            
         Next 
         
      Else If _ACTION=3
         
         'Value 
         
         _INPUT2=Val(Gui Read$(4,3))
         
      Else If _ACTION=4
         
         _INPUT2=Val(Gui Read$(4,3))
         
         If _INPUT2>255 or _INPUT2<-127
            
            _ERROR[5,""]
            
            If Param=0
               Goto _LOOP
            End If 
            
         End If 
         
         Poke Start(10)+_ADDRESS,_INPUT2
         
         Goto _DISPLAY
         
      End If 
      
   End If 
   
   
   
   _LOOP:
   
   
   
Loop 



_OPENMAIN:

_PATHMAIN$=Gui Asl$("Open Main"+Chr$(0),Path$(_PATHMAIN$)+Chr$(0),Filename$(_PATHMAIN$)+Chr$(0),""+Chr$(0))

If _PATHMAIN$<>"" and Exist(_PATHMAIN$)
   
   Open In 1,_PATHMAIN$
   _LOF=Lof(1)
   Close 1
   
   If _LOF=0
      
      _ERROR[9,_PATHMAIN$]
      
   Else 
      
      For _OPTION=0 To _OPTIONS-1
         
         _OPTION$(_OPTION)=""
         
      Next 
      
      _OPTIONS=0
      
      _GROUPS(0)=0
      
      _GROUP=0
      
      _SUBGROUPS(0)=0
      
      _SUBGROUP=0
      
      Wload _PATHMAIN$,10
      
      ' make a backup of the file
      
      Reserve As Data 13,Length(10)
      
      Copy Start(10),Start(10)+Length(10) To Start(13)
      
      Gui Set 1,0,0,Varptr(_PATHMAIN$)
      
      _FILE$=Filename$(_PATHMAIN$)
      
      _CHECKFILE[10,12]
      
      _FORMAT$=Param$
      
      Gui Set 1,5,0,Varptr(_FORMAT$)
      
      _GETOPTIONS[10,12]
      
      Gosub _OPTIONS
      
   End If 
   
End If 

Return 




_OPENSWAP:

_PATHSWAP$=Gui Asl$("Open Swap"+Chr$(0),Path$(_PATHSWAP$)+Chr$(0),Filename$(_PATHSWAP$)+Chr$(0),""+Chr$(0))

If _PATHSWAP$<>"" and Exist(_PATHSWAP$)
   
   Open In 1,_PATHSWAP$
   _LOF=Lof(1)
   Close 1
   
   If _LOF=0
      
      _ERROR[9,_PATHSWAP$]
      
   Else 
      
      Wload _PATHSWAP$,11
      
      Gui Set 1,1,0,Varptr(_PATHSWAP$)
      
   End If 
   
End If 

Return 



_OPTIONS:

If Gui Exist(2)
   
   Gui Set 2,0,1,Array(_OPTION$(0))
   
   _OPTION=0
   
   Gosub _OPTION
   
End If 

Return 



_OPTION:

_INFOTMP$=_INFO$(_OPTION)+Chr$(10)

For _INFOTMP=0 To 15
   
   If _INFOTMP$=""
      
      _INFOTMP$(_INFOTMP)=""+Chr$(0)
      
   Else 
      
      _INFOTMP$(_INFOTMP)=Left$(_INFOTMP$,Instr(_INFOTMP$,Chr$(10)))
      _INFOTMP$=Right$(_INFOTMP$,Len(_INFOTMP$)-Len(_INFOTMP$(_INFOTMP)))
      
      _INFOTMP$(_INFOTMP)=_INFOTMP$(_INFOTMP)-Chr$(10)+Chr$(0)
      
      If _GROUPS(_OPTION)>0
         
         Inc _INFOTMP
         
         If _GROUP$(_OPTION)<>""
            _INFOTMP$(_INFOTMP)="Group: "+_GROUP$(_OPTION)+" "+Str$(1+_GROUP)-" "+"/"+Str$(_GROUPS(_OPTION))-" "+Chr$(0)
         Else 
            _INFOTMP$(_INFOTMP)="Group: "+Str$(1+_GROUP)-" "+"/"+Str$(_GROUPS(_OPTION))-" "+Chr$(0)
         End If 
         
         If _SUBGROUPS(_OPTION)>0
            
            Inc _INFOTMP
            
            If _SUBGROUP$(_OPTION)<>""
               _INFOTMP$(_INFOTMP)="Sub: "+_SUBGROUP$(_OPTION)+" "+Str$(1+_SUBGROUP)-" "+"/"+Str$(_SUBGROUPS(_OPTION))-" "+Chr$(0)
            Else 
               _INFOTMP$(_INFOTMP)="Sub: "+Str$(1+_SUBGROUP)-" "+"/"+Str$(_SUBGROUPS(_OPTION))-" "+Chr$(0)
            End If 
            
         End If 
         
      End If 
      
   End If 
   
Next 

Gui Set 2,7,1,Array(_INFOTMP$(0))

_GROUP:

If _GROUPS(_OPTION)=0
   
   Gui Set 2,4,-1,1
   Gui Set 2,4,1,0
   Gui Set 2,4,2,0
   Gui Set 2,4,0,0
   
   Gui Set 2,8,-1,1
   Gui Set 2,8,1,0
   Gui Set 2,8,2,0
   Gui Set 2,8,0,0
   
Else 
   
   Gui Set 2,4,-1,0
   Gui Set 2,4,1,0
   Gui Set 2,4,2,_GROUPS(_OPTION)-1
   Gui Set 2,4,0,_GROUP
   
   If _SUBGROUPS(_OPTION)=0
      
      Gui Set 2,8,-1,1
      Gui Set 2,8,1,0
      Gui Set 2,8,2,0
      Gui Set 2,8,0,0
      
   Else 
      
      Gui Set 2,8,-1,0
      Gui Set 2,8,1,0
      Gui Set 2,8,2,_SUBGROUPS(_OPTION)-1
      Gui Set 2,8,0,_SUBGROUP
      
   End If 
   
End If 



Gui Set 2,9,-1,1
Gui Set 2,9,1,0
Gui Set 2,9,2,0
Gui Set 2,9,0,0



_CURRENT=0

_CURRENT$=""



If _VALUE(_OPTION)=1 or _VALUE(_OPTION)=2 or _VALUE(_OPTION)=5
   
   
   
   Gui Set 2,1,-1,1
   Gui Set 2,2,-1,0
   Gui Set 2,3,-1,1
   
   If Length(10)>0
      If _LENGTH(_OPTION)=1
         _CURRENT=Peek(Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP))
      Else If _LENGTH(_OPTION)=2
         _CURRENT=Deek(Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP))
      Else If _LENGTH(_OPTION)=4
         _CURRENT=Leek(Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP))
      End If 
   Else 
      _CURRENT=0
   End If 
   
   If _VALUE(_OPTION)=5
      
      _CURRENT$=Hex$(_CURRENT)-"$"
      
      _CURRENT=0
      
      For A=0 To Len(_CURRENT$)-1
         
         If A=0
            _POWER=1
         Else 
            _POWER=1
            For _DUMMY=1 To A
               _POWER=_POWER*10
            Next 
         End If 
         
         _CURRENT=_CURRENT+Val("$"+Mid$(_CURRENT$,Len(_CURRENT$)-A,1))*_POWER
         
      Next 
      
   End If 
   
   _CURRENT$=Str$(_CURRENT)-" "+Chr$(0)
   
   Gui Set 2,2,0,Varptr(_CURRENT$)
   
   _DUMMY$=""+Chr$(0)
   
   If _CURRENT>-1 and _CURRENT<256
      If _VALUENAME$(_OPTION,_CURRENT)<>""
         Gui Set 2,3,0,Varptr(_VALUENAME$(_OPTION,_CURRENT))
      Else 
         Gui Set 2,3,0,Varptr(_DUMMY$)
      End If 
   Else 
      Gui Set 2,3,0,Varptr(_DUMMY$)
   End If 
   
   
   
Else If _VALUE(_OPTION)=3 or _VALUE(_OPTION)=4
   
   
   
   Gui Set 2,1,-1,0
   Gui Set 2,2,-1,1
   Gui Set 2,3,-1,1
   
   If Length(10)>0
      _CURRENT$=Peek$(Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP),_LENGTH(_OPTION))
   Else 
      _CURRENT$=""
   End If 
   
   Gui Set 2,1,0,Varptr(_CURRENT$)
   
   
   
Else If _VALUE(_OPTION)=6 or _VALUE(_OPTION)=7
   
   
   
   Gui Set 2,1,-1,1
   Gui Set 2,2,-1,0
   Gui Set 2,3,-1,1
   
   If Length(10)>0
      
      If _VALUE(_OPTION)=6
         
         If _LENGTH(_OPTION)=1
            _CURRENT=Peek(Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP))
         Else If _LENGTH(_OPTION)=2
            _CURRENT=Deek(Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP))
         Else If _LENGTH(_OPTION)=4
            _CURRENT=Leek(Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP))
         End If 
         
         ' get pre-number 
         
         For _PRE=0 To 15
            
            If _PREVALUE(_OPTION,_PRE)=_CURRENT
               _CURRENT=_PRE
               Exit 
            End If 
            
         Next 
         
      Else If _VALUE(_OPTION)=7
         
         _CURRENT$=Peek$(Start(10)+_ADDRESS(_OPTION,_GROUP,_SUBGROUP),_LENGTH(_OPTION),Chr$(0))
         
         ' get pre-number 
         
         For _PRE=0 To 5
            
            If _PRESTRING$(_OPTION,_PRE)=_CURRENT$
               _CURRENT=_PRE
               Exit 
            End If 
            
         Next 
         
      End If 
      
   Else 
      _CURRENT=0
   End If 
   
   _CURRENT$=Str$(_CURRENT)-" "+Chr$(0)
   
   Gui Set 2,2,0,Varptr(_CURRENT$)
   
   _DUMMY$=""+Chr$(0)
   
   If _CURRENT>-1 and _CURRENT<256
      If _VALUENAME$(_OPTION,_CURRENT)<>""
         Gui Set 2,3,0,Varptr(_VALUENAME$(_OPTION,_CURRENT))
      Else 
         Gui Set 2,3,0,Varptr(_DUMMY$)
      End If 
   Else 
      Gui Set 2,3,0,Varptr(_DUMMY$)
   End If 
   
   
   
   _VALUENAMES=0
   
   For _VALUETMP=0 To 255
      
      If _VALUETMP=_CURRENT
         _VALUENAME=_VALUENAMES
      End If 
      
      If _VALUENAME$(_OPTION,_VALUETMP)<>""
         
         _VALUENAMETMP$(_VALUENAMES)=_VALUENAME$(_OPTION,_VALUETMP)
         _VALUENAMETMP(_VALUENAMES)=_VALUETMP
         
         Inc _VALUENAMES

      End If 
      
   Next 
   
   If _VALUENAMES=0
      
      Gui Set 2,9,-1,1
      Gui Set 2,9,1,0
      Gui Set 2,9,2,0
      Gui Set 2,9,0,0
      
   Else 
      
      Gui Set 2,9,-1,0
      Gui Set 2,9,2,_VALUENAMES-1
      Gui Set 2,9,0,_VALUENAME
      Gui Set 2,9,1,0
      
   End If 
   
   
   
End If 

Return 



_QUIT:

Erase 10
Erase 11
Erase 12
Erase 13

Gui Reset 

End 




Procedure _CHECKFILE[_BANK,_CHEAT]
   
   
   
   Shared _DIR$,_FILE$
   
   
   
   Examine Dir _DIR$+"Cheats"
   
   
   
   Repeat 
      
      _NEXT:
      
      _CHEAT$=Examine Next$
      
      If _CHEAT$<>"" and Upper$(Right$(_CHEAT$,4))=".CHT"
         
         If Object Type<0
            
            Wload _DIR$+"Cheats/"+_CHEAT$,_CHEAT
            
            
            
            _NAME$=""
            
            _AUTHOR$=""
            
            
            
            _ADR=0
            
            _TEST=False
            
            _TESTAND=True
            
            
            
            Repeat 
               
               
               
               _LINE$=Peek$(Start(_CHEAT)+_ADR,-1,Chr$(10))
               
               Add _ADR,Len(_LINE$)+1
               
               
               
               If _LINE$<>"" and Left$(_LINE$,1)<>";"
                  
                  
                  If Instr(_LINE$,"=")>0
                     
                     _COMMAND$=Upper$(Left$(_LINE$,Instr(_LINE$,"=")-1))
                     
                     While Left$(_COMMAND$,1)=" " or Left$(_COMMAND$,1)=Chr$(9)
                        _COMMAND$=Right$(_COMMAND$,Len(_COMMAND$)-1)
                     Wend 
                     
                     While Right$(_COMMAND$,1)=" " or Right$(_COMMAND$,1)=Chr$(9)
                        _COMMAND$=Left$(_COMMAND$,Len(_COMMAND$)-1)
                     Wend 
                     
                     
                     
                     _VALUE$=Right$(_LINE$,Len(_LINE$)-Instr(_LINE$,"="))
                     
                     While Left$(_VALUE$,1)=" " or Left$(_VALUE$,1)=Chr$(9)
                        _VALUE$=Right$(_VALUE$,Len(_VALUE$)-1)
                     Wend 
                     
                     While Right$(_VALUE$,1)=" " or Right$(_VALUE$,1)=Chr$(9)
                        _VALUE$=Left$(_VALUE$,Len(_VALUE$)-1)
                     Wend 
                     
                  Else 
                     
                     _COMMAND$=Upper$(_LINE$)
                     
                     _VALUE$=""
                     
                  End If 
                  
                  
                  
                  If _COMMAND$="NAME"
                     
                     _NAME$=_VALUE$
                     
                  Else If _COMMAND$="AUTHOR"
                     
                     _AUTHOR$=_VALUE$
                     
                  Else If _COMMAND$="FILENAME"
                     
                     _FILENAME$=Upper$(_VALUE$)
                     
                     If Instr(_FILENAME$,"*")>0
                        
                        _FILENAME$="@"+_FILENAME$+"@"
                        
                        _MID=Instr(_FILENAME$,"*")
                        
                        If Left$(Upper$("@"+_FILE$),_MID-1)=Left$(_FILENAME$,_MID-1) and Right$(Upper$("@"+_FILE$+"@"),Len(_FILENAME$)-_MID)=Right$(_FILENAME$,Len(_FILENAME$)-_MID)
                           _TEST=True
                        End If 
                        
                     Else If Instr(_FILENAME$,"#?")>0
                        
                        _FILENAME$="@"+_FILENAME$+"@"
                        
                        _MID=Instr(_FILENAME$,"#?")
                        
                        If Left$(Upper$("@"+_FILE$),_MID-1)=Left$(_FILENAME$,_MID-1) and Right$(Upper$("@"+_FILE$+"@"),Len(_FILENAME$)-_MID-1)=Right$(_FILENAME$,Len(_FILENAME$)-_MID-1)
                           _TEST=True
                        End If 
                        
                     Else 
                        
                        If Upper$(_FILE$)=_FILENAME$
                           _TEST=True
                        End If 
                        
                     End If 
                     
                  Else If _COMMAND$="SIZE"
                     
                     If Length(_BANK)=Val(_VALUE$)
                        _TEST=True
                     End If 
                     
                  Else If _COMMAND$="POSITION"
                     
                     _POSITION=Val(_VALUE$)
                     
                  Else If _COMMAND$="MATCH"
                     
                     _MATCH$=_VALUE$
                     
                     If Left$(_MATCH$,1)="$"
                        
                        _HEX$=Right$(_MATCH$,Len(_MATCH$)-1)
                        
                        _MATCH$=""
                        
                        For _ASC=1 To Len(_HEX$)/2
                           
                           _MATCH$=_MATCH$+Chr$(Val("$"+Mid$(_HEX$,1+(_ASC-1)*2,2)))
                           
                        Next 
                        
                     End If 
                     
                     If Peek$(Start(_BANK)+_POSITION,Len(_MATCH$))=_MATCH$
                        _TEST=True
                     End If 
                     
                  Else If _COMMAND$="AND"
                     
                     If _TEST=True
                        _TESTAND=True
                        _TEST=False
                     Else 
                        _TESTAND=False
                        _TEST=False
                     End If 
                     
                  Else If _COMMAND$="OR"
                     
                     If _TEST=True and _TESTAND=True
                        Pop Proc[_NAME$]
                     Else 
                        _TEST=False
                        _TESTAND=True
                     End If 
                     
                  Else If _COMMAND$="END"
                     
                     If _TEST=True and _TESTAND=True
                        Pop Proc[_NAME$]
                     Else 
                        Goto _NEXT
                     End If 
                     
                  End If 
                  
                  
                  
               End If 
               
               
               
            Until _ADR=>Length(_CHEAT)
            
            
            
         End If 
         
      End If 
      
   Until _CHEAT$=""
   
   
   
   Trap Erase _CHEAT
   
   
   
End Proc[-1]



Procedure _GETOPTIONS[_BANK,_CHEAT]
   
   
   
   _LOOP=False
   _REPEATS=0
   
   _BASE=0
   
   For _DUMMY1=0 To 47
      For _DUMMY2=0 To 255
         _VALUENAME$(_DUMMY1,_DUMMY2)=""
      Next 
   Next 
   
   For _OPTION=0 To _OPTIONS
      _OPTION$(_OPTION)=""
   Next 
   
   _OPTIONS=0
   
   _NAME$="(Unknown)"
   _AUTHOR$="(None)"
   
   
   
   If Length(_CHEAT)=0
      Pop Proc[-1]
   End If 
   
   
   
   Repeat 
      
      
      
      _LINE$=Peek$(Start(_CHEAT)+_ADR,-1,Chr$(10))
      
      Add _ADR,Len(_LINE$)+1
      
      
      
      If _LINE$<>"" and Left$(_LINE$,1)<>";"
         
         
         If Instr(_LINE$,"=")>0
            
            _COMMAND$=Upper$(Left$(_LINE$,Instr(_LINE$,"=")-1))
            
            While Left$(_COMMAND$,1)=" " or Left$(_COMMAND$,1)=Chr$(9)
               _COMMAND$=Right$(_COMMAND$,Len(_COMMAND$)-1)
            Wend 
            
            While Right$(_COMMAND$,1)=" " or Right$(_COMMAND$,1)=Chr$(9)
               _COMMAND$=Left$(_COMMAND$,Len(_COMMAND$)-1)
            Wend 
            
            
            
            _VALUE$=Right$(_LINE$,Len(_LINE$)-Instr(_LINE$,"="))
            
            While Left$(_VALUE$,1)=" " or Left$(_VALUE$,1)=Chr$(9)
               _VALUE$=Right$(_VALUE$,Len(_VALUE$)-1)
            Wend 
            
            While Right$(_VALUE$,1)=" " or Right$(_VALUE$,1)=Chr$(9)
               _VALUE$=Left$(_VALUE$,Len(_VALUE$)-1)
            Wend 
            
         Else 
            
            _COMMAND$=Upper$(_LINE$)
            
            _VALUE$=""
            
         End If 
         
         
         
         If _COMMAND$="NAME"
            
            _NAME$=_VALUE$
            
         Else If _COMMAND$="AUTHOR"
            
            _AUTHOR$=_VALUE$
            
         Else If _COMMAND$="OPTION"
            
            _OPTION$(_OPTIONS)=_VALUE$
            
            Inc _OPTIONS
            
            _INFO$(_OPTIONS-1)=_VALUE$
            
            _GROUPS(_OPTIONS-1)=_REPEATS
            
            _GROUP$(_OPTIONS-1)=_GROUP$
            
            _SUBGROUPS(_OPTIONS-1)=_SUBREPEATS
            
            _SUBGROUP$(_OPTIONS-1)=_SUBGROUP$
            
         Else If _COMMAND$="INFO"
            
            _INFO$(_OPTIONS-1)=_INFO$(_OPTIONS-1)+Chr$(10)+_VALUE$
            
         Else If _COMMAND$="ADDRESS"
            
            For _GROUP=0 To Max(0,_REPEATS-1)
               
               For _SUBGROUP=0 To Max(0,_SUBREPEATS-1)
                  
                  If Instr(_VALUE$,"+")>0 or Instr(_VALUE$,"-")>0 or Instr(_VALUE$,"*")>0 or Instr(_VALUE$,"/")>0 or Instr(Upper$(_VALUE$),"V")>0
                     
                     V=0
                     V$=""
                     _OPERATOR=0
                     
                     For I=1 To Len(_VALUE$)
                        
                        I$=Mid$(_VALUE$,I,1)
                        
                        If Instr("$0123456789abcdef",I$)>0
                           
                           V$=V$+I$
                           
                           If I=Len(_VALUE$)
                              
                              If _OPERATOR=0
                                 V=V+Val(V$)
                              Else If _OPERATOR=1
                                 V=V-Val(V$)
                              Else If _OPERATOR=2
                                 V=V*Val(V$)
                              Else If _OPERATOR=3
                                 V=V/Val(V$)
                              End If 
                              
                           End If 
                           
                        Else If I$="+" or I$="-" or I$="*" or I$="/"
                           
                           If _OPERATOR=0
                              V=V+Val(V$)
                           Else If _OPERATOR=1
                              V=V-Val(V$)
                           Else If _OPERATOR=2
                              V=V*Val(V$)
                           Else If _OPERATOR=3
                              V=V/Val(V$)
                           End If 
                           
                           If I$="+"
                              _OPERATOR=0
                           Else If I$="-"
                              _OPERATOR=1
                           Else If I$="*"
                              _OPERATOR=2
                           Else If I$="/"
                              _OPERATOR=3
                           End If 
                           
                           V$=""
                           
                        Else If Upper$(I$)="V"
                           
                           V$=Str$(V(_OPTIONS-1,_GROUP,_SUBGROUP,Val(Mid$(_VALUE$,I+1,1))))-" "
                           
                           I=I+1
                           
                        End If 
                        
                     Next 
                     
                     _ADDRESS=V+_BASE+_GROUP*_STEP+_SUBGROUP*_SUBSTEP
                     
                  Else 
                     
                     _ADDRESS=Val(_VALUE$)+_BASE+_GROUP*_STEP+_SUBGROUP*_SUBSTEP
                     
                  End If 
                  
                  _ADDRESS(_OPTIONS-1,_GROUP,_SUBGROUP)=_ADDRESS
                  
               Next 
               
            Next 
            
         Else If _COMMAND$="LENGTH"
            
            _LENGTH(_OPTIONS-1)=Val(_VALUE$)
            
            If _LENGTH(_OPTIONS-1)=1
               
               _MIN(_OPTIONS-1)=-127
               
               _MAX(_OPTIONS-1)=255
               
            Else If _LENGTH(_OPTIONS-1)=2
               
               _MIN(_OPTIONS-1)=-32767
               
               _MAX(_OPTIONS-1)=65535
               
            Else If _LENGTH(_OPTIONS-1)=4
               
               _MIN(_OPTIONS-1)=-2^31
               
               _MAX(_OPTIONS-1)=2^32
               
            End If 
            
         Else If _COMMAND$="VALUE"
            
            _VALUE(_OPTIONS-1)=Val(_VALUE$)
            
         Else If Left$(_COMMAND$,9)="VALUENAME"
            
            _VAL=Val(Right$(_COMMAND$,Len(_COMMAND$)-Instr(_COMMAND$,".")))
            
            _VAL=Max(0,Min(255,_VAL))
            
            _VALUENAME$(_OPTIONS-1,_VAL)=_VALUE$
            
         Else If Left$(_COMMAND$,8)="PREVALUE"
            
            _VAL=Val(Right$(_COMMAND$,Len(_COMMAND$)-Instr(_COMMAND$,".")))
            
            _VAL=Max(0,Min(15,_VAL))
            
            _PREVALUE(_OPTIONS-1,_VAL)=Val(_VALUE$)
            
         Else If Left$(_COMMAND$,9)="PRESTRING"
            
            _VAL=Val(Right$(_COMMAND$,Len(_COMMAND$)-Instr(_COMMAND$,".")))
            
            _VAL=Max(0,Min(15,_VAL))
            
            _PRESTRING$(_OPTIONS-1,_VAL)=_VALUE$
            
         Else If _COMMAND$="MIN"
            
            _MIN(_OPTIONS-1)=Val(_VALUE$)
            
         Else If _COMMAND$="MAX"
            
            _MAX(_OPTIONS-1)=Val(_VALUE$)
            
         Else If _COMMAND$="BASE"
            
            _BASE=Val(_VALUE$)
            
         Else If _COMMAND$="GROUP"
            
            If _LOOP=True
               _SUBGROUP$=_VALUE$
            Else 
               _GROUP$=_VALUE$
            End If 
            
         Else If _COMMAND$="DO"
            
            If _LOOP=True
               _SUBLOOP=True
               _SUBREPEATS=Val(_VALUE$)
            Else 
               _LOOP=True
               _REPEATS=Val(_VALUE$)
            End If 
            
         Else If _COMMAND$="STEP"
            
            If _LOOP=True
               _SUBSTEP=Val(_VALUE$)
            Else 
               _STEP=Val(_VALUE$)
            End If 
            
         Else If _COMMAND$="LOOP"
            
            If _SUBLOOP=True
               _SUBLOOP=False
               _SUBREPEATS=0
               _SUBSTEP=0
               _SUBGROUP$=""
            Else 
               _LOOP=False
               _REPEATS=0
               _STEP=0
               _GROUP$=""
            End If 
            
         Else If _COMMAND$="READ"
            
            V=Val(_VALUE$-"V")
            
            For _GROUP=0 To Max(0,_REPEATS-1)
               
               If _LENGTH(_OPTIONS-1)=1
                  V(_OPTIONS-1,_GROUP,_SUBGROUP,V)=Peek(Start(_BANK)+_ADDRESS(_OPTIONS-1,_GROUP,_SUBGROUP))
               Else If _LENGTH(_OPTIONS-1)=2
                  V(_OPTIONS-1,_GROUP,_SUBGROUP,V)=Deek(Start(_BANK)+_ADDRESS(_OPTIONS-1,_GROUP,_SUBGROUP))
               Else If _LENGTH(_OPTIONS-1)=4
                  V(_OPTIONS-1,_GROUP,_SUBGROUP,V)=Leek(Start(_BANK)+_ADDRESS(_OPTIONS-1,_GROUP,_SUBGROUP))
               End If 
               
            Next 
            
         End If 
         
      End If 
      
      
      
   Until _ADR=>Length(_CHEAT)
   
   
   
   Erase 12
   
   
   
End Proc[_NAME$]



Procedure _ERROR[_ERROR,_VALUE$]
   
   
   
   _BUTTON$="Ok"
   
   
   
   If _ERROR=1
      
      _ERROR$="Could not save file '"+_VALUE$+"'"
      
   Else If _ERROR=2
      
      _ERROR$="Found more than 256 occurences."+Chr$(10)+"Only the first 256 occurences will be shown."
      
   Else If _ERROR=3
      
      _ERROR$="No main file is loaded."
      
   Else If _ERROR=4
      
      _ERROR$="No swap file is loaded."
      
   Else If _ERROR=5
      
      _ERROR$="The requested value is too large."+Chr$(10)+"Continue anyway?"
      
      _BUTTON$="Yes|No"
      
   Else If _ERROR=6
      
      _ERROR$="Maximum value for this option is "+_VALUE$+"."
      
   Else If _ERROR=7
      
      _ERROR$="Minimum value for this option is "+_VALUE$+"."
      
   Else If _ERROR=8
      
      _ERROR$="SaveEd 1.00"+Chr$(10)+"(C) Copyright Rune Keller 1999"+Chr$(10)+"keller@vip.cybercity.dk"
      
   Else If _ERROR=9
      
      _ERROR$="Could not load file '"+_VALUE$+"'. The file is empty."
      
   End If 
   
   
   
   _DUMMY=Gui Req("Error",_ERROR$,_BUTTON$)
   
   
   
End Proc[_DUMMY]



Procedure _ABOUT
   
   
   
   _DUMMY=Gui Req("About","SaveEd 1.00"+Chr$(10)+"(C) Copyright Rune Keller 1999"+Chr$(10)+"keller@vip.cybercity.dk","Ok")
   
   
   
End Proc[_DUMMY]
