			-*- outline -*-

* Timeline

BETA3 adds sound.
At BETA3 there is a feature freeze until 1.0.
Just bug fixes and graphical polish are allowed.

After 1.0, major new tile and level features
(messages, tile variations, robots) are planned.

Actually, this is inaccurate, since I jumped the
gun on implementing new tiles and bots. ;)

* Current Projects

** Robots
*** regressions for dalek, hugbot

** Fix levels
*** Skirting the Issue (cooked by max)
*** Splitsville (cooked by everyone)

** Web Page
*** screenshots!
**** new level screenshots (new player!)
**** some screenshot with animation (BETA3)
**** New level browser screenshot
**** bots
*** buttons / banners for links    (BETA3?)
**** walking escapist


** level notes.
   grand prix: first blue to the left (stop at ud slider),
   then blue down, send red left then up.

** Upgrade System (BETA3)
*** important! 
   there is no clean way to download frameworks
   in upgrade, because the frameworks dir is ..
   from the MacOS dir, which is the "home" for
   escape. 

   currently we use a hack where the framework
   is in the macos dir and we create exclusively 
   symlinks in the frameworks dir 

   could perhaps replace .. with @ or something
   when fetching from web?
 
*** prevent upgrade when user-compiled on linux

** Animation
*** make things snappier/smoother
**** holding down key should work
**** move while animation is playing?
  (rather than cancel, as we currently do,
   maybe we could just add the animations
   into the queue?)
  some animations could fly around in the
  background while the player continues
  to move. a generic disambiguation system
  would be perfect for this..
**** try to make it so that if the player
    will move in some phase, that the
    movement phase is first. this gives
    more snappy-feeling movement (see
    max's chamber, my favorite test case)
*** make yellow slide lr more like ud
*** speed pref?
*** turn on/off anim in level?
*** test scrolling                 (BETA3)
*** frames_error[] for defaults    (BETA3)
*** player                         (BETA3)
**** player pushing udlr           (BETA3?)
  should lean over, so hands are actually
  up against the block!
**** player 'pressing'
  could be same as push anim (still) for now
**** player 'kicking'
  could be same as press anim for now
**** teleport
**** laser death
***** could be improved (laser flicks off?)
***** improve: laser from below can go to chest
*** traps
**** improve trap2 -> trap1
*** wires animation
**** anim for button
*** stepping on panel?
*** replace jiggle with individual anims for
    each sphere, including the last one when
    it doesn't move
*** bugs:
*** panel (un)triggered when stepping into a
    teleporter doesn't animate!
*** jumping back'n'forth at end of "Don't Touch That, Hugbot"
*** jiggle animation can be wrong (see animation.cpp)
*** push a series of steel blocks off the 
    screen; the last one does not move, it
    just gets overwritten by the one before it
*** stepping onto an exit that is disappearing
    (because we're stepping off a panel) still
    draws the door open anim
    .. this is not really semantically wrong,
    but the two actions should be in different
    phases, at least.

** Sound                                 (BETA3)
*** option on/off
*** Add some sounds in animation::start
**** note, what I'm doing now is bad, because
     it can't sync sounds with anwaits

** Usability
*** Installer
**** prompt to run when done installing
**** choose directory allow typing
*** File browser: rename files
*** Handhold
**** suggest register (when?)
**** suggest tutorial (when any remains)

** net stuff??
*** register player
**** now we do care about cryptographic randomness
**** probably better to use passwords so a player can share
      logins across multiple machines
*** viewing comments
**** from game
*** ability to share solutions
**** and see them from game, of course
**** player should be able to store several solutions (with names) 
     for each game, and manage them
*** sync ratings automatically, perhaps when updating.
    (should set a flag to say that some ratings have
     been unsent -- or could do this rating by rating)

** Code cleanup
*** base64 not used
*** triage xxx/fixme/perf
*** split up deeply nested code
**** main.cpp
***** this shouldn't all be in main, anyway
**** edit.cpp !
*** abstract interfaces (as in http.h) where possible
**** edit.h
**** level.h ?
**** play.h (still needs cleanup)
*** rationalize treatment of SDL_QUIT message
*** get rid of msg in upgrade/update. it is redundant.

** Bugs
*** mac users with single-button mice can't use selection rectangle, etc
*** selection rectangle doesn't scale correctly in editor
*** in maximized window on win32, some tiles are cut off at top??
*** CRASH: randstyle 7 on blank level
*** editor doesn't show msg when zoomed out. This is bad, especially
    in "choose destination" mode
*** sound is not synchronized with animations that use anwait
*** CRASH on ToF? v2 when pushing grey blocks (can't reproduce, valgrinds ok)
*** on OSX, mainshow is not dimmed. (it's yellow! -- byte order stuff?)
*** start game. don't move mouse. (or put it above the topmost
    level on load screen)
    go to load screen, scroll down and sit there for a while
    level jumps up by 6 or so!!   (BETA3?!)
*** OSX has different menu selected color, because of byte order
*** packpng does not run when compiled with VS.NET (on laptop)
*** win32: makefile doesn't stop if packpng returns -1
*** valgrind warns on closedir: "mutex is still in use" (??)
*** Load
**** hit esc from a directory two levels deep. now re-enter load
    screen and go to .. --- it sends you straight to the root.
*** Delete players.esd, then start escape -- it tries to create
    default player, but then fails
*** LIBPNG has security holes and should be upgraded on platforms where
    it is shipped. Escape doesn't load untrusted pngs, but one day we
    may support a skin system, at which point this would become
    potentially exploitable.

    Unfortunately, word has it that SDL_Image uses an ancient libpng
    API, so we may be screwed.
*** hit 1 to load. remove one of the directories from the command line. 
    try to change to it. now, you won't be able to change to anything
    because the path will be screwed up.

    ie:
    where: './attic-old/attic-old/fixme/fixme/official/triage/triage/attic-old'

*** textbox: extra word wrapping 
    this is a longer line\n
    shorterline
    where line + shorterline is too long to fit
*** leaks
**** editing
      .. some leaks in retract
*** pass allow_corrupted to dircache too (it doesn't count them now)
*** if player has a solution stored that is wrong (doesn't validate),
    then only shorter solutions can overwrite it -- any correct one
    should (or incorrect ones should be deleted automatically?)
*** warning: unsigned/signed comparison in util
*** valgrind: randstyle illegal read (see editai)
   this mode is currently disabled, and it sucks anyway...
*** edit allows load over changed level
   though we warn for most other actions that destroy an unsaved level

** Hardening
*** automatically back up player file 
**** recover player should let you pick from a list
*** make a pass over with 
**** deleted/corrupted files
**** no disk space / read-only drive
  From first start, we can't do anything because
  there is no default.esp and we can't make it.
  Also, SDL tries to create files, at least on win32,
  before we even get control.
**** interrupted network connection
**** really long inputs
**** totally empty root dir (no .. entry)

** Perf
*** put a printf in "readfilemagic". I still think we read files
  multiple times on load as .\triage\lev  and triage\lev
*** 2.6 gigs of allocation?
    I think that some of the retraction stuff must be very allocation-heavy.
    Playing with it just a little results in 2.6 gigs of allocation!!! (which
    is ultimately freed...)

    Actually I saw this without doing retraction (only a few hundred megs in
    that case). String stuff?
==12334==
==12334== ERROR SUMMARY: 279 errors from 4 contexts (suppressed: 185 from 4)
==12334== malloc/free: in use at exit: 2154726 bytes in 451 blocks.
==12334== malloc/free: 4546124 allocs, 4545673 frees, 2649989249 bytes allocated.

*** more aggressive caching for dirs? (like what?)
*** load performance
   With the progress indicator, this becomes much less painful!

   We now cache solutions, but this doesn't help much.

   After profiling (with levels in cache disk), we learn that
   the time is indeed spent loading and verifying the levels.
   The right thing to do here is to not be recursive, and maybe
   even to delay doing stuff like solution checking until we
   need to actually display them on the screen.

   On windows, there seems to be a lot of disk thrashing on the
   first launch (until the files get in cache)...


** Little nice things
*** load: sort by age
*** escape.spacebar.org link on title screen
*** if escape is started through a symlink (linux), it should
    find its 'real' location. (It may fail to find libs this way, btw)
*** improve general mm icon color scheme
*** playback of solution while rating/commenting
*** time-based progress indication for update
*** Mainshow
**** make the levels more interesting
    .. load some from triage?
*** sad face for when reporting errors (like, "your comment was lost")
*** show nsolved ncooked (in sideinfo)
    not sure if this is a good idea
*** "you solved it" centered wrt level, not screen?
*** rate while playing a level?
**** tie in rating with commenting?
*** scrolling arrows centered wrt drawing, not level
*** in editor, can't scroll to set destination of teleport/panel
   .. this may be desirable to discourage non-local effects
*** way to minimize app with keystroke
*** player selector
**** show player details at bottom, like on load screen?
***** might want to save more info, then


** Graphics
*** QICON kind of sucks
*** THINSPACE, NEGSPACE and other 'magic' formatting characters
*** hand anti-alias the font
*** implement 'color stack' for fonts 
**** font::closestack
  .. adds and removes pops to make parens balanced.

** "messages" in escape levels
*** prompts (waits keypress)
*** status line
*** 'hint' flag with 'hinting' mode

** solution playback
  as a key from load screen
  .. sort of redundant now that the solutions are shown

** editor fanciness
*** random styles and random generator
**** 'pattern' matching system
**** overwrite yes/no
**** retract1
*** undo
*** drag off edge causes line to edge, at least

** player file size
02/14/2005  06:39 PM            59,701 tom.esp
01/06/2005  01:12 PM            50,140 tom.esp
-rw-r--r--    1 tom7     users       48929 Jun 23 13:27 tom.esp
-rw-r--r--    1 tom7     users       33669 Jun 23 19:54 tom.esp (sub-byte encodings)
*** in rleencode, write smaller frame headers
    rledecode already supports this.
*** improve solution optimization
    (look for shorter paths between level-changing events)
    it seems that some of the reachability stuff should
    make this pretty easy. 

    even simpler, just replay the solutions, and if we ever reach
    the same x/y location twice, try deleting the series
    of moves in-between, and re-validating the solution.
*** prune solutions in player files 
   (ie, restrict to files actually on disk!!)
   ... tom's is growing pretty big now.


** Little nice things
*** init_flips still seems wrong. Pitched
    rectangle doesn't have height h (TILEH)
    in its center!
*** zooming
    make tileu buttons for it
*** center the drawing (horizontally, at least) 
    when I can't fit all tiles. 
    (also when I can ?!)
*** draw alpha-dimmed tiles around border?
     (tilesdim is now there.)
**** draw it!

** Fancy graphics
*** hq2x version for very high resolutions?
*** meld adjacent blue blocks, etc.
   this will interfere badly with animation, so it's
   probably not worth it.
*** select source dir for game graphics ("skins")
**** useful to have 'color blind' option (turns anims off,
                                          probably)
*** select other player graphics
*** tile backgrounds
   should be purely graphical (not affecting gameplay)
   esp 'exit' in like, choochu shuba
   (use 'dest' to find background tile? -- no, that's
    messy. just use a new layer, like:)
*** variations layer
   another layer with variations for the tiles (mainly
   static items like floor, exit, walls, black). I think
   this is superior to the "tile background" hack above

** Build system
*** after make upgrade on windows, md5.obj is messed
*** make recommend (etc.)

** new tiles
** one-way tiles (a la lolo)

*** more bots
**** move in a certain direction
    (then we want 'direction' tiles to change the robot's direction)
**** 'don medusa' moving laser
    
*** powers that can be picked up
**** bridge, a la lolo
    (crosses what, water?)
**** zapper: when pressing against a block that
     can't be moved, vaporize it (use once)
     .. shouldn't apply to blue; we need a nice-looking
     invincible block
**** key?
     different colors, and they unlock specific doors
*** brian's 4-way POOF! block
    .. needs generic disembodied 'push' routine
    - good if triggered by wires?
*** 4x4 rotator. when pressed, it rotates its target
    4x4 squares clockwise.
*** warp to bizarro world??
*** tile creator 
    (if to its left/right/whatever, there is floor and no
     guy, create a block. maybe this would work better as
     a single tile that creates blocks on itself)
    (could be triggered by a button?)
    (could copy whatever is to its right, etc.?)
*** "heart framers" -- if any exist in the level, the
    exit will be unavailable (or, on pickup, look for
    any heart framers and replace lockedexit with exit
    if that was the last one)
*** minotaur
*** dalek
*** more stuff controlled by wires and buttons (ie panels)
*** robot that can be controlled by pushbuttons
*** blaster that destroys certain tiles (except blue?) horizontally
    when it receives a pulse.. then we need a "floor sensor" or
    whatever 

** web browser integration?
*** can put <img src="http://localhost:34883/blah"> in pages ...

** "Known Issues"
*** switching color depths while escape is running breaks things
*** can't do multi-user installations on any platform. just have each
    user install for himself
*** SDL computes maximized window size (and mouse pos) incorrectly on
    win32 XP with XP theme