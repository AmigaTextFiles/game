; $VER: Interceptor HD Install-Script V1.0 by Jean-Francois Fabre
; Adapted from an installer from Sentinel

(set GameDir "TestDriveII")

;try to figure out a place where the user usually installs his games
(if (exists "Games:" (noreq) )
    (set @default-dest "Games:")
    (if (exists "SYS:Games" (noreq) )
        (set @default-dest "SYS:Games")
        (if (exists "Work:Games" (noreq) )
            (set @default-dest "Work:Games")
            (if (exists "JEUX:" (noreq) )
               (set @default-dest "JEUX:")
               (set @default-dest "SYS:")
            )
        )
    )
)

;ask the user to select a directory to install the game into
(set default-dest
     (tackon (askdir (prompt "Where would you like " @app-name " installed?\n"
                             "A drawer called " GameDir " will be created.")
                     (help @askdir-help)
                     (default @default-dest)
             )
     GameDir
     )
)
(set @default-dest default-dest)

; Ask the user what to install
(set #install-datadisks
	(askoptions
		(prompt	"What do you want to install ?")
		(help	@askoptions-help)
		(choices
			"Program Disk"
			"California Scenery Disk"
			"European Scenery Disk"
			"Muscle Car Disk"
			"Supercars Car Disk"
		)
	)
)


;create the selected directory
(makedir @default-dest
         (infos)
)

(makedir ("%s/scen1" @default-dest))
(makedir ("%s/scen2" @default-dest))
(makedir ("%s/cars1" @default-dest))
(makedir ("%s/cars2" @default-dest))


(if (BITAND #install-datadisks 1)
    (

        (message "\n\n\n\n\n\nPlease insert Test Drive II disk in any drive")

	;copy the executable so we can locate it

        (copyfiles (source "patchtd2")
                   (dest "ram:")
        )


	(makedir ("%s/scen" @default-dest))
	(makedir ("%s/pics" @default-dest))
	(makedir ("%s/sfx" @default-dest))
	(makedir ("%s/cars" @default-dest))

        (copyfiles (source "tdboot:scen")
                   (dest ("%s/scen" @default-dest))
		   (all)
        )

        (copyfiles (source "tdboot:pics")
                   (dest ("%s/pics" @default-dest))
		   (all)
        )

        (copyfiles (source "tdboot:sfx")
                   (dest ("%s/sfx" @default-dest))
		   (all)
        )

        (copyfiles (source "tdboot:cars")
                   (dest ("%s/cars" @default-dest))
		   (all)
        )

        (copyfiles (source "tdboot:")
                   (dest @default-dest)
		   (choices "cars.dat0" "duel" "disktype.dat" "scen.dat0" "select.dat0")
        )


	;copy all extra files to this directory

        (copyfiles (source "TD2.icon")
                   (dest @default-dest)
		   (newname "TD2.info")
        )

        (copyfiles (source "TD2")
                   (dest @default-dest)
        )

        (copyfiles (source "td2hd.readme.info")
                   (dest @default-dest)
        )

        (copyfiles (source "td2hd.readme")
                   (dest @default-dest)
        )


        (copyfiles (source "DuelHD")
                   (dest @default-dest)
        )

        (copyfiles (source "select.dat0")
                   (dest @default-dest)
        )


	; patch the executable (to remove the protection)

        (if
	       	(= 0 (run ("ram:patchtd2 %s/duel" @default-dest)))
	        ("")
        	(abort "file \"patchtd2\" not found !")
      	)

     )
)


(if (BITAND #install-datadisks 2)
    (

        (message "\n\n\n\n\n\nPlease insert California Challenge Disk in any drive")


	(makedir ("%s/scen1/scen" @default-dest))

        (copyfiles (source "SceneryDisk:scen")
                   (dest ("%s/scen1/scen" @default-dest))
		   (all)
        )

        (copyfiles (source "SceneryDisk:")
                   (dest ("%s/scen1" @default-dest))
		   (choices "disktype.dat" "scen.dat2")

        )

    )

)

(if (BITAND #install-datadisks 4)
    (

        (message "\n\n\n\n\n\nPlease insert European Challenge Disk in any drive")


	(makedir ("%s/scen2/scen" @default-dest))

        (copyfiles (source "euroscene:scen")
                   (dest ("%s/scen2/scen" @default-dest))
		   (all)
        )

        (copyfiles (source "euroscene:")
                   (dest ("%s/scen2" @default-dest))
		   (choices "disktype.dat" "scen.dat2")

        )

    )

)

(if (BITAND #install-datadisks 8)
    (

        (message "\n\n\n\n\n\nPlease insert Muscle Car Disk in any drive")

	(makedir ("%s/cars1/cars" @default-dest))

        (copyfiles (source "Muscle:cars")
                   (dest ("%s/cars1/cars" @default-dest))
		   (all)
        )

        (copyfiles (source "Muscle:")
                   (dest ("%s/cars1" @default-dest))
		   (choices "disktype.dat" "cars.dat1")

        )
    )

)


(if (BITAND #install-datadisks 16)
    (

        (message "\n\n\n\n\n\nPlease insert Super Cars Disk in any drive")


	(makedir ("%s/cars2/cars" @default-dest))


        (copyfiles (source "Cardisk:cars")
                   (dest ("%s/cars2/cars" @default-dest))
		   (all)
        )

        (copyfiles (source "Cardisk:")
                   (dest ("%s/cars2" @default-dest))
		   (choices "disktype.dat" "cars.dat1")
        )

    )

)
