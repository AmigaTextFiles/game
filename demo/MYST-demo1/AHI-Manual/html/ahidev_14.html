<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from ahidev.texinfo on 31 October 1997 -->

<TITLE>Ahi Developers's Guide - Writing To The Device</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="ahidev_1.html">first</A>, <A HREF="ahidev_13.html">previous</A>, <A HREF="ahidev_15.html">next</A>, <A HREF="ahidev_21.html">last</A> section, <A HREF="ahidev_toc.html">table of contents</A>.
<P><HR><P>


<H2><A NAME="SEC28" HREF="ahidev_toc.html#TOC28">Writing To The Device</A></H2>

<P>
<A NAME="IDX105"></A>
<A NAME="IDX106"></A>

</P>
<P>
<A NAME="IDX107"></A>
<A NAME="IDX108"></A>
<A NAME="IDX109"></A>
<A NAME="IDX110"></A>
<A NAME="IDX111"></A>
<A NAME="IDX112"></A>
<A NAME="IDX113"></A>
<A NAME="IDX114"></A>
<A NAME="IDX115"></A>
<A NAME="IDX116"></A>
<A NAME="IDX117"></A>

</P>

<P>
 You write to the device by passing an <CODE>AHIRequest</CODE> to the device with
<CODE>CMD_WRITE</CODE> set in <CODE>io_Command</CODE>, the precedence in
<CODE>io_Message.mn_Node.ln_Pri</CODE>, the number of bytes to be written in
<CODE>io_Length</CODE>, the address of the write buffer set in <CODE>io_Data</CODE>,
the sample format set in <CODE>ahir_Type</CODE>, the desired sample frequency set
in <CODE>ahir_Frequency</CODE>, the desired volume set in <CODE>ahir_Volume</CODE> and
the desired stereo position set in <CODE>ahir_Position</CODE>.  Unless you are
doing double buffering, <CODE>ahir_Link</CODE> should be set to <CODE>NULL</CODE>.
<CODE>io_Length</CODE> must be an even multiple of the sample frame size.

</P>


<H3><A NAME="SEC29" HREF="ahidev_toc.html#TOC29">Double Buffering</A></H3>

<P>
<A NAME="IDX118"></A>

</P>
<P>
 To do double buffering, you need two I/O requests.  Create the second one
by making a copy of the request you used in <CODE>OpenDevice()</CODE>.  Start the
first with <CODE>SendIO()</CODE>.  Set <CODE>ahir_Link</CODE> in the second request to
the address of the first request, and <CODE>SendIO()</CODE> it.  Wait on the
first, fill the first buffer again and repeat, this time with
<CODE>ahir_Link</CODE> of the first buffer set to the address of the second I/O
request.

</P>


<H3><A NAME="SEC30" HREF="ahidev_toc.html#TOC30">Distortion</A></H3>

<P>
<A NAME="IDX119"></A>

</P>
<P>
 The problems with aliasing are present but not as obvious as with reading.
Just make sure your source data is bandlimited correctly, and do not play
samples at a lower frequency than they were recorded.

</P>


<H3><A NAME="SEC31" HREF="ahidev_toc.html#TOC31">Playing multiple sounds at the same time</A></H3>

<P>
 If you want to play several sounds at the same time, just make a new copy
of the I/O request you used in <CODE>OpenDevice()</CODE>, and <CODE>CMD_WRITE</CODE>
it.  The user has set the number of channels available in the preference
tool, and if too many requests are sent to the device the one with lowest
precedence will be muted.  When a request is finished, the muted request
with the highest precedence will be played.  Note that all muted requests
continue to play silently, so the programmer will not have to worry if
there are enough channels or not.

</P>


<H3><A NAME="SEC32" HREF="ahidev_toc.html#TOC32">Suggested precedences</A></H3>

<P>
<A NAME="IDX120"></A>

</P>
<P>
 The precedences to use depend on what kind of sound you are playing.  The
recommended precedences are the same as for <CODE>audio.device</CODE>, listed in
<CITE>AMIGA ROM Kernel Reference manual -- Devices</CITE>.  Reprinted without
permission.  So sue me.

</P>

<PRE>
 Precedences  | Type of sound
 -------------+----------------------------------------------------------
    127       |  Unstoppable.  Sounds first allocated at lower
              | precedencies, then set to this highest level.
    90 - 100  |  Emergencies.  Alert, urgent situation that requires
              | immediate action.
    80 - 90   |  Annunciators.  Attention, bell (CTRL-G).
    75        |  Speech.  Synthesized or recorded speech
              | (narrator.device).
    50 - 70   |  Sonic cues.  Sounds that provide information that is not
              | provided by graphics.  Only the beginning of of each sound
              | should be at this level; the rest should ne set to sound
              | effects level.
   -50 - 50   |  Music program.  Musical notes in a music-oriented program.
              | The higher levels should be used for the attack portions
              | of each note.
   -70 - -50  |  Sound effects.  Sounds used in conjunction with graphics.
              | More important sounds should use higher levels.
   -100 - -80 |  Background.  Theme music and restartable background sounds.
   -128       |  Silence.  Lowest level (freeing the channel completely is
              | preferred).
</PRE>

<P>
 Right.  As you can see, some things do not apply to <CODE>ahi.device</CODE>.
First, there is no way to change the precedence of a playing sound, so the
precedences should be set from the beginning.  Second, it is not
recommended to use the device interface to play music.  However, playing an
audio stream from CD or disk comes very close.  Third, there are no channels
to free in AHI since they are dynamically allocated by the device.

</P>

<P><HR><P>
Go to the <A HREF="ahidev_1.html">first</A>, <A HREF="ahidev_13.html">previous</A>, <A HREF="ahidev_15.html">next</A>, <A HREF="ahidev_21.html">last</A> section, <A HREF="ahidev_toc.html">table of contents</A>.
</BODY>
</HTML>
