; $VER: Installation script for Heretic II Deutsch 1.0 (28. Mai 2002)
; © Thomas `Cojo` Veress
; thx to raven/activision for this fantastic game
; thx to Hyperion Entertainment Software for the fine work on the Amigaport (will we see SIN on the new amigas?! ;-))
; Created with GoldED 5.0

; error handling

(onerror

    (if (> @ioerr 0)

        (
            (message

                ("Es ist ein fehler aufgetreten. Bitte prüfen sie die Logdatei.")
            )
        )
    )

    (exit (quiet))
)

(welcome "Willkommen zur Installation\nder Deutschen Untertitel und Menü Dateien\nfür Heretic II")

(set #copyhelp "Vorerst wird die Installation ihre Original Dateien sichern, dann werden mehre Dateien in den von ihnen gewählten Ordner kopiert\n\nfür Experten: falls nur deutsche Menüs aber keine deutschen Untertitel und pickup messages gewünscht sind, nur die menus.cfg kopieren lassen!")
(set #copy "\nKopieren von Dateien bestätigen\n(der pfad `h2dins:` ist Workaround für Leerzeichen in Pfadnamen!)")

;try to find h2installation....

(if (exists "sys:hereticII" (NOREQ))

    (set @default-dest "sys:hereticII")
)

(if (exists "sys:spiele/hereticII" (NOREQ))

    (set @default-dest "sys:spiele/hereticII")
)

(if (exists "sys:games/hereticII" (NOREQ))

    (set @default-dest "sys:games/hereticII")
)

(if (exists "games:hereticII" (NOREQ))

    (set @default-dest "games:hereticII")
)

(if (exists "spiele:hereticII" (NOREQ))

    (set @default-dest "spiele:hereticII")
)

(if (exists "work:hereticII" (NOREQ))

    (set @default-dest "work:hereticII")
)

(if (exists "work:spiele/hereticII" (NOREQ))

    (set @default-dest "work:spiele/hereticII")
)

(if (exists "work:games/hereticII" (NOREQ))

    (set @default-dest "work:games/hereticII")
)

(if (exists "sys:heretic2" (NOREQ))

    (set @default-dest "sys:heretic2")
)

(if (exists "sys:spiele/heretic2" (NOREQ))

    (set @default-dest "sys:spiele/heretic2")
)

(if (exists "sys:games/heretic2" (NOREQ))

    (set @default-dest "sys:games/heretic2")
)

(if (exists "games:heretic2" (NOREQ))

    (set @default-dest "games:heretic2")
)

(if (exists "spiele:heretic2" (NOREQ))

    (set @default-dest "spiele:heretic2")
)

(if (exists "work:heretic2" (NOREQ))

    (set @default-dest "work:heretic2")
)

(if (exists "work:spiele/heretic2" (NOREQ))

    (set @default-dest "work:spiele/heretic2")
)

(if (exists "work:games/heretic2" (NOREQ))

    (set @default-dest "work:games/heretic2")
)

;ask for h2installation path (filebrowser lists eventually found installationpath if userlev => average)
(set @default-dest

    (askdir

        (prompt "geben sie den Pfad zu ihrem Heretic 2 Verzeichnis an\nzum Beispiel \"Spiele:HereticII\"")

        (help #copyhelp)

        (default @default-dest)
    )
)

;SPACE IN DEST-PATHNAME workaround
;i <censored> cant find any good installer documentation...

(makeassign "h2dins" @default-dest)

(if (exists "h2dins:base/menus.cfg_english")

     (set #result

         (askbool

             (prompt "sie scheinen dieses Paket bereits einmal installiert zu haben\nwollen sie die Englischen Dateien wiederherstellen?")

             (help @askbool-help)

             (choices

                 "jawohl"
                 "nee,nee"
             )

             (default 1)
         )
     )
)

     (if (= #result 1)
       (
        (delete "h2dins:base/menus.cfg" (optional "nofail" "force" "askuser"))
        (delete "h2dins:base/levelmsg.txt" (optional "nofail" "force" "askuser"))
        (delete "h2dins:base/gamemsg.txt" (optional "nofail" "force" "askuser"))
        ;gat ritt of da shit ;)
        (rename "h2dins:base/menus.cfg_english" "h2dins:base/menus.cfg")
        (rename "h2dins:base/gamemsg.txt_english" "h2dins:base/gamemsg.txt")
        (rename "h2dins:base/levelmsg.txt_english" "h2dins:base/levelmsg.txt")

        (exit "Originaldateien wiederhergestellt!")
       )
     )
(if (exists "h2dins:base")

    (
;      (message "Deutsche Dateien werden Installiert...")

        (rename "h2dins:base/menus.cfg" "h2dins:base/menus.cfg_english")
        (rename "h2dins:base/gamemsg.txt" "h2dins:base/gamemsg.txt_english")
        (rename "h2dins:base/levelmsg.txt" "h2dins:base/levelmsg.txt_english")
        ;rename didnt overwrite, so a second install still keeps orig files

        (copyfiles

            (prompt #copy)

            (help #copyhelp)

            (source "base")

            (dest "h2dins:base")

            (infos)

            (all)

            (confirm "expert")

            (optional "oknodelete" "force" "askuser")
        )

    )
    ;else
    (
     (exit "\nSie müssen Heretic 2 bereits installiert haben,\nbzw. den richtigen Ordner auswählen!\n\num einen Ordner auszuwählen zu können, muss der Installer mindestens auf der Benutzerstufe `geübter Benutzer` ausgeführt werden!")
    )
)


(exit "\nSollte ihnen diese Übersetzung nicht zusagen, so rufen sie das Installationsscript erneut auf um die Englischen Dateien wieder herzustellen\n\nViel Spaß wünscht ihnen der ACBB,\nAmigaClub Berlin&Brandenburg")

