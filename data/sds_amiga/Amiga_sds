;build sds pak batch
ECHO "Scourge done Slick by the Quake done Quick team (http://www.planetquake.com/qdq/)"
assign here: ""

;check if user has ixemul.library (requierd for qtools)and use that instead
if exists "libs:ixemul.library"
   echo "found your ixemul.library"
 else
   echo "ixemul.library not found, using generic 020 version"
;add lib to system
  copy >NIL: amigastuff/libs/ixemul.library t:
  assign libs: t: ADD
endif

;copy qtools exe to current folder and assign needed libs
makedir >NIL: t:qtoolslibs
copy >NIL: qtools_files/libs/ t:qtoolslibs ALL
assign libs: t:qtoolslibs ADD

;lets go!
;extract pak contents in sdsmega order, assuming qtools overwrites files
;due to lameness of qtools we need to do a copy & delete orgy to,
;cos qtools adds files the way they are stored on hd with full relative path (it whould even iclude : in filenames .. DOH!!),
;have not found a workaround for this :/

;extract everything from pak
echo "working on pak0.pak"
qtools x pak0.pak
;copy this to new dir
cd pak0.dir
   copy >NIL: ALL #? /
   cd /
   ;delete old dir & file writen by qtools
   delete >NIL: pak0.dir all
   delete >NIL: pak0.idx
if exists pak1.pak
   echo "working on pak1.pak"
   qtools x pak1.pak
   cd pak1.dir
   copy >NIL: ALL #? /
   cd /
   delete >NIL: pak1.dir all
   delete >NIL: pak1.idx
  else echo "no pak1.pak?!"
endif
if exists firstper.pak
   echo "working on firstper.pak"
   qtools x firstper.pak
   cd firstper.dir
   copy >NIL: ALL #? /
   cd /
   delete >NIL: firstper.dir all
   delete >NIL: firstper.idx
  else "echo no firstper.pak (if you got pak2.pak everything is fine)
endif

if exists pak2.pak
   echo "working on pak2.pak"
   qtools x pak2.pak
   cd pak2.dir
   copy >NIL: ALL #? /
   cd /
   delete >NIL: pak2.dir all
   delete >NIL: pak2.idx
  else "no pak2.pak (if you have firstper.pak everything is fine)"
endif

if exists sdslite.pak
   echo "working on sdslite.pak"
   qtools x sdslite.pak
   cd sdslite.dir
   copy >NIL: ALL #? /
   cd /
   delete >NIL: sdslite.dir all
   delete >NIL: sdslite.idx
  else "no lite pak available"
endif

if exists voxjo.pak
   echo "working on voxjo.pak"
   qtools x voxjo.pak
   cd voxjo.dir
   copy >NIL: ALL #? /
   cd /
   delete >NIL: voxjo.dir all
   delete >NIL: voxjo.idx
  else "voxjo pak couldnt be found in current drawer"
endif

if exists "patch.pak"
   echo "working on patch.pak"
   qtools x patch.pak
   cd patch.dir
   copy >NIL: ALL #? /
   cd /
   delete >NIL: patch.dir all
   delete >NIL: patch.idx
  else echo "doh! no patch pak!"
endif

;kill paks and pc stuff

delete >nil: choice.com
delete >nil: counter.bat
delete >nil: firstper.pak
delete >nil: move_pak.bat
delete >nil: pak0.pak
delete >nil: pak1.pak
delete >nil: pak2.pak
delete >nil: patch.pak
delete >nil: sds.bat
delete >nil: sdsfixgl
delete >nil: sdsfixgl.exe
delete >nil: sdsfixgl.hqx
delete >nil: sdslite.pak
delete >nil: voxjo.pak

;lets create a single pak file for everything :)

echo "building single pakfile"
  C:List credits/#? TO T:liste LFORMAT "qtools a credits/%S -o pak0.pak"
  C:List firstper/#? TO T:liste1 LFORMAT "qtools a firstper/%S -o pak0.pak"
  C:List gfx/#? TO T:liste2 LFORMAT "qtools a gfx/%S -o pak0.pak"
  C:List lite/#? TO T:liste3 LFORMAT "qtools a lite/%S -o pak0.pak"
  C:List maps/#? TO T:liste4 LFORMAT "qtools a maps/%S -o pak0.pak"
  C:List movie/#? TO T:liste5 LFORMAT "qtools a movie/%S -o pak0.pak"
  C:List otherdem/#? TO T:liste6 LFORMAT "qtools a otherdem/%S -o pak0.pak"
  C:List progs/count/#? TO T:liste7 LFORMAT "qtools a progs/count/%S -o pak0.pak"
  C:List progs/#? TO T:liste8 LFORMAT "qtools a progs/%S -o pak0.pak" files
  C:List progs/credits/#? TO T:liste9 LFORMAT "qtools a progs/credits/%S -o pak0.pak"
  C:List sound/sds/command/#? TO T:liste10 LFORMAT "qtools a sound/sds/command/%S -o pak0.pak"
  C:List sound/sds/count/#? TO T:liste11 LFORMAT "qtools a sound/sds/count/%S -o pak0.pak"
  C:List sound/sds/enforcer/#? TO T:liste12 LFORMAT "qtools a sound/sds/enforcer/%S -o pak0.pak"
  C:List sound/sds/event/#? TO T:liste13 LFORMAT "qtools a sound/sds/event/%S -o pak0.pak"
  C:List sound/sds/george/#? TO T:liste14 LFORMAT "qtools a sound/sds/george/%S -o pak0.pak"
  C:List sound/sds/levelord/#? TO T:liste15 LFORMAT "qtools a sound/sds/levelord/%S -o pak0.pak"
  C:List sound/sds/marine/#? TO T:liste16 LFORMAT "qtools a sound/sds/marine/%S -o pak0.pak"
  C:List sound/sds/medic/#? TO T:liste17 LFORMAT "qtools a sound/sds/medic/%S -o pak0.pak"
  C:List sound/sds/music/#? TO T:liste18 LFORMAT "qtools a sound/sds/music/%S -o pak0.pak"
  C:List sound/sds/strogg/#? TO T:liste19 LFORMAT "qtools a sound/sds/strogg/%S -o pak0.pak"
  C:List sound/sds/voice/#? TO T:liste20 LFORMAT "qtools a sound/sds/voice/%S -o pak0.pak"
  C:LIST sound/boss2/#? TO T:liste21 LFORMAT "qtools a sound/boss2/%S -o pak0.pak"
  execute t:liste
  execute t:liste1
  execute t:liste2
  execute t:liste3
  execute t:liste4
  execute t:liste5
  execute t:liste6
  execute t:liste7
  execute t:liste8
  execute t:liste9
  execute t:liste10
  execute t:liste11
  execute t:liste12
  execute t:liste13
  execute t:liste14
  execute t:liste15
  execute t:liste16
  execute t:liste17
  execute t:liste18
  execute t:liste19
  execute t:liste20
  execute t:liste21
  qtools a pak2_yes.rc -o pak0.pak
  qtools a progs.dat -o pak0.pak
  qtools a quake.rc -o pak0.pak
  qtools a sds.cfg -o pak0.pak
  qtools a vocals.cfg -o pak0.pak
  qtools a config.cfg -o pak0.pak

;qtools adds hidden flag to pak, remove h bit
c:protect pak0.pak sub h

;whooa shit... lets clean up
echo "cleaning up....."

delete >NIL: t:liste
delete >NIL: t:liste1
delete >NIL: t:liste2
delete >NIL: t:liste3
delete >NIL: t:liste4
delete >NIL: t:liste5
delete >NIL: t:liste6
delete >NIL: t:liste7
delete >NIL: t:liste8
delete >NIL: t:liste9
delete >NIL: t:liste10
delete >NIL: t:liste11
delete >NIL: t:liste12
delete >NIL: t:liste13
delete >NIL: t:liste14
delete >NIL: t:liste15
delete >NIL: t:liste16
delete >NIL: t:liste17
delete >NIL: t:liste18
delete >NIL: t:liste19
delete >NIL: t:liste20
delete >NIL: t:liste21
delete >NIL: credits/ all noreq quiet
delete >NIL: firstper/ all noreq quiet
delete >NIL: gfx/ all noreq quiet
delete >NIL: libs/ all noreq quiet
delete >NIL: lite/ all noreq quiet
delete >NIL: maps/ all noreq quiet
delete >NIL: movie/ all noreq quiet
delete >NIL: otherdem/ all noreq quiet
delete >NIL: progs/ all noreq quiet
delete >NIL: qtools_files/ all noreq quiet
delete >NIL: sound/ all noreq quiet
delete >NIL: amiga_sds
delete >NIL: amiga_sds.info
delete >NIL: config.cfg
delete >NIL: pak2_yes.rc
delete >NIL: progs.dat
delete >NIL: qtools
delete >NIL: quake.rc
delete >NIL: sds.cfg
delete >NIL: vocals.cfg

if exists t:ixemul.library
 delete t:ixemul.library
endif

if exists t:qtoolslibs
 delete >NIL: all t:qtoolslibs/
endif

if exists /hipnotic
 copy sdsfix.68k /
 cd /
 sdsfix.68k
 delete >NIL: sdsfix.68k
 cd here:
 delete >NIL: sdsfix.68k
 else echo "run sdsfix.68k from quake basedir/HIPNOTIC/ to fix cache mismatch problems with glquake and hipnotic"
endif
echo "done!"
wait 2
