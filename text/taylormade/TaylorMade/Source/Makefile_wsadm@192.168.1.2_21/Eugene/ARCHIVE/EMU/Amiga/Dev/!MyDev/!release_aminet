#Makefile for TaylorMade 0.2 (i386-aros) by Eugene aGGreSSor Sobolev

#   Default compile arguments

project = TaylorMade
file_out = taylormade
postfix =
CC = ppc-amigaos-gcc
STRIP=ppc-amigaos-strip
version = 0.2
libs  = -lpdcurses -lsdl -lsdl_gfx -lsdl_image -ltiff -lwebp -ljpeg -lpng -lz -lauto -mcrt=newlib
flags = -O2 -std=c99 -lauto -w

header = taylormade.h
c_files = player.c ui.c
obj = player.o ui.o 

#   AmigaOS 3.1 -- AmigaOS loadseg()ble executable/binary
#   https://github.com/bebbo/amiga-gcc.git
ifeq ($(OS), AOS3)
    postfix=_aos3
    CC=m68k-amigaos-gcc
    STRIP=m68k-amigaos-strip
    libs  = -lpdcurses -lsdl -lz
    flags = -Wall -O3 -lm -m68020-60 -noixemul -fomit-frame-pointer -std=c99 -w
else

#   AmigaOS 4.1 -- ELF 32-bit MSB executable, PowerPC or cisco 4500, version 1 (SYSV), statically linked
#   https://github.com/sba1/adtools
ifeq ($(OS), AOS4)
    postfix=_aos4
    CC=ppc-amigaos-gcc
    STRIP=ppc-amigaos-strip
    libs  = -lpdcurses -lsdl -lsdl_gfx -lsdl_image -ltiff -lwebp -ljpeg -lpng -lz -lauto -mcrt=newlib
    flags = -O2 -std=c99 -lauto -w
else

#   AROS i386 --  ELF 32-bit LSB relocatable, Intel 80386, version 1 (SYSV), not stripped
#   http://archives.aros-exec.org/share/development/cross/gcc-4.2.2-i386-aros-cygwin.tar.bz2
ifeq ($(OS), AROS32)
    postfix=_aros-i386
    CC=i386-aros-gcc
    STRIP=i386-aros-strip --strip-unneeded --remove-section .comment
    libs  = -lpdcurses -lsdl -lsdl_gfx -lsdl_image -ltiff -lwebp -ljpeg -lpng -lz
    flags = -Wall -g
endif
endif
endif

.PHONY: all clean

all : ${file_out} ${header}

${file_out}: ${obj} 
	@echo "Linking!"
	${CC} ${flags} -g ${obj} ${libs} -o ../${file_out}${postfix} 
	@rm *.o -Rf 

${obj}: ${c_files}
	@echo "Compiling!"
	${CC} ${flags} -c ${c_files}

clean: 
	@rm *.o -Rf 
	@rm ../${file_out}${postfix} -Rf
	@echo "Deleting objects and output files"
	@echo "Objects: ${obj} | output file: ${file_out}${postfix}"

clear: clean
