#!/bin/bash
#
# starts Armagetron from the installation directory and keeps it running

echo $$ > $HOME/.armagetron/armagetron-starter.pid

INSTALL=/usr/local/games/armagetron

if test ! -r $HOME/.armagetron ; then
   mkdir $HOME/.armagetron

   if test -r $HOME/.ArmageTronrc ; then
       #migrage very old configuration
       cp $HOME/.ArmageTronrc $HOME/.armagetron/user.cfg
   fi
fi

if test ! -r $HOME/.armagetron/var ; then
    #migrate old configuration
    files=$( ls $HOME/.armagetron )
    mkdir $HOME/.armagetron/var
       
    test "$files" != "" && mv $files $HOME/.armagetron/var
   fi

if test "x$1" = "x-h" ; then
    echo -e "\n\nTo uninstall Armagetron, type armagetron --uninstal."
fi

if test  "x$1" = "x--uninstall" ; then
    $INSTALL/bin/uninstall
else
    while true; do
	echo "$INSTALL/bin/armagetron --datadir $INSTALL --configdir /etc/armagetron --userdatadir $HOME/.armagetron  --daemon $* & jobs -p > $HOME/.armagetron/armagetron.pid ; wait ; echo Terminated" | bash -i
    done
fi
