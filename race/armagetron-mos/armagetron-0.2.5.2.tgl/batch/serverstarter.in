#!/bin/bash
#
# starts @progtitle@ from the installation directory and keeps it running

echo $$ > $HOME/.@prognamebase@/@progname@-starter.pid

INSTALL=@prefix@/games/@progname@

if test ! -r $HOME/.@prognamebase@ ; then
   mkdir $HOME/.@prognamebase@

   if test -r $HOME/.ArmageTronrc ; then
       #migrage very old configuration
       cp $HOME/.ArmageTronrc $HOME/.@prognamebase@/user.cfg
   fi
fi

if test ! -r $HOME/.@prognamebase@/var ; then
    #migrate old configuration
    files=$( ls $HOME/.@prognamebase@ )
    mkdir $HOME/.@prognamebase@/var
       
    test "$files" != "" && mv $files $HOME/.@prognamebase@/var
   fi

if test "x$1" = "x-h" ; then
    echo -e "\n\nTo uninstall @progtitle@, type @progname@ --uninstal."
fi

if test  "x$1" = "x--uninstall" ; then
    $INSTALL/bin/uninstall
else
    while true; do
	echo "$INSTALL/bin/@progname@ --datadir $INSTALL @configdir@ --userdatadir $HOME/.@prognamebase@  --daemon $* & jobs -p > $HOME/.@prognamebase@/@progname@.pid ; wait ; echo Terminated" | bash -i
    done
fi
