<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
   
  <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
  <title>map_format</title>
</head>
<body>
<b><big><big><big> MangoQuest and MangoPeeler file format (.bmq)</big></big></big><big><big><br>
</big></big><big><big> Maps for versions 0.6.3 and 0.6.3a</big></big><big><big><br>
</big></big><i><big> by <a href="mailto:phneutre@mangoquest.org">Cl&eacute;ment
"phneutre" Bourdarias</a>
</big><big><br>
</big><big> Programmer of The Blue Mango Quest</big></i></b><br>
<br>
 In this short text I'll explain the format of the file I use to stock maps.<br>
If you just want to make maps, read the <a href="http://mangoquest.sourceforge.net/doc/mangopeeler.html"><b>
MangoPeeler user's manual</b></a>
.<br>
<br>
 The first thing to know is that maps are compressed using zlib with level 
9 of compression.<br>
Thus, it must be opened with someting like :<br>
<br>
<small>gzFile map_file=0;</small><small><br>
</small><small>if (!(map_file = gzopen(filename, "rb9")))</small><small><br>
</small><small>&nbsp; {</small><small><br>
</small><small>&nbsp;&nbsp;&nbsp; fprintf(stderr, "\nError opening file %s.\n",
filename);</small><small><br>
</small><small>&nbsp;&nbsp;&nbsp; exit(1);</small><small><br>
</small><small>&nbsp; }</small><br>
<br>
 There are two main parts in a map file :<br>
<ul>
  <li>Header (3 chars and 8 integers, that is 19 bytes)</li>
  <li>Datas (map in itself and world geometry)</li>
</ul>
<b><big><big> 1. Header</big></big></b><br>
The header can be called quick description of the map.<br>
<br>
1. The 3 first bytes are <b>3 chars that are used for the map verification.</b>
 They must be respectively <b>'B', 'M' and 'Q'</b>. It they're not, we can
be sure that the map is corrupted.<br>
Then, there is the compatibility number (integer), that is a number for the
version of the map format.<br>
<br>
2. The next 14 bytes are 7 integers that represent, in this order:<br>
<br>
- size of the map (can be 14, 20 or 28)<br>
- world of the map (can be 0, 1, 2 or 3, each number is one of the 4 worlds)<br>
- time limit, in seconds (no limit if 0)<br>
- number of huts, must be &gt; 0<br>
- number of shmolluxes, must be &gt; 0<br>
- number of lives at the beginning of the map<br>
- square of the winning post (no winning post if -1)<br>
<br>
<b><big><big>2. Datas (map and world geometry)</big></big></b><br>
There is two parts in the datas.<br>
<br>
<b><big>1. Map only</big></b><br>
We will note the size of the map <i>S</i>.<br>
A map is a big square of <i>S * S</i> little squares. On each square, we
will put walls and ceiling or walls, and maybe a bonus with his parameter,
and maybe a special object for his parameter. We will need 7 integers. thus
or array will be an <b>array of integers of <i>S</i>*<i>S</i>*7 size</b>.<br>
You can acces to it by a <i>for </i>loop:<br>
<br>
<b><small>int i=0;<br>
for (i = 0; i &lt; S* S* 7; i += 7)</small><small><br>
</small><small>&nbsp; {</small><small><br>
</small><small>&nbsp;&nbsp;&nbsp; </small></b>&nbsp;array[i] &nbsp;is the
<b>ground texture</b> for square i;<br>
&nbsp;&nbsp;&nbsp; array[i + 1] is the <b>ceiling texture</b> for square
i;<br>
&nbsp;&nbsp;&nbsp; array[i + 2] is <b>wall texture</b> for square i;<br>
<br>
&nbsp;&nbsp;&nbsp; array[i + 3] is <b>bonus </b>on square i;<br>
&nbsp;&nbsp;&nbsp; array[i + 4] is <b>bonus parameter</b> on square i;<br>
<br>
&nbsp;&nbsp;&nbsp; array[i + 5] is <b>special object</b> on square i;<br>
&nbsp;&nbsp;&nbsp; array[i + 6] is <b>parameter for special object</b> on
square i;<br>
<b><small>}</small></b><br>
<br>
<b><big>2. World geometry</big></b><br>
(but I won't discuss here how to do a portal engine...)<br>
<br>
The fist datas thare are written are the <u><b>portals.</b></u><br>
- Number of portals (integer)<br>
and, <b>for each portal:</b><br>
- X1 (double)<br>
- Z1 (double)<br>
- X2 (double)<br>
- Z2 (double)<br>
- Type (can be 0 or 1 for Horizontal or Vertical)<br>
- Number (each portal has a number)<br>
<br>
Then, we found the big sectors datas. In each sector, we found :<br>
<br>
</body>
</html>
