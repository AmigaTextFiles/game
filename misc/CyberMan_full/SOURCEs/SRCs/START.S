
HardDisk_LOADER:
	MOVE.L	4.w,A6
	JSR	-150(A6)	;SuperState
	JSR	-132(A6)	;Forbid
	JSR	-120(A6)	;Disable

	LEA.L	$7F000,A0	;A0=DEST
	LEA.L	PROG(PC),A1	;A1=SOURCE
	MOVE.L	#4095,D0	;D0=NUM of BYTEs
.copy	MOVE.B	(A1)+,(A0)+
	SUBQ.L	#1,D0
	BNE.B	.copy
	JMP	$7F000

PROG:
	MOVE.W	#$2700,SR

	MOVEQ	#0,D0
	MOVEC	D0,VBR

	MOVE.W	#$7FFF,$DFF096
	MOVE.W	#$7FFF,$DFF09A
	MOVE.W	#$7FFF,$DFF09C
	MOVE.W	#$7FFF,$DFF09E

	MOVE.B	#$FC,$BFE001
	MOVE.B	#$00,$BFE101
	MOVE.B	#$03,$BFE201
	MOVE.B	#$00,$BFE301
	MOVE.B	#$FF,$BFE401
	MOVE.B	#$FF,$BFE501
	MOVE.B	#$CB,$BFE601
	MOVE.B	#$02,$BFE701
	MOVE.B	#$9E,$BFE801
	MOVE.B	#$04,$BFE901
	MOVE.B	#$00,$BFEA01
	MOVE.B	#$00,$BFEB01
	MOVE.B	#$38,$BFEC01
	MOVE.B	#$7F,$BFED01	;Clear INTs
	MOVE.B	#$88,$BFED01
	MOVE.B	#$21,$BFEE01
	MOVE.B	#$08,$BFEF01

	MOVE.B	#$F7,$BFD000
	MOVE.B	#$3B,$BFD100
	MOVE.B	#$C0,$BFD200
	MOVE.B	#$FF,$BFD300
	MOVE.B	#$CC,$BFD400
	MOVE.B	#$02,$BFD500
	MOVE.B	#$FF,$BFD600
	MOVE.B	#$FF,$BFD700
	MOVE.B	#$7E,$BFD800
	MOVE.B	#$AA,$BFD900
	MOVE.B	#$04,$BFDA00
	MOVE.B	#$00,$BFDB00
	MOVE.B	#$00,$BFDC00
	MOVE.B	#$7F,$BFDD00	;Clear INTs
	MOVE.B	#$84,$BFDD00
	MOVE.B	#$08,$BFDE00
	MOVE.B	#$80,$BFDF00

	MOVE.W	#$1DD8,$DFF040
	MOVE.W	#$0042,$DFF042
	MOVE.W	#$FFFF,$DFF044
	MOVE.W	#$FFFF,$DFF046
	MOVE.W	#$0006,$DFF048
	MOVE.W	#$0064,$DFF04A
	MOVE.W	#$0000,$DFF04C
	MOVE.W	#$327F,$DFF04E
	MOVE.W	#$0000,$DFF050
	MOVE.W	#$307F,$DFF052
	MOVE.W	#$0007,$DFF054
	MOVE.W	#$A419,$DFF056
	MOVE.W	#$0032,$DFF060
	MOVE.W	#$0000,$DFF062
	MOVE.W	#$0000,$DFF064
	MOVE.W	#$0000,$DFF066
	MOVE.W	#$5555,$DFF070
	MOVE.W	#$0000,$DFF072
	MOVE.W	#$0000,$DFF074

	MOVE.L	#$00000000,$DFF080

	MOVE.W	#$3C81,$DFF08E
	MOVE.W	#$04C1,$DFF090
	MOVE.W	#$0038,$DFF092
	MOVE.W	#$00D0,$DFF094
	MOVE.W	#$7FFF,$DFF096
	MOVE.W	#$7FFF,$DFF09C
	MOVE.W	#$7FFF,$DFF09A
	MOVE.W	#$7FFF,$DFF09E
	MOVE.W	#$9100,$DFF09E

	MOVE.W	#$4200,$DFF100
	MOVE.W	#$0000,$DFF102
	MOVE.W	#$0024,$DFF104
	MOVE.W	#$0000,$DFF106	;no AGA
	MOVE.W	#$0000,$DFF108
	MOVE.W	#$0000,$DFF10A

	MOVE.W	#$0000,$DFF1FC	;no AGA
	MOVE.W	#$0020,$DFF1DC	;PAL

.waitb	BTST.B	#6,$DFF002
	BNE.B	.waitb

;	MOVE.L	#$00001000,A0
;	MOVE.L	A0,USP
;	MOVE.L	#$00001000,A7	;SSP

	MOVE.W	#$2000,SR

	LEA.L	$00001000,A0	;A0=DEST
	LEA.L	CHIP,A2		;A2=SOURCE FREEZE
	MOVE.L	#$64400-1,D0	;D0=NUM of BYTEs
.copyC	MOVE.B	(A2)+,(A0)+
	SUBQ.L	#1,D0
	BNE.B	.copyC

	LEA.L	FAST,A0
	MOVE.L	A0,A1
	ADD.L	#$28000,A1
	JMP	(A1)

;*******************
	section	chip,data
CHIP	incbin	EH:game/CyberMan/BINs/chip.$01000
	ds.b	25600
	incbin	EH:game/CyberMan/BINs/chip.$2B000

	section	fast,data
FAST	incbin	EH:game/CyberMan/BINs/fast.$00000	;..$27FFF
	incbin	EH:game/CyberMan/BINs/GAME
check	ds.b	$38000-(check-FAST)
	incbin	EH:game/CyberMan/BINs/fast.$38000

