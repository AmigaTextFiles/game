;*** -*- lisp -*-
;*** mris installation script
;*** $VER: Install 1.1 (13.9.96)© 1996 Christian Stieber

;*** localized strings
(set Default-Manual 1)
(set Default-Catalog 1)
(if (= @language "english")
    ((set #OS-Confirm (cat "Mris requires AmigaOS Release 3.0 or newer.\n"
			   "You are currently running an older release, which means "
			   "mris will not run on your system. Do you want to install "
			   "it anyway?"))
     (set #OS-Error "AmigaOS Release 3.0 or newer is required to run mris.")
     (set #Select-Mris "Please select a place to install mris:")
     (set #Installing-Exec "Installing mris program.")
     (set #Clearing-Tooltypes "Clearing tooltypes.")
     (set #Installing-Sprites "Installing sprites.")
     (set #Installing-Sprites-Help (cat "Mris comes with two sprite sets. If you only "
					"use one gender (mris or msit) at all times, "
					"you don't need both sets.\n"
					"The sprites have to be located in the same drawer "
					"as the program itself.\n\n"
					@copyfiles-help))
     (set #Installing-Gamesupport "Installing gamesupport.library.")
     (set #Installing-Gamesupport-Help (cat "Mris requires a support library called gamesupport.library.\n"
					    "This library should be installed in LIBS: so other games can "
					    "use it as well.\n"
					    "If you don't want it there, you can install it into the same "
					    "drawer that the mris program is in. However, the installation "
					    "script can't do that for you.\n\n"
					    @copylib-help))
     (set #Installing-Gardens "Installing mris gardens.")
     (set #Installing-Gardens-Help (cat "Mris comes with various garden files. "
					"They are not required, although at least "
					"one of them should be installed so you can "
					"play the game.\n\n"
					@copyfiles-help))
     (set #Installing-Catalogs "Installing catalogs.")
     (set #Installing-Manuals "Installing manuals.")
;     (set #Installing-Catalogs-Help (cat "Catalog files must be installed in the "
;					 "\"%s\" or the \"LOCALE:Catalogs\" drawer.\n\n"
;					 @copyfiles-help))
     (set #Settings-Username "Setting default username.")
     (set #Ask-Catalogs (cat "Which languages do you want to install?\n"
			     "German is always available, since it is built into the program."))
     (set #Ask-Catalogs-Help (cat "You only need to install the languages that are actually "
				  "used on your system. There is absolutely no reason to install "
				  "other languages as well.\n\n"
				  @askoptions-help))
     (set #Ask-Manuals "Which manuals do you want to install?")
     (set #Ask-Change-Username (cat "As fas as I can tell, mris will use \"%s\" "
					  "as its default username.\n"
					  "Do you want to use another default username?"))
     (set #Ask-Change-Username-Help (cat "The default username should be the name of the person "
					 "who will be using the game more often than other persons.\n"
					 "Usernames should be full names, such as \"Christian Stieber\" "
					 "or \"Christine Ruf\".\n\n"
					 @askbool-help))
     (set #Ask-Username "Please enter the default username")
     (set #Ask-Username-Help #Ask-Change-Username-Help)
     (set #Ask-mris-drawer (cat "You have selected the drawer \"%s\". "
				"Do you want to create a new drawer for mris inside it?")))
  (if (= @language "deutsch")
      ((set Default-Catalog 0)
       (set #OS-Confirm (cat "Für mris wird AmigaOS 3.0 oder neuer benötigt.\n"
			     "Sie benutzen zur Zeit eine ältere Version, weswegen "
			     "mris auf ihrem System nicht funktionieren wird. "
			     "Möchten sie es dennoch installieren?"))
       (set #OS-Error "Mris benötigt AmigaOS 3.0 oder neuer")
       (set #Select-Mris "Wählen sie einen Platz für mris:")
       (set #Installing-Exec "Installiere das mris Programm.")
       (set #Clearing-Tooltypes "Löschen der Programmmerkmale.")
       (set #Installing-Sprites "Installiere die Sprites.")
       (set #Installing-Sprites-Help (cat "Es gibt zwei Spritesätze für mris. Wenn sie immer "
					  "nur eine Version des Spiels (mris oder msit) verwenden, "
					  "dann brauchen sie nicht beide Sätze.\n"
					  "Die Sprites müssen in demselben Schublade wie das "
					  "Programm selbst liegen.\n\n"
					  @copyfiles-help))
       (set #Installing-Gamesupport "Installiere gamesupport.library.")
       (set #Installing-Gamesupport-Help (cat "Mris benötigt eine Funktionsbibliothek namens gamesupport.library.\n"
					      "Diese Bibliothek sollte in LIBS: installiert werden um eine "
					      "Benutzung durch weitere Spiele zu ermöglichen.\n"
					      "Wenn sie sie dort jedoch nicht haben wollen können sie sie "
					      "in derselben Schublade installieren in der sich auch das "
					      "mris Programm befindet. Allerdings kann das Installationsskript "
					      "dies nicht erledigen.\n\n"
					      @copylib-help))
       (set #Installing-Gardens "Installiere Gartendateien.")
       (set #Installing-Gardens-Help (cat "Es gibt mehrere Gartendateien für mris. "
					  "Sie werden nicht unbedingt benötigt, aber sie "
					  "sollten zumindest eine Datei installieren damit "
					  "das Spiel überhaupt spielbar ist.\n\n"
					  @copyfiles-help))
       (set #Installing-Catalogs "Installiere Catalog-Dateien.")
;       (set #Installing-Catalogs-Help (cat "Catalog-Dateien müssen in der Schublade "
;					   "\"%s\" oder \"LOCALE:Catalogs\" installiert werden.\n\n"
;					   @copyfiles-help))
       (set #Installing-Manuals "Installiere Handbücher.")
       (set #Setting-Username "Setze den Vorgabenamen.")
       (set #Ask-Catalogs (cat "Welche Sprachen möchten sie installieren?\n"
			       "Deutsch ist immer verfügbar, da es fest in das Programm eingebaut ist."))
       (set #Ask-Catalogs-Help (cat "Sie brauchen nur die Sprachen installieren die auf ihrem System "
				    "auch tatsächlich benutzt werden. Es gibt überhaupt keinen Grund "
				    "auch andere Sprachen zu installieren.\n\n"
				    @askoptions-help))
       (set #Ask-Manuals "Welche Handbücher möchten sie installieren?")
       (set #Ask-Change-Username (cat "Soweit ich feststellen kann wird mris den Namen "
				      "\"%s\" als Vorgabe verwenden.\n"
				      "Möchten sie einen anderen Vorgabenamen benutzen?"))
       (set #Ask-Change-Username-Help (cat "Der Vorgabename sollte der Name derjenigen Person sein "
					   "die das Spiel am häufigsten benutzt.\n"
					   "Benutzernamen sollten vollständige Namen, wie z.B. "
					   "\"Christian Stieber\" oder \"Christine Ruf\" sein.\n\n"
					   @askbool-help))
       (set #Ask-Username "Bitte geben sie den Vorgabenamen ein")
       (set #Ask-Username-Help #Ask-Change-Username-Help)
       (set #Ask-mris-drawer (cat "Sie haben die Schublade \"%s\" ausgewählt. "
				  "Möchten sie darin eine Schublade für mris anlegeen?")))))

;*** check OS version
(if (< (/ (getversion) 65536) 39)
    (if (not (askbool (prompt #OS-Confirm)
		      (help @askbool-help)
		      (default 0)))
	(abort #OS-Error)))

;*** check for a better default directory
(set Number 0)
(set Done 0)
(while (not done)
  (if (set New-Dir (select Number "Games:" "Spiele:" ""))
      ((if (= (exists New-Dir (noreq)) 2)
	   ((set @default-dest New-Dir)
	    (set Done 1)))
       (set Number (+ Number 1)))
    (set Done 1)))

;*** get directory to install mris
(set @default-dest (askdir (prompt #Select-Mris)
			   (help @askdir-help)
			   (default @default-dest)
			   (newpath)))

;*** if name doesn't contain mris or msit, ask if we should create a drawer
(if (not (patmatch "#?(mris|msit)#?" @default-dest))
    (if (askbool (prompt (#Ask-mris-drawer @default-dest))
		 (help @askbool-help)
		 (default 1))
	(set @default-dest (tackon @default-dest "mris"))))

;*** install mris executable
(copyfiles (prompt #Installing-Exec)
	   (source "mris")
	   (dest @default-dest)
	   (infos)
	   (optional force askuser))
(tooltype (prompt #Clearing-Tooltypes)
	  (dest (tackon @default-dest "mris"))
	  (settooltype "UP")
	  (settooltype "DOWN")
	  (settooltype "LEFT")
	  (settooltype "RIGHT")
	  (settooltype "THROW")
	  (settooltype "PAUSE")
	  (settooltype "QUIT")
	  (settooltype "ICONIZE")
	  (settooltype "RANDOM")
	  (settooltype "DYNAMIC")
	  (settooltype "USER")
	  (settooltype "PUBSCREEN")
	  (settooltype "SCREEN")
	  (settooltype "JOYSTICK")
	  (settooltype "FONT")
	  (settooltype "MSIT")
	  (settooltype "(UP" "<key description>)")
	  (settooltype "(DOWN" "<key description>)")
	  (settooltype "(LEFT" "<key description>)")
	  (settooltype "(RIGHT" "<key description>)")
	  (settooltype "(THROW" "<key description>)")
	  (settooltype "(PAUSE" "<key description>)")
	  (settooltype "(QUIT" "<key description>)")
	  (settooltype "(ICONIZE" "<key description>)")
	  (settooltype "(RANDOM" "YES or NO)")
	  (settooltype "(DYNAMIC" "YES or NO)")
	  (settooltype "(USER" "<user name>)")
	  (settooltype "(PUBSCREEN" "<public screen name>)")
	  (settooltype "(SCREEN" "<screen description>)")
	  (settooltype "(JOYSTICK" "YES or NO)")
	  (settooltype "(FONT" "<font description>)")
	  (settooltype "(MSIT" "YES or NO)")
	  (setstack 47000)
	  (noposition))

;*** install sprites
(copyfiles (prompt #Installing-Sprites)
	   (help #Installing-Sprites-Help)
	   (source "")
	   (dest @default-dest)
	   (pattern "(mris|msit).sprites")
	   (optional force askuser)
	   (confirm))

;*** install gamesupport.library
(copylib (prompt #Installing-Gamesupport)
	 (help #Installing-Gamesupport-Help)
	 (source "gamesupport.library")
	 (dest "LIBS:")
	 (optional force askuser)
	 (confirm))

;*** install gardens
(copyfiles (prompt #Installing-Gardens)
	   (help #Installing-Gardens-Help)
	   (source "mris gardens")
	   (dest (tackon @default-dest "mris gardens"))
	   (choices "Alphabet" "Digits" "Puzzle")
	   (optional force askuser)
	   (confirm))

;*** install catalogs
(set Catalog-Selection (askoptions (prompt #Ask-Catalogs)
				   (help #Ask-Catalogs-Help)
				   (choices "english")
				   (default Default-Catalog)))
(if Catalog-Selection
    ((set Number 0)
     (set Catalog-Pattern "(%")
     (while (set Catalog (select Number "english" ""))
       ((if (in Catalog-Selection Number)
	    (set Catalog-Pattern (cat Catalog-Pattern "|" Catalog)))
	(set Number (+ Number 1))))
     (set Catalog-Pattern (cat Catalog-Pattern ")"))
     (copyfiles (prompt #Installing-Catalogs)
		(help @copyfiles-help)
		(source "Catalogs")
		(pattern Catalog-Pattern)
		(dest (tackon @default-dest "Catalogs"))
		(optional force askuser)
		(confirm))))

;*** install manuals
(set Manual-Selection (askoptions (prompt #Ask-Manuals)
				  (help @askoptions-help)
				  (choices "english")
				  (default Default-Manual)))
(if Manual-Selection
    ((set Number 0)
     (set Manual-Pattern "(%")
     (while (set Manual (select Number "english" ""))
       ((if (in Manual-Selection Number)
	    (set Manual-Pattern (cat Manual-Pattern "|" Manual)))
	(set Number (+ Number 1))))
     (set Manual-Pattern (cat Manual-Pattern ")"))
     (copyfiles (prompt #Installing-Manuals)
		(help @copyfiles-help)
		(source "Manuals")
		(pattern Manual-Pattern)
		(dest (tackon @default-dest "Manuals"))
		(optional force askuser)
		(confirm))))

;*** set default username
(if @user-level
    ((set Number 0)
     (set Done 0)
     (while (not done)
       (if (set Env-Name (select Number "REALNAME" "USERNAME" "USER" ""))
	   ((if (= (exists (tackon "ENV:" Env-Name)) 1)
		((set Username (getenv Env-Name))
		 (if (> (strlen Username) 4)
		     (set Done 1)
		   (set Username ""))))
	    (set Number (+ Number 1)))
	 (set Done 1)))
     (if Username
	 (set Change-Username (askbool (prompt (#Ask-Change-Username Username))
				       (help #Ask-Change-Username-Help)
				       (default 0)))
       (set Change-Username 1))
     (if Change-Username
	 ((set Username (askstring (prompt #Ask-Username)
				   (help #Ask-Username-Help)
				   (default Username)))
	  (if Username
	      (tooltype (prompt #Setting-Username)
			(dest (tackon @default-dest "mris"))
			(settooltype "USER" Username)
			(settooltype "(USER")))))))
